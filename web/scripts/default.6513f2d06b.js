function ScribeTransport(a){this.SESSION_BUFFER_KEY="ScribeTransport",this.SCRIBE_API_ENDPOINT="/i/jot",this.options={},a&&(this.updateOptions(a),this.registerEventHandlers(a))}function ClientEvent(a){this.scribeContext={},this.scribeData={},this.scribe=function(b,c){var d=a||window.scribeTransport;if(!d)throw new Error("You must create a global scribeTransport variable or pass one into this constructor.");if(!b||typeof b!="object"||c&&typeof c!="object")throw new Error("Invalid terms or data hash argument when calling ClientEvent.scribe().");if(this.scribeContext){var e=typeof this.scribeContext=="function"?this.scribeContext():this.scribeContext;b=$.extend({},e,b)}for(var f in b)b[f]=b[f]&&(""+b[f]).toLowerCase().replace(/_?[^a-z0-9_]+_?/g,"_");d.options.debug&&$.each(["client","action"],function(a,c){if(!b[c])throw new Error("You must specify a "+c+" term in your client_event.")});var c=$.extend({},c);if(this.scribeData){var g=typeof this.scribeData=="function"?this.scribeData():this.scribeData;c=$.extend({},g,c)}c.event_namespace=b,c.triggered_on=c.triggered_on||+(new Date),c.format_version=c.format_version||2,d.send(c,"client_event")}}window.Modernizr=function(a,b,c){function D(a){j.cssText=a}function E(a,b){return D(n.join(a+";")+(b||""))}function F(a,b){return typeof a===b}function G(a,b){return!!~(""+a).indexOf(b)}function H(a,b){for(var d in a){var e=a[d];if(!G(e,"-")&&j[e]!==c)return b=="pfx"?e:!0}return!1}function I(a,b,d){for(var e in a){var f=b[a[e]];if(f!==c)return d===!1?a[e]:F(f,"function")?f.bind(d||b):f}return!1}function J(a,b,c){var d=a.charAt(0).toUpperCase()+a.slice(1),e=(a+" "+p.join(d+" ")+d).split(" ");return F(b,"string")||F(b,"undefined")?H(e,b):(e=(a+" "+q.join(d+" ")+d).split(" "),I(e,b,c))}function K(){e.input=function(c){for(var d=0,e=c.length;d<e;d++)u[c[d]]=c[d]in k;return u.list&&(u.list=!!b.createElement("datalist")&&!!a.HTMLDataListElement),u}("autocomplete autofocus list placeholder max min multiple pattern required step".split(" ")),e.inputtypes=function(a){for(var d=0,e,f,h,i=a.length;d<i;d++)k.setAttribute("type",f=a[d]),e=k.type!=="text",e&&(k.value=l,k.style.cssText="position:absolute;visibility:hidden;",/^range$/.test(f)&&k.style.WebkitAppearance!==c?(g.appendChild(k),h=b.defaultView,e=h.getComputedStyle&&h.getComputedStyle(k,null).WebkitAppearance!=="textfield"&&k.offsetHeight!==0,g.removeChild(k)):/^(search|tel)$/.test(f)||(/^(url|email)$/.test(f)?e=k.checkValidity&&k.checkValidity()===!1:e=k.value!=l)),t[a[d]]=!!e;return t}("search tel url email datetime date month week time datetime-local number range color".split(" "))}var d="2.6.2",e={},f=!0,g=b.documentElement,h="modernizr",i=b.createElement(h),j=i.style,k=b.createElement("input"),l=":)",m={}.toString,n=" -webkit- -moz- -o- -ms- ".split(" "),o="Webkit Moz O ms",p=o.split(" "),q=o.toLowerCase().split(" "),r={svg:"http://www.w3.org/2000/svg"},s={},t={},u={},v=[],w=v.slice,x,y=function(a,c,d,e){var f,i,j,k,l=b.createElement("div"),m=b.body,n=m||b.createElement("body");if(parseInt(d,10))while(d--)j=b.createElement("div"),j.id=e?e[d]:h+(d+1),l.appendChild(j);return f=["&#173;",'<style id="s',h,'">',a,"</style>"].join(""),l.id=h,(m?l:n).innerHTML+=f,n.appendChild(l),m||(n.style.background="",n.style.overflow="hidden",k=g.style.overflow,g.style.overflow="hidden",g.appendChild(n)),i=c(l,a),m?l.parentNode.removeChild(l):(n.parentNode.removeChild(n),g.style.overflow=k),!!i},z=function(b){var c=a.matchMedia||a.msMatchMedia;if(c)return c(b).matches;var d;return y("@media "+b+" { #"+h+" { position: absolute; } }",function(b){d=(a.getComputedStyle?getComputedStyle(b,null):b.currentStyle).position=="absolute"}),d},A=function(){function d(d,e){e=e||b.createElement(a[d]||"div"),d="on"+d;var f=d in e;return f||(e.setAttribute||(e=b.createElement("div")),e.setAttribute&&e.removeAttribute&&(e.setAttribute(d,""),f=F(e[d],"function"),F(e[d],"undefined")||(e[d]=c),e.removeAttribute(d))),e=null,f}var a={select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img"};return d}(),B={}.hasOwnProperty,C;!F(B,"undefined")&&!F(B.call,"undefined")?C=function(a,b){return B.call(a,b)}:C=function(a,b){return b in a&&F(a.constructor.prototype[b],"undefined")},Function.prototype.bind||(Function.prototype.bind=function(a){var b=this;if(typeof b!="function")throw new TypeError;var c=w.call(arguments,1),d=function(){if(this instanceof d){var e=function(){};e.prototype=b.prototype;var f=new e,g=b.apply(f,c.concat(w.call(arguments)));return Object(g)===g?g:f}return b.apply(a,c.concat(w.call(arguments)))};return d}),s.flexbox=function(){return J("flexWrap")},s.flexboxlegacy=function(){return J("boxDirection")},s.canvas=function(){var a=b.createElement("canvas");return!!a.getContext&&!!a.getContext("2d")},s.canvastext=function(){return!!e.canvas&&!!F(b.createElement("canvas").getContext("2d").fillText,"function")},s.webgl=function(){return!!a.WebGLRenderingContext},s.touch=function(){var c;return"ontouchstart"in a||a.DocumentTouch&&b instanceof DocumentTouch?c=!0:y(["@media (",n.join("touch-enabled),("),h,")","{#modernizr{top:9px;position:absolute}}"].join(""),function(a){c=a.offsetTop===9}),c},s.geolocation=function(){return"geolocation"in navigator},s.postmessage=function(){return!!a.postMessage},s.websqldatabase=function(){return!!a.openDatabase},s.indexedDB=function(){return!!J("indexedDB",a)},s.hashchange=function(){return A("hashchange",a)&&(b.documentMode===c||b.documentMode>7)},s.history=function(){return!!a.history&&!!history.pushState},s.draganddrop=function(){var a=b.createElement("div");return"draggable"in a||"ondragstart"in a&&"ondrop"in a},s.websockets=function(){return"WebSocket"in a||"MozWebSocket"in a},s.rgba=function(){return D("background-color:rgba(150,255,150,.5)"),G(j.backgroundColor,"rgba")},s.hsla=function(){return D("background-color:hsla(120,40%,100%,.5)"),G(j.backgroundColor,"rgba")||G(j.backgroundColor,"hsla")},s.multiplebgs=function(){return D("background:url(https://),url(https://),red url(https://)"),/(url\s*\(.*?){3}/.test(j.background)},s.backgroundsize=function(){return J("backgroundSize")},s.borderimage=function(){return J("borderImage")},s.borderradius=function(){return J("borderRadius")},s.boxshadow=function(){return J("boxShadow")},s.textshadow=function(){return b.createElement("div").style.textShadow===""},s.opacity=function(){return E("opacity:.55"),/^0.55$/.test(j.opacity)},s.cssanimations=function(){return J("animationName")},s.csscolumns=function(){return J("columnCount")},s.cssgradients=function(){var a="background-image:",b="gradient(linear,left top,right bottom,from(#9f9),to(white));",c="linear-gradient(left top,#9f9, white);";return D((a+"-webkit- ".split(" ").join(b+a)+n.join(c+a)).slice(0,-a.length)),G(j.backgroundImage,"gradient")},s.cssreflections=function(){return J("boxReflect")},s.csstransforms=function(){return!!J("transform")},s.csstransforms3d=function(){var a=!!J("perspective");return a&&"webkitPerspective"in g.style&&y("@media (transform-3d),(-webkit-transform-3d){#modernizr{left:9px;position:absolute;height:3px;}}",function(b,c){a=b.offsetLeft===9&&b.offsetHeight===3}),a},s.csstransitions=function(){return J("transition")},s.fontface=function(){var a;return y('@font-face {font-family:"font";src:url("https://")}',function(c,d){var e=b.getElementById("smodernizr"),f=e.sheet||e.styleSheet,g=f?f.cssRules&&f.cssRules[0]?f.cssRules[0].cssText:f.cssText||"":"";a=/src/i.test(g)&&g.indexOf(d.split(" ")[0])===0}),a},s.generatedcontent=function(){var a;return y(["#",h,"{font:0/0 a}#",h,':after{content:"',l,'";visibility:hidden;font:3px/1 a}'].join(""),function(b){a=b.offsetHeight>=3}),a},s.video=function(){var a=b.createElement("video"),c=!1;try{if(c=!!a.canPlayType)c=new Boolean(c),c.ogg=a.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,""),c.h264=a.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,""),c.webm=a.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,"")}catch(d){}return c},s.audio=function(){var a=b.createElement("audio"),c=!1;try{if(c=!!a.canPlayType)c=new Boolean(c),c.ogg=a.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),c.mp3=a.canPlayType("audio/mpeg;").replace(/^no$/,""),c.wav=a.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),c.m4a=(a.canPlayType("audio/x-m4a;")||a.canPlayType("audio/aac;")).replace(/^no$/,"")}catch(d){}return c},s.localstorage=function(){try{return localStorage.setItem(h,h),localStorage.removeItem(h),!0}catch(a){return!1}},s.sessionstorage=function(){try{return sessionStorage.setItem(h,h),sessionStorage.removeItem(h),!0}catch(a){return!1}},s.webworkers=function(){return!!a.Worker},s.applicationcache=function(){return!!a.applicationCache},s.svg=function(){return!!b.createElementNS&&!!b.createElementNS(r.svg,"svg").createSVGRect},s.inlinesvg=function(){var a=b.createElement("div");return a.innerHTML="<svg/>",(a.firstChild&&a.firstChild.namespaceURI)==r.svg},s.smil=function(){return!!b.createElementNS&&/SVGAnimate/.test(m.call(b.createElementNS(r.svg,"animate")))},s.svgclippaths=function(){return!!b.createElementNS&&/SVGClipPath/.test(m.call(b.createElementNS(r.svg,"clipPath")))};for(var L in s)C(s,L)&&(x=L.toLowerCase(),e[x]=s[L](),v.push((e[x]?"":"no-")+x));return e.input||K(),e.addTest=function(a,b){if(typeof a=="object")for(var d in a)C(a,d)&&e.addTest(d,a[d]);else{a=a.toLowerCase();if(e[a]!==c)return e;b=typeof b=="function"?b():b,typeof f!="undefined"&&f&&(g.className+=" "+(b?"":"no-")+a),e[a]=b}return e},D(""),i=k=null,function(a,b){function k(a,b){var c=a.createElement("p"),d=a.getElementsByTagName("head")[0]||a.documentElement;return c.innerHTML="x<style>"+b+"</style>",d.insertBefore(c.lastChild,d.firstChild)}function l(){var a=r.elements;return typeof a=="string"?a.split(" "):a}function m(a){var b=i[a[g]];return b||(b={},h++,a[g]=h,i[h]=b),b}function n(a,c,f){c||(c=b);if(j)return c.createElement(a);f||(f=m(c));var g;return f.cache[a]?g=f.cache[a].cloneNode():e.test(a)?g=(f.cache[a]=f.createElem(a)).cloneNode():g=f.createElem(a),g.canHaveChildren&&!d.test(a)?f.frag.appendChild(g):g}function o(a,c){a||(a=b);if(j)return a.createDocumentFragment();c=c||m(a);var d=c.frag.cloneNode(),e=0,f=l(),g=f.length;for(;e<g;e++)d.createElement(f[e]);return d}function p(a,b){b.cache||(b.cache={},b.createElem=a.createElement,b.createFrag=a.createDocumentFragment,b.frag=b.createFrag()),a.createElement=function(c){return r.shivMethods?n(c,a,b):b.createElem(c)},a.createDocumentFragment=Function("h,f","return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&("+l().join().replace(/\w+/g,function(a){return b.createElem(a),b.frag.createElement(a),'c("'+a+'")'})+");return n}")(r,b.frag)}function q(a){a||(a=b);var c=m(a);return r.shivCSS&&!f&&!c.hasCSS&&(c.hasCSS=!!k(a,"article,aside,figcaption,figure,footer,header,hgroup,nav,section{display:block}mark{background:#FF0;color:#000}")),j||p(a,c),a}var c=a.html5||{},d=/^<|^(?:button|map|select|textarea|object|iframe|option|optgroup)$/i,e=/^(?:a|b|code|div|fieldset|h1|h2|h3|h4|h5|h6|i|label|li|ol|p|q|span|strong|style|table|tbody|td|th|tr|ul)$/i,f,g="_html5shiv",h=0,i={},j;(function(){try{var a=b.createElement("a");a.innerHTML="<xyz></xyz>",f="hidden"in a,j=a.childNodes.length==1||function(){b.createElement("a");var a=b.createDocumentFragment();return typeof a.cloneNode=="undefined"||typeof a.createDocumentFragment=="undefined"||typeof a.createElement=="undefined"}()}catch(c){f=!0,j=!0}})();var r={elements:c.elements||"abbr article aside audio bdi canvas data datalist details figcaption figure footer header hgroup mark meter nav output progress section summary time video",shivCSS:c.shivCSS!==!1,supportsUnknownElements:j,shivMethods:c.shivMethods!==!1,type:"default",shivDocument:q,createElement:n,createDocumentFragment:o};a.html5=r,q(b)}(this,b),e._version=d,e._prefixes=n,e._domPrefixes=q,e._cssomPrefixes=p,e.mq=z,e.hasEvent=A,e.testProp=function(a){return H([a])},e.testAllProps=J,e.testStyles=y,e.prefixed=function(a,b,c){return b?J(a,b,c):J(a,"pfx")},g.className=g.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(f?" js "+v.join(" "):""),e}(this,this.document),window.console||(window.console={log:function(){return}});var TD={storage:{},core:{},net:{},mustaches:typeof TD_mustaches=="undefined"?{}:TD_mustaches,templates:{},components:{},services:{},controller:{auth:{}},vo:{},ui:{},sync:{},cache:{}};TD.buildID="1feb57ccef7973c36223bf77b3517c68f43d51f9",TD.buildIDShort="1feb57c",TD.version="3.1.3",TD.config={api_root:"https://api.tweetdeck.com",td_create_key:"WRaMQNHU2Jy51bhFEL3C",td_create_secret:"MiLkmD1t1xlZqKoLLY8ScxX5gwpOQsjBopZcV4KLcuo=",client_name:"blackbird",debug_menu:!1,app_name:"TweetDeck",app_icon:"web/assets/logos/128.png",sync_name:"blackbird"},TD.i=function(){var a=/[^A-Za-z0-9_]/g,b={},c=TD.config.i18n_test_length_ratio||.2,d=TD.config.i18n_test_padding_char||"d";return function(e,f,g){var h,i,j;return typeof e=="string"&&(e={text:e}),TD.util.i18n.getLocale()==="en_US"?i=e.text:(h=b[e.text],h===undefined&&(h=e.text.replace(a,""),b[e.text]=h),i=TD.util.i18n.getMessage(h)||e.text),g||(i=TD.ui.template.toHtml(i,f)),TD.config.i18n_test&&(j=Math.round(i.length*c),i=i+Array(j+1).join(d)),i}}();var Hogan={};(function(a,b){function c(a,b,c){var d,e;return b&&typeof b=="object"&&(b[a]!=null?d=b[a]:c&&b.get&&typeof b.get=="function"&&(d=b.get(a))),d}function d(a,b,c,d){function e(){}function f(){}e.prototype=a,f.prototype=a.subs;var g,h=new e;h.subs=new f,h.subsText={},h.ib();for(g in b)h.subs[g]=b[g],h.subsText[g]=d;for(g in c)h.partials[g]=c[g];return h}function k(a){return String(a===null||a===undefined?"":a)}function l(a){return a=k(a),j.test(a)?a.replace(e,"&amp;").replace(f,"&lt;").replace(g,"&gt;").replace(h,"&#39;").replace(i,"&quot;"):a}a.Template=function(a,b,c,d){a=a||{},this.r=a.code||this.r,this.c=c,this.options=d||{},this.text=b||"",this.partials=a.partials||{},this.subs=a.subs||{},this.ib()},a.Template.prototype={r:function(a,b,c){return""},v:l,t:k,render:function(a,b,c){return this.ri([a],b||{},c)},ri:function(a,b,c){return this.r(a,b,c)},ep:function(a,b){var c=this.partials[a],e=b[c.name];if(c.instance&&c.base==e)return c.instance;if(typeof e=="string"){if(!this.c)throw new Error("No compiler available.");e=this.c.compile(e,this.options)}return e?(this.partials[a].base=e,c.subs&&(this.activeSub===undefined&&(b.stackText=this.text),e=d(e,c.subs,c.partials,b.stackText||this.text)),this.partials[a].instance=e,e):null},rp:function(a,b,c,d){var e=this.ep(a,c);return e?e.ri(b,c,d):""},rs:function(a,b,c){var d=a[a.length-1];if(!m(d)){c(a,b,this);return}for(var e=0;e<d.length;e++)a.push(d[e]),c(a,b,this),a.pop()},s:function(a,b,c,d,e,f,g){var h;return m(a)&&a.length===0?!1:(typeof a=="function"&&(a=this.ms(a,b,c,d,e,f,g)),h=!!a,!d&&h&&b&&b.push(typeof a=="object"?a:b[b.length-1]),h)},d:function(a,b,d,e){var f,g=a.split("."),h=this.f(g[0],b,d,e),i=this.options.modelGet,j=null;if(a==="."&&m(b[b.length-2]))h=b[b.length-1];else for(var k=1;k<g.length;k++)f=c(g[k],h,i),f!=null?(j=h,h=f):h="";return e&&!h?!1:(!e&&typeof h=="function"&&(b.push(j),h=this.mv(h,b,d),b.pop()),h)},f:function(a,b,d,e){var f=!1,g=null,h=!1,i=this.options.modelGet;for(var j=b.length-1;j>=0;j--){g=b[j],f=c(a,g,i);if(f!=null){h=!0;break}}return h?(!e&&typeof f=="function"&&(f=this.mv(f,b,d)),f):e?!1:""},ls:function(a,b,c,d,e){var f=this.options.delimiters;return this.options.delimiters=e,this.b(this.ct(k(a.call(b,d)),b,c)),this.options.delimiters=f,!1},ct:function(a,b,c){if(this.options.disableLambda)throw new Error("Lambda features disabled.");return this.c.compile(a,this.options).render(b,c)},b:b?function(a){this.buf.push(a)}:function(a){this.buf+=a},fl:b?function(){var a=this.buf.join("");return this.buf=[],a}:function(){var a=this.buf;return this.buf="",a},ib:function(){this.buf=b?[]:""},ms:function(a,b,c,d,e,f,g){var h,i=b[b.length-1],j=a.call(i);return typeof j=="function"?d?!0:(h=this.activeSub&&this.subsText[this.activeSub]?this.subsText[this.activeSub]:this.text,this.ls(j,i,c,h.substring(e,f),g)):j},mv:function(a,b,c){var d=b[b.length-1],e=a.call(d);return typeof e=="function"?this.ct(k(e.call(d)),d,c):e},sub:function(a,b,c,d){var e=this.subs[a];e&&(this.activeSub=a,e(b,c,this,d),this.activeSub=!1)}};var e=/&/g,f=/</g,g=/>/g,h=/\'/g,i=/\"/g,j=/[&<>\"\']/,m=Array.isArray||function(a){return Object.prototype.toString.call(a)==="[object Array]"}})(typeof exports!="undefined"?exports:Hogan),function(a){function g(a){a.n.substr(a.n.length-1)==="}"&&(a.n=a.n.substring(0,a.n.length-1))}function h(a){return a.trim?a.trim():a.replace(/^\s*|\s*$/g,"")}function i(a,b,c){if(b.charAt(c)!=a.charAt(0))return!1;for(var d=1,e=a.length;d<e;d++)if(b.charAt(c+d)!=a.charAt(d))return!1;return!0}function k(b,c,d,e){var f=[],g=null,h=null,i=null;h=d[d.length-1];while(b.length>0){i=b.shift();if(!(!h||h.tag!="<"||i.tag in j))throw new Error("Illegal content in < super tag.");if(a.tags[i.tag]<=a.tags.$||l(i,e))d.push(i),i.nodes=k(b,i.tag,d,e);else{if(i.tag=="/"){if(d.length===0)throw new Error("Closing tag without opener: /"+i.n);g=d.pop();if(i.n!=g.n&&!m(i.n,g.n,e))throw new Error("Nesting error: "+g.n+" vs. "+i.n);return g.end=i.i,f}i.tag=="\n"&&(i.last=b.length==0||b[0].tag=="\n")}f.push(i)}if(d.length>0)throw new Error("missing closing tag: "+d.pop().n);return f}function l(a,b){for(var c=0,d=b.length;c<d;c++)if(b[c].o==a.n)return a.tag="#",!0}function m(a,b,c){for(var d=0,e=c.length;d<e;d++)if(c[d].c==a&&c[d].o==b)return!0}function n(a){var b=[];for(var c in a)b.push('"'+q(c)+'": function(c,p,t,i) {'+a[c]+"}");return"{ "+b.join(",")+" }"}function o(a){var b=[];for(var c in a.partials)b.push('"'+q(c)+'":{name:"'+q(a.partials[c].name)+'", '+o(a.partials[c])+"}");return"partials: {"+b.join(",")+"}, subs: "+n(a.subs)}function q(a){return a.replace(f,"\\\\").replace(c,'\\"').replace(d,"\\n").replace(e,"\\r")}function r(a){return~a.indexOf(".")?"d":"f"}function s(a,b){var c="<"+(b.prefix||""),d=c+a.n+p++;return b.partials[d]={name:a.n,partials:{}},b.code+='t.b(t.rp("'+q(d)+'",c,p,"'+(a.indent||"")+'"));',d}function t(a,b){b.code+="t.b(t.t(t."+r(a.n)+'("'+q(a.n)+'",c,p,0)));'}function u(a){return"t.b("+a+");"}var b=/\S/,c=/\"/g,d=/\n/g,e=/\r/g,f=/\\/g;a.tags={"#":1,"^":2,"<":3,$:4,"/":5,"!":6,">":7,"=":8,_v:9,"{":10,"&":11,_t:12},a.scan=function v(c,d){function v(){o.length>0&&(p.push({tag:"_t",text:new String(o)}),o="")}function w(){var c=!0;for(var d=s;d<p.length;d++){c=a.tags[p[d].tag]<a.tags._v||p[d].tag=="_t"&&p[d].text.match(b)===null;if(!c)return!1}return c}function x(a,b){v();if(a&&w())for(var c=s,d;c<p.length;c++)p[c].text&&((d=p[c+1])&&d.tag==">"&&(d.indent=p[c].text.toString()),p.splice(c,1));else b||p.push({tag:"\n"});q=!1,s=p.length}function y(a,b){var c="="+u,d=a.indexOf(c,b),e=h(a.substring(a.indexOf("=",b)+1,d)).split(" ");return t=e[0],u=e[e.length-1],d+c.length-1}var e=c.length,f=0,j=1,k=2,l=f,m=null,n=null,o="",p=[],q=!1,r=0,s=0,t="{{",u="}}";d&&(d=d.split(" "),t=d[0],u=d[1]);for(r=0;r<e;r++)l==f?i(t,c,r)?(--r,v(),l=j):c.charAt(r)=="\n"?x(q):o+=c.charAt(r):l==j?(r+=t.length-1,n=a.tags[c.charAt(r+1)],m=n?c.charAt(r+1):"_v",m=="="?(r=y(c,r),l=f):(n&&r++,l=k),q=r):i(u,c,r)?(p.push({tag:m,n:h(o),otag:t,ctag:u,i:m=="/"?q-t.length:r+u.length}),o="",r+=u.length-1,l=f,m=="{"&&(u=="}}"?r++:g(p[p.length-1]))):o+=c.charAt(r);return x(q,!0),p};var j={_t:!0,"\n":!0,$:!0,"/":!0};a.stringify=function(b,c,d){return"{code: function (c,p,i) { "+a.wrapMain(b.code)+" },"+o(b)+"}"};var p=0;a.generate=function(b,c,d){p=0;var e={code:"",subs:{},partials:{}};return a.walk(b,e),d.asString?this.stringify(e,c,d):this.makeTemplate(e,c,d)},a.wrapMain=function(a){return'var t=this;t.b(i=i||"");'+a+"return t.fl();"},a.template=a.Template,a.makeTemplate=function(a,b,c){var d=this.makePartials(a);return d.code=new Function("c","p","i",this.wrapMain(a.code)),new this.template(d,b,this,c)},a.makePartials=function(a){var b,c={subs:{},partials:a.partials,name:a.name};for(b in c.partials)c.partials[b]=this.makePartials(c.partials[b]);for(b in a.subs)c.subs[b]=new Function("c","p","t","i",a.subs[b]);return c},a.codegen={"#":function(b,c){c.code+="if(t.s(t."+r(b.n)+'("'+q(b.n)+'",c,p,1),'+"c,p,0,"+b.i+","+b.end+',"'+b.otag+" "+b.ctag+'")){'+"t.rs(c,p,"+"function(c,p,t){",a.walk(b.nodes,c),c.code+="});c.pop();}"},"^":function(b,c){c.code+="if(!t.s(t."+r(b.n)+'("'+q(b.n)+'",c,p,1),c,p,1,0,0,"")){',a.walk(b.nodes,c),c.code+="};"},">":s,"<":function(b,c){var d={partials:{},code:"",subs:{},inPartial:!0};a.walk(b.nodes,d);var e=c.partials[s(b,c)];e.subs=d.subs,e.partials=d.partials},$:function(b,c){var d={subs:{},code:"",partials:c.partials,prefix:b.n};a.walk(b.nodes,d),c.subs[b.n]=d.code,c.inPartial||(c.code+='t.sub("'+q(b.n)+'",c,p,i);')},"\n":function(a,b){b.code+=u('"\\n"'+(a.last?"":" + i"))},_v:function(a,b){b.code+="t.b(t.v(t."+r(a.n)+'("'+q(a.n)+'",c,p,0)));'},_t:function(a,b){b.code+=u('"'+q(a.text)+'"')},"{":t,"&":t},a.walk=function(b,c){var d;for(var e=0,f=b.length;e<f;e++)d=a.codegen[b[e].tag],d&&d(b[e],c);return c},a.parse=function(a,b,c){return c=c||{},k(a,"",[],c.sectionTags||[])},a.cache={},a.cacheKey=function(a,b){return[a,!!b.asString,!!b.disableLambda,b.delimiters,!!b.modelGet].join("||")},a.compile=function(b,c){c=c||{};var d=a.cacheKey(b,c),e=this.cache[d];return e?e:(e=this.generate(this.parse(this.scan(b,c.delimiters),b,c),b,c),this.cache[d]=e)}}(typeof exports!="undefined"?exports:Hogan),ScribeTransport.prototype={flush:function(a,b){if(!a||!a.length)return;b===undefined&&(b=!!this.options.sync);if(this.options.useAjax){var c={url:this.options.url,data:$.extend(this.ajaxParams(a),this.options.requestParameters),type:"POST",dataType:"json",async:!b,headers:{"X-Twitter-Polling":!0}};this.options.debug&&(this.options.debugHandler&&(c.success=this.options.debugHandler),c.data.debug="1"),$.ajax(c)}else{var d=this.options.debug?"&debug=1":"";(new Image).src=this.options.url+"?q="+(+(new Date)).toString().slice(-4)+d+"&"+this.imageParams(a)}this.reset()},ajaxParams:function(a){if(typeof a=="string")return{log:"["+a+"]"};var b=this.options.encodeParameters;return b&&typeof b=="function"?b.apply(this,arguments):{log:JSON.stringify(a)}},imageParams:function(a){if(typeof a=="string")return"log=%5B"+a+"%5D";var b=this.options.encodeParameters;return b&&typeof b=="function"?b.apply(this,arguments):"log="+encodeURIComponent(JSON.stringify(a))},reset:function(){this.options.bufferEvents&&(this.skipUnloadFlush=!1,sessionStorage.removeItem(this.options.bufferKey))},getBuffer:function(){return sessionStorage.getItem(this.options.bufferKey)||""},send:function(a,b,c){if(!b||!a||this.options.bufferSize<0)return;a._category_=b;if(c||!this.options.bufferEvents||!this.options.bufferSize)this.flush([a],c);else{var d=JSON.stringify(a);this.options.useAjax||(d=encodeURIComponent(d));var e=this.getBuffer(),f=e+(e?this.SEPARATOR+d:d);this.options.bufferSize&&this.fullBuffer(f)?this.options.useAjax?this.flush(f):(this.flush(e),sessionStorage.setItem(this.options.bufferKey,d)):sessionStorage.setItem(this.options.bufferKey,f)}this.options.debug&&$(document).trigger("scribedata."+this.options.bufferKey,a),this.options.metrics&&a.event_info!="debug"&&$(document).trigger("debugscribe",a)},fullBuffer:function(a){return a.length>=(this.options.useAjax?this.options.bufferSize*2083:2050-this.options.url.length)},updateOptions:function(a){this.options=$.extend({},this.options,a),this.options.requestParameters||(this.options.requestParameters={}),this.options.flushOnUnload===undefined&&(this.options.flushOnUnload=!0),this.options.bufferKey||(this.options.bufferKey=this.SESSION_BUFFER_KEY),this.options.bufferSize===0&&(this.options.bufferEvents=!1),this.options.useAjax===undefined&&(this.options.useAjax=!0);if(this.options.bufferEvents||this.options.bufferEvents==undefined)try{sessionStorage.setItem(this.SESSION_BUFFER_KEY+".init","test");var b=sessionStorage.getItem(this.SESSION_BUFFER_KEY+".init")=="test";sessionStorage.removeItem(this.SESSION_BUFFER_KEY+".init"),this.options.bufferEvents=b}catch(c){this.options.bufferEvents=!1}if(this.options.debug&&!this.options.debugHandler){var d=this;this.options.debugHandler=a.debugHandler||function(a){$(document).trigger("handlescribe."+d.options.bufferKey,a)}}var e=window.location.protocol==="https:"?"https:":"http:";this.options.url===undefined?this.options.useAjax?this.options.url=this.SCRIBE_API_ENDPOINT:this.options.url="https://twitter.com"+this.SCRIBE_API_ENDPOINT:this.options.url=this.options.url.replace(/^[a-z]+:/g,e).replace(/\/$/,""),this.options.bufferEvents&&this.options.bufferSize===undefined&&(this.options.bufferSize=20)},appHost:function(){return window.location.host},registerEventHandlers:function(){var a=this,b=$(document);if(this.options.bufferEvents){b.on("flushscribe."+a.options.bufferKey,function(b){a.flush(a.getBuffer(),!0)});if(this.options.flushOnUnload){var c=function(b){a.skipUnloadFlush=!b||!b.match(/http/)||!!b.match(new RegExp("^https?://"+a.appHost(),"gi")),a.skipUnloadFlush&&window.setTimeout(function(){a.skipUnloadFlush=!1},3e3)};b.on("mouseup."+this.options.bufferKey,"a",function(a){if(this.getAttribute("target")||a.button||a.metaKey||a.shiftKey||a.altKey||a.ctrlKey)return;c(this.getAttribute("href"))}),b.on("submit."+this.options.bufferKey,"form",function(a){c(this.getAttribute("action"))}),b.on("uiNavigate."+this.options.bufferKey,function(a,b){c(b.url)}),$(window).on("unload."+this.options.bufferKey,function(){a.skipUnloadFlush||a.flush(a.getBuffer(),!0),a.skipUnloadFlush=!1})}}this.SEPARATOR=this.options.useAjax?",":encodeURIComponent(",")},destroy:function(){this.flush(this.getBuffer()),$(document).off("flushscribe."+this.options.bufferKey),$(window).off("unload."+this.options.bufferKey),$(document).off("mouseup."+this.options.bufferKey),$(document).off("submit."+this.options.bufferKey),$(document).off("uiNavigate."+this.options.bufferKey)}},function(a,b){function c(a){return K.isWindow(a)?a:a.nodeType===9?a.defaultView||a.parentWindow:!1}function d(a){if(!cp[a]){var b=H.body,c=K("<"+a+">").appendTo(b),d=c.css("display");c.remove();if(d==="none"||d===""){cq||(cq=H.createElement("iframe"),cq.frameBorder=cq.width=cq.height=0),b.appendChild(cq);if(!cr||!cq.createElement)cr=(cq.contentWindow||cq.contentDocument).document,cr.write((H.compatMode==="CSS1Compat"?"<!doctype html>":"")+"<html><body>"),cr.close();c=cr.createElement(a),cr.body.appendChild(c),d=K.css(c,"display"),b.removeChild(cq)}cp[a]=d}return cp[a]}function e(a,b){var c={};return K.each(cv.concat.apply([],cv.slice(0,b)),function(){c[this]=a}),c}function f(){cw=b}function g(){return setTimeout(f,0),cw=K.now()}function h(){try{return new a.ActiveXObject("Microsoft.XMLHTTP")}catch(b){}}function i(){try{return new a.XMLHttpRequest}catch(b){}}function j(a,c){a.dataFilter&&(c=a.dataFilter(c,a.dataType));var d=a.dataTypes,e={},f,g,h=d.length,i,j=d[0],k,l,m,n,o;for(f=1;f<h;f++){if(f===1)for(g in a.converters)typeof g=="string"&&(e[g.toLowerCase()]=a.converters[g]);k=j,j=d[f];if(j==="*")j=k;else if(k!=="*"&&k!==j){l=k+" "+j,m=e[l]||e["* "+j];if(!m){o=b;for(n in e){i=n.split(" ");if(i[0]===k||i[0]==="*"){o=e[i[1]+" "+j];if(o){n=e[n],n===!0?m=o:o===!0&&(m=n);break}}}}!m&&!o&&K.error("No conversion from "+l.replace(" "," to ")),m!==!0&&(c=m?m(c):o(n(c)))}}return c}function k(a,c,d){var e=a.contents,f=a.dataTypes,g=a.responseFields,h,i,j,k;for(i in g)i in d&&(c[g[i]]=d[i]);while(f[0]==="*")f.shift(),h===b&&(h=a.mimeType||c.getResponseHeader("content-type"));if(h)for(i in e)if(e[i]&&e[i].test(h)){f.unshift(i);break}if(f[0]in d)j=f[0];else{for(i in d){if(!f[0]||a.converters[i+" "+f[0]]){j=i;break}k||(k=i)}j=j||k}if(j)return j!==f[0]&&f.unshift(j),d[j]}function l(a,b,c,d){if(K.isArray(b))K.each(b,function(b,e){c||bR.test(a)?d(a,e):l(a+"["+(typeof e=="object"||K.isArray(e)?b:"")+"]",e,c,d)});else if(!c&&b!=null&&typeof b=="object")for(var e in b)l(a+"["+e+"]",b[e],c,d);else d(a,b)}function m(a,c){var d,e,f=K.ajaxSettings.flatOptions||{};for(d in c)c[d]!==b&&((f[d]?a:e||(e={}))[d]=c[d]);e&&K.extend(!0,a,e)}function n(a,c,d,e,f,g){f=f||c.dataTypes[0],g=g||{},g[f]=!0;var h=a[f],i=0,j=h?h.length:0,k=a===ce,l;for(;i<j&&(k||!l);i++)l=h[i](c,d,e),typeof l=="string"&&(!k||g[l]?l=b:(c.dataTypes.unshift(l),l=n(a,c,d,e,l,g)));return(k||!l)&&!g["*"]&&(l=n(a,c,d,e,"*",g)),l}function o(a){return function(b,c){typeof b!="string"&&(c=b,b="*");if(K.isFunction(c)){var d=b.toLowerCase().split(ca),e=0,f=d.length,g,h,i;for(;e<f;e++)g=d[e],i=/^\+/.test(g),i&&(g=g.substr(1)||"*"),h=a[g]=a[g]||[],h[i?"unshift":"push"](c)}}}function p(a,b,c){var d=b==="width"?a.offsetWidth:a.offsetHeight,e=b==="width"?bL:bM,f=0,g=e.length;if(d>0){if(c!=="border")for(;f<g;f++)c||(d-=parseFloat(K.css(a,"padding"+e[f]))||0),c==="margin"?d+=parseFloat(K.css(a,c+e[f]))||0:d-=parseFloat(K.css(a,"border"+e[f]+"Width"))||0;return d+"px"}d=bN(a,b,b);if(d<0||d==null)d=a.style[b]||0;d=parseFloat(d)||0;if(c)for(;f<g;f++)d+=parseFloat(K.css(a,"padding"+e[f]))||0,c!=="padding"&&(d+=parseFloat(K.css(a,"border"+e[f]+"Width"))||0),c==="margin"&&(d+=parseFloat(K.css(a,c+e[f]))||0);return d+"px"}function q(a,b){b.src?K.ajax({url:b.src,async:!1,dataType:"script"}):K.globalEval((b.text||b.textContent||b.innerHTML||"").replace(bB,"/*$0*/")),b.parentNode&&b.parentNode.removeChild(b)}function r(a){var b=H.createElement("div");return bD.appendChild(b),b.innerHTML=a.outerHTML,b.firstChild}function s(a){var b=(a.nodeName||"").toLowerCase();b==="input"?t(a):b!=="script"&&typeof a.getElementsByTagName!="undefined"&&K.grep(a.getElementsByTagName("input"),t)}function t(a){if(a.type==="checkbox"||a.type==="radio")a.defaultChecked=a.checked}function u(a){return typeof a.getElementsByTagName!="undefined"?a.getElementsByTagName("*"):typeof a.querySelectorAll!="undefined"?a.querySelectorAll("*"):[]}function v(a,b){var c;if(b.nodeType===1){b.clearAttributes&&b.clearAttributes(),b.mergeAttributes&&b.mergeAttributes(a),c=b.nodeName.toLowerCase();if(c==="object")b.outerHTML=a.outerHTML;else if(c!=="input"||a.type!=="checkbox"&&a.type!=="radio"){if(c==="option")b.selected=a.defaultSelected;else if(c==="input"||c==="textarea")b.defaultValue=a.defaultValue}else a.checked&&(b.defaultChecked=b.checked=a.checked),b.value!==a.value&&(b.value=a.value);b.removeAttribute(K.expando)}}function w(a,b){if(b.nodeType===1&&!!K.hasData(a)){var c,d,e,f=K._data(a),g=K._data(b,f),h=f.events;if(h){delete g.handle,g.events={};for(c in h)for(d=0,e=h[c].length;d<e;d++)K.event.add(b,c+(h[c][d].namespace?".":"")+h[c][d].namespace,h[c][d],h[c][d].data)}g.data&&(g.data=K.extend({},g.data))}}function x(a,b){return K.nodeName(a,"table")?a.getElementsByTagName("tbody")[0]||a.appendChild(a.ownerDocument.createElement("tbody")):a}function y(a){var b=bp.split("|"),c=a.createDocumentFragment();if(c.createElement)while(b.length)c.createElement(b.pop());return c}function z(a,b,c){b=b||0;if(K.isFunction(b))return K.grep(a,function(a,d){var e=!!b.call(a,d,a);return e===c});if(b.nodeType)return K.grep(a,function(a,d){return a===b===c});if(typeof b=="string"){var d=K.grep(a,function(a){return a.nodeType===1});if(bl.test(b))return K.filter(b,d,!c);b=K.filter(b,d)}return K.grep(a,function(a,d){return K.inArray(a,b)>=0===c})}function A(a){return!a||!a.parentNode||a.parentNode.nodeType===11}function B(){return!0}function C(){return!1}function D(a,b,c){var d=b+"defer",e=b+"queue",f=b+"mark",g=K._data(a,d);g&&(c==="queue"||!K._data(a,e))&&(c==="mark"||!K._data(a,f))&&setTimeout(function(){!K._data(a,e)&&!K._data(a,f)&&(K.removeData(a,d,!0),g.fire())},0)}function E(a){for(var b in a){if(b==="data"&&K.isEmptyObject(a[b]))continue;if(b!=="toJSON")return!1}return!0}function F(a,c,d){if(d===b&&a.nodeType===1){var e="data-"+c.replace(O,"-$1").toLowerCase();d=a.getAttribute(e);if(typeof d=="string"){try{d=d==="true"?!0:d==="false"?!1:d==="null"?null:K.isNumeric(d)?parseFloat(d):N.test(d)?K.parseJSON(d):d}catch(f){}K.data(a,c,d)}else d=b}return d}function G(a){var b=L[a]={},c,d;a=a.split(/\s+/);for(c=0,d=a.length;c<d;c++)b[a[c]]=!0;return b}var H=a.document,I=a.navigator,J=a.location,K=function(){function c(){if(!d.isReady){try{H.documentElement.doScroll("left")}catch(a){setTimeout(c,1);return}d.ready()}}var d=function(a,b){return new d.fn.init(a,b,g)},e=a.jQuery,f=a.$,g,h=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,i=/\S/,j=/^\s+/,k=/\s+$/,l=/^<(\w+)\s*\/?>(?:<\/\1>)?$/,m=/^[\],:{}\s]*$/,n=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,o=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,p=/(?:^|:|,)(?:\s*\[)+/g,q=/(webkit)[ \/]([\w.]+)/,r=/(opera)(?:.*version)?[ \/]([\w.]+)/,s=/(msie) ([\w.]+)/,t=/(mozilla)(?:.*? rv:([\w.]+))?/,u=/-([a-z]|[0-9])/ig,v=/^-ms-/,w=function(a,b){return(b+"").toUpperCase()},x=I.userAgent,y,z,A,B=Object.prototype.toString,C=Object.prototype.hasOwnProperty,D=Array.prototype.push,E=Array.prototype.slice,F=String.prototype.trim,G=Array.prototype.indexOf,J={};return d.fn=d.prototype={constructor:d,init:function(a,c,e){var f,g,i,j;if(!a)return this;if(a.nodeType)return this.context=this[0]=a,this.length=1,this;if(a==="body"&&!c&&H.body)return this.context=H,this[0]=H.body,this.selector=a,this.length=1,this;if(typeof a=="string"){a.charAt(0)!=="<"||a.charAt(a.length-1)!==">"||a.length<3?f=h.exec(a):f=[null,a,null];if(f&&(f[1]||!c)){if(f[1])return c=c instanceof d?c[0]:c,j=c?c.ownerDocument||c:H,i=l.exec(a),i?d.isPlainObject(c)?(a=[H.createElement(i[1])],d.fn.attr.call(a,c,!0)):a=[j.createElement(i[1])]:(i=d.buildFragment([f[1]],[j]),a=(i.cacheable?d.clone(i.fragment):i.fragment).childNodes),d.merge(this,a);g=H.getElementById(f[2]);if(g&&g.parentNode){if(g.id!==f[2])return e.find(a);this.length=1,this[0]=g}return this.context=H,this.selector=a,this}return!c||c.jquery?(c||e).find(a):this.constructor(c).find(a)}return d.isFunction(a)?e.ready(a):(a.selector!==b&&(this.selector=a.selector,this.context=a.context),d.makeArray(a,this))},selector:"",jquery:"1.7.1",length:0,size:function(){return this.length},toArray:function(){return E.call(this,0)},get:function(a){return a==null?this.toArray():a<0?this[this.length+a]:this[a]},pushStack:function(a,b,c){var e=this.constructor();return d.isArray(a)?D.apply(e,a):d.merge(e,a),e.prevObject=this,e.context=this.context,b==="find"?e.selector=this.selector+(this.selector?" ":"")+c:b&&(e.selector=this.selector+"."+b+"("+c+")"),e},each:function(a,b){return d.each(this,a,b)},ready:function(a){return d.bindReady(),z.add(a),this},eq:function(a){return a=+a,a===-1?this.slice(a):this.slice(a,a+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(E.apply(this,arguments),"slice",E.call(arguments).join(","))},map:function(a){return this.pushStack(d.map(this,function(b,c){return a.call(b,c,b)}))},end:function(){return this.prevObject||this.constructor(null)},push:D,sort:[].sort,splice:[].splice},d.fn.init.prototype=d.fn,d.extend=d.fn.extend=function(){var a,c,e,f,g,h,i=arguments[0]||{},j=1,k=arguments.length,l=!1;typeof i=="boolean"&&(l=i,i=arguments[1]||{},j=2),typeof i!="object"&&!d.isFunction(i)&&(i={}),k===j&&(i=this,--j);for(;j<k;j++)if((a=arguments[j])!=null)for(c in a){e=i[c],f=a[c];if(i===f)continue;l&&f&&(d.isPlainObject(f)||(g=d.isArray(f)))?(g?(g=!1,h=e&&d.isArray(e)?e:[]):h=e&&d.isPlainObject(e)?e:{},i[c]=d.extend(l,h,f)):f!==b&&(i[c]=f)}return i},d.extend({noConflict:function(b){return a.$===d&&(a.$=f),b&&a.jQuery===d&&(a.jQuery=e),d},isReady:!1,readyWait:1,holdReady:function(a){a?d.readyWait++:d.ready(!0)},ready:function(a){if(a===!0&&!--d.readyWait||a!==!0&&!d.isReady){if(!H.body)return setTimeout(d.ready,1);d.isReady=!0;if(a!==!0&&--d.readyWait>0)return;z.fireWith(H,[d]),d.fn.trigger&&d(H).trigger("ready").off("ready")}},bindReady:function(){if(!z){z=d.Callbacks("once memory");if(H.readyState==="complete")return setTimeout(d.ready,1);if(H.addEventListener)H.addEventListener("DOMContentLoaded",A,!1),a.addEventListener("load",d.ready,!1);else if(H.attachEvent){H.attachEvent("onreadystatechange",A),a.attachEvent("onload",d.ready);var b=!1;try{b=a.frameElement==null}catch(e){}H.documentElement.doScroll&&b&&c()}}},isFunction:function(a){return d.type(a)==="function"},isArray:Array.isArray||function(a){return d.type(a)==="array"},isWindow:function(a){return a&&typeof a=="object"&&"setInterval"in a},isNumeric:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},type:function(a){return a==null?String(a):J[B.call(a)]||"object"},isPlainObject:function(a){if(!a||d.type(a)!=="object"||a.nodeType||d.isWindow(a))return!1;try{if(a.constructor&&!C.call(a,"constructor")&&!C.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(c){return!1}var e;for(e in a);return e===b||C.call(a,e)},isEmptyObject:function(a){for(var b in a)return!1;return!0},error:function(a){throw new Error(a)},parseJSON:function(b){if(typeof b!="string"||!b)return null;b=d.trim(b);if(a.JSON&&a.JSON.parse)return a.JSON.parse(b);if(m.test(b.replace(n,"@").replace(o,"]").replace(p,"")))return(new Function("return "+b))();d.error("Invalid JSON: "+b)},parseXML:function(c){var e,f;try{a.DOMParser?(f=new DOMParser,e=f.parseFromString(c,"text/xml")):(e=new ActiveXObject("Microsoft.XMLDOM"),e.async="false",e.loadXML(c))}catch(g){e=b}return(!e||!e.documentElement||e.getElementsByTagName("parsererror").length)&&d.error("Invalid XML: "+c),e},noop:function(){},globalEval:function(b){b&&i.test(b)&&(a.execScript||function(b){a.eval.call(a,b)})(b)},camelCase:function(a){return a.replace(v,"ms-").replace(u,w)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toUpperCase()===b.toUpperCase()},each:function(a,c,e){var f,g=0,h=a.length,i=h===b||d.isFunction(a);if(e){if(i){for(f in a)if(c.apply(a[f],e)===!1)break}else for(;g<h;)if(c.apply(a[g++],e)===!1)break}else if(i){for(f in a)if(c.call(a[f],f,a[f])===!1)break}else for(;g<h;)if(c.call(a[g],g,a[g++])===!1)break;return a},trim:F?function(a){return a==null?"":F.call(a)}:function(a){return a==null?"":(a+"").replace(j,"").replace(k,"")},makeArray:function(a,b){var c=b||[];if(a!=null){var e=d.type(a);a.length==null||e==="string"||e==="function"||e==="regexp"||d.isWindow(a)?D.call(c,a):d.merge(c,a)}return c},inArray:function(a,b,c){var d;if(b){if(G)return G.call(b,a,c);d=b.length,c=c?c<0?Math.max(0,d+c):c:0;for(;c<d;c++)if(c in b&&b[c]===a)return c}return-1},merge:function(a,c){var d=a.length,e=0;if(typeof c.length=="number")for(var f=c.length;e<f;e++)a[d++]=c[e];else while(c[e]!==b)a[d++]=c[e++];return a.length=d,a},grep:function(a,b,c){var d=[],e;c=!!c;for(var f=0,g=a.length;f<g;f++)e=!!b(a[f],f),c!==e&&d.push(a[f]);return d},map:function(a,c,e){var f,g,h=[],i=0,j=a.length,k=a instanceof d||j!==b&&typeof j=="number"&&(j>0&&a[0]&&a[j-1]||j===0||d.isArray(a));if(k)for(;i<j;i++)f=c(a[i],i,e),f!=null&&(h[h.length]=f);else for(g in a)f=c(a[g],g,e),f!=null&&(h[h.length]=f);return h.concat.apply([],h)},guid:1,proxy:function(a,c){if(typeof c=="string"){var e=a[c];c=a,a=e}if(!d.isFunction(a))return b;var f=E.call(arguments,2),g=function(){return a.apply(c,f.concat(E.call(arguments)))};return g.guid=a.guid=a.guid||g.guid||d.guid++,g},access:function(a,c,e,f,g,h){var i=a.length;if(typeof c=="object"){for(var j in c)d.access(a,j,c[j],f,g,e);return a}if(e!==b){f=!h&&f&&d.isFunction(e);for(var k=0;k<i;k++)g(a[k],c,f?e.call(a[k],k,g(a[k],c)):e,h);return a}return i?g(a[0],c):b},now:function(){return(new Date).getTime()},uaMatch:function(a){a=a.toLowerCase();var b=q.exec(a)||r.exec(a)||s.exec(a)||a.indexOf("compatible")<0&&t.exec(a)||[];return{browser:b[1]||"",version:b[2]||"0"}},sub:function(){function a(b,c){return new a.fn.init(b,c)}d.extend(!0,a,this),a.superclass=this,a.fn=a.prototype=this(),a.fn.constructor=a,a.sub=this.sub,a.fn.init=function(c,e){return e&&e instanceof d&&!(e instanceof a)&&(e=a(e)),d.fn.init.call(this,c,e,b)},a.fn.init.prototype=a.fn;var b=a(H);return a},browser:{}}),d.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(a,b){J["[object "+b+"]"]=b.toLowerCase()}),y=d.uaMatch(x),y.browser&&(d.browser[y.browser]=!0,d.browser.version=y.version),d.browser.webkit&&(d.browser.safari=!0),i.test("Â ")&&(j=/^[\s\xA0]+/,k=/[\s\xA0]+$/),g=d(H),H.addEventListener?A=function(){H.removeEventListener("DOMContentLoaded",A,!1),d.ready()}:H.attachEvent&&(A=function(){H.readyState==="complete"&&(H.detachEvent("onreadystatechange",A),d.ready())}),d}(),L={};K.Callbacks=function(a){a=a?L[a]||G(a):{};var c=[],d=[],e,f,g,h,i,j=function(b){var d,e,f,g,h;for(d=0,e=b.length;d<e;d++)f=b[d],g=K.type(f),g==="array"?j(f):g==="function"&&(!a.unique||!l.has(f))&&c.push(f)},k=function(b,j){j=j||[],e=!a.memory||[b,j],f=!0,i=g||0,g=0,h=c.length;for(;c&&i<h;i++)if(c[i].apply(b,j)===!1&&a.stopOnFalse){e=!0;break}f=!1,c&&(a.once?e===!0?l.disable():c=[]:d&&d.length&&(e=d.shift(),l.fireWith(e[0],e[1])))},l={add:function(){if(c){var a=c.length;j(arguments),f?h=c.length:e&&e!==!0&&(g=a,k(e[0],e[1]))}return this},remove:function(){if(c){var b=arguments,d=0,e=b.length;for(;d<e;d++)for(var g=0;g<c.length;g++)if(b[d]===c[g]){f&&g<=h&&(h--,g<=i&&i--),c.splice(g--,1);if(a.unique)break}}return this},has:function(a){if(c){var b=0,d=c.length;for(;b<d;b++)if(a===c[b])return!0}return!1},empty:function(){return c=[],this},disable:function(){return c=d=e=b,this},disabled:function(){return!c},lock:function(){return d=b,(!e||e===!0)&&l.disable(),this},locked:function(){return!d},fireWith:function(b,c){return d&&(f?a.once||d.push([b,c]):(!a.once||!e)&&k(b,c)),this},fire:function(){return l.fireWith(this,arguments),this},fired:function(){return!!e}};return l};var M=[].slice;K.extend({Deferred:function(a){var b=K.Callbacks("once memory"),c=K.Callbacks("once memory"),d=K.Callbacks("memory"),e="pending",f={resolve:b,reject:c,notify:d},g={done:b.add,fail:c.add,progress:d.add,state:function(){return e},isResolved:b.fired,isRejected:c.fired,then:function(a,b,c){return h.done(a).fail(b).progress(c),this},always:function(){return h.done.apply(h,arguments).fail.apply(h,arguments),this},pipe:function(a,b,c){return K.Deferred(function(d){K.each({done:[a,"resolve"],fail:[b,"reject"],progress:[c,"notify"]},function(a,b){var c=b[0],e=b[1],f;K.isFunction(c)?h[a](function(){f=c.apply(this,arguments),f&&K.isFunction(f.promise)?f.promise().then(d.resolve,d.reject,d.notify):d[e+"With"](this===h?d:this,[f])}):h[a](d[e])})}).promise()},promise:function(a){if(a==null)a=g;else for(var b in g)a[b]=g[b];return a}},h=g.promise({}),i;for(i in f)h[i]=f[i].fire,h[i+"With"]=f[i].fireWith;return h.done(function(){e="resolved"},c.disable,d.lock).fail(function(){e="rejected"},b.disable,d.lock),a&&a.call(h,h),h},when:function(a){function b(a){return function(b){g[a]=arguments.length>1?M.call(arguments,0):b,j.notifyWith(k,g)}}function c(a){return function(b){d[a]=arguments.length>1?M.call(arguments,0):b,--h||j.resolveWith(j,d)}}var d=M.call(arguments,0),e=0,f=d.length,g=Array(f),h=f,i=f,j=f<=1&&a&&K.isFunction(a.promise)?a:K.Deferred(),k=j.promise();if(f>1){for(;e<f;e++)d[e]&&d[e].promise&&K.isFunction(d[e].promise)?d[e].promise().then(c(e),j.reject,b(e)):--h;h||j.resolveWith(j,d)}else j!==a&&j.resolveWith(j,f?[a]:[]);return k}}),K.support=function(){var b,c,d,e,f,g,h,i,j,k,l,m,n,o=H.createElement("div"),p=H.documentElement;o.setAttribute("className","t"),o.innerHTML="   <link/><table></table><a href='/a' style='top:1px;float:left;opacity:.55;'>a</a><input type='checkbox'/>",c=o.getElementsByTagName("*"),d=o.getElementsByTagName("a")[0];if(!c||!c.length||!d)return{};e=H.createElement("select"),f=e.appendChild(H.createElement("option")),g=o.getElementsByTagName("input")[0],b={leadingWhitespace:o.firstChild.nodeType===3,tbody:!o.getElementsByTagName("tbody").length,htmlSerialize:!!o.getElementsByTagName("link").length,style:/top/.test(d.getAttribute("style")),hrefNormalized:d.getAttribute("href")==="/a",opacity:/^0.55/.test(d.style.opacity),cssFloat:!!d.style.cssFloat,checkOn:g.value==="on",optSelected:f.selected,getSetAttribute:o.className!=="t",enctype:!!H.createElement("form").enctype,html5Clone:H.createElement("nav").cloneNode(!0).outerHTML!=="<:nav></:nav>",submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0},g.checked=!0,b.noCloneChecked=g.cloneNode(!0).checked,e.disabled=!0,b.optDisabled=!f.disabled;try{delete o.test}catch(q){b.deleteExpando=!1}!o.addEventListener&&o.attachEvent&&o.fireEvent&&(o.attachEvent("onclick",function(){b.noCloneEvent=!1}),o.cloneNode(!0).fireEvent("onclick")),g=H.createElement("input"),g.value="t",g.setAttribute("type","radio"),b.radioValue=g.value==="t",g.setAttribute("checked","checked"),o.appendChild(g),i=H.createDocumentFragment(),i.appendChild(o.lastChild),b.checkClone=i.cloneNode(!0).cloneNode(!0).lastChild.checked,b.appendChecked=g.checked,i.removeChild(g),i.appendChild(o),o.innerHTML="",a.getComputedStyle&&(h=H.createElement("div"),h.style.width="0",h.style.marginRight="0",o.style.width="2px",o.appendChild(h),b.reliableMarginRight=(parseInt((a.getComputedStyle(h,null)||{marginRight:0}).marginRight,10)||0)===0);if(o.attachEvent)for(m in{submit:1,change:1,focusin:1})l="on"+m,n=l in o,n||(o.setAttribute(l,"return;"),n=typeof o[l]=="function"),b[m+"Bubbles"]=n;return i.removeChild(o),i=e=f=h=o=g=null,K(function(){var a,c,d,e,f,g,h,i,k,l,m,p=H.getElementsByTagName("body")[0];!p||(h=1,i="position:absolute;top:0;left:0;width:1px;height:1px;margin:0;",k="visibility:hidden;border:0;",l="style='"+i+"border:5px solid #000;padding:0;'",m="<div "+l+"><div></div></div>"+"<table "+l+" cellpadding='0' cellspacing='0'>"+"<tr><td></td></tr></table>",a=H.createElement("div"),a.style.cssText=k+"width:0;height:0;position:static;top:0;margin-top:"+h+"px",p.insertBefore(a,p.firstChild),o=H.createElement("div"),a.appendChild(o),o.innerHTML="<table><tr><td style='padding:0;border:0;display:none'></td><td>t</td></tr></table>",j=o.getElementsByTagName("td"),n=j[0].offsetHeight===0,j[0].style.display="",j[1].style.display="none",b.reliableHiddenOffsets=n&&j[0].offsetHeight===0,o.innerHTML="",o.style.width=o.style.paddingLeft="1px",K.boxModel=b.boxModel=o.offsetWidth===2,typeof o.style.zoom!="undefined"&&(o.style.display="inline",o.style.zoom=1,b.inlineBlockNeedsLayout=o.offsetWidth===2,o.style.display="",o.innerHTML="<div style='width:4px;'></div>",b.shrinkWrapBlocks=o.offsetWidth!==2),o.style.cssText=i+k,o.innerHTML=m,c=o.firstChild,d=c.firstChild,f=c.nextSibling.firstChild.firstChild,g={doesNotAddBorder:d.offsetTop!==5,doesAddBorderForTableAndCells:f.offsetTop===5},d.style.position="fixed",d.style.top="20px",g.fixedPosition=d.offsetTop===20||d.offsetTop===15,d.style.position=d.style.top="",c.style.overflow="hidden",c.style.position="relative",g.subtractsBorderForOverflowNotVisible=d.offsetTop===-5,g.doesNotIncludeMarginInBodyOffset=p.offsetTop!==h,p.removeChild(a),o=a=null,K.extend(b,g))}),b}();var N=/^(?:\{.*\}|\[.*\])$/,O=/([A-Z])/g;K.extend({cache:{},uuid:0,expando:"jQuery"+(K.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(a){return a=a.nodeType?K.cache[a[K.expando]]:a[K.expando],!!a&&!E(a)},data:function(a,c,d,e){if(!!K.acceptData(a)){var f,g,h,i=K.expando,j=typeof c=="string",k=a.nodeType,l=k?K.cache:a,m=k?a[i]:a[i]&&i,n=c==="events";if((!m||!l[m]||!n&&!e&&!l[m].data)&&j&&d===b)return;m||(k?a[i]=m=++K.uuid:m=i),l[m]||(l[m]={},k||(l[m].toJSON=K.noop));if(typeof c=="object"||typeof c=="function")e?l[m]=K.extend(l[m],c):l[m].data=K.extend(l[m].data,c);return f=g=l[m],e||(g.data||(g.data={}),g=g.data),d!==b&&(g[K.camelCase(c)]=d),n&&!g[c]?f.events:(j?(h=g[c],h==null&&(h=g[K.camelCase(c)])):h=g,h)}},removeData:function(a,b,c){if(!!K.acceptData(a)){var d,e,f,g=K.expando,h=a.nodeType,i=h?K.cache:a,j=h?a[g]:g;if(!i[j])return;if(b){d=c?i[j]:i[j].data;if(d){K.isArray(b)||(b in d?b=[b]:(b=K.camelCase(b),b in d?b=[b]:b=b.split(" ")));for(e=0,f=b.length;e<f;e++)delete d[b[e]];if(!(c?E:K.isEmptyObject)(d))return}}if(!c){delete i[j].data;if(!E(i[j]))return}K.support.deleteExpando||!i.setInterval?delete i[j]:i[j]=null,h&&(K.support.deleteExpando?delete a[g]:a.removeAttribute?a.removeAttribute(g):a[g]=null)}},_data:function(a,b,c){return K.data(a,b,c,!0)},acceptData:function(a){if(a.nodeName){var b=K.noData[a.nodeName.toLowerCase()];if(b)return b!==!0&&a.getAttribute("classid")===b}return!0}}),K.fn.extend({data:function(a,c){var d,e,f,g=null;if(typeof a=="undefined"){if(this.length){g=K.data(this[0]);if(this[0].nodeType===1&&!K._data(this[0],"parsedAttrs")){e=this[0].attributes;for(var h=0,i=e.length;h<i;h++)f=e[h].name,f.indexOf("data-")===0&&(f=K.camelCase(f.substring(5)),F(this[0],f,g[f]));K._data(this[0],"parsedAttrs",!0)}}return g}return typeof a=="object"?this.each(function(){K.data(this,a)}):(d=a.split("."),d[1]=d[1]?"."+d[1]:"",c===b?(g=this.triggerHandler("getData"+d[1]+"!",[d[0]]),g===b&&this.length&&(g=K.data(this[0],a),g=F(this[0],a,g)),g===b&&d[1]?this.data(d[0]):g):this.each(function(){var b=K(this),e=[d[0],c];b.triggerHandler("setData"+d[1]+"!",e),K.data(this,a,c),b.triggerHandler("changeData"+d[1]+"!",e)}))},removeData:function(a){return this.each(function(){K.removeData(this,a)})}}),K.extend({_mark:function(a,b){a&&(b=(b||"fx")+"mark",K._data(a,b,(K._data(a,b)||0)+1))},_unmark:function(a,b,c){a!==!0&&(c=b,b=a,a=!1);if(b){c=c||"fx";var d=c+"mark",e=a?0:(K._data(b,d)||1)-1;e?K._data(b,d,e):(K.removeData(b,d,!0),D(b,c,"mark"))}},queue:function(a,b,c){var d;if(a)return b=(b||"fx")+"queue",d=K._data(a,b),c&&(!d||K.isArray(c)?d=K._data(a,b,K.makeArray(c)):d.push(c)),d||[]},dequeue:function(a,b){b=b||"fx";var c=K.queue(a,b),d=c.shift(),e={};d==="inprogress"&&(d=c.shift()),d&&(b==="fx"&&c.unshift("inprogress"),K._data(a,b+".run",e),d.call(a,function(){K.dequeue(a,b)},e)),c.length||(K.removeData(a,b+"queue "+b+".run",!0),D(a,b,"queue"))}}),K.fn.extend({queue:function(a,c){return typeof a!="string"&&(c=a,a="fx"),c===b?K.queue(this[0],a):this.each(function(){var b=K.queue(this,a,c);a==="fx"&&b[0]!=="inprogress"&&K.dequeue(this,a)})},dequeue:function(a){return this.each(function(){K.dequeue(this,a)})},delay:function(a,b){return a=K.fx?K.fx.speeds[a]||a:a,b=b||"fx",this.queue(b,function(b,c){var d=setTimeout(b,a);c.stop=function(){clearTimeout(d)}})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,c){function d(){--h||e.resolveWith(f,[f])}typeof a!="string"&&(c=a,a=b),a=a||"fx";var e=K.Deferred(),f=this,g=f.length,h=1,i=a+"defer",j=a+"queue",k=a+"mark",l;while(g--)if(l=K.data(f[g],i,b,!0)||(K.data(f[g],j,b,!0)||K.data(f[g],k,b,!0))&&K.data(f[g],i,K.Callbacks("once memory"),!0))h++,l.add(d);return d(),e.promise()}});var P=/[\n\t\r]/g,Q=/\s+/,R=/\r/g,S=/^(?:button|input)$/i,T=/^(?:button|input|object|select|textarea)$/i,U=/^a(?:rea)?$/i,V=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,W=K.support.getSetAttribute,X,Y,Z;K.fn.extend({attr:function(a,b){return K.access(this,a,b,!0,K.attr)},removeAttr:function(a){return this.each(function(){K.removeAttr(this,a)})},prop:function(a,b){return K.access(this,a,b,!0,K.prop)},removeProp:function(a){return a=K.propFix[a]||a,this.each(function(){try{this[a]=b,delete this[a]}catch(c){}})},addClass:function(a){var b,c,d,e,f,g,h;if(K.isFunction(a))return this.each(function(b){K(this).addClass(a.call(this,b,this.className))});if(a&&typeof a=="string"){b=a.split(Q);for(c=0,d=this.length;c<d;c++){e=this[c];if(e.nodeType===1)if(!e.className&&b.length===1)e.className=a;else{f=" "+e.className+" ";for(g=0,h=b.length;g<h;g++)~f.indexOf(" "+b[g]+" ")||(f+=b[g]+" ");e.className=K.trim(f)}}}return this},removeClass:function(a){var c,d,e,f,g,h,i;if(K.isFunction(a))return this.each(function(b){K(this).removeClass(a.call(this,b,this.className))});if(a&&typeof a=="string"||a===b){c=(a||"").split(Q);for(d=0,e=this.length;d<e;d++){f=this[d];if(f.nodeType===1&&f.className)if(a){g=(" "+f.className+" ").replace(P," ");for(h=0,i=c.length;h<i;h++)g=g.replace(" "+c[h]+" "," ");f.className=K.trim(g)}else f.className=""}}return this},toggleClass:function(a,b){var c=typeof a,d=typeof b=="boolean";return K.isFunction(a)?this.each(function(c){K(this).toggleClass(a.call(this,c,this.className,b),b)}):this.each(function(){if(c==="string"){var e,f=0,g=K(this),h=b,i=a.split(Q);while(e=i[f++])h=d?h:!g.hasClass(e),g[h?"addClass":"removeClass"](e)}else if(c==="undefined"||c==="boolean")this.className&&K._data(this,"__className__",this.className),this.className=this.className||a===!1?"":K._data(this,"__className__")||""})},hasClass:function(a){var b=" "+a+" ",c=0,d=this.length;for(;c<d;c++)if(this[c].nodeType===1&&(" "+this[c].className+" ").replace(P," ").indexOf(b)>-1)return!0;return!1},val:function(a){var c,d,e,f=this[0];if(!!arguments.length)return e=K.isFunction(a),this.each(function(d){var f=K(this),g;if(this.nodeType===1){e?g=a.call(this,d,f.val()):g=a,g==null?g="":typeof g=="number"?g+="":K.isArray(g)&&(g=K.map(g,function(a){return a==null?"":a+""})),c=K.valHooks[this.nodeName.toLowerCase()]||K.valHooks[this.type];if(!c||!("set"in c)||c.set(this,g,"value")===b)this.value=g}});if(f)return c=K.valHooks[f.nodeName.toLowerCase()]||K.valHooks[f.type],c&&"get"in c&&(d=c.get(f,"value"))!==b?d:(d=f.value,typeof d=="string"?d.replace(R,""):d==null?"":d)}}),K.extend({valHooks:{option:{get:function(a){var b=a.attributes.value;return!b||b.specified?a.value:a.text}},select:{get:function(a){var b,c,d,e,f=a.selectedIndex,g=[],h=a.options,i=a.type==="select-one";if(f<0)return null;c=i?f:0,d=i?f+1:h.length;for(;c<d;c++){e=h[c];if(e.selected&&(K.support.optDisabled?!e.disabled:e.getAttribute("disabled")===null)&&(!e.parentNode.disabled||!K.nodeName(e.parentNode,"optgroup"))){b=K(e).val();if(i)return b;g.push(b)}}return i&&!g.length&&h.length?K(h[f]).val():g},set:function(a,b){var c=K.makeArray(b);return K(a).find("option").each(function(){this.selected=K.inArray(K(this).val(),c)>=0}),c.length||(a.selectedIndex=-1),c}}},attrFn:{val:!0,css:!0,html:!0,text:!0,data:!0,width:!0,height:!0,offset:!0},attr:function(a,c,d,e){var f,g,h,i=a.nodeType;if(!!a&&i!==3&&i!==8&&i!==2){if(e&&c in K.attrFn)return K(a)[c](d);if(typeof a.getAttribute=="undefined")return K.prop(a,c,d);h=i!==1||!K.isXMLDoc(a),h&&(c=c.toLowerCase(),g=K.attrHooks[c]||(V.test(c)?Y:X));if(d!==b){if(d===null){K.removeAttr(a,c);return}return g&&"set"in g&&h&&(f=g.set(a,d,c))!==b?f:(a.setAttribute(c,""+d),d)}return g&&"get"in g&&h&&(f=g.get(a,c))!==null?f:(f=a.getAttribute(c),f===null?b:f)}},removeAttr:function(a,b){var c,d,e,f,g=0;if(b&&a.nodeType===1){d=b.toLowerCase().split(Q),f=d.length;for(;g<f;g++)e=d[g],e&&(c=K.propFix[e]||e,K.attr(a,e,""),a.removeAttribute(W?e:c),V.test(e)&&c in a&&(a[c]=!1))}},attrHooks:{type:{set:function(a,b){if(S.test(a.nodeName)&&a.parentNode)K.error("type property can't be changed");else if(!K.support.radioValue&&b==="radio"&&K.nodeName(a,"input")){var c=a.value;return a.setAttribute("type",b),c&&(a.value=c),b}}},value:{get:function(a,b){return X&&K.nodeName(a,"button")?X.get(a,b):b in a?a.value:null},set:function(a,b,c){if(X&&K.nodeName(a,"button"))return X.set(a,b,c);a.value=b}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(a,c,d){var e,f,g,h=a.nodeType;if(!!a&&h!==3&&h!==8&&h!==2)return g=h!==1||!K.isXMLDoc(a),g&&(c=K.propFix[c]||c,f=K.propHooks[c]),d!==b?f&&"set"in f&&(e=f.set(a,d,c))!==b?e:a[c]=d:f&&"get"in f&&(e=f.get(a,c))!==null?e:a[c]},propHooks:{tabIndex:{get:function(a){var c=a.getAttributeNode("tabindex");return c&&c.specified?parseInt(c.value,10):T.test(a.nodeName)||U.test(a.nodeName)&&a.href?0:b}}}}),K.attrHooks.tabindex=K.propHooks.tabIndex,Y={get:function(a,c){var d,e=K.prop(a,c);return e===!0||typeof e!="boolean"&&(d=a.getAttributeNode(c))&&d.nodeValue!==!1?c.toLowerCase():b},set:function(a,b,c){var d;return b===!1?K.removeAttr(a,c):(d=K.propFix[c]||c,d in a&&(a[d]=!0),a.setAttribute(c,c.toLowerCase())),c}},W||(Z={name:!0,id:!0},X=K.valHooks.button={get:function(a,c){var d;return d=a.getAttributeNode(c),d&&(Z[c]?d.nodeValue!=="":d.specified)?d.nodeValue:b},set:function(a,b,c){var d=a.getAttributeNode(c);return d||(d=H.createAttribute(c),a.setAttributeNode(d)),d.nodeValue=b+""}},K.attrHooks.tabindex.set=X.set,K.each(["width","height"],function(a,b){K.attrHooks[b]=K.extend(K.attrHooks[b],{set:function(a,c){if(c==="")return a.setAttribute(b,"auto"),c}})}),K.attrHooks.contenteditable={get:X.get,set:function(a,b,c){b===""&&(b="false"),X.set(a,b,c)}}),K.support.hrefNormalized||K.each(["href","src","width","height"],function(a,c){K.attrHooks[c]=K.extend(K.attrHooks[c],{get:function(a){var d=a.getAttribute(c,2);return d===null?b:d}})}),K.support.style||(K.attrHooks.style={get:function(a){return a.style.cssText.toLowerCase()||b},set:function(a,b){return a.style.cssText=""+b}}),K.support.optSelected||(K.propHooks.selected=K.extend(K.propHooks.selected,{get:function(a){var b=a.parentNode;return b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex),null}})),K.support.enctype||(K.propFix.enctype="encoding"),K.support.checkOn||K.each(["radio","checkbox"],function(){K.valHooks[this]={get:function(a){return a.getAttribute("value")===null?"on":a.value}}}),K.each(["radio","checkbox"],function(){K.valHooks[this]=K.extend(K.valHooks[this],{set:function(a,b){if(K.isArray(b))return a.checked=K.inArray(K(a).val(),b)>=0}})});var $=/^(?:textarea|input|select)$/i,_=/^([^\.]*)?(?:\.(.+))?$/,ba=/\bhover(\.\S+)?\b/,bb=/^key/,bc=/^(?:mouse|contextmenu)|click/,bd=/^(?:focusinfocus|focusoutblur)$/,be=/^(\w*)(?:#([\w\-]+))?(?:\.([\w\-]+))?$/,bf=function(a){var b=be.exec(a);return b&&(b[1]=(b[1]||"").toLowerCase(),b[3]=b[3]&&new RegExp("(?:^|\\s)"+b[3]+"(?:\\s|$)")),b},bg=function(a,b){var c=a.attributes||{};return(!b[1]||a.nodeName.toLowerCase()===b[1])&&(!b[2]||(c.id||{}).value===b[2])&&(!b[3]||b[3].test((c["class"]||{}).value))},bh=function(a){return K.event.special.hover?a:a.replace(ba,"mouseenter$1 mouseleave$1")};K.event={add:function(a,c,d,e,f){var g,h,i,j,k,l,m,n,o,p,q,r;if(!(a.nodeType===3||a.nodeType===8||!c||!d||!(g=K._data(a)))){d.handler&&(o=d,d=o.handler),d.guid||(d.guid=K.guid++),i=g.events,i||(g.events=i={}),h=g.handle,h||(g.handle=h=function(a){return typeof K!="undefined"&&(!a||K.event.triggered!==a.type)?K.event.dispatch.apply(h.elem,arguments):b},h.elem=a),c=K.trim(bh(c)).split(" ");for(j=0;j<c.length;j++){k=_.exec(c[j])||[],l=k[1],m=(k[2]||"").split(".").sort(),r=K.event.special[l]||{},l=(f?r.delegateType:r.bindType)||l,r=K.event.special[l]||{},n=K.extend({type:l,origType:k[1],data:e,handler:d,guid:d.guid,selector:f,quick:bf(f),namespace:m.join(".")},o),q=i[l];if(!q){q=i[l]=[],q.delegateCount=0;if(!r.setup||r.setup.call(a,e,m,h)===!1)a.addEventListener?a.addEventListener(l,h,!1):a.attachEvent&&a.attachEvent("on"+l,h)}r.add&&(r.add.call(a,n),n.handler.guid||(n.handler.guid=d.guid)),f?q.splice(q.delegateCount++,0,n):q.push(n),K.event.global[l]=!0}a=null}},global:{},remove:function(a,b,c,d,e){var f=K.hasData(a)&&K._data(a),g,h,i,j,k,l,m,n,o,p,q,r;if(!!f&&!!(n=f.events)){b=K.trim(bh(b||"")).split(" ");for(g=0;g<b.length;g++){h=_.exec(b[g])||[],i=j=h[1],k=h[2];if(!i){for(i in n)K.event.remove(a,i+b[g],c,d,!0);continue}o=K.event.special[i]||{},i=(d?o.delegateType:o.bindType)||i,q=n[i]||[],l=q.length,k=k?new RegExp("(^|\\.)"+k.split(".").sort().join("\\.(?:.*\\.)?")+"(\\.|$)"):null;for(m=0;m<q.length;m++)r=q[m],(e||j===r.origType)&&(!c||c.guid===r.guid)&&(!k||k.test(r.namespace))&&(!d||d===r.selector||d==="**"&&r.selector)&&(q.splice(m--,1),r.selector&&q.delegateCount--,o.remove&&o.remove.call(a,r));q.length===0&&l!==q.length&&((!o.teardown||o.teardown.call(a,k)===!1)&&K.removeEvent(a,i,f.handle),delete n[i])}K.isEmptyObject(n)&&(p=f.handle,p&&(p.elem=null),K.removeData(a,["events","handle"],!0))}},customEvent:{getData:!0,setData:!0,changeData:!0},trigger:function(c,d,e,f){if(!e||e.nodeType!==3&&e.nodeType!==8){var g=c.type||c,h=[],i,j,k,l,m,n,o,p,q,r;if(bd.test(g+K.event.triggered))return;g.indexOf("!")>=0&&(g=g.slice(0,-1),j=!0),g.indexOf(".")>=0&&(h=g.split("."),g=h.shift(),h.sort());if((!e||K.event.customEvent[g])&&!K.event.global[g])return;c=typeof c=="object"?c[K.expando]?c:new K.Event(g,c):new K.Event(g),c.type=g,c.isTrigger=!0,c.exclusive=j,c.namespace=h.join("."),c.namespace_re=c.namespace?new RegExp("(^|\\.)"+h.join("\\.(?:.*\\.)?")+"(\\.|$)"):null,n=g.indexOf(":")<0?"on"+g:"";if(!e){i=K.cache;for(k in i)i[k].events&&i[k].events[g]&&K.event.trigger(c,d,i[k].handle.elem,!0);return}c.result=b,c.target||(c.target=e),d=d!=null?K.makeArray(d):[],d.unshift(c),o=K.event.special[g]||{};if(o.trigger&&o.trigger.apply(e,d)===!1)return;q=[[e,o.bindType||g]];if(!f&&!o.noBubble&&!K.isWindow(e)){r=o.delegateType||g,l=bd.test(r+g)?e:e.parentNode,m=null;for(;l;l=l.parentNode)q.push([l,r]),m=l;m&&m===e.ownerDocument&&q.push([m.defaultView||m.parentWindow||a,r])}for(k=0;k<q.length&&!c.isPropagationStopped();k++)l=q[k][0],c.type=q[k][1],p=(K._data(l,"events")||{})[c.type]&&K._data(l,"handle"),p&&p.apply(l,d),p=n&&l[n],p&&K.acceptData(l)&&p.apply(l,d)===!1&&c.preventDefault();return c.type=g,!f&&!c.isDefaultPrevented()&&(!o._default||o._default.apply(e.ownerDocument,d)===!1)&&(g!=="click"||!K.nodeName(e,"a"))&&K.acceptData(e)&&n&&e[g]&&(g!=="focus"&&g!=="blur"||c.target.offsetWidth!==0)&&!K.isWindow(e)&&(m=e[n],m&&(e[n]=null),K.event.triggered=g,e[g](),K.event.triggered=b,m&&(e[n]=m)),c.result}},dispatch:function(c){c=K.event.fix(c||a.event);var d=(K._data(this,"events")||{})[c.type]||[],e=d.delegateCount,f=[].slice.call(arguments,0),g=!c.exclusive&&!c.namespace,h=[],i,j,k,l,m,n,o,p,q,r,s;f[0]=c,c.delegateTarget=this;if(e&&!c.target.disabled&&(!c.button||c.type!=="click")){l=K(this),l.context=this.ownerDocument||this;for(k=c.target;k!=this;k=k.parentNode||this){n={},p=[],l[0]=k;for(i=0;i<e;i++)q=d[i],r=q.selector,n[r]===b&&(n[r]=q.quick?bg(k,q.quick):l.is(r)),n[r]&&p.push(q);p.length&&h.push({elem:k,matches:p})}}d.length>e&&h.push({elem:this,matches:d.slice(e)});for(i=0;i<h.length&&!c.isPropagationStopped();i++){o=h[i],c.currentTarget=o.elem;for(j=0;j<o.matches.length&&!c.isImmediatePropagationStopped();j++){q=o.matches[j];if(g||!c.namespace&&!q.namespace||c.namespace_re&&c.namespace_re.test(q.namespace))c.data=q.data,c.handleObj=q,m=((K.event.special[q.origType]||{}).handle||q.handler).apply(o.elem,f),m!==b&&(c.result=m,m===!1&&(c.preventDefault(),c.stopPropagation()))}}return c.result},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(a,b){return a.which==null&&(a.which=b.charCode!=null?b.charCode:b.keyCode),a}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,c){var d,e,f,g=c.button,h=c.fromElement;return a.pageX==null&&c.clientX!=null&&(d=a.target.ownerDocument||H,e=d.documentElement,f=d.body,a.pageX=c.clientX+(e&&e.scrollLeft||f&&f.scrollLeft||0)-(e&&e.clientLeft||f&&f.clientLeft||0),a.pageY=c.clientY+(e&&e.scrollTop||f&&f.scrollTop||0)-(e&&e.clientTop||f&&f.clientTop||0)),!a.relatedTarget&&h&&(a.relatedTarget=h===a.target?c.toElement:h),!a.which&&g!==b&&(a.which=g&1?1:g&2?3:g&4?2:0),a}},fix:function(a){if(a[K.expando])return a;var c,d,e=a,f=K.event.fixHooks[a.type]||{},g=f.props?this.props.concat(f.props):this.props;a=K.Event(e);for(c=g.length;c;)d=g[--c],a[d]=e[d];return a.target||(a.target=e.srcElement||H),a.target.nodeType===3&&(a.target=a.target.parentNode),a.metaKey===b&&(a.metaKey=a.ctrlKey),f.filter?f.filter(a,e):a},special:{ready:{setup:K.bindReady},load:{noBubble:!0},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(a,b,c){K.isWindow(this)&&(this.onbeforeunload=c)},teardown:function(a,b){this.onbeforeunload===b&&(this.onbeforeunload=null)}}},simulate:function(a,b,c,d){var e=K.extend(new K.Event,c,{type:a,isSimulated:!0,originalEvent:{}});d?K.event.trigger(e,null,b):K.event.dispatch.call(b,e),e.isDefaultPrevented()&&c.preventDefault()}},K.event.handle=K.event.dispatch,K.removeEvent=H.removeEventListener?function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)}:function(a,b,c){a.detachEvent&&a.detachEvent("on"+b,c)},K.Event=function(a,b){if(this instanceof K.Event)a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||a.returnValue===!1||a.getPreventDefault&&a.getPreventDefault()?B:C):this.type=a,b&&K.extend(this,b),this.timeStamp=a&&a.timeStamp||K.now(),this[K.expando]=!0;else return new K.Event(a,b)},K.Event.prototype={preventDefault:function(){this.isDefaultPrevented=B;var a=this.originalEvent;!a||(a.preventDefault?a.preventDefault():a.returnValue=!1)},stopPropagation:function(){this.isPropagationStopped=B;var a=this.originalEvent;!a||(a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=B,this.stopPropagation()},isDefaultPrevented:C,isPropagationStopped:C,isImmediatePropagationStopped:C},K.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(a,b){K.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c=this,d=a.relatedTarget,e=a.handleObj,f=e.selector,g;if(!d||d!==c&&!K.contains(c,d))a.type=e.origType,g=e.handler.apply(this,arguments),a.type=b;return g}}}),K.support.submitBubbles||(K.event.special.submit={setup:function(){if(K.nodeName(this,"form"))return!1;K.event.add(this,"click._submit keypress._submit",function(a){var c=a.target,d=K.nodeName(c,"input")||K.nodeName(c,"button")?c.form:b;d&&!d._submit_attached&&(K.event.add(d,"submit._submit",function(a){this.parentNode&&!a.isTrigger&&K.event.simulate("submit",this.parentNode,a,!0)}),d._submit_attached=!0)})},teardown:function(){if(K.nodeName(this,"form"))return!1;K.event.remove(this,"._submit")}}),K.support.changeBubbles||(K.event.special.change={setup:function(){if($.test(this.nodeName)){if(this.type==="checkbox"||this.type==="radio")K.event.add(this,"propertychange._change",function(a){a.originalEvent.propertyName==="checked"&&(this._just_changed=!0)}),K.event.add(this,"click._change",function(a){this._just_changed&&!a.isTrigger&&(this._just_changed=!1,K.event.simulate("change",this,a,!0))});return!1}K.event.add(this,"beforeactivate._change",function(a){var b=a.target;$.test(b.nodeName)&&!b._change_attached&&(K.event.add(b,"change._change",function(a){this.parentNode&&!a.isSimulated&&!a.isTrigger&&K.event.simulate("change",this.parentNode,a,!0)}),b._change_attached=!0)})},handle:function(a){var b=a.target;if(this!==b||a.isSimulated||a.isTrigger||b.type!=="radio"&&b.type!=="checkbox")return a.handleObj.handler.apply(this,arguments)},teardown:function(){return K.event.remove(this,"._change"),$.test(this.nodeName)}}),K.support.focusinBubbles||K.each({focus:"focusin",blur:"focusout"},function(a,b){var c=0,d=function(a){K.event.simulate(b,a.target,K.event.fix(a),!0)};K.event.special[b]={setup:function(){c++===0&&H.addEventListener(a,d,!0)},teardown:function(){--c===0&&H.removeEventListener(a,d,!0)}}}),K.fn.extend({on:function(a,c,d,e,f){var g,h;if(typeof a=="object"){typeof c!="string"&&(d=c,c=b);for(h in a)this.on(h,c,d,a[h],f);return this}d==null&&e==null?(e=c,d=c=b):e==null&&(typeof c=="string"?(e=d,d=b):(e=d,d=c,c=b));if(e===!1)e=C;else if(!e)return this;return f===1&&(g=e,e=function(a){return K().off(a),g.apply(this,arguments)},e.guid=g.guid||(g.guid=K.guid++)),this.each(function(){K.event.add(this,a,e,d,c)})},one:function(a,b,c,d){return this.on.call(this,a,b,c,d,1)},off:function(a,c,d){if(a&&a.preventDefault&&a.handleObj){var e=a.handleObj;return K(a.delegateTarget).off(e.namespace?e.type+"."+e.namespace:e.type,e.selector,e.handler),this}if(typeof a=="object"){for(var f in a)this.off(f,c,a[f]);return this}if(c===!1||typeof c=="function")d=c,c=b;return d===!1&&(d=C),this.each(function(){K.event.remove(this,a,d,c)})},bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},live:function(a,b,c){return K(this.context).on(a,this.selector,b,c),this},die:function(a,b){return K(this.context).off(a,this.selector||"**",b),this},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return arguments.length==1?this.off(a,"**"):this.off(b,a,c)},trigger:function(a,b){return this.each(function(){K.event.trigger(a,b,this)})},triggerHandler:function(a,b){if(this[0])return K.event.trigger(a,b,this[0],!0)},toggle:function(a){var b=arguments,c=a.guid||K.guid++,d=0,e=function(c){var e=(K._data(this,"lastToggle"+a.guid)||0)%d;return K._data(this,"lastToggle"+a.guid,e+1),c.preventDefault(),b[e].apply(this,arguments)||!1};e.guid=c;while(d<b.length)b[d++].guid=c;return this.click(e)},hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)}}),K.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(a,b){K.fn[b]=function(a,c){return c==null&&(c=a,a=null),arguments.length>0?this.on(b,null,a,c):this.trigger(b)},K.attrFn&&(K.attrFn[b]=!0),bb.test(b)&&(K.event.fixHooks[b]=K.event.keyHooks),bc.test(b)&&(K.event.fixHooks[b]=K.event.mouseHooks)}),function(){function a(a,b,c,d,f,g){for(var h=0,i=d.length;h<i;h++){var j=d[h];if(j){var k=!1;j=j[a];while(j){if(j[e]===c){k=d[j.sizset];break}if(j.nodeType===1){g||(j[e]=c,j.sizset=h);if(typeof b!="string"){if(j===b){k=!0;break}}else if(m.filter(b,[j]).length>0){k=j;break}}j=j[a]}d[h]=k}}}function c(a,b,c,d,f,g){for(var h=0,i=d.length;h<i;h++){var j=d[h];if(j){var k=!1;j=j[a];while(j){if(j[e]===c){k=d[j.sizset];break}j.nodeType===1&&!g&&(j[e]=c,j.sizset=h);if(j.nodeName.toLowerCase()===b){k=j;break}j=j[a]}d[h]=k}}}var d=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,e="sizcache"+(Math.random()+"").replace(".",""),f=0,g=Object.prototype.toString,h=!1,i=!0,j=/\\/g,k=/\r\n/g,l=/\W/;[0,0].sort(function(){return i=!1,0});var m=function(a,b,c,e){c=c||[],b=b||H;var f=b;if(b.nodeType!==1&&b.nodeType!==9)return[];if(!a||typeof a!="string")return c;var h,i,j,k,l,n,q,r,t=!0,u=m.isXML(b),v=[],x=a;do{d.exec(""),h=d.exec(x);if(h){x=h[3],v.push(h[1]);if(h[2]){k=h[3];break}}}while(h);if(v.length>1&&p.exec(a))if(v.length===2&&o.relative[v[0]])i=w(v[0]+v[1],b,e);else{i=o.relative[v[0]]?[b]:m(v.shift(),b);while(v.length)a=v.shift(),o.relative[a]&&(a+=v.shift()),i=w(a,i,e)}else{!e&&v.length>1&&b.nodeType===9&&!u&&o.match.ID.test(v[0])&&!o.match.ID.test(v[v.length-1])&&(l=m.find(v.shift(),b,u),b=l.expr?m.filter(l.expr,l.set)[0]:l.set[0]);if(b){l=e?{expr:v.pop(),set:s(e)}:m.find(v.pop(),v.length===1&&(v[0]==="~"||v[0]==="+")&&b.parentNode?b.parentNode:b,u),i=l.expr?m.filter(l.expr,l.set):l.set,v.length>0?j=s(i):t=!1;while(v.length)n=v.pop(),q=n,o.relative[n]?q=v.pop():n="",q==null&&(q=b),o.relative[n](j,q,u)}else j=v=[]}j||(j=i),j||m.error(n||a);if(g.call(j)==="[object Array]")if(!t)c.push.apply(c,j);else if(b&&b.nodeType===1)for(r=0;j[r]!=null;r++)j[r]&&(j[r]===!0||j[r].nodeType===1&&m.contains(b,j[r]))&&c.push(i[r]);else for(r=0;j[r]!=null;r++)j[r]&&j[r].nodeType===1&&c.push(i[r]);else s(j,c);return k&&(m(k,f,c,e),m.uniqueSort(c)),c};m.uniqueSort=function(a){if(u){h=i,a.sort(u);if(h)for(var b=1;b<a.length;b++)a[b]===a[b-1]&&a.splice(b--,1)}return a},m.matches=function(a,b){return m(a,null,null,b)},m.matchesSelector=function(a,b){return m(b,null,null,[a]).length>0},m.find=function(a,b,c){var d,e,f,g,h,i;if(!a)return[];for(e=0,f=o.order.length;e<f;e++){h=o.order[e];if(g=o.leftMatch[h].exec(a)){i=g[1],g.splice(1,1);if(i.substr(i.length-1)!=="\\"){g[1]=(g[1]||"").replace(j,""),d=o.find[h](g,b,c);if(d!=null){a=a.replace(o.match[h],"");break}}}}return d||(d=typeof b.getElementsByTagName!="undefined"?b.getElementsByTagName("*"):[]),{set:d,expr:a}},m.filter=function(a,c,d,e){var f,g,h,i,j,k,l,n,p,q=a,r=[],s=c,t=c&&c[0]&&m.isXML(c[0]);while(a&&c.length){for(h in o.filter)if((f=o.leftMatch[h].exec(a))!=null&&f[2]){k=o.filter[h],l=f[1],g=!1,f.splice(1,1);if(l.substr(l.length-1)==="\\")continue;s===r&&(r=[]);if(o.preFilter[h]){f=o.preFilter[h](f,s,d,r,e,t);if(!f)g=i=!0;else if(f===!0)continue}if(f)for(n=0;(j=s[n])!=null;n++)j&&(i=k(j,f,n,s),p=e^i,d&&i!=null?p?g=!0:s[n]=!1:p&&(r.push(j),g=!0));if(i!==b){d||(s=r),a=a.replace(o.match[h],"");if(!g)return[];break}}if(a===q)if(g==null)m.error(a);else break;q=a}return s},m.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)};var n=m.getText=function(a){var b,c,d=a.nodeType,e="";if(d){if(d===1||d===9){if(typeof a.textContent=="string")return a.textContent;if(typeof a.innerText=="string")return a.innerText.replace(k,"");for(a=a.firstChild;a;a=a.nextSibling)e+=n(a)}else if(d===3||d===4)return a.nodeValue}else for(b=0;c=a[b];b++)c.nodeType!==8&&(e+=n(c));return e},o=m.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF\-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF\-]|\\.)+)\s*(?:(\S?=)\s*(?:(['"])(.*?)\3|(#?(?:[\w\u00c0-\uFFFF\-]|\\.)*)|)|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*\-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\(\s*(even|odd|(?:[+\-]?\d+|(?:[+\-]?\d*)?n\s*(?:[+\-]\s*\d+)?))\s*\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^\-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF\-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(a){return a.getAttribute("href")},type:function(a){return a.getAttribute("type")}},relative:{"+":function(a,b){var c=typeof b=="string",d=c&&!l.test(b),e=c&&!d;d&&(b=b.toLowerCase());for(var f=0,g=a.length,h;f<g;f++)if(h=a[f]){while((h=h.previousSibling)&&h.nodeType!==1);a[f]=e||h&&h.nodeName.toLowerCase()===b?h||!1:h===b}e&&m.filter(b,a,!0)},">":function(a,b){var c,d=typeof b=="string",e=0,f=a.length;if(d&&!l.test(b)){b=b.toLowerCase();for(;e<f;e++){c=a[e];if(c){var g=c.parentNode;a[e]=g.nodeName.toLowerCase()===b?g:!1}}}else{for(;e<f;e++)c=a[e],c&&(a[e]=d?c.parentNode:c.parentNode===b);d&&m.filter(b,a,!0)}},"":function(b,d,e){var g,h=f++,i=a;typeof d=="string"&&!l.test(d)&&(d=d.toLowerCase(),g=d,i=c),i("parentNode",d,h,b,g,e)},"~":function(b,d,e){var g,h=f++,i=a;typeof d=="string"&&!l.test(d)&&(d=d.toLowerCase(),g=d,i=c),i("previousSibling",d,h,b,g,e)}},find:{ID:function(a,b,c){if(typeof b.getElementById!="undefined"&&!c){var d=b.getElementById(a[1]);return d&&d.parentNode?[d]:[]}},NAME:function(a,b){if(typeof b.getElementsByName!="undefined"){var c=[],d=b.getElementsByName(a[1]);for(var e=0,f=d.length;e<f;e++)d[e].getAttribute("name")===a[1]&&c.push(d[e]);return c.length===0?null:c}},TAG:function(a,b){if(typeof b.getElementsByTagName!="undefined")return b.getElementsByTagName(a[1])}},preFilter:{CLASS:function(a,b,c,d,e,f){a=" "+a[1].replace(j,"")+" ";if(f)return a;for(var g=0,h;(h=b[g])!=null;g++)h&&(e^(h.className&&(" "+h.className+" ").replace(/[\t\n\r]/g," ").indexOf(a)>=0)?c||d.push(h):c&&(b[g]=!1));return!1},ID:function(a){return a[1].replace(j,"")},TAG:function(a,b){return a[1].replace(j,"").toLowerCase()},CHILD:function(a){if(a[1]==="nth"){a[2]||m.error(a[0]),a[2]=a[2].replace(/^\+|\s*/g,"");var b=/(-?)(\d*)(?:n([+\-]?\d*))?/.exec(a[2]==="even"&&"2n"||a[2]==="odd"&&"2n+1"||!/\D/.test(a[2])&&"0n+"+a[2]||a[2]);a[2]=b[1]+(b[2]||1)-0,a[3]=b[3]-0}else a[2]&&m.error(a[0]);return a[0]=f++,a},ATTR:function(a,b,c,d,e,f){var g=a[1]=a[1].replace(j,"");return!f&&o.attrMap[g]&&(a[1]=o.attrMap[g]),a[4]=(a[4]||a[5]||"").replace(j,""),a[2]==="~="&&(a[4]=" "+a[4]+" "),a},PSEUDO:function(a,b,c,e,f){if(a[1]==="not")if((d.exec(a[3])||"").length>1||/^\w/.test(a[3]))a[3]=m(a[3],null,null,b);else{var g=m.filter(a[3],b,c,!0^f);return c||e.push.apply(e,g),!1}else if(o.match.POS.test(a[0])||o.match.CHILD.test(a[0]))return!0;return a},POS:function(a){return a.unshift(!0),a}},filters:{enabled:function(a){return a.disabled===!1&&a.type!=="hidden"},disabled:function(a){return a.disabled===!0},checked:function(a){return a.checked===!0},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,a.selected===!0},parent:function(a){return!!a.firstChild},empty:function(a){return!a.firstChild},has:function(a,b,c){return!!m(c[3],a).length},header:function(a){return/h\d/i.test(a.nodeName)},text:function(a){var b=a.getAttribute("type"),c=a.type;return a.nodeName.toLowerCase()==="input"&&"text"===c&&(b===c||b===null)},radio:function(a){return a.nodeName.toLowerCase()==="input"&&"radio"===a.type},checkbox:function(a){return a.nodeName.toLowerCase()==="input"&&"checkbox"===a.type},file:function(a){return a.nodeName.toLowerCase()==="input"&&"file"===a.type},password:function(a){return a.nodeName.toLowerCase()==="input"&&"password"===a.type},submit:function(a){var b=a.nodeName.toLowerCase();return(b==="input"||b==="button")&&"submit"===a.type},image:function(a){return a.nodeName.toLowerCase()==="input"&&"image"===a.type},reset:function(a){var b=a.nodeName.toLowerCase();return(b==="input"||b==="button")&&"reset"===a.type},button:function(a){var b=a.nodeName.toLowerCase();return b==="input"&&"button"===a.type||b==="button"},input:function(a){return/input|select|textarea|button/i.test(a.nodeName)},focus:function(a){return a===a.ownerDocument.activeElement}},setFilters:{first:function(a,b){return b===0},last:function(a,b,c,d){return b===d.length-1},even:function(a,b){return b%2===0},odd:function(a,b){return b%2===1},lt:function(a,b,c){return b<c[3]-0},gt:function(a,b,c){return b>c[3]-0},nth:function(a,b,c){return c[3]-0===b},eq:function(a,b,c){return c[3]-0===b}},filter:{PSEUDO:function(a,b,c,d){var e=b[1],f=o.filters[e];if(f)return f(a,c,b,d);if(e==="contains")return(a.textContent||a.innerText||n([a])||"").indexOf(b[3])>=0;if(e==="not"){var g=b[3];for(var h=0,i=g.length;h<i;h++)if(g[h]===a)return!1;return!0}m.error(e)},CHILD:function(a,b){var c,d,f,g,h,i,j,k=b[1],l=a;switch(k){case"only":case"first":while(l=l.previousSibling)if(l.nodeType===1)return!1;if(k==="first")return!0;l=a;case"last":while(l=l.nextSibling)if(l.nodeType===1)return!1;return!0;case"nth":c=b[2],d=b[3];if(c===1&&d===0)return!0;f=b[0],g=a.parentNode;if(g&&(g[e]!==f||!a.nodeIndex)){i=0;for(l=g.firstChild;l;l=l.nextSibling)l.nodeType===1&&(l.nodeIndex=++i);g[e]=f}return j=a.nodeIndex-d,c===0?j===0:j%c===0&&j/c>=0}},ID:function(a,b){return a.nodeType===1&&a.getAttribute("id")===b},TAG:function(a,b){return b==="*"&&a.nodeType===1||!!a.nodeName&&a.nodeName.toLowerCase()===b},CLASS:function(a,b){return(" "+(a.className||a.getAttribute("class"))+" ").indexOf(b)>-1},ATTR:function(a,b){var c=b[1],d=m.attr?m.attr(a,c):o.attrHandle[c]?o.attrHandle[c](a):a[c]!=null?a[c]:a.getAttribute(c),e=d+"",f=b[2],g=b[4];return d==null?f==="!=":!f&&m.attr?d!=null:f==="="?e===g:f==="*="?e.indexOf(g)>=0:f==="~="?(" "+e+" ").indexOf(g)>=0:g?f==="!="?e!==g:f==="^="?e.indexOf(g)===0:f==="$="?e.substr(e.length-g.length)===g:f==="|="?e===g||e.substr(0,g.length+1)===g+"-":!1:e&&d!==!1},POS:function(a,b,c,d){var e=b[2],f=o.setFilters[e];if(f)return f(a,c,b,d)}}},p=o.match.POS,q=function(a,b){return"\\"+(b-0+1)};for(var r in o.match)o.match[r]=new RegExp(o.match[r].source+/(?![^\[]*\])(?![^\(]*\))/.source),o.leftMatch[r]=new RegExp(/(^(?:.|\r|\n)*?)/.source+o.match[r].source.replace(/\\(\d+)/g,q));var s=function(a,b){return a=Array.prototype.slice.call(a,0),b?(b.push.apply(b,a),b):a};try{Array.prototype.slice.call(H.documentElement.childNodes,0)[0].nodeType}catch(t){s=function(a,b){var c=0,d=b||[];if(g.call(a)==="[object Array]")Array.prototype.push.apply(d,a);else if(typeof a.length=="number")for(var e=a.length;c<e;c++)d.push(a[c]);else for(;a[c];c++)d.push(a[c]);return d}}var u,v;H.documentElement.compareDocumentPosition?u=function(a,b){return a===b?(h=!0,0):!a.compareDocumentPosition||!b.compareDocumentPosition?a.compareDocumentPosition?-1:1:a.compareDocumentPosition(b)&4?-1:1}:(u=function(a,b){if(a===b)return h=!0,0;if(a.sourceIndex&&b.sourceIndex)return a.sourceIndex-b.sourceIndex;var c,d,e=[],f=[],g=a.parentNode,i=b.parentNode,j=g;if(g===i)return v(a,b);if(!g)return-1;if(!i)return 1;while(j)e.unshift(j),j=j.parentNode;j=i;while(j)f.unshift(j),j=j.parentNode;c=e.length,d=f.length;for(var k=0;k<c&&k<d;k++)if(e[k]!==f[k])return v(e[k],f[k]);return k===c?v(a,f[k],-1):v(e[k],b,1)},v=function(a,b,c){if(a===b)return c;var d=a.nextSibling;while(d){if(d===b)return-1;d=d.nextSibling}return 1}),function(){var a=H.createElement("div"),c="script"+(new Date).getTime(),d=H.documentElement;a.innerHTML="<a name='"+c+"'/>",d.insertBefore(a,d.firstChild),H.getElementById(c)&&(o.find.ID=function(a,c,d){if(typeof c.getElementById!="undefined"&&!d){var e=c.getElementById(a[1]);return e?e.id===a[1]||typeof e.getAttributeNode!="undefined"&&e.getAttributeNode("id").nodeValue===a[1]?[e]:b:[]}},o.filter.ID=function(a,b){var c=typeof a.getAttributeNode!="undefined"&&a.getAttributeNode("id");return a.nodeType===1&&c&&c.nodeValue===b}),d.removeChild(a),d=a=null}(),function(){var a=H.createElement("div");a.appendChild(H.createComment("")),a.getElementsByTagName("*").length>0&&(o.find.TAG=function(a,b){var c=b.getElementsByTagName(a[1]);if(a[1]==="*"){var d=[];for(var e=0;c[e];e++)c[e].nodeType===1&&d.push(c[e]);c=d}return c}),a.innerHTML="<a href='#'></a>",a.firstChild&&typeof a.firstChild.getAttribute!="undefined"&&a.firstChild.getAttribute("href")!=="#"&&(o.attrHandle.href=function(a){return a.getAttribute("href",2)}),a=null}(),H.querySelectorAll&&function(){var a=m,b=H.createElement("div"),c="__sizzle__";b.innerHTML="<p class='TEST'></p>";if(!b.querySelectorAll||b.querySelectorAll(".TEST").length!==0){m=function(b,d,e,f){d=d||H;if(!f&&!m.isXML(d)){var g=/^(\w+$)|^\.([\w\-]+$)|^#([\w\-]+$)/.exec(b);if(g&&(d.nodeType===1||d.nodeType===9)){if(g[1])return s(d.getElementsByTagName(b),e);if(g[2]&&o.find.CLASS&&d.getElementsByClassName)return s(d.getElementsByClassName(g[2]),e)}if(d.nodeType===9){if(b==="body"&&d.body)return s([d.body],e);if(g&&g[3]){var h=d.getElementById(g[3]);if(!h||!h.parentNode)return s([],e);if(h.id===g[3])return s([h],e)}try{return s(d.querySelectorAll(b),e)}catch(i){}}else if(d.nodeType===1&&d.nodeName.toLowerCase()!=="object"){var j=d,k=d.getAttribute("id"),l=k||c,n=d.parentNode,p=/^\s*[+~]/.test(b);k?l=l.replace(/'/g,"\\$&"):d.setAttribute("id",l),p&&n&&(d=d.parentNode);try{if(!p||n)return s(d.querySelectorAll("[id='"+l+"'] "+b),e)}catch(q){}finally{k||j.removeAttribute("id")}}}return a(b,d,e,f)};for(var d in a)m[d]=a[d];b=null}}(),function(){var a=H.documentElement,b=a.matchesSelector||a.mozMatchesSelector||a.webkitMatchesSelector||a.msMatchesSelector;if(b){var c=!b.call(H.createElement("div"),"div"),d=!1;try{b.call(H.documentElement,"[test!='']:sizzle")}catch(e){d=!0}m.matchesSelector=function(a,e){e=e.replace(/\=\s*([^'"\]]*)\s*\]/g,"='$1']");if(!m.isXML(a))try{if(d||!o.match.PSEUDO.test(e)&&!/!=/.test(e)){var f=b.call(a,e);if(f||!c||a.document&&a.document.nodeType!==11)return f}}catch(g){}return m(e,null,null,[a]).length>0}}}(),function(){var a=H.createElement("div");a.innerHTML="<div class='test e'></div><div class='test'></div>";if(!!a.getElementsByClassName&&a.getElementsByClassName("e").length!==0){a.lastChild.className="e";if(a.getElementsByClassName("e").length===1)return;o.order.splice(1,0,"CLASS"),o.find.CLASS=function(a,b,c){if(typeof b.getElementsByClassName!="undefined"&&!c)return b.getElementsByClassName(a[1])},a=null}}(),H.documentElement.contains?m.contains=function(a,b){return a!==b&&(a.contains?a.contains(b):!0)}:H.documentElement.compareDocumentPosition?m.contains=function(a,b){return!!(a.compareDocumentPosition(b)&16)}:m.contains=function(){return!1},m.isXML=function(a){var b=(a?a.ownerDocument||a:0).documentElement;return b?b.nodeName!=="HTML":!1};var w=function(a,b,c){var d,e=[],f="",g=b.nodeType?[b]:b;while(d=o.match.PSEUDO.exec(a))f+=d[0],a=a.replace(o.match.PSEUDO,"");a=o.relative[a]?a+"*":a;for(var h=0,i=g.length;h<i;h++)m(a,g[h],e,c);return m.filter(f,e)};m.attr=K.attr,m.selectors.attrMap={},K.find=m,K.expr=m.selectors,K.expr[":"]=K.expr.filters,K.unique=m.uniqueSort,K.text=m.getText,K.isXMLDoc=m.isXML,K.contains=m.contains}();var bi=/Until$/,bj=/^(?:parents|prevUntil|prevAll)/,bk=/,/,bl=/^.[^:#\[\.,]*$/,bm=Array.prototype.slice,bn=K.expr.match.POS,bo={children:!0,contents:!0,next:!0,prev:!0};K.fn.extend({find:function(a){var b=this,c,d;if(typeof a!="string")return K(a).filter(function(){for(c=0,d=b.length;c<d;c++)if(K.contains(b[c],this))return!0});var e=this.pushStack("","find",a),f,g,h;for(c=0,d=this.length;c<d;c++){f=e.length,K.find(a,this[c],e);if(c>0)for(g=f;g<e.length;g++)for(h=0;h<f;h++)if(e[h]===e[g]){e.splice(g--,1);break}}return e},has:function(a){var b=K(a);return this.filter(function(){for(var a=0,c=b.length;a<c;a++)if(K.contains(this,b[a]))return!0})},not:function(a){return this.pushStack(z(this,a,!1),"not",a)},filter:function(a){return this.pushStack(z(this,a,!0),"filter",a)},is:function(a){return!!a&&(typeof a=="string"?bn.test(a)?K(a,this.context).index(this[0])>=0:K.filter(a,this).length>0:this.filter(a).length>0)},closest:function(a,b){var c=[],d,e,f=this[0];if(K.isArray(a)){var g=1;while(f&&f.ownerDocument&&f!==b){for(d=0;d<a.length;d++)K(f).is(a[d])&&c.push({selector:a[d],elem:f,level:g});f=f.parentNode,g++}return c}var h=bn.test(a)||typeof a!="string"?K(a,b||this.context):0;for(d=0,e=this.length;d<e;d++){f=this[d];while(f){if(h?h.index(f)>-1:K.find.matchesSelector(f,a)){c.push(f);break}f=f.parentNode;if(!f||!f.ownerDocument||f===b||f.nodeType===11)break}}return c=c.length>1?K.unique(c):c,this.pushStack(c,"closest",a)},index:function(a){return a?typeof a=="string"?K.inArray(this[0],K(a)):K.inArray(a.jquery?a[0]:a,this):this[0]&&this[0].parentNode?this.prevAll().length:-1},add:function(a,b){var c=typeof a=="string"?K(a,b):K.makeArray(a&&a.nodeType?[a]:a),d=K.merge(this.get(),c);return this.pushStack(A(c[0])||A(d[0])?d:K.unique(d))},andSelf:function(){return this.add(this.prevObject)}}),K.each({parent:function(a){var b=a.parentNode;return b&&b.nodeType!==11?b:null},parents:function(a){return K.dir(a,"parentNode")},parentsUntil:function(a,b,c){return K.dir(a,"parentNode",c)},next:function(a){return K.nth(a,2,"nextSibling")},prev:function(a){return K.nth(a,2,"previousSibling")},nextAll:function(a){return K.dir(a,"nextSibling")},prevAll:function(a){return K.dir(a,"previousSibling")},nextUntil:function(a,b,c){return K.dir(a,"nextSibling",c)},prevUntil:function(a,b,c){return K.dir(a,"previousSibling",c)},siblings:function(a){return K.sibling(a.parentNode.firstChild,a)},children:function(a){return K.sibling(a.firstChild)},contents:function(a){return K.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:K.makeArray(a.childNodes)}},function(a,b){K.fn[a]=function(c,d){var e=K.map(this,b,c);return bi.test(a)||(d=c),d&&typeof d=="string"&&(e=K.filter(d,e)),e=this.length>1&&!bo[a]?K.unique(e):e,(this.length>1||bk.test(d))&&bj.test(a)&&(e=e.reverse()),this.pushStack(e,a,bm.call(arguments).join(","))}}),K.extend({filter:function(a,b,c){return c&&(a=":not("+a+")"),b.length===1?K.find.matchesSelector(b[0],a)?[b[0]]:[]:K.find.matches(a,b)},dir:function(a,c,d){var e=[],f=a[c];while(f&&f.nodeType!==9&&(d===b||f.nodeType!==1||!K(f).is(d)))f.nodeType===1&&e.push(f),f=f[c];return e},nth:function(a,b,c,d){b=b||1;var e=0;for(;a;a=a[c])if(a.nodeType===1&&++e===b)break;return a},sibling:function(a,b){var c=[];for(;a;a=a.nextSibling)a.nodeType===1&&a!==b&&c.push(a);return c}});var bp="abbr|article|aside|audio|canvas|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",bq=/ jQuery\d+="(?:\d+|null)"/g,br=/^\s+/,bs=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/ig,bt=/<([\w:]+)/,bu=/<tbody/i,bv=/<|&#?\w+;/,bw=/<(?:script|style)/i,bx=/<(?:script|object|embed|option|style)/i,by=new RegExp("<(?:"+bp+")","i"),bz=/checked\s*(?:[^=]|=\s*.checked.)/i,bA=/\/(java|ecma)script/i,bB=/^\s*<!(?:\[CDATA\[|\-\-)/,bC={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},bD=y(H);bC.optgroup=bC.option,bC.tbody=bC.tfoot=bC.colgroup=bC.caption=bC.thead,bC.th=bC.td,K.support.htmlSerialize||(bC._default=[1,"div<div>","</div>"]),K.fn.extend({text:function(a){return K.isFunction(a)?this.each(function(b){var c=K(this);c.text(a.call(this,b,c.text()))}):typeof a!="object"&&a!==b?this.empty().append((this[0]&&this[0].ownerDocument||H).createTextNode(a)):K.text(this)},wrapAll:function(a){if(K.isFunction(a))return this.each(function(b){K(this).wrapAll(a.call(this,b))});if(this[0]){var b=K(a,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){var a=this;while(a.firstChild&&a.firstChild.nodeType===1)a=a.firstChild;return a}).append(this)}return this},wrapInner:function(a){return K.isFunction(a)?this.each(function(b){K(this).wrapInner(a.call(this,b))}):this.each(function(){var b=K(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=K.isFunction(a);return this.each(function(c){K(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){K.nodeName(this,"body")||K(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(a){this.nodeType===1&&this.appendChild(a)})},prepend:function(){return this.domManip(arguments,!0,function(a){this.nodeType===1&&this.insertBefore(a,this.firstChild)})},before:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,!1,function(a){this.parentNode.insertBefore(a,this)});if(arguments.length){var a=K.clean(arguments);return a.push.apply(a,this.toArray()),this.pushStack(a,"before",arguments)}},after:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,!1,function(a){this.parentNode.insertBefore(a,this.nextSibling)});if(arguments.length){var a=this.pushStack(this,"after",arguments);return a.push.apply(a,K.clean(arguments)),a}},remove:function(a,b){for(var c=0,d;(d=this[c])!=null;c++)if(!a||K.filter(a,[d]).length)!b&&d.nodeType===1&&(K.cleanData(d.getElementsByTagName("*")),K.cleanData([d])),d.parentNode&&d.parentNode.removeChild(d);return this},empty:function(){for(var a=0,b;(b=this[a])!=null;a++){b.nodeType===1&&K.cleanData(b.getElementsByTagName("*"));while(b.firstChild)b.removeChild(b.firstChild)}return this},clone:function(a,b){return a=a==null?!1:a,b=b==null?a:b,this.map(function(){return K.clone(this,a,b)})},html:function(a){if(a===b)return this[0]&&this[0].nodeType===1?this[0].innerHTML.replace(bq,""):null;if(typeof a=="string"&&!bw.test(a)&&(K.support.leadingWhitespace||!br.test(a))&&!bC[(bt.exec(a)||["",""])[1].toLowerCase()]){a=a.replace(bs,"<$1></$2>");try{for(var c=0,d=this.length;c<d;c++)this[c].nodeType===1&&(K.cleanData(this[c].getElementsByTagName("*")),this[c].innerHTML=a)}catch(e){this.empty().append(a)}}else K.isFunction(a)?this.each(function(b){var c=K(this);c.html(a.call(this,b,c.html()))}):this.empty().append(a);return this},replaceWith:function(a){return this[0]&&this[0].parentNode?K.isFunction(a)?this.each(function(b){var c=K(this),d=c.html();c.replaceWith(a.call(this,b,d))}):(typeof a!="string"&&(a=K(a).detach()),this.each(function(){var b=this.nextSibling,c=this.parentNode;K(this).remove(),b?K(b).before(a):K(c).append(a)})):this.length?this.pushStack(K(K.isFunction(a)?a():a),"replaceWith",a):this},detach:function(a){return this.remove(a,!0)},domManip:function(a,c,d){var e,f,g,h,i=a[0],j=[];if(!K.support.checkClone&&arguments.length===3&&typeof i=="string"&&bz.test(i))return this.each(function(){K(this).domManip(a,c,d,!0)});if(K.isFunction(i))return this.each(function(e){var f=K(this);a[0]=i.call(this,e,c?f.html():b),f.domManip(a,c,d)});if(this[0]){h=i&&i.parentNode,K.support.parentNode&&h&&h.nodeType===11&&h.childNodes.length===this.length?e={fragment:h}:e=K.buildFragment(a,this,j),g=e.fragment,g.childNodes.length===1?f=g=g.firstChild:f=g.firstChild;if(f){c=c&&K.nodeName(f,"tr");for(var k=0,l=this.length,m=l-1;k<l;k++)d.call(c?x(this[k],f):this[k],e.cacheable||l>1&&k<m?K.clone(g,!0,!0):g)}j.length&&K.each(j,q)}return this}}),K.buildFragment=function(a,b,c){var d,e,f,g,h=a[0];return b&&b[0]&&(g=b[0].ownerDocument||b[0]),g.createDocumentFragment||(g=H),a.length===1&&typeof h=="string"&&h.length<512&&g===H&&h.charAt(0)==="<"&&!bx.test(h)&&(K.support.checkClone||!bz.test(h))&&(K.support.html5Clone||!by.test(h))&&(e=!0,f=K.fragments[h],f&&f!==1&&(d=f)),d||(d=g.createDocumentFragment(),K.clean(a,g,d,c)),e&&(K.fragments[h]=f?d:1),{fragment:d,cacheable:e}},K.fragments={},K.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){K.fn[a]=function(c){var d=[],e=K(c),f=this.length===1&&this[0].parentNode;if(f&&f.nodeType===11&&f.childNodes.length===1&&e.length===1)return e[b](this[0]),this;for(var g=0,h=e.length;g<h;g++){var i=(g>0?this.clone(!0):this).get();K(e[g])[b](i),d=d.concat(i)}return this.pushStack(d,a,e.selector)}}),K.extend({clone:function(a,b,c){var d,e,f,g=K.support.html5Clone||!by.test("<"+a.nodeName)?a.cloneNode(!0):r(a);if((!K.support.noCloneEvent||!K.support.noCloneChecked)&&(a.nodeType===1||a.nodeType===11)&&!K.isXMLDoc(a)){v(a,g),d=u(a),e=u(g);for(f=0;d[f];++f)e[f]&&v(d[f],e[f])}if(b){w(a,g);if(c){d=u(a),e=u(g);for(f=0;d[f];++f)w(d[f],e[f])}}return d=e=null,g},clean:function(a,b,c,d){var e;b=b||H,typeof b.createElement=="undefined"&&(b=b.ownerDocument||b[0]&&b[0].ownerDocument||H);var f=[],g;for(var h=0,i;(i=a[h])!=null;h++){typeof i=="number"&&(i+="");if(!i)continue;if(typeof i=="string")if(!bv.test(i))i=b.createTextNode(i);else{i=i.replace(bs,"<$1></$2>");var j=(bt.exec(i)||["",""])[1].toLowerCase(),k=bC[j]||bC._default,l=k[0],m=b.createElement("div");b===H?bD.appendChild(m):y(b).appendChild(m),m.innerHTML=k[1]+i+k[2];while(l--)m=m.lastChild;if(!K.support.tbody){var n=bu.test(i),o=j==="table"&&!n?m.firstChild&&m.firstChild.childNodes:k[1]==="<table>"&&!n?m.childNodes:[];for(g=o.length-1;g>=0;--g)K.nodeName(o[g],"tbody")&&!o[g].childNodes.length&&o[g].parentNode.removeChild(o[g])}!K.support.leadingWhitespace&&br.test(i)&&m.insertBefore(b.createTextNode(br.exec(i)[0]),m.firstChild),i=m.childNodes}var p;if(!K.support.appendChecked)if(i[0]&&typeof (p=i.length)=="number")for(g=0;g<p;g++)s(i[g]);else s(i);i.nodeType?f.push(i):f=K.merge(f,i)}if(c){e=function(a){return!a.type||bA.test(a.type)};for(h=0;f[h];h++)if(d&&K.nodeName(f[h],"script")&&(!f[h].type||f[h].type.toLowerCase()==="text/javascript"))d.push(f[h].parentNode?f[h].parentNode.removeChild(f[h]):f[h]);else{if(f[h].nodeType===1){var q=K.grep(f[h].getElementsByTagName("script"),e);f.splice.apply(f,[h+1,0].concat(q))}c.appendChild(f[h])}}return f},cleanData:function(a){var b,c,d=K.cache,e=K.event.special,f=K.support.deleteExpando;for(var g=0,h;(h=a[g])!=null;g++){if(h.nodeName&&K.noData[h.nodeName.toLowerCase()])continue;c=h[K.expando];if(c){b=d[c];if(b&&b.events){for(var i in b.events)e[i]?K.event.remove(h,i):K.removeEvent(h,i,b.handle);b.handle&&(b.handle.elem=null)}f?delete h[K.expando]:h.removeAttribute&&h.removeAttribute(K.expando),delete d[c]}}}});var bE=/alpha\([^)]*\)/i,bF=/opacity=([^)]*)/,bG=/([A-Z]|^ms)/g,bH=/^-?\d+(?:px)?$/i,bI=/^-?\d/,bJ=/^([\-+])=([\-+.\de]+)/,bK={position:"absolute",visibility:"hidden",display:"block"},bL=["Left","Right"],bM=["Top","Bottom"],bN,bO,bP;K.fn.css=function(a,c){return arguments.length===2&&c===b?this:K.access(this,a,c,!0,function(a,c,d){return d!==b?K.style(a,c,d):K.css(a,c)})},K.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=bN(a,"opacity","opacity");return c===""?"1":c}return a.style.opacity}}},cssNumber:{fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":K.support.cssFloat?"cssFloat":"styleFloat"},style:function(a,c,d,e){if(!!a&&a.nodeType!==3&&a.nodeType!==8&&!!a.style){var f,g,h=K.camelCase(c),i=a.style,j=K.cssHooks[h];c=K.cssProps[h]||h;if(d===b)return j&&"get"in j&&(f=j.get(a,!1,e))!==b?f:i[c];g=typeof d,g==="string"&&(f=bJ.exec(d))&&(d=+(f[1]+1)*+f[2]+parseFloat(K.css(a,c)),g="number");if(d==null||g==="number"&&isNaN(d))return;g==="number"&&!K.cssNumber[h]&&(d+="px");if(!j||!("set"in j)||(d=j.set(a,d))!==b)try{i[c]=d}catch(k){}}},css:function(a,c,d){var e,f;c=K.camelCase(c),f=K.cssHooks[c],c=K.cssProps[c]||c,c==="cssFloat"&&(c="float");if(f&&"get"in f&&(e=f.get(a,!0,d))!==b)return e;if(bN)return bN(a,c)},swap:function(a,b,c){var d={};for(var e in b)d[e]=a.style[e],a.style[e]=b[e];c.call(a);for(e in b)a.style[e]=d[e]}}),K.curCSS=K.css,K.each(["height","width"],function(a,b){K.cssHooks[b]={get:function(a,c,d){var e;if(c)return a.offsetWidth!==0?p(a,b,d):(K.swap(a,bK,function(){e=p(a,b,d)}),e)},set:function(a,b){if(!bH.test(b))return b;b=parseFloat(b);if(b>=0)return b+"px"}}}),K.support.opacity||(K.cssHooks.opacity={get:function(a,b){return bF.test((b&&a.currentStyle?a.currentStyle.filter:a.style.filter)||"")?parseFloat(RegExp.$1)/100+"":b?"1":""},set:function(a,b){var c=a.style,d=a.currentStyle,e=K.isNumeric(b)?"alpha(opacity="+b*100+")":"",f=d&&d.filter||c.filter||"";c.zoom=1;if(b>=1&&K.trim(f.replace(bE,""))===""){c.removeAttribute("filter");if(d&&!d.filter)return}c.filter=bE.test(f)?f.replace(bE,e):f+" "+e}}),K(function(){K.support.reliableMarginRight||(K.cssHooks.marginRight={get:function(a,b){var c;return K.swap(a,{display:"inline-block"},function(){b?c=bN(a,"margin-right","marginRight"):c=a.style.marginRight}),c}})}),H.defaultView&&H.defaultView.getComputedStyle&&(bO=function(a,b){var c,d,e;return b=b.replace(bG,"-$1").toLowerCase(),(d=a.ownerDocument.defaultView)&&(e=d.getComputedStyle(a,null))&&(c=e.getPropertyValue(b),c===""&&!K.contains(a.ownerDocument.documentElement,a)&&(c=K.style(a,b))),c}),H.documentElement.currentStyle&&(bP=function(a,b){var c,d,e,f=a.currentStyle&&a.currentStyle[b],g=a.style;return f===null&&g&&(e=g[b])&&(f=e),!bH.test(f)&&bI.test(f)&&(c=g.left,d=a.runtimeStyle&&a.runtimeStyle.left,d&&(a.runtimeStyle.left=a.currentStyle.left),g.left=b==="fontSize"?"1em":f||0,f=g.pixelLeft+"px",g.left=c,d&&(a.runtimeStyle.left=d)),f===""?"auto":f}),bN=bO||bP,K.expr&&K.expr.filters&&(K.expr.filters.hidden=function(a){var b=a.offsetWidth,c=a.offsetHeight;return b===0&&c===0||!K.support.reliableHiddenOffsets&&(a.style&&a.style.display||K.css(a,"display"))==="none"},K.expr.filters.visible=function(a){return!K.expr.filters.hidden(a)});var bQ=/%20/g,bR=/\[\]$/,bS=/\r?\n/g,bT=/#.*$/,bU=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,bV=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,bW=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,bX=/^(?:GET|HEAD)$/,bY=/^\/\//,bZ=/\?/,b$=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,b_=/^(?:select|textarea)/i,ca=/\s+/,cb=/([?&])_=[^&]*/,cc=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,cd=K.fn.load,ce={},cf={},cg,ch,ci=["*/"]+["*"];try{cg=J.href}catch(cj){cg=H.createElement("a"),cg.href="",cg=cg.href}ch=cc.exec(cg.toLowerCase())||[],K.fn.extend({load:function(a,c,d){if(typeof a!="string"&&cd)return cd.apply(this,arguments);if(!this.length)return this;var e=a.indexOf(" ");if(e>=0){var f=a.slice(e,a.length);a=a.slice(0,e)}var g="GET";c&&(K.isFunction(c)?(d=c,c=b):typeof c=="object"&&(c=K.param(c,K.ajaxSettings.traditional),g="POST"));var h=this;return K.ajax({url:a,type:g,dataType:"html",data:c,complete:function(a,b,c){c=a.responseText,a.isResolved()&&(a.done(function(a){c=a}),h.html(f?K("<div>").append(c.replace(b$,"")).find(f):c)),d&&h.each(d,[c,b,a])}}),this},serialize:function(){return K.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?K.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||b_.test(this.nodeName)||bV.test(this.type))}).map(function(a,b){var c=K(this).val();return c==null?null:K.isArray(c)?K.map(c,function(a,c){return{name:b.name,value:a.replace(bS,"\r\n")}}):{name:b.name,value:c.replace(bS,"\r\n")}}).get()}}),K.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(a,b){K.fn[b]=function(a){return this.on(b,a)}}),K.each(["get","post"],function(a,c){K[c]=function(a,d,e,f){return K.isFunction(d)&&(f=f||e,e=d,d=b),K.ajax({type:c,url:a,data:d,success:e,dataType:f})}}),K.extend({getScript:function(a,c){return K.get(a,b,c,"script")},getJSON:function(a,b,c){return K.get(a,b,c,"json")},ajaxSetup:function(a,b){return b?m(a,K.ajaxSettings):(b=a,a=K.ajaxSettings),m(a,b),a},ajaxSettings:{url:cg,isLocal:bW.test(ch[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded",processData:!0,async:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":ci},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":a.String,"text html":!0,"text json":K.parseJSON,"text xml":K.parseXML},flatOptions:{context:!0,url:!0}},ajaxPrefilter:o(ce),ajaxTransport:o(cf),ajax:function(a,c){function d(a,c,d,n){if(v!==2){v=2,t&&clearTimeout(t),s=b,q=n||"",y.readyState=a>0?4:0;var o,p,r,u=c,x=d?k(e,y,d):b,z,A;if(a>=200&&a<300||a===304){if(e.ifModified){if(z=y.getResponseHeader("Last-Modified"))K.lastModified[m]=z;if(A=y.getResponseHeader("Etag"))K.etag[m]=A}if(a===304)u="notmodified",o=!0;else try{p=j(e,x),u="success",o=!0}catch(B){u="parsererror",r=B}}else{r=u;if(!u||a)u="error",a<0&&(a=0)}y.status=a,y.statusText=""+(c||u),o?h.resolveWith(f,[p,u,y]):h.rejectWith(f,[y,u,r]),y.statusCode(l),l=b,w&&g.trigger("ajax"+(o?"Success":"Error"),[y,e,o?p:r]),i.fireWith(f,[y,u]),w&&(g.trigger("ajaxComplete",[y,e]),--K.active||K.event.trigger("ajaxStop"))}}typeof a=="object"&&(c=a,a=b),c=c||{};var e=K.ajaxSetup({},c),f=e.context||e,g=f!==e&&(f.nodeType||f instanceof K)?K(f):K.event,h=K.Deferred(),i=K.Callbacks("once memory"),l=e.statusCode||{},m,o={},p={},q,r,s,t,u,v=0,w,x,y={readyState:0,setRequestHeader:function(a,b){if(!v){var c=a.toLowerCase();a=p[c]=p[c]||a,o[a]=b}return this},getAllResponseHeaders:function(){return v===2?q:null},getResponseHeader:function(a){var c;if(v===2){if(!r){r={};while(c=bU.exec(q))r[c[1].toLowerCase()]=c[2]}c=r[a.toLowerCase()]}return c===b?null:c},overrideMimeType:function(a){return v||(e.mimeType=a),this},abort:function(a){return a=a||"abort",s&&s.abort(a),d(0,a),this}};h.promise(y),y.success=y.done,y.error=y.fail,y.complete=i.add,y.statusCode=function(a){if(a){var b;if(v<2)for(b in a)l[b]=[l[b],a[b]];else b=a[y.status],y.then(b,b)}return this},e.url=((a||e.url)+"").replace(bT,"").replace(bY,ch[1]+"//"),e.dataTypes=K.trim(e.dataType||"*").toLowerCase().split(ca),e.crossDomain==null&&(u=cc.exec(e.url.toLowerCase()),e.crossDomain=!(!u||u[1]==ch[1]&&u[2]==ch[2]&&(u[3]||(u[1]==="http:"?80:443))==(ch[3]||(ch[1]==="http:"?80:443)))),e.data&&e.processData&&typeof e.data!="string"&&(e.data=K.param(e.data,e.traditional)),n(ce,e,c,y);if(v===2)return!1;w=e.global,e.type=e.type.toUpperCase(),e.hasContent=!bX.test(e.type),w&&K.active++===0&&K.event.trigger("ajaxStart");if(!e.hasContent){e.data&&(e.url+=(bZ.test(e.url)?"&":"?")+e.data,delete e.data),m=e.url;if(e.cache===!1){var z=K.now(),A=e.url.replace(cb,"$1_="+z);e.url=A+(A===e.url?(bZ.test(e.url)?"&":"?")+"_="+z:"")}}(e.data&&e.hasContent&&e.contentType!==!1||c.contentType)&&y.setRequestHeader("Content-Type",e.contentType),e.ifModified&&(m=m||e.url,K.lastModified[m]&&y.setRequestHeader("If-Modified-Since",K.lastModified[m]),K.etag[m]&&y.setRequestHeader("If-None-Match",K.etag[m])),y.setRequestHeader("Accept",e.dataTypes[0]&&e.accepts[e.dataTypes[0]]?e.accepts[e.dataTypes[0]]+(e.dataTypes[0]!=="*"?", "+ci+"; q=0.01":""):e.accepts["*"]);for(x in e.headers)y.setRequestHeader(x,e.headers[x]);if(!e.beforeSend||e.beforeSend.call(f,y,e)!==!1&&v!==2){for(x in{success:1,error:1,complete:1})y[x](e[x]);s=n(cf,e,c,y);if(!s)d(-1,"No Transport");else{y.readyState=1,w&&g.trigger("ajaxSend",[y,e]),e.async&&e.timeout>0&&(t=setTimeout(function(){y.abort("timeout")},e.timeout));try{v=1,s.send(o,d)}catch(B){if(v<2)d(-1,B);else throw B}}return y}return y.abort(),!1},param:function(a,c){var d=[],e=function(a,b){b=K.isFunction(b)?b():b,d[d.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};c===b&&(c=K.ajaxSettings.traditional);if(K.isArray(a)||a.jquery&&!K.isPlainObject(a))K.each(a,function(){e(this.name,this.value)});else for(var f in a)l(f,a[f],c,e);return d.join("&").replace(bQ,"+")}}),K.extend({active:0,lastModified:{},etag:{}});var ck=K.now(),cl=/(\=)\?(&|$)|\?\?/i;K.ajaxSetup({jsonp:"callback",jsonpCallback:function(){return K.expando+"_"+ck++}}),K.ajaxPrefilter("json jsonp",function(b,c,d){var e=b.contentType==="application/x-www-form-urlencoded"&&typeof b.data=="string";if(b.dataTypes[0]==="jsonp"||b.jsonp!==!1&&(cl.test(b.url)||e&&cl.test(b.data))){var f,g=b.jsonpCallback=K.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback,h=a[g],i=b.url,j=b.data,k="$1"+g+"$2";return b.jsonp!==!1&&(i=i.replace(cl,k),b.url===i&&(e&&(j=j.replace(cl,k)),b.data===j&&(i+=(/\?/.test(i)?"&":"?")+b.jsonp+"="+g))),b.url=i,b.data=j,a[g]=function(a){f=[a]},d.always(function(){a[g]=h,f&&K.isFunction(h)&&a[g](f[0])}),b.converters["script json"]=function(){return f||K.error(g+" was not called"),f[0]},b.dataTypes[0]="json","script"}}),K.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(a){return K.globalEval(a),a}}}),K.ajaxPrefilter("script",function(a){a.cache===b&&(a.cache=!1),a.crossDomain&&(a.type="GET",a.global=!1)}),K.ajaxTransport("script",function(a){if(a.crossDomain){var c,d=H.head||H.getElementsByTagName("head")[0]||H.documentElement;return{send:function(e,f){c=H.createElement("script"),c.async="async",a.scriptCharset&&(c.charset=a.scriptCharset),c.src=a.url,c.onload=c.onreadystatechange=function(a,e){if(e||!c.readyState||/loaded|complete/.test(c.readyState))c.onload=c.onreadystatechange=null,d&&c.parentNode&&d.removeChild(c),c=b,e||f(200,"success")},d.insertBefore(c,d.firstChild)},abort:function(){c&&c.onload(0,1)}}}});var cm=a.ActiveXObject?function(){for(var a in co)co[a](0,1)}:!1,cn=0,co;K.ajaxSettings.xhr=a.ActiveXObject?function(){return!this.isLocal&&i()||h()}:i,function(a){K.extend(K.support,{ajax:!!a,cors:!!a&&"withCredentials"in a})}(K.ajaxSettings.xhr()),K.support.ajax&&K.ajaxTransport(function(c){if(!c.crossDomain||K.support.cors){var d;return{send:function(e,f){var g=c.xhr(),h,i;c.username?g.open(c.type,c.url,c.async,c.username,c.password):g.open(c.type,c.url,c.async);if(c.xhrFields)for(i in c.xhrFields)g[i]=c.xhrFields[i];c.mimeType&&g.overrideMimeType&&g.overrideMimeType(c.mimeType),!c.crossDomain&&!e["X-Requested-With"]&&(e["X-Requested-With"]="XMLHttpRequest");try{for(i in e)g.setRequestHeader(i,e[i])}catch(j){}g.send(c.hasContent&&c.data||null),d=function(a,e){var i,j,k,l,m;try{if(d&&(e||g.readyState===4)){d=b,h&&(g.onreadystatechange=K.noop,cm&&delete co[h]);if(e)g.readyState!==4&&g.abort();else{i=g.status,k=g.getAllResponseHeaders(),l={},m=g.responseXML,m&&m.documentElement&&(l.xml=m),l.text=g.responseText;try{j=g.statusText}catch(n){j=""}!i&&c.isLocal&&!c.crossDomain?i=l.text?200:404:i===1223&&(i=204)}}}catch(o){e||f(-1,o)}l&&f(i,j,l,k)},!c.async||g.readyState===4?d():(h=++cn,cm&&(co||(co={},K(a).unload(cm)),co[h]=d),g.onreadystatechange=d)},abort:function(){d&&d(0,1)}}}});var cp={},cq,cr,cs=/^(?:toggle|show|hide)$/,ct=/^([+\-]=)?([\d+.\-]+)([a-z%]*)$/i,cu,cv=[["height","marginTop","marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]],cw;K.fn.extend({show:function(a,b,c){var f,g;if(a||a===0)return this.animate(e("show",3),a,b,c);for(var h=0,i=this.length;h<i;h++)f=this[h],f.style&&(g=f.style.display,!K._data(f,"olddisplay")&&g==="none"&&(g=f.style.display=""),g===""&&K.css(f,"display")==="none"&&K._data(f,"olddisplay",d(f.nodeName)));for(h=0;h<i;h++){f=this[h];if(f.style){g=f.style.display;if(g===""||g==="none")f.style.display=K._data(f,"olddisplay")||""}}return this},hide:function(a,b,c){if(a||a===0)return this.animate(e("hide",3),a,b,c);var d,f,g=0,h=this.length;for(;g<h;g++)d=this[g],d.style&&(f=K.css(d,"display"),f!=="none"&&!K._data(d,"olddisplay")&&K._data(d,"olddisplay",f));for(g=0;g<h;g++)this[g].style&&(this[g].style.display="none");return this},_toggle:K.fn.toggle,toggle:function(a,b,c){var d=typeof a=="boolean";return K.isFunction(a)&&K.isFunction(b)?this._toggle.apply(this,arguments):a==null||d?this.each(function(){var b=d?a:K(this).is(":hidden");K(this)[b?"show":"hide"]()}):this.animate(e("toggle",3),a,b,c),this},fadeTo:function(a,b,c,d){return this.filter(":hidden").css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,e){function f(){g.queue===!1&&K._mark(this);var b=K.extend({},g),c=this.nodeType===1,e=c&&K(this).is(":hidden"),f,h,i,j,k,l,m,n,o;b.animatedProperties={};for(i in a){f=K.camelCase(i),i!==f&&(a[f]=a[i],delete a[i]),h=a[f],K.isArray(h)?(b.animatedProperties[f]=h[1],h=a[f]=h[0]):b.animatedProperties[f]=b.specialEasing&&b.specialEasing[f]||b.easing||"swing";if(h==="hide"&&e||h==="show"&&!e)return b.complete.call(this);c&&(f==="height"||f==="width")&&(b.overflow=[this.style.overflow,this.style.overflowX,this.style.overflowY],K.css(this,"display")==="inline"&&K.css(this,"float")==="none"&&(!K.support.inlineBlockNeedsLayout||d(this.nodeName)==="inline"?this.style.display="inline-block":this.style.zoom=1))}b.overflow!=null&&(this.style.overflow="hidden");for(i in a)j=new K.fx(this,b,i),h=a[i],cs.test(h)?(o=K._data(this,"toggle"+i)||(h==="toggle"?e?"show":"hide":0),o?(K._data(this,"toggle"+i,o==="show"?"hide":"show"),j[o]()):j[h]()):(k=ct.exec(h),l=j.cur(),k?(m=parseFloat(k[2]),n=k[3]||(K.cssNumber[i]?"":"px"),n!=="px"&&(K.style(this,i,(m||1)+n),l=(m||1)/j.cur()*l,K.style(this,i,l+n)),k[1]&&(m=(k[1]==="-="?-1:1)*m+l),j.custom(l,m,n)):j.custom(l,h,""));return!0}var g=K.speed(b,c,e);return K.isEmptyObject(a)?this.each(g.complete,[!1]):(a=K.extend({},a),g.queue===!1?this.each(f):this.queue(g.queue,f))},stop:function(a,c,d){return typeof a!="string"&&(d=c,c=a,a=b),c&&a!==!1&&this.queue(a||"fx",[]),this.each(function(){function b(a,b,c){var e=b[c];K.removeData(a,c,!0),e.stop(d)}var c,e=!1,f=K.timers,g=K._data(this);d||K._unmark(!0,this);if(a==null)for(c in g)g[c]&&g[c].stop&&c.indexOf(".run")===c.length-4&&b(this,g,c);else g[c=a+".run"]&&g[c].stop&&b(this,g,c);for(c=f.length;c--;)f[c].elem===this&&(a==null||f[c].queue===a)&&(d?f[c](!0):f[c].saveState(),e=!0,f.splice(c,1));(!d||!e)&&K.dequeue(this,a)})}}),K.each({slideDown:e("show",1),slideUp:e("hide",1),slideToggle:e("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){K.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),K.extend({speed:function(a,b,c){var d=a&&typeof a=="object"?K.extend({},a):{complete:c||!c&&b||K.isFunction(a)&&a,duration:a,easing:c&&b||b&&!K.isFunction(b)&&b};d.duration=K.fx.off?0:typeof d.duration=="number"?d.duration:d.duration in K.fx.speeds?K.fx.speeds[d.duration]:K.fx.speeds._default;if(d.queue==null||d.queue===!0)d.queue="fx";return d.old=d.complete,d.complete=function(a){K.isFunction(d.old)&&d.old.call(this),d.queue?K.dequeue(this,d.queue):a!==!1&&K._unmark(this)},d},easing:{linear:function(a,b,c,d){return c+d*a},swing:function(a,b,c,d){return(-Math.cos(a*Math.PI)/2+.5)*d+c}},timers:[],fx:function(a,b,c){this.options=b,this.elem=a,this.prop=c,b.orig=b.orig||{}}}),K.fx.prototype={update:function(){this.options.step&&this.options.step.call(this.elem,this.now,this),(K.fx.step[this.prop]||K.fx.step._default)(this)},cur:function(){if(this.elem[this.prop]==null||!!this.elem.style&&this.elem.style[this.prop]!=null){var a,b=K.css(this.elem,this.prop);return isNaN(a=parseFloat(b))?!b||b==="auto"?0:b:a}return this.elem[this.prop]},custom:function(a,c,d){function e(a){return f.step(a)}var f=this,h=K.fx;this.startTime=cw||g(),this.end=c,this.now=this.start=a,this.pos=this.state=0,this.unit=d||this.unit||(K.cssNumber[this.prop]?"":"px"),e.queue=this.options.queue,e.elem=this.elem,e.saveState=function(){f.options.hide&&K._data(f.elem,"fxshow"+f.prop)===b&&K._data(f.elem,"fxshow"+f.prop,f.start)},e()&&K.timers.push(e)&&!cu&&(cu=setInterval(h.tick,h.interval))},show:function(){var a=K._data(this.elem,"fxshow"+this.prop);this.options.orig[this.prop]=a||K.style(this.elem,this.prop),this.options.show=!0,a!==b?this.custom(this.cur(),a):this.custom(this.prop==="width"||this.prop==="height"?1:0,this.cur()),K(this.elem).show()},hide:function(){this.options.orig[this.prop]=K._data(this.elem,"fxshow"+this.prop)||K.style(this.elem,this.prop),this.options.hide=!0,this.custom(this.cur(),0)},step:function(a){var b,c,d,e=cw||g(),f=!0,h=this.elem,i=this.options;if(a||e>=i.duration+this.startTime){this.now=this.end,this.pos=this.state=1,this.update(),i.animatedProperties[this.prop]=!0;for(b in i.animatedProperties)i.animatedProperties[b]!==!0&&(f=!1);if(f){i.overflow!=null&&!K.support.shrinkWrapBlocks&&K.each(["","X","Y"],function(a,b){h.style["overflow"+b]=i.overflow[a]}),i.hide&&K(h).hide();if(i.hide||i.show)for(b in i.animatedProperties)K.style(h,b,i.orig[b]),K.removeData(h,"fxshow"+b,!0),K.removeData(h,"toggle"+b,!0);d=i.complete,d&&(i.complete=!1,d.call(h))}return!1}return i.duration==Infinity?this.now=e:(c=e-this.startTime,this.state=c/i.duration,this.pos=K.easing[i.animatedProperties[this.prop]](this.state,c,0,1,i.duration),this.now=this.start+(this.end-this.start)*this.pos),this.update(),!0}},K.extend(K.fx,{tick:function(){var a,b=K.timers,c=0;for(;c<b.length;c++)a=b[c],!a()&&b[c]===a&&b.splice(c--,1);b.length||K.fx.stop()},interval:13,stop:function(){clearInterval(cu),cu=null},speeds:{slow:600,fast:200,_default:400},step:{opacity:function(a){K.style(a.elem,"opacity",a.now)},_default:function(a){a.elem.style&&a.elem.style[a.prop]!=null?a.elem.style[a.prop]=a.now+a.unit:a.elem[a.prop]=a.now}}}),K.each(["width","height"],function(a,b){K.fx.step[b]=function(a){K.style(a.elem,b,Math.max(0,a.now)+a.unit)}}),K.expr&&K.expr.filters&&(K.expr.filters.animated=function(a){return K.grep(K.timers,function(b){return a===b.elem}).length});var cx=/^t(?:able|d|h)$/i,cy=/^(?:body|html)$/i;"getBoundingClientRect"in H.documentElement?K.fn.offset=function(a){var b=this[0],d;if(a)return this.each(function(b){K.offset.setOffset(this,a,b)});if(!b||!b.ownerDocument)return null;if(b===b.ownerDocument.body)return K.offset.bodyOffset(b);try{d=b.getBoundingClientRect()}catch(e){}var f=b.ownerDocument,g=f.documentElement;if(!d||!K.contains(g,b))return d?{top:d.top,left:d.left}:{top:0,left:0};var h=f.body,i=c(f),j=g.clientTop||h.clientTop||0,k=g.clientLeft||h.clientLeft||0,l=i.pageYOffset||K.support.boxModel&&g.scrollTop||h.scrollTop,m=i.pageXOffset||K.support.boxModel&&g.scrollLeft||h.scrollLeft,n=d.top+l-j,o=d.left+m-k;return{top:n,left:o}}:K.fn.offset=function(a){var b=this[0];if(a)return this.each(function(b){K.offset.setOffset(this,a,b)});if(!b||!b.ownerDocument)return null;if(b===b.ownerDocument.body)return K.offset.bodyOffset(b);var c,d=b.offsetParent,e=b,f=b.ownerDocument,g=f.documentElement,h=f.body,i=f.defaultView,j=i?i.getComputedStyle(b,null):b.currentStyle,k=b.offsetTop,l=b.offsetLeft;while((b=b.parentNode)&&b!==h&&b!==g){if(K.support.fixedPosition&&j.position==="fixed")break;c=i?i.getComputedStyle(b,null):b.currentStyle,k-=b.scrollTop,l-=b.scrollLeft,b===d&&(k+=b.offsetTop,l+=b.offsetLeft,K.support.doesNotAddBorder&&(!K.support.doesAddBorderForTableAndCells||!cx.test(b.nodeName))&&(k+=parseFloat(c.borderTopWidth)||0,l+=parseFloat(c.borderLeftWidth)||0),e=d,d=b.offsetParent),K.support.subtractsBorderForOverflowNotVisible&&c.overflow!=="visible"&&(k+=parseFloat(c.borderTopWidth)||0,l+=parseFloat(c.borderLeftWidth)||0),j=c}if(j.position==="relative"||j.position==="static")k+=h.offsetTop,l+=h.offsetLeft;return K.support.fixedPosition&&j.position==="fixed"&&(k+=Math.max(g.scrollTop,h.scrollTop),l+=Math.max(g.scrollLeft,h.scrollLeft)),{top:k,left:l}},K.offset={bodyOffset:function(a){var b=a.offsetTop,c=a.offsetLeft;return K.support.doesNotIncludeMarginInBodyOffset&&(b+=parseFloat(K.css(a,"marginTop"))||0,c+=parseFloat(K.css(a,"marginLeft"))||0),{top:b,left:c}},setOffset:function(a,b,c){var d=K.css(a,"position");d==="static"&&(a.style.position="relative");var e=K(a),f=e.offset(),g=K.css(a,"top"),h=K.css(a,"left"),i=(d==="absolute"||d==="fixed")&&K.inArray("auto",[g,h])>-1,j={},k={},l,m;i?(k=e.position(),l=k.top,m=k.left):(l=parseFloat(g)||0,m=parseFloat(h)||0),K.isFunction(b)&&(b=b.call(a,c,f)),b.top!=null&&(j.top=b.top-f.top+l),b.left!=null&&(j.left=b.left-f.left+m),"using"in b?b.using.call(a,j):e.css(j)}},K.fn.extend({position:function(){if(!this[0])return null;var a=this[0],b=this.offsetParent(),c=this.offset(),d=cy.test(b[0].nodeName)?{top:0,left:0}:b.offset();return c.top-=parseFloat(K.css(a,"marginTop"))||0,c.left-=parseFloat(K.css(a,"marginLeft"))||0,d.top+=parseFloat(K.css(b[0],"borderTopWidth"))||0,d.left+=parseFloat(K.css(b[0],"borderLeftWidth"))||0,{top:c.top-d.top,left:c.left-d.left}},offsetParent:function(){return this.map(function(){var a=this.offsetParent||H.body;while(a&&!cy.test(a.nodeName)&&K.css(a,"position")==="static")a=a.offsetParent;return a})}}),K.each(["Left","Top"],function(a,d){var e="scroll"+d;K.fn[e]=function(d){var f,g;return d===b?(f=this[0],f?(g=c(f),g?"pageXOffset"in g?g[a?"pageYOffset":"pageXOffset"]:K.support.boxModel&&g.document.documentElement[e]||g.document.body[e]:f[e]):null):this.each(function(){g=c(this),g?g.scrollTo(a?K(g).scrollLeft():d,a?d:K(g).scrollTop()):this[e]=d})}}),K.each(["Height","Width"],function(a,c){var d=c.toLowerCase();K.fn["inner"+c]=function(){var a=this[0];return a?a.style?parseFloat(K.css(a,d,"padding")):this[d]():null},K.fn["outer"+c]=function(a){var b=this[0];return b?b.style?parseFloat(K.css(b,d,a?"margin":"border")):this[d]():null},K.fn[d]=function(a){var e=this[0];if(!e)return a==null?null:this;if(K.isFunction(a))return this.each(function(b){var c=K(this);c[d](a.call(this,b,c[d]()))});if(K.isWindow(e)){var f=e.document.documentElement["client"+c],g=e.document.body;return e.document.compatMode==="CSS1Compat"&&f||g&&g["client"+c]||f}if(e.nodeType===9)return Math.max(e.documentElement["client"+c],e.body["scroll"+c],e.documentElement["scroll"+c],e.body["offset"+c],e.documentElement["offset"+c]);if(a===b){var h=K.css(e,d),i=parseFloat(h);return K.isNumeric(i)?i:h}return this.css(d,typeof a=="string"?a:a+"px")}}),a.jQuery=a.$=K,typeof define=="function"&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return K})}(window),TD.controller.feather=function(){var exposed={};exposed.latestFeatherId=6;var feather_base;return window.location.href.indexOf("http://localhost:8090")===0?feather_base="http://localhost:8090":feather_base="https://web.tweetdeck.com",exposed.loadFeathers=function(isRetry){var d=new TD.core.defer.Deferred;return $.get(feather_base+"/web/scripts/unbundled/feathers.js").success(function(feathers){try{eval(feathers),d.callback()}catch(e){d.errback()}}).error(function(a,b,c){isRetry||exposed.loadFeathers(!0),d.errback()}),d},exposed.applyFeathers=function(a){var b=exposed.latestFeatherId,c,d=_.sortBy(a,function(a){return a.id});for(var e=0;e<d.length;e++){c=d[e];if(c.id>b)try{c.patch(),b=c.id}catch(f){console.log("Error patching feather id: "+c.id+" "+f)}}exposed.latestFeatherId=b},setInterval(exposed.loadFeathers,36e5),exposed}(),function(a){var b={};a.publish=function(c,e){var f=b[c];f&&a.each(f,function(){this.apply(a,e||[])})},a.subscribe=function(a,c){return b[a]||(b[a]=[]),b[a].push(c),[a,c]},a.unsubscribe=function(c){if(!c||!(c instanceof Array))throw new Error("unsubscribe(): handle must be an instance of Array.");var e=c[0];b[e]&&a.each(b[e],function(a){this==c[1]&&b[e].splice(a,1)})},a.unsubscribeAll=function(a){delete b[a]}}(jQuery),TD.core.base64=function(){var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",b=function(a){a=a.replace(/\r\n/g,"\n");var b="";for(var c=0;c<a.length;c++){var d=a.charCodeAt(c);d<128?b+=String.fromCharCode(d):d>127&&d<2048?(b+=String.fromCharCode(d>>6|192),b+=String.fromCharCode(d&63|128)):(b+=String.fromCharCode(d>>12|224),b+=String.fromCharCode(d>>6&63|128),b+=String.fromCharCode(d&63|128))}return b},c=function(a){var b="",c=0,d=c1=c2=0;while(c<a.length)d=a.charCodeAt(c),d<128?(b+=String.fromCharCode(d),c++):d>191&&d<224?(c2=a.charCodeAt(c+1),b+=String.fromCharCode((d&31)<<6|c2&63),c+=2):(c2=a.charCodeAt(c+1),c3=a.charCodeAt(c+2),b+=String.fromCharCode((d&15)<<12|(c2&63)<<6|c3&63),c+=3);return b},d=function(c){var d="",e,f,g,h,i,j,k,l=0;c=b(c);while(l<c.length)e=c.charCodeAt(l++),f=c.charCodeAt(l++),g=c.charCodeAt(l++),h=e>>2,i=(e&3)<<4|f>>4,j=(f&15)<<2|g>>6,k=g&63,isNaN(f)?j=k=64:isNaN(g)&&(k=64),d=d+a.charAt(h)+a.charAt(i)+a.charAt(j)+a.charAt(k);return d},e=function(b){var d="",e,f,g,h,i,j,k,l=0;b=b.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(l<b.length)h=a.indexOf(b.charAt(l++)),i=a.indexOf(b.charAt(l++)),j=a.indexOf(b.charAt(l++)),k=a.indexOf(b.charAt(l++)),e=h<<2|i>>4,f=(i&15)<<4|j>>2,g=(j&3)<<6|k,d=d+String.fromCharCode(e),j!=64&&(d=d+String.fromCharCode(f)),k!=64&&(d=d+String.fromCharCode(g));return d=c(d),d};return{encode:d,decode:e}}(),function(a,b){function c(a){return"[object Arguments]"==bc.call(a)}function d(a){return new e(a)}function e(a){if(a&&a._wrapped)return a;this._wrapped=a}function f(){for(var a,b,c,d=-1,e=arguments.length,f={e:"",f:"",k:"",q:"",c:{d:"",m:"++l<o"},o:{d:""}};++d<e;)for(b in a=arguments[d],a)c=(c=a[b])==B?"":c,/d|m|j/.test(b)?("string"==typeof c&&(c={b:c,n:c}),f.c[b]=c.b,f.o[b]=c.n):f[b]=c;a=f.a,b=f.c,c=f.o;var d=/^[^,]+/.exec(a)[0],e=c.m,g=/\S+$/.exec(e||d)[0];f.g=d,f.i=E,f.h="j.call("+g+",l)",f.l=g,f.p=L,f.r=f.r!==C,f.f||(f.f="if(!"+d+")return u");if("r"==d||!b.j)f.c=B;return e||(c.m="l in "+g),Function("c,i,j,k,n,s,w,z,C,D,h,E",'"use strict";return function('+a+"){"+bj(f)+"}")(R,U,_,y,j,P,bb,X,bc,A,C)}function g(a,b){return N[b]}function h(a){return"\\"+Q[a]}function i(a){return O[a]}function j(a,b){return function(c,d,e){return a.call(b,c,d,e)}}function k(){}function l(a,b){var c=N.length;return N[c]="'+_.escape("+b+")+'",M+c}function m(a,b){var c=N.length;return N[c]="'+((__t=("+b+"))==null?'':__t)+'",M+c}function n(a,b){var c=N.length;return N[c]="';"+b+";__p+='",M+c}function o(a,b,c,d){if(!a)return c;var e=a.length,f=3>arguments.length;d&&(b=j(b,d));if(e===e>>>0){for(e&&f&&(c=a[--e]);e--;)c=b(c,a[e],e,a);return c}var g=bC(a);for((e=g.length)&&f&&(c=a[g[--e]]);e--;)f=g[e],c=b(c,a[f],f,a);return c}function p(a,c,d){if(a)return c==b||d?a[0]:bb.call(a,0,c)}function q(a,b){var c=[];if(!a)return c;for(var d,e=-1,f=a.length;++e<f;)d=a[e],bB(d)?ba.apply(c,b?d:q(d)):c.push(d);return c}function r(a,b,c){if(!a)return-1;var d=-1,e=a.length;if(c){if("number"!=typeof c)return d=u(a,b),a[d]===b?d:-1;d=(0>c?Math.max(0,e+c):c)-1}for(;++d<e;)if(a[d]===b)return d;return-1}function s(a,b,c){var d=-Infinity,e=d;if(!a)return e;var f=-1,g=a.length;if(!b){for(;++f<g;)a[f]>e&&(e=a[f]);return e}for(c&&(b=j(b,c));++f<g;)c=b(a[f],f,a),c>d&&(d=c,e=a[f]);return e}function t(a,c,d){return a?bb.call(a,c==b||d?1:c):[]}function u(a,b,c,d){if(!a)return 0;var e,f=0,g=a.length;if(c){if(d)var h=c,c=function(a){return h.call(d,a)};for(b=c(b);f<g;)e=f+g>>>1,c(a[e])<b?f=e+1:g=e}else for(;f<g;)e=f+g>>>1,a[e]<b?f=e+1:g=e;return f}function v(a,b,c,d){var e=[];if(!a)return e;var f=-1,g=a.length,h=[];"function"==typeof b&&(d=c,c=b,b=C);for(c?d&&(c=j(c,d)):c=y;++f<g;)if(d=c(a[f],f,a),b?!f||h[h.length-1]!==d:0>r(h,d))h.push(d),e.push(a[f]);return e}function w(a,b){function c(){var g=arguments,h=b;return e||(a=b[d]),f.length&&(g=g.length?$.apply(f,g):f),this instanceof c?(k.prototype=a.prototype,h=new k,g=a.apply(h,g),P[typeof g]&&g!==B?g:h):a.apply(h,g)}var d,e=bc.call(a)==U;if(e){if(bd)return bd.call.apply(bd,arguments)}else d=b,b=a;var f=bb.call(arguments,2);return c}function x(a,c,d){d||(d=[]);if(a===c)return 0!==a||1/a==1/c;if(a==b||c==b)return a===c;a._chain&&(a=a._wrapped),c._chain&&(c=c._wrapped);if(a.isEqual&&bc.call(a.isEqual)==U)return a.isEqual(c);if(c.isEqual&&bc.call(c.isEqual)==U)return c.isEqual(a);var e=bc.call(a);if(e!=bc.call(c))return C;switch(e){case X:return a==""+c;case V:return a!=+a?c!=+c:0==a?1/a==1/c:a==+c;case S:case T:return+a==+c;case W:return a.source==c.source&&a.global==c.global&&a.multiline==c.multiline&&a.ignoreCase==c.ignoreCase}if("object"!=typeof a||"object"!=typeof c)return C;for(var f=d.length;f--;)if(d[f]==a)return A;var f=-1,g=A,h=0;d.push(a);if(e==R){if(h=a.length,g=h==c.length)for(;h--&&(g=x(a[h],c[h],d)););}else{if("constructor"in a!="constructor"in c||a.constructor!=c.constructor)return C;for(var i in a)if(_.call(a,i)&&(h++,!(g=_.call(c,i)&&x(a[i],c[i],d))))break;if(g){for(i in c)if(_.call(c,i)&&!(h--))break;g=!h}if(g&&E)for(;7>++f&&(i=L[f],!_.call(a,i)||!!(g=_.call(c,i)&&x(a[i],c[i],d))););}return d.pop(),g}function y(a){return a}function z(a){bu(bA(a),function(b){var c=d[b]=a[b];e.prototype[b]=function(){var a=[this._wrapped];return arguments.length&&ba.apply(a,arguments),a=c.apply(d,a),this._chain&&(a=new e(a),a._chain=A),a}})}"use strict";var A=!0,B=null,C=!1,D="object"==typeof exports&&exports&&("object"==typeof global&&global&&global==global.global&&(a=global),exports),E=!{valueOf:0}.propertyIsEnumerable("valueOf"),F=0,G=a._,H=RegExp("^"+({}.valueOf+"").replace(/[.*+?^=!:${}()|[\]\/\\]/g,"\\$&").replace(/valueOf|for [^\]]+/g,".+?")+"$"),I=/__token__(\d+)/g,J=/[&<"']/g,K=/['\n\r\t\u2028\u2029\\]/g,L="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),M="__token__",N=[],O={"&":"&amp;","<":"&lt;",'"':"&quot;","'":"&#x27;"},P={"boolean":C,"function":A,object:A,number:C,string:C,"undefined":C},Q={"\\":"\\","'":"'","\n":"n","\r":"r","\t":"t","\u2028":"u2028","\u2029":"u2029"},R="[object Array]",S="[object Boolean]",T="[object Date]",U="[object Function]",V="[object Number]",W="[object RegExp]",X="[object String]",Y=Array.prototype,Z=Object.prototype,$=Y.concat,_=Z.hasOwnProperty,ba=Y.push,bb=Y.slice,bc=Z.toString,bd=H.test(bd=bb.bind)&&/\n|Opera/.test(bd+bc.call(a.opera))&&bd,be=H.test(be=Array.isArray)&&be,bf=a.isFinite,bg=H.test(bg=Object.keys)&&bg,bh=a.clearTimeout,bi=a.setTimeout;d.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,variable:"obj"};var bj=Function("obj","var __p;with(obj){__p='var l,u';if(k){__p+='='+k};__p+=';'+f+';'+q+';';if(c){__p+='var o='+g+'.length;l=-1;';if(o){__p+='if(o===o>>>0){'};__p+=''+c['d']+';while('+c['m']+'){'+c['j']+'}';if(o){__p+='}'}}if(o){if(c){__p+='else{'}if(!i){__p+='var v=typeof '+l+'==\\'function\\';'};__p+=''+o['d']+';for('+o['m']+'){';if(i){if(r){__p+='if('+h+'){'};__p+=''+o['j']+';';if(r){__p+='}'}}else{__p+='if(!(v&&l==\\'prototype\\')';if(r){__p+='&&'+h};__p+='){'+o['j']+'}'};__p+='}';if(i){__p+='var g='+l+'.constructor;';for(var k=0;k<7;k++){__p+='l=\\''+p[k]+'\\';if(';if(p[k]=='constructor'){__p+='!(g&&g.prototype==='+l+')&&'};__p+=''+h+'){'+o['j']+'}'}}if(c){__p+='}'}};__p+=''+e+';return u'}return __p"),bk={a:"f,d,B",k:"f",q:"if(!d){d=k}else if(B){d=n(d,B)}",j:"d(f[l],l,f)"},bl={k:"D",j:"if(!d(f[l],l,f))return!u"},bm={a:"r",k:"r",q:"for(var x,y=1,o=arguments.length;y<o;y++){x=arguments[y];"+(E?"if(x){":""),m:"l in x",r:C,j:"r[l]=x[l]",e:(E?"}":"")+"}"},bn={k:"[]",j:"d(f[l],l,f)&&u.push(f[l])"},bo={q:"if(B)d=n(d,B)"},bp={j:{n:bk.j}},bq={k:"",f:"if(!f)return[]",d:{b:"u=Array(o)",n:"u=[]"},j:{b:"u[l]=d(f[l],l,f)",n:"u.push(d(f[l],l,f))"}},br=f({a:"r",f:"if(!s[typeof r]||r===null)throw TypeError()",k:"[]",j:"u.push(l)"}),H=f({a:"f,A",k:"h",j:"if(f[l]===A)return D"}),bs=f(bk,bl),Z=f(bk,bn),bt=f(bk,bo,{k:"",j:"if(d(f[l],l,f))return f[l]"}),bu=f(bk,bo),bv=f(bq,{a:"f,p",q:"var b=w.call(arguments,2),m=typeof p=='function'",j:{b:"u[l]=(m?p:f[l][p]).apply(f[l],b)",n:"u.push((m?p:f[l][p]).apply(f[l],b))"}}),bw=f(bk,bq),bx=f(bq,{a:"f,t",j:{b:"u[l]=f[l][t]",n:"u.push(f[l][t])"}}),bq=f({a:"f,d,a,B",k:"a",q:"var q=arguments.length<3;if(B)d=n(d,B)",d:{b:"if(q)u=f[++l]"},j:{b:"u=d(u,f[l],l,f)",n:"u=q?(q=h,f[l]):d(u,f[l],l,f)"}}),bn=f(bk,bn,{j:"!"+bn.j}),bl=f(bk,bl,{k:"h",j:bl.j.replace("!","")}),by=f(bm,{j:"if(r[l]==E)"+bm.j}),bz=f(bm),bm=f(bk,bo,bp,{r:C}),bk=f(bk,bo,bp),bA=f({a:"r",k:"[]",r:C,j:"if(C.call(r[l])==i)u.push(l)",e:"u.sort()"});c(arguments)||(c=function(a){return!!a&&!!_.call(a,"callee")});var bB=be||function(a){return bc.call(a)==R},be=f({a:"F",k:"D",q:"var e=C.call(F);if(e==c||e==z)return!F.length",j:{n:"return h"}}),bC=bg?function(a){return"function"==typeof a?br(a):bg(a)}:br,bD=f({a:"r",k:"[]",j:"u.push(r[l])"});d.VERSION="0.3.1",d.after=function(a,b){return 1>a?b():function(){if(1>--a)return b.apply(this,arguments)}},d.bind=w,d.bindAll=function(a){var b=arguments,c=1;1==b.length&&(c=0,b=bA(a));for(var d=b.length;c<d;c++)a[b[c]]=w(a[b[c]],a);return a},d.chain=function(a){return a=new e(a),a._chain=A,a},d.clone=function(a){return P[typeof a]&&a!==B?bB(a)?a.slice():bz({},a):a},d.compact=function(a){var b=[];if(!a)return b;for(var c=-1,d=a.length;++c<d;)a[c]&&b.push(a[c]);return b},d.compose=function(){var a=arguments;return function(){for(var b=arguments,c=a.length;c--;)b=[a[c].apply(this,b)];return b[0]}},d.contains=H,d.debounce=function(a,c,d){function e(){i=b,d||a.apply(h,f)}var f,g,h,i;return function(){var b=d&&!i;return f=arguments,h=this,bh(i),i=bi(e,c),b&&(g=a.apply(h,f)),g}},d.defaults=by,d.defer=function(a){var c=bb.call(arguments,1);return bi(function(){return a.apply(b,c)},1)},d.delay=function(a,c){var d=bb.call(arguments,2);return bi(function(){return a.apply(b,d)},c)},d.difference=function(a){var b=[];if(!a)return b;for(var c=-1,d=a.length,e=$.apply(b,bb.call(arguments,1));++c<d;)0>r(e,a[c])&&b.push(a[c]);return b},d.escape=function(a){return a==B?"":(a+"").replace(J,i)},d.every=bs,d.extend=bz,d.filter=Z,d.find=bt,d.first=p,d.flatten=q,d.forEach=bu,d.forIn=bm,d.forOwn=bk,d.functions=bA,d.groupBy=function(a,b,c){var d={};if(!a)return d;var e,f=-1,g="function"==typeof b,h=a.length;for(g&&c&&(b=j(b,c));++f<h;)e=a[f],c=g?b(e,f,a):e[b],(_.call(d,c)?d[c]:d[c]=[]).push(e);return d},d.has=function(a,b){return _.call(a,b)},d.identity=y,d.indexOf=r,d.initial=function(a,c,d){return a?bb.call(a,0,-(c==b||d?1:c)):[]},d.intersection=function(a){var b=[];if(!a)return b;for(var c,d=-1,e=a.length,f=bb.call(arguments,1);++d<e;)c=a[d],0>r(b,c)&&bs(f,function(a){return-1<r(a,c)})&&b.push(c);return b},d.invoke=bv,d.isArguments=c,d.isArray=bB,d.isBoolean=function(a){return a===A||a===C||bc.call(a)==S},d.isDate=function(a){return bc.call(a)==T},d.isElement=function(a){return!!a&&1==a.nodeType},d.isEmpty=be,d.isEqual=x,d.isFinite=function(a){return bf(a)&&bc.call(a)==V},d.isFunction=function(a){return bc.call(a)==U},d.isNaN=function(a){return bc.call(a)==V&&a!=+a},d.isNull=function(a){return a===B},d.isNumber=function(a){return bc.call(a)==V},d.isObject=function(a){return P[typeof a]&&a!==B},d.isRegExp=function(a){return bc.call(a)==W},d.isString=function(a){return bc.call(a)==X},d.isUndefined=function(a){return a===b},d.keys=bC,d.last=function(a,c,d){if(a){var e=a.length;return c==b||d?a[e-1]:bb.call(a,-c||e)}},d.lastIndexOf=function(a,b,c){if(!a)return-1;var d=a.length;for(c&&"number"==typeof c&&(d=(0>c?Math.max(0,d+c):Math.min(c,d-1))+1);d--;)if(a[d]===b)return d;return-1},d.map=bw,d.max=s,d.memoize=function(a,b){var c={};return function(){var d=b?b.apply(this,arguments):arguments[0];return _.call(c,d)?c[d]:c[d]=a.apply(this,arguments)}},d.min=function(a,b,c){var d=Infinity,e=d;if(!a)return e;var f=-1,g=a.length;if(!b){for(;++f<g;)a[f]<e&&(e=a[f]);return e}for(c&&(b=j(b,c));++f<g;)c=b(a[f],f,a),c<d&&(d=c,e=a[f]);return e},d.mixin=z,d.noConflict=function(){return a._=G,this},d.once=function(a){var b,c=C;return function(){return c?b:(c=A,b=a.apply(this,arguments))}},d.partial=function(a){var b=bb.call(arguments,1),c=b.length;return function(){var d;return d=arguments,d.length&&(b.length=c,ba.apply(b,d)),d=1==b.length?a.call(this,b[0]):a.apply(this,b),b.length=c,d}},d.pick=function(a){for(var b,c=0,d=$.apply(Y,arguments),e=d.length,f={};++c<e;)b=d[c],b in a&&(f[b]=a[b]);return f},d.pluck=bx,d.range=function(a,b,c){c||(c=1),2>arguments.length&&(b=a||0,a=0);for(var d=-1,e=Math.max(Math.ceil((b-a)/c),0),f=Array(e);++d<e;)f[d]=a,a+=c;return f},d.reduce=bq,d.reduceRight=o,d.reject=bn,d.rest=t,d.result=function(a,b){if(!a)return B;var c=a[b];return bc.call(c)==U?a[b]():c},d.shuffle=function(a){if(!a)return[];for(var b,c=-1,d=a.length,e=Array(d);++c<d;)b=Math.floor(Math.random()*(c+1)),e[c]=e[b],e[b]=a[c];return e},d.size=function(a){var b=bc.call(a);return b==R||b==X?a.length:bC(a).length},d.some=bl,d.sortBy=function(a,c,d){if(!a)return[];if("string"==typeof c)var e=c,c=function(a){return a[e]};else d&&(c=j(c,d));for(var d=-1,f=a.length,g=Array(f);++d<f;)g[d]={a:c(a[d],d,a),b:a[d]};for(g.sort(function(a,c){var d=a.a,e=c.a;return d===b?1:e===b?-1:d<e?-1:d>e?1:0});f--;)g[f]=g[f].b;return g},d.sortedIndex=u,d.tap=function(a,b){return b(a),a},d.template=function(a,b,c){c||(c={});var e;e=d.templateSettings;var f=c.escape,i=c.evaluate,j=c.interpolate,c=c.variable;return f==B&&(f=e.escape),i==B&&(i=e.evaluate),j==B&&(j=e.interpolate),f&&(a=a.replace(f,l)),j&&(a=a.replace(j,m)),i&&(a=a.replace(i,n)),a="__p='"+a.replace(K,h).replace(I,g)+"';",N.length=0,c||(c=e.variable,a="with("+c+"||{}){"+a+"}"),a="function("+c+"){var __p,__t,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,'')}"+a+"return __p}",e=Function("_","return "+a)(d),b?e(b):(e.source=a,e)},d.throttle=function(a,c){function d(){i=new Date,h=b,a.apply(g,e)}var e,f,g,h,i=0;return function(){var b=new Date,j=c-(b-i);return e=arguments,g=this,0>=j?(i=b,f=a.apply(g,e)):h||(h=bi(d,j)),f}},d.times=function(a,b,c){var d=-1;if(c)for(;++d<a;)b.call(c,d);else for(;++d<a;)b(d)},d.toArray=function(a){if(!a)return[];if(bc.call(a.toArray)==U)return a.toArray();var b=a.length;return b===b>>>0?bb.call(a):bD(a)},d.union=function(){for(var a=-1,b=[],c=$.apply(b,arguments),d=c.length;++a<d;)0>r(b,c[a])&&b.push(c[a]);return b},d.uniq=v,d.uniqueId=function(a){var b=F++;return a?a+b:b},d.values=bD,d.without=function(a){var b=[];if(!a)return b;for(var c=bb.call(arguments,1),d=-1,e=a.length;++d<e;)0>r(c,a[d])&&b.push(a[d]);return b},d.wrap=function(a,b){return function(){var c=[a];return arguments.length&&ba.apply(c,arguments),b.apply(this,c)}},d.zip=function(a){if(!a)return[];for(var b=-1,c=s(bx(arguments,"length")),d=Array(c);++b<c;)d[b]=bx(arguments,b);return d},d.all=bs,d.any=bl,d.collect=bw,d.detect=bt,d.each=bu,d.foldl=bq,d.foldr=o,d.head=p,d.include=H,d.inject=bq,d.methods=bA,d.select=Z,d.tail=t,d.take=p,d.unique=v,e.prototype=d.prototype,z(d),e.prototype.chain=function(){return this._chain=A,this},e.prototype.value=function(){return this._wrapped},bu("pop push reverse shift sort splice unshift".split(" "),function(a){var b=Y[a];e.prototype[a]=function(){var a=this._wrapped;return b.apply(a,arguments),a.length===0&&delete a[0],this._chain&&(a=new e(a),a._chain=A),a}}),bu(["concat","join","slice"],function(a){var b=Y[a];e.prototype[a]=function(){var a=b.apply(this._wrapped,arguments);return this._chain&&(a=new e(a),a._chain=A),a}}),typeof define=="function"&&typeof define.amd=="object"&&define.amd?(a._=d,define(function(){return d})):D?"object"==typeof module&&module&&module.s==D?(module.s=d)._=d:D._=d:a._=d}(this),function(){function a(a){return a?c.escapeRegExp(a):"\\s"}var b=String.prototype.trim,c;c=this._s={capitalize:function(a){return a.charAt(0).toUpperCase()+a.substring(1).toLowerCase()},join:function(a){for(var b="",c=1;c<arguments.length;c+=1)b+=String(arguments[c]),c!==arguments.length-1&&(b+=String(a));return b},escapeRegExp:function(a){return a.replace(/([-.*+?^${}()|[\]\/\\])/g,"\\$1")},reverse:function(a){return Array.prototype.reverse.apply(a.split("")).join("")},contains:function(a,b){return a.indexOf(b)!==-1},clean:function(a){return c.strip(a.replace(/\s+/g," "))},trim:function(c,d){return!d&&b?b.call(c):(d=a(d),c.replace(new RegExp("^["+d+"]+|["+d+"]+$","g"),""))},ltrim:function(b,c){return c=a(c),b.replace(new RegExp("^["+c+"]+","g"),"")},rtrim:function(b,c){return c=a(c),b.replace(new RegExp("["+c+"]+$","g"),"")},startsWith:function(a,b){return a.length>=b.length&&a.substring(0,b.length)===b},endsWith:function(a,b){return a.length>=b.length&&a.substring(a.length-b.length)===b},sprintf:function(){for(var a=0,b,c=arguments[a++],d=[],e,f,g;c;){if(e=/^[^\x25]+/.exec(c))d.push(e[0]);else if(e=/^\x25{2}/.exec(c))d.push("%");else{if(!(e=/^\x25(?:(\d+)\$)?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(c)))throw"Huh ?!";if((b=arguments[e[1]||a++])==null||b==undefined)throw"Too few arguments.";if(/[^s]/.test(e[7])&&typeof b!="number")throw"Expecting number but found "+typeof b;switch(e[7]){case"b":b=b.toString(2);break;case"c":b=String.fromCharCode(b);break;case"d":b=parseInt(b);break;case"e":b=e[6]?b.toExponential(e[6]):b.toExponential();break;case"f":b=e[6]?parseFloat(b).toFixed(e[6]):parseFloat(b);break;case"o":b=b.toString(8);break;case"s":b=(b=String(b))&&e[6]?b.substring(0,e[6]):b;break;case"u":b=Math.abs(b);break;case"x":b=b.toString(16);break;case"X":b=b.toString(16).toUpperCase()}b=/[def]/.test(e[7])&&e[2]&&b>=0?"+"+b:b,f=e[3]?e[3]=="0"?"0":e[3].charAt(1):" ",g=e[5]-String(b).length-0;if(e[5]){g=g;for(var h=[];g>0;h[--g]=f);f=h.join("")}else f="";f=f,d.push(""+(e[4]?b+f:f+b))}c=c.substring(e[0].length)}return d.join("")}},this._s.strip=c.trim,this._s.lstrip=c.ltrim,this._s.rstrip=c.rtrim,this._&&this._.mixin(this._s)}(),TD.core.sha1=function(a){function b(a,b){var c=a<<b|a>>>32-b;return c}function c(a){var b="",c,d,e;for(c=0;c<=6;c+=2)d=a>>>c*4+4&15,e=a>>>c*4&15,b+=d.toString(16)+e.toString(16);return b}function d(a){var b="",c,d;for(c=7;c>=0;c--)d=a>>>c*4&15,b+=d.toString(16);return b}function e(a){a=a.replace(/\r\n/g,"\n");var b="";for(var c=0;c<a.length;c++){var d=a.charCodeAt(c);d<128?b+=String.fromCharCode(d):d>127&&d<2048?(b+=String.fromCharCode(d>>6|192),b+=String.fromCharCode(d&63|128)):(b+=String.fromCharCode(d>>12|224),b+=String.fromCharCode(d>>6&63|128),b+=String.fromCharCode(d&63|128))}return b}var f,g,h,i=new Array(80),j=1732584193,k=4023233417,l=2562383102,m=271733878,n=3285377520,o,p,q,r,s,t;a=e(a);var u=a.length,v=new Array;for(g=0;g<u-3;g+=4)h=a.charCodeAt(g)<<24|a.charCodeAt(g+1)<<16|a.charCodeAt(g+2)<<8|a.charCodeAt(g+3),v.push(h);switch(u%4){case 0:g=2147483648;break;case 1:g=a.charCodeAt(u-1)<<24|8388608;break;case 2:g=a.charCodeAt(u-2)<<24|a.charCodeAt(u-1)<<16|32768;break;case 3:g=a.charCodeAt(u-3)<<24|a.charCodeAt(u-2)<<16|a.charCodeAt(u-1)<<8|128}v.push(g);while(v.length%16!=14)v.push(0);v.push(u>>>29),v.push(u<<3&4294967295);for(f=0;f<v.length;f+=16){for(g=0;g<16;g++)i[g]=v[f+g];for(g=16;g<=79;g++)i[g]=b(i[g-3]^i[g-8]^i[g-14]^i[g-16],1);o=j,p=k,q=l,r=m,s=n;for(g=0;g<=19;g++)t=b(o,5)+(p&q|~p&r)+s+i[g]+1518500249&4294967295,s=r,r=q,q=b(p,30),p=o,o=t;for(g=20;g<=39;g++)t=b(o,5)+(p^q^r)+s+i[g]+1859775393&4294967295,s=r,r=q,q=b(p,30),p=o,o=t;for(g=40;g<=59;g++)t=b(o,5)+(p&q|p&r|q&r)+s+i[g]+2400959708&4294967295,s=r,r=q,q=b(p,30),p=o,o=t;for(g=60;g<=79;g++)t=b(o,5)+(p^q^r)+s+i[g]+3395469782&4294967295,s=r,r=q,q=b(p,30),p=o,o=t;j=j+o&4294967295,k=k+p&4294967295,l=l+q&4294967295,m=m+r&4294967295,n=n+s&4294967295}var t=d(j)+d(k)+d(l)+d(m)+d(n);return t.toLowerCase()},function(){var a=8,b="=",c=0,d=function(b){var c=[],d=(1<<a)-1,e=b.length*a,f;for(f=0;f<e;f+=a)c[f>>5]|=(b.charCodeAt(f/a)&d)<<32-a-f%32;return c},e=function(a){var b=[],c=a.length,d,e;for(d=0;d<c;d+=2){e=parseInt(a.substr(d,2),16);if(!isNaN(e))b[d>>3]|=e<<24-4*(d%8);else return"INVALID HEX STRING"}return b},f=function(a){var b=c?"0123456789ABCDEF":"0123456789abcdef",d="",e=a.length*4,f,g;for(f=0;f<e;f+=1)g=a[f>>2]>>(3-f%4)*8,d+=b.charAt(g>>4&15)+b.charAt(g&15);return d},g=function(a){var c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",d="",e=a.length*4,f,g,h;for(f=0;f<e;f+=3){h=(a[f>>2]>>8*(3-f%4)&255)<<16|(a[f+1>>2]>>8*(3-(f+1)%4)&255)<<8|a[f+2>>2]>>8*(3-(f+2)%4)&255;for(g=0;g<4;g+=1)f*8+g*6<=a.length*32?d+=c.charAt(h>>6*(3-g)&63):d+=b}return d},h=function(a,b){return a>>>b|a<<32-b},i=function(a,b){return a>>>b},j=function(a,b,c){return a&b^~a&c},k=function(a,b,c){return a&b^a&c^b&c},l=function(a){return h(a,2)^h(a,13)^h(a,22)},m=function(a){return h(a,6)^h(a,11)^h(a,25)},n=function(a){return h(a,7)^h(a,18)^i(a,3)},o=function(a){return h(a,17)^h(a,19)^i(a,10)},p=function(a,b){var c=(a&65535)+(b&65535),d=(a>>>16)+(b>>>16)+(c>>>16);return(d&65535)<<16|c&65535},q=function(a,b,c,d){var e=(a&65535)+(b&65535)+(c&65535)+(d&65535),f=(a>>>16)+(b>>>16)+(c>>>16)+(d>>>16)+(e>>>16);return(f&65535)<<16|e&65535},r=function(a,b,c,d,e){var f=(a&65535)+(b&65535)+(c&65535)+(d&65535)+(e&65535),g=(a>>>16)+(b>>>16)+(c>>>16)+(d>>>16)+(e>>>16)+(f>>>16);return(g&65535)<<16|f&65535},s=function(a,b,c){var d,e,f,g,h,i,s,t,u,v,w,x,y,z,A,B=[],C;if(c==="SHA-224"||c==="SHA-256")x=(b+65>>9<<4)+15,A=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],c==="SHA-224"?w=[3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428]:w=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225];a[b>>5]|=128<<24-b%32,a[x]=b,C=a.length;for(y=0;y<C;y+=16){d=w[0],e=w[1],f=w[2],g=w[3],h=w[4],i=w[5],s=w[6],t=w[7];for(z=0;z<64;z+=1)z<16?B[z]=a[z+y]:B[z]=q(o(B[z-2]),B[z-7],n(B[z-15]),B[z-16]),u=r(t,m(h),j(h,i,s),A[z],B[z]),v=p(l(d),k(d,e,f)),t=s,s=i,i=h,h=p(g,u),g=f,f=e,e=d,d=p(u,v);w[0]=p(d,w[0]),w[1]=p(e,w[1]),w[2]=p(f,w[2]),w[3]=p(g,w[3]),w[4]=p(h,w[4]),w[5]=p(i,w[5]),w[6]=p(s,w[6]),w[7]=p(t,w[7])}switch(c){case"SHA-224":return[w[0],w[1],w[2],w[3],w[4],w[5],w[6]];case"SHA-256":return w;default:return[]}},t=function(b,c){this.sha224=null,this.sha256=null,this.strBinLen=null,this.strToHash=null;if("HEX"===c){if(0!==b.length%2)return"TEXT MUST BE IN BYTE INCREMENTS";this.strBinLen=b.length*4,this.strToHash=e(b)}else if("ASCII"===c||"undefined"==typeof c)this.strBinLen=b.length*a,this.strToHash=d(b);else return"UNKNOWN TEXT INPUT TYPE"};t.prototype={getHash:function(a,b){var c=null,d=this.strToHash.slice();switch(b){case"HEX":c=f;break;case"B64":c=g;break;default:return"FORMAT NOT RECOGNIZED"}switch(a){case"SHA-224":return null===this.sha224&&(this.sha224=s(d,this.strBinLen,a)),c(this.sha224);case"SHA-256":return null===this.sha256&&(this.sha256=s(d,this.strBinLen,a)),c(this.sha256);default:return"HASH NOT RECOGNIZED"}},getHMAC:function(b,c,h,i){var j,k,l,m,n,o,p=[],q=[];switch(i){case"HEX":j=f;break;case"B64":j=g;break;default:return"FORMAT NOT RECOGNIZED"}switch(h){case"SHA-224":o=224;break;case"SHA-256":o=256;break;default:return"HASH NOT RECOGNIZED"}if("HEX"===c){if(0!==b.length%2)return"KEY MUST BE IN BYTE INCREMENTS";k=e(b),n=b.length*4}else if("ASCII"===c)k=d(b),n=b.length*a;else return"UNKNOWN KEY INPUT TYPE";64<n/8?(k=s(k,n,h),k[15]&=4294967040):64>n/8&&(k[15]&=4294967040);for(l=0;l<=15;l+=1)p[l]=k[l]^909522486,q[l]=k[l]^1549556828;return m=s(p.concat(this.strToHash),512+this.strBinLen,h),m=s(q.concat(m),512+o,h),j(m)}},window.jsSHA=t}(),TD.util=function(){var a,b,c=0,d=1e3,e=d*60,f=e*60,g=f*24,h=g*7,i=/(.+)(?:_normal)\.(\w+)$/,j=new RegExp("<(?:.|\\n)*?>","gm"),k=/\B(?=(\d{3})+(?!\d))/g,l=/^[@\uff20]?/,m=/^https?:\/\/twitter.com\/([a-zA-Z0-9-_]+)(?:\/status\/([0-9]+))?$/;return $.subscribe("/date",function(a){var b=TD.util.parseDateString(a).getTime(),d=(new Date).getTime();c=b-d}),{ANCHOR_TAG_REGEXP:/href=/g,LT_REGEXP:/</g,GT_REGEXP:/>/g,SINGLE_QUOTE_REGEXP:/'/g,QUOTE_REGEXP:/"/g,TWITTER_USERNAME_REGEXP:/@([A-Za-z0-9_]+)/g,parseDateString:function(a){var b;return $.browser.msie&&a?b=new Date(Date.parse(a.replace(/( \+)/," UTC$1"))):b=new Date(a),b},parseISO8601:function(a){var b=a.split("+"),c=b[0].split("T"),d=c[0].split("-"),e=c[1].split("Z"),f=e[0].split(":"),g=f[2].split("."),h=Number(f[0]),i=new Date;return i.setUTCDate(1),i.setUTCMonth(0),i.setUTCFullYear(Number(d[0])),i.setUTCMonth(Number(d[1])-1),i.setUTCDate(Number(d[2])),i.setUTCHours(Number(h)),i.setUTCMinutes(Number(f[1])),i.setUTCSeconds(Number(g[0])),g[1]?i.setUTCMilliseconds(Number(g[1].substring(0,3))):i.setUTCMilliseconds(0),i},iso8601:function(a){a||(a=new Date);var b=("000"+a.getUTCFullYear()).slice(-4)+"-"+("0"+(a.getUTCMonth()+1)).slice(-2)+"-"+("0"+a.getUTCDate()).slice(-2)+"T"+("0"+a.getUTCHours()).slice(-2)+":"+("0"+a.getUTCMinutes()).slice(-2)+":"+("0"+a.getUTCSeconds()).slice(-2);return a.getMilliseconds()&&(b+="."+("000"+a.getMilliseconds()).slice(-3)),b},unixTime:function(a){return Math.round(a.getTime()/1e3)},prettyDate:function(a){return TD.util.timeAgo(a.getTime(),!1,!0)},clean:function(a){return a?a.replace(this.LT_REGEXP,"&lt;").replace(this.GT_REGEXP,"&gt;").replace(this.SINGLE_QUOTE_REGEXP,"&#39;").replace(this.QUOTE_REGEXP,"&quot;"):a},removeHTMLCodes:function(a){return a.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"')},stripHTMLTags:function(a){return a.replace(j,"")},htmlToText:function(a){return $("<div>"+a+"</div>").text()},h:function(a){var b=$("<div/>"),c=function(a){return a?b.text(a).html().replace(/\"/gi,"&quot;"):a};return this.h=function(a){return c(a)},c(a)},transform:function(a,b){return a?(b=b||{},this.updateEntities(a,b),this.linkify(a,b)):""},updateEntities:function(a,b){var c=twttr.txt.modifyIndicesFromUnicodeToUTF16,d,e,f,g,h,i,j,k;b.media&&b.media.length?c(a,b.media):b.media=[];if(b.urls&&b.urls.length)c(a,b.urls);else{e=this.extractURLEntities(a),k={},b.urls=[];for(f=0;f<b.media.length;f++)k[b.media[f].url]=!0;for(f=0;f<e.length;f++)k[e[f].url]||b.urls.push(e[f])}b.hashtags&&b.hashtags.length?c(a,b.hashtags):b.hashtags=this.extractHashtagEntities(a),b.user_mentions&&b.user_mentions.length?c(a,b.user_mentions):b.user_mentions=[],b.cashtags=twttr.txt.extractCashtagsWithIndices(a),d=this.extractMentionEntities(a);for(f=0,h=d.length;f<h;f++)i=d[f],j=this.getEntityOverlap(i,b),j?i.list_slug&&i.indices[0]===j.indices[0]&&(j.indices=i.indices,j.list_slug=i.list_slug):b.user_mentions.push(i);return b},extractURLEntities:function(a){return twttr.txt.extractUrlsWithIndices(a)},extractMentionEntities:function(a){var b=twttr.txt.extractMentionsOrListsWithIndices(a);return _.each(b,function(a){a.screen_name=a.screenName,a.list_slug=a.listSlug,delete a.screenName,delete a.listSlug}),b},extractHashtagEntities:function(a){var b=twttr.txt.extractHashtagsWithIndices(a);return _.each(b,function(a){a.text=a.hashtag,delete a.hashtag}),b},getEntityOverlap:function(a,b){var c=b.urls;c=c.concat(b.media),c=c.concat(b.user_mentions),c=c.concat(b.hashtags);for(var d=0,e=c.length;d<e;d++)if(a.indices[0]<c[d].indices[1]&&a.indices[1]>c[d].indices[0])return c[d];return null},linkify:function(a,b){var c,d,e,f,g,h="",i,j=b.urls||[];j=j.concat(b.media||[]),j=j.concat(b.user_mentions||[]),j=j.concat(b.hashtags||[]),j=j.concat(b.cashtags||[]),j.sort(function(a,b){return b.indices[0]-a.indices[0]});for(var k=0,l=j.length;k<l;k++)f=j[k],c=a.substring(0,f.indices[0]),d=a.substring(f.indices[0],f.indices[1]),e=a.substring(f.indices[1]),g="",f.url?d===f.url?g=this.createUrlAnchor(f):g=d:f.screen_name?f.list_slug?g=TD.ui.template.render("text/list_link",{slug:f.list_slug.substr(1),user:{screenName:f.screen_name},fullName:"@"+f.screen_name+f.list_slug}):(d='<span class="at">@</span>'+f.screen_name,g='<a href="http://twitter.com/'+f.screen_name+'"',g+=' rel="user"',g+=' data-user-name="'+f.screen_name+'"',g+=' target="_blank">'+d+"</a>"):f.text?(i={searchTerm:f.text,symbol:"#",escapedSymbol:escape("#")},g=TD.ui.template.render("text/search_link",i)):f.cashtag&&(i={searchTerm:f.cashtag,symbol:"$",escapedSymbol:escape("$")},g=TD.ui.template.render("text/search_link",i)),h=g+this.clean(e)+h,a=c;return this.clean(a)+h},createUrlAnchor:function(a){var b,c=a.url,d="url",e=a.expanded_url||a.url,f=e.match(m),g,h;return f&&(g=f[1],h=f[2]),!_.startsWith(c,"https://")&&!_.startsWith(c,"http://")&&(c="http://"+c),b='<a href="'+TD.util.escape(c)+'" target="_blank" class="url-ext" ',a.expanded_url&&(b+='data-full-url="'+TD.util.escape(a.expanded_url)+'" '),h?(d="tweet",b+='data-tweet-id="'+h+'" '):g&&(d="user",b+='data-user-name="'+g+'" '),b+='rel="'+d+'" ',a.display_url&&a.expanded_url&&a.display_url.charCodeAt(a.display_url.length-1)==8230&&(b+='title="'+TD.util.escape(a.expanded_url)+'" '),b+=">"+TD.util.escape(a.display_url||a.url)+"</a>",b},getReplyUsers:function(a){var b=a.getMainTweet(),c={},d=a.account.getUsername().toLowerCase(),e=[b.user.screenName];return e=e.concat(twttr.txt.extractMentions(b.text)),a.retweetedStatus&&e.push(a.user.screenName),e=e.filter(function(a){return a.toLowerCase()!==d}),b.user.isMe()&&e.length===0&&e.unshift(b.user.screenName),e=e.filter(function(a){var b=a.toLowerCase(),d=!c[b];return c[b]=!0,d}),e=e.map(TD.util.atMentionify),e},pluralise:function(a,b,c){return c!=1?b:a},atMentionify:function(a){return a.replace(l,"@")},deMentionify:function(a){return a.replace(l,"")},selectAttrsFrom:function(a,b){var c={};for(var d=0;d<b.length;d++)c[b[d]]=a[b[d]];return c},values:function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(a[c]);return b},isEmpty:_.isEmpty,isChromeApp:function(){return a==null&&(a=_.startsWith(window.location.href,"chrome-extension://")),a},isWrapperApp:function(){return b==null&&(b=Boolean(window.deck&&deck.inApp())),b},isUnsupportedWebWrapperVersion:function(){var a,b=!1,c=Boolean(TD.util.isWrapperApp()&&deck.getWrapperVersion),d;if(c){d=deck.getWrapperVersion();switch(TD.util.getAppEnv()){case"mac":a=TD.minWrapperVersionMac;break;case"win":a=TD.minWrapperVersionWin}b=!a||TD.util.versionComparator(d,a)<0}return b},isRetina:function(){return window.devicePixelRatio>=1.5},shouldStream:function(){var a=new XMLHttpRequest,b="withCredentials"in a;return b&&TD.settings.getUseStream()&&!TD.config.disable_streaming},getCurrentLocation:function(a,b,c){var d=Number.MAX_VALUE,e,f,g,h=navigator.geolocation,i=function(a){var b=a.coords.accuracy;b<d&&(e=a,d=b),b<50&&(clearTimeout(g),j())},j=function(){h.clearWatch(f),e?b(e):c&&c()};g=setTimeout(j,a),f=h.watchPosition(i,c,{enableHighAccuracy:!0})},openURL:function(a,b){if(!_.isString(a))return;if(!_.startsWith(a,"https://")&&!_.startsWith(a,"http://"))return;b&&(a=TD.net.util.addURLParameters(a,b));var c=window.open(a);c.focus()},maybeOpenClickExternally:function(a){var b=!1,c=$(a.currentTarget),d=c.prop("tagName"),e=c.attr("rel"),f=c.attr("target"),g=a.ctrlKey||a.shiftKey||a.altKey||a.metaKey||a.button!==0;return d==="A"&&f==="_blank"&&(e==="url"||g)&&(TD.util.isWrapperApp()?(TD.util.openURL(c.attr("href")),a.preventDefault(),a.stopImmediatePropagation()):a.stopImmediatePropagation(),b=!0),b},openEmail:function(a,b,c){var d="mailto:",e={};b&&(e.subject=b),c&&(e.body=c),a&&(d+=a),d=d+"?"+TD.net.util.formEncode(e),window.open(d)},escape:function(a){return this.clean(a)},truncateText:function(a,b,c,d,e,f){b=b==undefined?"â¦":b,d=d||0,f=f||0;var g;if(a.length>c+d){var h=a.indexOf(" ",c-f-1);h!=-1&&(c=Math.min(c,h+1)),g=a.substr(0,c),e&&(g=this.transform(g)),g+=b}return g},timesCached:null,timeWords:function(){return TD.util.timesCached||(TD.util.timesCached={longForm:{singular:{now:TD.i("now",null,!0),seconds:TD.i("{{one}} second ago",null,!0),minutes:TD.i("{{one}} minute ago",null,!0),hours:TD.i("{{one}} hour ago",null,!0),days:TD.i("{{one}} day ago",null,!0)},plural:{now:TD.i("now",null,!0),seconds:TD.i("{{plural_number}} seconds ago",null,!0),minutes:TD.i("{{plural_number}} minutes ago",null,!0),hours:TD.i("{{plural_number}} hours ago",null,!0),days:TD.i("{{plural_number}} days ago",null,!0)}},shortForm:{singular:{now:TD.i("now",null,!0),seconds:TD.i("{{one}}s",null,!0),minutes:TD.i("{{one}}m",null,!0),hours:TD.i("{{one}}h",null,!0),days:TD.i("{{one}}d",null,!0)},plural:{now:TD.i("now",null,!0),seconds:TD.i("{{plural_number}}s",null,!0),minutes:TD.i("{{plural_number}}m",null,!0),hours:TD.i("{{plural_number}}h",null,!0),days:TD.i("{{plural_number}}d",null,!0)}}}),TD.util.timesCached},datesCached:null,dates:function(){return TD.util.datesCached||(TD.util.datesCached={months:[TD.i("Jan"),TD.i("Feb"),TD.i("Mar"),TD.i("Apr"),TD.i("May"),TD.i("Jun"),TD.i("Jul"),TD.i("Aug"),TD.i("Sep"),TD.i("Oct"),TD.i("Nov"),TD.i("Dec")],dates:[TD.i("1st"),TD.i("2nd"),TD.i("3rd"),TD.i("4th"),TD.i("5th"),TD.i("6th"),TD.i("7th"),TD.i("8th"),TD.i("9th"),TD.i("10th"),TD.i("11th"),TD.i("12th"),TD.i("13th"),TD.i("14th"),TD.i("15th"),TD.i("16th"),TD.i("17th"),TD.i("18th"),TD.i("19th"),TD.i("20th"),TD.i("21st"),TD.i("22nd"),TD.i("23rd"),TD.i("24th"),TD.i("25th"),TD.i("26th"),TD.i("27th"),TD.i("28th"),TD.i("29th"),TD.i("30th"),TD.i("31st")]}),TD.util.datesCached},timeAgo:function(a,b,h){var i=(new Date).getTime(),j=(new Date(a)).getTime(),k,l=TD.util.timeWords()[b?"longForm":"shortForm"],m,n,o;return h&&(i+=c),k=i-j,isNaN(k)||k<d*-5?"":(k<d*7?(n="",m="now"):k<e?(n=Math.floor(k/d),m="seconds"):k<f?(n=Math.floor(k/e),m="minutes"):k<g?(n=Math.floor(k/f),m="hours"):(n=Math.floor(k/g),m="days"),n===1?l=l.singular:l=l.plural,o=TD.ui.template.toHtml(l[m],{one:n,plural_number:n}),o)},prettyTime:function(a){var b={month:TD.util.dates().months[a.getMonth()],hours24:a.getHours(),hours12:a.getHours()%12||12,minutes:TD.util.padLeadingZero(a.getMinutes()),amPm:a.getHours()<12?TD.i("am"):TD.i("pm"),date:TD.util.dates().dates[a.getDate()-1],day:a.getDate(),year:a.getFullYear().toString().slice(2)};return b},prettyTimeString:function(a){return TD.i("{{hours12}}:{{minutes}}{{amPm}} Â· {{day}} {{month}} {{year}}",TD.util.prettyTime(a))},padLeadingZero:function(a){return a.toString().replace(/^(\d)$/,"0$1")},prettyNumber:function(a){var b;if(typeof a=="string")a=parseInt(a,10);else if(typeof a!="number"||isNaN(a))return"";return b=a.toString().split("."),b[0].replace(k,",")},chirpDescSort:function(a,b){return b.created.getTime()-a.created.getTime()},chirpAscSort:function(a,b){return a.created.getTime()-b.created.getTime()},transformTwitterAvatar:function(a,b){return a.replace(i,"$1_"+b+".$2")},getOSName:function(){var a="";return this.isWrapperApp()?a=deck.osname():navigator.appVersion.indexOf("Win")!=-1?a="windows":navigator.appVersion.indexOf("Mac")!=-1?a="osx":navigator.appVersion.indexOf("Linux")!=-1&&(a="linux"),a},getAppEnv:function(){var a="unknown",b;if(this.isChromeApp())a="chrome";else if(this.isWrapperApp()){b=this.getOSName();switch(b){case"osx":a="mac";break;case"windows":a="win"}}else _.startsWith(window.location.href,"file://")||(a="web");return a},hasFixedScrollBars:function(){var a,b=$("<div>").css({width:"100px",height:"100px",overflow:"scroll",position:"absolute",top:"-9999px"});return $("body").append(b),a=b[0].offsetWidth-b[0].clientWidth,b.remove(),Boolean(a)},bind:function(a,b){return function(){a.apply(b,arguments)}},random:function(a,b){return b==null&&(b=a,a=0),a+(0|Math.random()*(b-a+1))},extendObjectWith:function(a,b){_.each(b,function(b){a[b[0]]=b[1]})},insertLogDivider:_.debounce(function(){console.log(" ")},1),versionComparator:function(a,b){a=a.toString(),b=b.toString();var c=a.split("."),d=b.split("."),e,f,g=Math.min(c.length,d.length);for(var h=0;h<g;h++){e=parseInt(c[h],10),f=parseInt(d[h],10);if(e>f)return 1;if(e<f)return-1}return c.length>d.length?1:c.length<d.length?-1:0},getPreciseTime:function(){if(!window.performance)return+(new Date);if(typeof window.performance.now=="function")return window.performance.now();if(typeof window.performance.webkitNow=="function")return window.performance.webkitNow()},fnPerformanceWrapper:function(a,b,c){return function(){var d=TD.util.getPreciseTime(),e,f=a.apply(b,arguments);return e=TD.util.getPreciseTime(),TD.controller.stats.performance.log(c,e-d),f}},logTimeToRenderColumn:function(a,b){var c;b>0&&(c=a/b,TD.controller.stats.performance.log(TD.controller.stats.performance.keys.RENDER_TWEET,c))},TpmCounter:function(a,b,c){var d=0,e=0,f=0,g=[],h=(new Date).getTime(),i=setInterval(function(){var a,i,j,k=(new Date).getTime(),l=k-b;g.push({renderedCount:f,startTime:h}),e+=f,f=0,h=k;while(g.length&&g[0].startTime<l)a=g.shift(),e-=a.renderedCount;g.length&&(i=k-g[0].startTime,j=6e4/i,d=e*j,$(document).trigger(c,{itemsPerMinute:Math.round(d)}))}.bind(this),a);this.incrementCounter=function(a){f+=a},this.stop=function(){clearInterval(i)}},deterministicObjectHash:function(a){var b=TD.util.createHashableObject(a),c=JSON.stringify(b),d=TD.core.sha1(c);return d=d.substr(0,10),d},createHashableObject:function(a){var b,c;if(Array.isArray(a))b=a.map(TD.util.createHashableObject),b.push("A");else if(a===Object(a)){b=[];for(var d in a)a.hasOwnProperty(d)&&(c=TD.util.createHashableObject(a[d]),b.push([d,c]));b.sort(function(a,b){return a[0].localeCompare(b[0])}),b.push("O")}else b=a;return b}}}(),TD.core.defer=function(){var a={};a.NAME="TD.core.defer",a.DEBUG_DEFERREDS=!1;var b=Array.prototype.slice,c=function(a){this.message=a,this.name=a};c.prototype=new Error,c.prototype.toString=function(){return this.message&&this.message!=this.name?this.name+"("+this.message.toString()+")":this.name+"()"};var d=function(a,b,d){d.prototype=new c(a.NAME+"."+b),a[b]=d};d(a,"AlreadyCalledError",function(a){this.deferred=a}),d(a,"CancelledError",function(a){this.deferred=a}),d(a,"GenericError",function(a){this.message=a}),d(a,"XMLHttpRequestError",function(a,b){this.req=a,this.message=b;try{this.number=a.status}catch(c){}});var e=function(){try{throw new Error("DEBUG_DEFERRED stack trace")}catch(a){return a.stack}};return a.Deferred=function(b){this.chain=[],this.id=_.uniqueId("d:"),a.DEBUG_DEFERREDS&&(this.create_stack=e()),this.fired=-1,this.paused=0,this.results=[null,null],this.canceller=b,this.silentlyCancelled=!1,this.chained=!1},a.Deferred.prototype={toString:function(){var a;return this.fired==-1?a="unfired":this.fired===0?a="success":a="error","Deferred("+this.id+", "+a+"["+this.chain.length+"])"},cancel:function(){this.fired==-1?(this.canceller?this.canceller(this):this.silentlyCancelled=!0,this.fired==-1&&this.errback(new a.CancelledError(this))):this.fired===0&&this.results[0]instanceof a.Deferred&&this.results[0].cancel()},_resback:function(b){a.DEBUG_DEFERREDS&&(this.invoke_stack=e()),this.fired=b instanceof Error?1:0,this.results[this.fired]=b,this._fire()},_check:function(){if(this.fired!=-1){if(!this.silentlyCancelled)throw new a.AlreadyCalledError(this);this.silentlyCancelled=!1;return}},callback:function(b){this._check();if(b instanceof a.Deferred)throw new Error("Deferred instances can only be chained if they are the result of a callback");this._resback(b)},errback:function(b){this._check();if(b instanceof a.Deferred)throw new Error("Deferred instances can only be chained if they are the result of a callback");b instanceof Error||(b=new a.GenericError(b)),this._resback(b)},addBoth:function(a){var c=b.call(arguments,1);return this.addCallbacks(a,a,c,c,null,null)},addBothWith:function(a,c){var d=b.call(arguments,2);return this.addCallbacks(c,c,d,d,a,a)},addCallback:function(a){var c=b.call(arguments,1);return this.addCallbacks(a,null,c,null,null,null)},addCallbackWith:function(a,c){var d=b.call(arguments,2);return this.addCallbacks(c,null,d,null,a,null)},addErrback:function(a){var c=b.call(arguments,1);return this.addCallbacks(null,a,null,c,null,null)},addErrbackWith:function(a,c){var d=b.call(arguments,2);return this.addCallbacks(null,c,null,d,null,a)},addCallbacks:function(a,b,c,d,e,f){if(this.chained)throw new Error("Chained Deferreds can not be re-used");return this.chain.push([a,b,c,d,e,f]),this.fired>=0&&this._fire(),this},_fire:function(){var b=this.chain,c=this.fired,d=this.results[c],e=this,f=null,g,h,i=function(a){e._resback(a),e.paused--,e.paused===0&&e.fired>=0&&e._fire()};while(b.length>0&&this.paused===0){var j=b.shift(),k=j[c];if(k===null)continue;try{j[2+c]?g=[d].concat(j[2+c]):g=[d],h=j[4+c],d=k.apply(h,g),c=d instanceof Error?1:0,d instanceof a.Deferred&&(f=i,this.paused++)}catch(l){c=1,l instanceof Error?d=l:d=new a.GenericError(l),d.stack&&d.stack.split?d.stackTrace=d.stack.split("\n"):d.stackTrace=[]}}this.fired=c,this.results[c]=d,f&&this.paused&&(d.addBoth(f),d.chained=!0)}},a.DeferredList=function(b,c,d){a.Deferred.apply(this,[d]),this.list=b;var e=[];this.resultList=e,this.finishedCount=0,this.fireOnOneCallback=Boolean(c&&c.fireOnOneCallback),this.fireOnOneErrback=Boolean(c&&c.fireOnOneErrback),this.consumeErrors=Boolean(c&&c.consumeErrors);var f=_.bind(this._cbDeferred,this);for(var g=0;g<b.length;g++){var h=b[g];e.push(void 0),h.addCallback(f,g,!0),h.addErrback(f,g,!1)}b.length===0&&!this.fireOnOneCallback&&this.callback(this.resultList)},a.DeferredList.prototype=new a.Deferred,a.DeferredList.prototype._cbDeferred=function(a,b,c){return this.resultList[b]=[c,a],this.finishedCount+=1,this.fired==-1&&(c&&this.fireOnOneCallback?this.callback([b,a]):!c&&this.fireOnOneErrback?this.errback(a):this.finishedCount==this.list.length&&this.callback(this.resultList)),!c&&this.consumeErrors&&(a=null),a},a.gatherResults=function(b){var c=new a.DeferredList(b,{fireOnOneErrback:!0});return c.addCallback(function(a){var b=[];for(var c=0;c<a.length;c++)b.push(a[c][1]);return b}),c},a.succeed=function(b){var c=new a.Deferred;return c.callback.apply(c,[b]),c},a.fail=function(b){var c=new a.Deferred;return c.errback.apply(c,[b]),c},a.maybeDeferred=function(c){var d;try{var e=c.apply(null,b.call(arguments,1));e instanceof a.Deferred?d=e:e instanceof Error?d=a.fail(e):d=a.succeed(e)}catch(f){d=a.fail(f)}return d},a}(),TD.util.i18n=function(){var a={},b,c,d=function(a){if(typeof TD_locale_messages=="undefined")return undefined;var b=TD_locale_messages[a];return b&&b.message?b.message:undefined},e=function(a){var b=deck.i18n(a);return b?b:undefined};return a.getMessage=function(a){return b||(TD.util.isChromeApp()?b=chrome.i18n.getMessage:TD.util.isWrapperApp()?b=e:b=d),b(a)},a.getLocale=function(){return c?c:(TD.util.isChromeApp()&&(c=a.getMessage("@@ui_locale")),c)},a}(),TD.constants={keyCodes:{enter:13,escape:27,tab:9,del:8,spacebar:32,upArrow:38,downArrow:40,leftArrow:37,rightArrow:39},charCodes:{space:32,questionMark:63},regexps:{name:/\S+/,username:/^[@ï¼ ]?([a-zA-Z0-9_]{1,15})$/,usernameWithAt:/^[@ï¼ ]{1}([a-zA-Z0-9_]{1,15}) /,usernameWithSpace:/^[@ï¼ ]{1}(\w{1,15})\s*$/,email:/^[\w-]+([^@,\s\<\>\(\)]*[\w-]+)?\@[\w-]+(\.[\w-]+)*\.[a-z]{2,}$/i,tokenSeparator:/[\s-_]+/},time:{oneDay:864e5,oneHour:36e5},TDApi:{ERROR_ACCOUNT_DOESNT_EXIST:"Account does not exist.",ERROR_BAD_PASSWORD:"BadPassword",ERROR_SESSION_EXPIRED:"SessionExpired"}},TD.languages={_index:null,_initialiseIndex:function(){var a=TD.languages.getAllLanguages();TD.languages._index={},a.forEach(function(a){TD.languages._index[a.code]=a,a.actual_code&&(TD.languages._index[a.actual_code]=a)})},getLanguageFromISOCode:function(a){TD.languages._index||TD.languages._initialiseIndex();var b=TD.languages._index[a];return _.clone(b)},getSystemLanguageCode:function(a){var b=navigator.language||navigator.userLanguage||"";return a&&(b=b.replace(/-[a-z]+$/i,"")),b},isSupportedTranslationSourceLanguage:function(a){var b=TD.languages.getSupportedTranslationSourceLanguages();return b.indexOf(a.toLowerCase())!==-1},isSystemLangSupportedDestinationLanguage:function(){var a=TD.languages.getSupportedTranslationDestinationLanguages();return a.indexOf(TD.languages.getSystemLanguageCode(!0).toLowerCase())!==-1||a.indexOf(TD.languages.getSystemLanguageCode(!1).toLowerCase())!==-1},getSupportedDestinationSystemLanguage:function(){var a=TD.languages.getSupportedTranslationDestinationLanguages();return a.indexOf(TD.languages.getSystemLanguageCode(!0).toLowerCase())!==-1?TD.languages.getSystemLanguageCode(!0):TD.languages.getSystemLanguageCode(!1)},getAllLanguages:function(){return[{code:"am",localized_name:TD.i("Amharic"),name:"á áá­á"},{code:"ar",localized_name:TD.i("Arabic"),name:"Ø§ÙØ¹Ø±Ø¨ÙØ©"},{code:"bg",localized_name:TD.i("Bulgarian"),name:"ÐÑÐ»Ð³Ð°ÑÑÐºÐ¸"},{code:"bn",localized_name:TD.i("Bengali"),name:"à¦¬à¦¾à¦à¦²à¦¾"},{code:"bo",localized_name:TD.i("Tibetan"),name:"à½à½¼à½à¼à½¦à¾à½"},{code:"chr",localized_name:TD.i("Cherokee"),name:"á£á³á©"},{code:"da",localized_name:TD.i("Danish"),name:"Dansk"},{code:"de",localized_name:TD.i("German"),name:"Deutsch"},{code:"dv",localized_name:TD.i("Maldivian"),name:"ÞÞ¨ÞÞ¬ÞÞ¨"},{code:"el",localized_name:TD.i("Greek"),name:"ÎÎ»Î»Î·Î½Î¹ÎºÎ¬"},{code:"en",localized_name:TD.i("English"),name:"English"},{code:"es",localized_name:TD.i("Spanish"),name:"EspaÃ±ol"},{code:"fa",localized_name:TD.i("Persian"),name:"ÙØ§Ø±Ø³Û"},{code:"fi",localized_name:TD.i("Finnish"),name:"Suomi"},{code:"fr",localized_name:TD.i("French"),name:"FranÃ§ais"},{code:"gu",localized_name:TD.i("Gujarati"),name:"àªà«àªàª°àª¾àª¤à«"},{code:"iw",actual_code:"he",localized_name:TD.i("Hebrew"),name:"×¢××¨××ª"},{code:"hi",localized_name:TD.i("Hindi"),name:"à¤¹à¤¿à¤à¤¦à¥"},{code:"hu",localized_name:TD.i("Hungarian"),name:"Magyar"},{code:"hy",localized_name:TD.i("Armenian"),name:"ÕÕ¡ÕµÕ¥ÖÕ¥Õ¶"},{code:"in",actual_code:"id",localized_name:TD.i("Indonesian"),name:"Bahasa Indonesia"},{code:"is",localized_name:TD.i("Icelandic"),name:"Ãslenska"},{code:"it",localized_name:TD.i("Italian"),name:"Italiano"},{code:"iu",localized_name:TD.i("Inuktitut"),name:"áááááá¦"},{code:"ja",localized_name:TD.i("Japanese"),name:"æ¥æ¬èª"},{code:"ka",localized_name:TD.i("Georgian"),name:"á¥áá áá£áá"},{code:"km",localized_name:TD.i("Khmer"),name:"ááááá"},{code:"kn",localized_name:TD.i("Kannada"),name:"à²à²¨à³à²¨à²¡"},{code:"ko",localized_name:TD.i("Korean"),name:"íêµ­ì´"},{code:"lo",localized_name:TD.i("Lao"),name:"àº¥àº²àº§"},{code:"lt",localized_name:TD.i("Lithuanian"),name:"LietuviÅ³"},{code:"ml",localized_name:TD.i("Malayalam"),name:"à´®à´²à´¯à´¾à´³à´"},{code:"my",localized_name:TD.i("Myanmar"),name:"áá¼ááºáá¬áá¬áá¬"},{code:"ne",localized_name:TD.i("Nepali"),name:"à¤¨à¥à¤ªà¤¾à¤²à¥"},{code:"nl",localized_name:TD.i("Dutch"),name:"Nederlands"},{code:"no",localized_name:TD.i("Norwegian"),name:"Norsk"},{code:"or",localized_name:TD.i("Oriya"),name:"à¬à¬¡à¬¼à¬¿à¬"},{code:"pa",localized_name:TD.i("Panjabi"),name:"à¨ªà©°à¨à¨¾à¨¬à©"},{code:"pl",localized_name:TD.i("Polish"),name:"Polski"},{code:"pt",localized_name:TD.i("Portuguese"),name:"PortuguÃªs"},{code:"ru",localized_name:TD.i("Russian"),name:"Ð ÑÑÑÐºÐ¸Ð¹"},{code:"si",localized_name:TD.i("Sinhala"),name:"à·à·à¶à·à¶½"},{code:"sv",localized_name:TD.i("Swedish"),name:"Svenska"},{code:"ta",localized_name:TD.i("Tamil"),name:"à®¤à®®à®¿à®´à¯"},{code:"te",localized_name:TD.i("Telugu"),name:"à°¤à±à°²à±à°à±"},{code:"th",localized_name:TD.i("Thai"),name:"à¹à¸à¸¢"},{code:"tl",localized_name:TD.i("Tagalog"),name:"Tagalog"},{code:"tr",localized_name:TD.i("Turkish"),name:"TÃ¼rkÃ§e"},{code:"ur",localized_name:TD.i("Urdu"),name:"ïºïº­ïº©ï»­"},{code:"vi",localized_name:TD.i("Vietnamese"),name:"Tiáº¿ng Viá»t"},{code:"zh",localized_name:TD.i("Chinese"),name:"ä¸­æ"}]},getSupportedTranslationSourceLanguages:function(){return["bg","ca","zh","cs","da","nl","en","et","fi","fr","de","el","ht","hi","hu","id","in","it","ja","ko","lv","lt","no","pl","pt","ro","ru","sk","sl","es","sv","th","tr","uk","vi","ar","fa","he"]},getSupportedTranslationDestinationLanguages:function(){return["bg","ca","zh-cn","zh-tw","cs","da","nl","en","et","fi","fr","de","el","ht","hi","hu","id","in","it","ja","ko","lv","lt","no","pl","pt","ro","ru","sk","sl","es","sv","th","tr","uk","vi","ar","fa","he"]}},TD.services.bitly=function(){var a={},b,c="tweetdeckapi",d="R_b8032856b71a14fabfe64f6845689ddf",e=function(a,b){var e="https://api-ssl.bitly.com/v3/"+a,f;b.login=c,b.apiKey=d,b.format="json";var g=TD.storage.accountController.getAccountsForService("bitly");if(g.length>0){var h=g[0];b.x_login=h.getUserID(),b.x_apiKey=h.getOAuthToken()}return f=TD.net.ajax.jsonp(e,b),f};return a.shorten=function(a,b,c){var d=a,f,g=function(d){var e=d.data;if(!e||!e.data||!e.data.url){c();return}e.data&&(e.data.long_url=a),b(e)};return!_.startsWith(a,"http://")&&!_.startsWith(a,"https://")&&(d="http://"+a),f=e("shorten",{longUrl:d}),f.addCallbacks(g,c),f},a}(),!function(a,b){typeof define=="function"?define(b):typeof module!="undefined"?module.exports=b():this[a]=b()}("klass",function(){function f(a){return j.call(g(a)?a:function(){},a,1)}function g(a){return typeof a===c}function h(a,b,c){return function(){var d=this.supr;this.supr=c[e][a];var f=b.apply(this,arguments);return this.supr=d,f}}function i(a,b,c){for(var f in b)b.hasOwnProperty(f)&&(a[f]=g(b[f])&&g(c[e][f])&&d.test(b[f])?h(f,b[f],c):b[f])}function j(a,b){function c(){}function l(){this.initialize?this.initialize.apply(this,arguments):(b||h&&d.apply(this,arguments),j.apply(this,arguments))}c[e]=this[e];var d=this,f=new c,h=g(a),j=h?a:this,k=h?{}:a;return l.methods=function(a){return i(f,a,d),l[e]=f,this},l.methods.call(l,k).prototype.constructor=l,l.extend=arguments.callee,l[e].implement=l.statics=function(a,b){return a=typeof a=="string"?function(){var c={};return c[a]=b,c}():a,i(this,a,d),this},l.mixin=function(){for(var a=0;a<arguments.length;a++){var b=arguments[a];b===undefined?console.warn("you have an undefined mixin coming from "+ns):b.call(this,this)}return this},l}var a=this,b=a.klass,c="function",d=/xyz/.test(function(){xyz})?/\bsupr\b/:/.*/,e="prototype";return f.noConflict=function(){return a.klass=b,this},a.klass=f,f}),klass.mixin=function(a,b){if(_.isString(a)){var c=window,d=a.split(".");for(var e=0,f=d.length;e<f;++e)c=c[d[e]]=c[d[e]]||(_.isUndefined(d[e+1])?b:{});return c}_.extend(a,b)},klass.mixin("TD.mixins.caretHelper",function(){return this.statics({spaceBoundary:/\s|$/,wordEnd:/\S+$/}).methods({init:function(){this.$input.bind("blur",_.bind(function(a){setTimeout(_.bind(function(){this.hide()},this),1e3)},this)).bind("mouseup",_.bind(function(a){setTimeout(_.bind(function(){this.getCaret()},this),0)},this)).bind("focus",_.bind(function(a){this.getCaret()},this))},getCurrentText:function(){return this.$input.val()},setCaretPosition:function(a){var b=this.$input[0];if(b.setSelectionRange)b.focus(),b.setSelectionRange(a,a);else if(b.createTextRange){var c=b.createTextRange();c.collapse(!0),c.moveEnd("character",a),c.moveStart("character",a),c.select()}this.lastCaret=a},getCaret:function(){var a=this.$input[0],b=0;if(document.selection){try{a.focus()}catch(c){}var d=document.selection.createRange();if(d==null)return this.lastCaret=0,0;var e=a.createTextRange(),f=e.duplicate();e.moveToBookmark(d.getBookmark()),f.setEndPoint("EndToStart",e),b=f.text.length}else if(a.selectionStart||a.selectionStart=="0")b=a.selectionStart;return this.lastCaret=b,b},insertOrReplaceSelection:function(a,b){var c=this.$input[0],d=this.getCaret(),e=d+a.length;if(document.selection){c.focus();var f=document.selection.createRange();f.text=a;if(b){var g=c.createTextRange();g.collapse(!0),g.moveEnd("character",e),g.moveStart("character",d),g.select()}else this.setCaretPosition(e)}else if(c.selectionStart||c.selectionStart=="0"){var h=c.selectionStart,i=c.selectionEnd,j=c.scrollTop;c.value=c.value.substring(0,h)+a+c.value.substring(i,c.value.length),c.focus(),c.selectionStart=b?d:e,c.selectionEnd=e,c.scrollTop=j}else c.value+=a,this.setCaretPosition(e),c.focus();this.lastCaret=e,this.$input.change()},getCurrentWord:function(a){var b=this.getCurrentText(),c=b.slice(0,a),d=b.slice(a,b.length),e=b.charAt(a-1);if(!e||e===" ")return"";this.leftBoundary=c.search(this.constructor.wordEnd);var f=c.slice(this.leftBoundary,c.length),g=d.slice(0,d.search(this.constructor.spaceBoundary)),h=f.concat(g);return this.rightBoundary=this.leftBoundary+h.length,h},replaceCurrentWord:function(a){var b=this.getCurrentText().split("");this.oldValueArray=b;var c=b.slice(0,this.leftBoundary),d=b.slice(this.rightBoundary,b.length);if(d.length<1||!d[0].match(/\s/))a+=" ";var e=(c.join("")+a).length+1;return{value:c.join("")+a+d.join(""),cursor:e}}}),this}),function(){function c(b,c){return c=c||"",typeof b!="string"&&(b.global&&c.indexOf("g")<0&&(c+="g"),b.ignoreCase&&c.indexOf("i")<0&&(c+="i"),b.multiline&&c.indexOf("m")<0&&(c+="m"),b=b.source),new RegExp(b.replace(/#\{(\w+)\}/g,function(b,c){var d=a.txt.regexen[c]||"";return typeof d!="string"&&(d=d.source),d}),c)}function d(a,b){return a.replace(/#\{(\w+)\}/g,function(a,c){return b[c]||""})}function e(a,b,c){var d=String.fromCharCode(b);return c!==b&&(d+="-"+String.fromCharCode(c)),a.push(d),a}function q(a){var b={};for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}function u(a,b,c){return c?!a||a.match(b)&&RegExp["$&"]===a:typeof a=="string"&&a.match(b)&&RegExp["$&"]===a}if(typeof a=="undefined"||a===null)var a={};a.txt={},a.txt.regexen={};var b={"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;","'":"&#39;"};a.txt.htmlEscape=function(a){return a&&a.replace(/[&"'><]/g,function(a){return b[a]})},a.txt.regexSupplant=c,a.txt.stringSupplant=d,a.txt.addCharsToCharClass=e;var f=String.fromCharCode,g=[f(32),f(133),f(160),f(5760),f(6158),f(8232),f(8233),f(8239),f(8287),f(12288)];e(g,9,13),e(g,8192,8202);var h=[f(65534),f(65279),f(65535)];e(h,8234,8238),a.txt.regexen.spaces_group=c(g.join("")),a.txt.regexen.spaces=c("["+g.join("")+"]"),a.txt.regexen.invalid_chars_group=c(h.join("")),a.txt.regexen.punct=/\!'#%&'\(\)*\+,\\\-\.\/:;<=>\?@\[\]\^_{|}~\$/,a.txt.regexen.rtl_chars=/[\u0600-\u06FF]|[\u0750-\u077F]|[\u0590-\u05FF]|[\uFE70-\uFEFF]/mg,a.txt.regexen.non_bmp_code_pairs=/[\uD800-\uDBFF][\uDC00-\uDFFF]/mg;var i=[];e(i,1024,1279),e(i,1280,1319),e(i,11744,11775),e(i,42560,42655),e(i,1425,1471),e(i,1473,1474),e(i,1476,1477),e(i,1479,1479),e(i,1488,1514),e(i,1520,1524),e(i,64274,64296),e(i,64298,64310),e(i,64312,64316),e(i,64318,64318),e(i,64320,64321),e(i,64323,64324),e(i,64326,64335),e(i,1552,1562),e(i,1568,1631),e(i,1646,1747),e(i,1749,1756),e(i,1758,1768),e(i,1770,1775),e(i,1786,1788),e(i,1791,1791),e(i,1872,1919),e(i,2208,2208),e(i,2210,2220),e(i,2276,2302),e(i,64336,64433),e(i,64467,64829),e(i,64848,64911),e(i,64914,64967),e(i,65008,65019),e(i,65136,65140),e(i,65142,65276),e(i,8204,8204),e(i,3585,3642),e(i,3648,3662),e(i,4352,4607),e(i,12592,12677),e(i,43360,43391),e(i,44032,55215),e(i,55216,55295),e(i,65441,65500),e(i,12449,12538),e(i,12540,12542),e(i,65382,65439),e(i,65392,65392),e(i,65296,65305),e(i,65313,65338),e(i,65345,65370),e(i,12353,12438),e(i,12441,12446),e(i,13312,19903),e(i,19968,40959),e(i,173824,177983),e(i,177984,178207),e(i,194560,195103),e(i,12291,12291),e(i,12293,12293),e(i,12347,12347),a.txt.regexen.nonLatinHashtagChars=c(i.join(""));var j=[];e(j,192,214),e(j,216,246),e(j,248,255),e(j,256,591),e(j,595,596),e(j,598,599),e(j,601,601),e(j,603,603),e(j,611,611),e(j,616,616),e(j,623,623),e(j,626,626),e(j,649,649),e(j,651,651),e(j,699,699),e(j,768,879),e(j,7680,7935),a.txt.regexen.latinAccentChars=c(j.join("")),a.txt.regexen.hashSigns=/[#ï¼]/,a.txt.regexen.hashtagAlpha=c(/[a-z_#{latinAccentChars}#{nonLatinHashtagChars}]/i),a.txt.regexen.hashtagAlphaNumeric=c(/[a-z0-9_#{latinAccentChars}#{nonLatinHashtagChars}]/i),a.txt.regexen.endHashtagMatch=c(/^(?:#{hashSigns}|:\/\/)/),a.txt.regexen.hashtagBoundary=c(/(?:^|$|[^&a-z0-9_#{latinAccentChars}#{nonLatinHashtagChars}])/),a.txt.regexen.validHashtag=c(/(#{hashtagBoundary})(#{hashSigns})(#{hashtagAlphaNumeric}*#{hashtagAlpha}#{hashtagAlphaNumeric}*)/gi),a.txt.regexen.validMentionPrecedingChars=/(?:^|[^a-zA-Z0-9_!#$%&*@ï¼ ]|RT:?)/,a.txt.regexen.atSigns=/[@ï¼ ]/,a.txt.regexen.validMentionOrList=c("(#{validMentionPrecedingChars})(#{atSigns})([a-zA-Z0-9_]{1,20})(/[a-zA-Z][a-zA-Z0-9_-]{0,24})?","g"),a.txt.regexen.validReply=c(/^(?:#{spaces})*#{atSigns}([a-zA-Z0-9_]{1,20})/),a.txt.regexen.endMentionMatch=c(/^(?:#{atSigns}|[#{latinAccentChars}]|:\/\/)/),a.txt.regexen.validUrlPrecedingChars=c(/(?:[^A-Za-z0-9@ï¼ $#ï¼#{invalid_chars_group}]|^)/),a.txt.regexen.invalidUrlWithoutProtocolPrecedingChars=/[-_.\/]$/,a.txt.regexen.invalidDomainChars=d("#{punct}#{spaces_group}#{invalid_chars_group}",a.txt.regexen),a.txt.regexen.validDomainChars=c(/[^#{invalidDomainChars}]/),a.txt.regexen.validSubdomain=c(/(?:(?:#{validDomainChars}(?:[_-]|#{validDomainChars})*)?#{validDomainChars}\.)/),a.txt.regexen.validDomainName=c(/(?:(?:#{validDomainChars}(?:-|#{validDomainChars})*)?#{validDomainChars}\.)/),a.txt.regexen.validGTLD=c(/(?:(?:aero|asia|biz|cat|com|coop|edu|gov|info|int|jobs|mil|mobi|museum|name|net|org|pro|tel|travel|xxx)(?=[^0-9a-zA-Z]|$))/),a.txt.regexen.validCCTLD=c(/(?:(?:ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cs|cu|cv|cx|cy|cz|dd|de|dj|dk|dm|do|dz|ec|ee|eg|eh|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sk|sl|sm|sn|so|sr|ss|st|su|sv|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|za|zm|zw|sx)(?=[^0-9a-zA-Z]|$))/),a.txt.regexen.validPunycode=c(/(?:xn--[0-9a-z]+)/),a.txt.regexen.validDomain=c(/(?:#{validSubdomain}*#{validDomainName}(?:#{validGTLD}|#{validCCTLD}|#{validPunycode}))/),a.txt.regexen.validAsciiDomain=c(/(?:(?:[\-a-z0-9#{latinAccentChars}]+)\.)+(?:#{validGTLD}|#{validCCTLD}|#{validPunycode})/gi),a.txt.regexen.invalidShortDomain=c(/^#{validDomainName}#{validCCTLD}$/),a.txt.regexen.validPortNumber=c(/[0-9]+/),a.txt.regexen.validGeneralUrlPathChars=c(/[a-z0-9!\*';:=\+,\.\$\/%#\[\]\-_~@|&#{latinAccentChars}]/i),a.txt.regexen.validUrlBalancedParens=c(/\(#{validGeneralUrlPathChars}+\)/i),a.txt.regexen.validUrlPathEndingChars=c(/[\+\-a-z0-9=_#\/#{latinAccentChars}]|(?:#{validUrlBalancedParens})/i),a.txt.regexen.validUrlPath=c("(?:(?:#{validGeneralUrlPathChars}*(?:#{validUrlBalancedParens}#{validGeneralUrlPathChars}*)*#{validUrlPathEndingChars})|(?:@#{validGeneralUrlPathChars}+/))","i"),a.txt.regexen.validUrlQueryChars=/[a-z0-9!?\*'@\(\);:&=\+\$\/%#\[\]\-_\.,~|]/i,a.txt.regexen.validUrlQueryEndingChars=/[a-z0-9_&=#\/]/i,a.txt.regexen.extractUrl=c("((#{validUrlPrecedingChars})((https?:\\/\\/)?(#{validDomain})(?::(#{validPortNumber}))?(\\/#{validUrlPath}*)?(\\?#{validUrlQueryChars}*#{validUrlQueryEndingChars})?))","gi"),a.txt.regexen.validTcoUrl=/^https?:\/\/t\.co\/[a-z0-9]+/i,a.txt.regexen.urlHasProtocol=/^https?:\/\//i,a.txt.regexen.urlHasHttps=/^https:\/\//i,a.txt.regexen.cashtag=/[a-z]{1,6}(?:[._][a-z]{1,2})?/i,a.txt.regexen.validCashtag=c("(^|#{spaces})(\\$)(#{cashtag})(?=$|\\s|[#{punct}])","gi"),a.txt.regexen.validateUrlUnreserved=/[a-z0-9\-._~]/i,a.txt.regexen.validateUrlPctEncoded=/(?:%[0-9a-f]{2})/i,a.txt.regexen.validateUrlSubDelims=/[!$&'()*+,;=]/i,a.txt.regexen.validateUrlPchar=c("(?:#{validateUrlUnreserved}|#{validateUrlPctEncoded}|#{validateUrlSubDelims}|[:|@])","i"),a.txt.regexen.validateUrlScheme=/(?:[a-z][a-z0-9+\-.]*)/i,a.txt.regexen.validateUrlUserinfo=c("(?:#{validateUrlUnreserved}|#{validateUrlPctEncoded}|#{validateUrlSubDelims}|:)*","i"),a.txt.regexen.validateUrlDecOctet=/(?:[0-9]|(?:[1-9][0-9])|(?:1[0-9]{2})|(?:2[0-4][0-9])|(?:25[0-5]))/i,a.txt.regexen.validateUrlIpv4=c(/(?:#{validateUrlDecOctet}(?:\.#{validateUrlDecOctet}){3})/i),a.txt.regexen.validateUrlIpv6=/(?:\[[a-f0-9:\.]+\])/i,a.txt.regexen.validateUrlIp=c("(?:#{validateUrlIpv4}|#{validateUrlIpv6})","i"),a.txt.regexen.validateUrlSubDomainSegment=/(?:[a-z0-9](?:[a-z0-9_\-]*[a-z0-9])?)/i,a.txt.regexen.validateUrlDomainSegment=/(?:[a-z0-9](?:[a-z0-9\-]*[a-z0-9])?)/i,a.txt.regexen.validateUrlDomainTld=/(?:[a-z](?:[a-z0-9\-]*[a-z0-9])?)/i,a.txt.regexen.validateUrlDomain=c(/(?:(?:#{validateUrlSubDomainSegment]}\.)*(?:#{validateUrlDomainSegment]}\.)#{validateUrlDomainTld})/i),a.txt.regexen.validateUrlHost=c("(?:#{validateUrlIp}|#{validateUrlDomain})","i"),a.txt.regexen.validateUrlUnicodeSubDomainSegment=/(?:(?:[a-z0-9]|[^\u0000-\u007f])(?:(?:[a-z0-9_\-]|[^\u0000-\u007f])*(?:[a-z0-9]|[^\u0000-\u007f]))?)/i,a.txt.regexen.validateUrlUnicodeDomainSegment=/(?:(?:[a-z0-9]|[^\u0000-\u007f])(?:(?:[a-z0-9\-]|[^\u0000-\u007f])*(?:[a-z0-9]|[^\u0000-\u007f]))?)/i,a.txt.regexen.validateUrlUnicodeDomainTld=/(?:(?:[a-z]|[^\u0000-\u007f])(?:(?:[a-z0-9\-]|[^\u0000-\u007f])*(?:[a-z0-9]|[^\u0000-\u007f]))?)/i,a.txt.regexen.validateUrlUnicodeDomain=c(/(?:(?:#{validateUrlUnicodeSubDomainSegment}\.)*(?:#{validateUrlUnicodeDomainSegment}\.)#{validateUrlUnicodeDomainTld})/i),a.txt.regexen.validateUrlUnicodeHost=c("(?:#{validateUrlIp}|#{validateUrlUnicodeDomain})","i"),a.txt.regexen.validateUrlPort=/[0-9]{1,5}/,a.txt.regexen.validateUrlUnicodeAuthority=c("(?:(#{validateUrlUserinfo})@)?(#{validateUrlUnicodeHost})(?::(#{validateUrlPort}))?","i"),a.txt.regexen.validateUrlAuthority=c("(?:(#{validateUrlUserinfo})@)?(#{validateUrlHost})(?::(#{validateUrlPort}))?","i"),a.txt.regexen.validateUrlPath=c(/(\/#{validateUrlPchar}*)*/i),a.txt.regexen.validateUrlQuery=c(/(#{validateUrlPchar}|\/|\?)*/i),a.txt.regexen.validateUrlFragment=c(/(#{validateUrlPchar}|\/|\?)*/i),a.txt.regexen.validateUrlUnencoded=c("^(?:([^:/?#]+):\\/\\/)?([^/?#]*)([^?#]*)(?:\\?([^#]*))?(?:#(.*))?$","i");var k="tweet-url list-slug",l="tweet-url username",m="tweet-url hashtag",n="tweet-url cashtag",o={urlClass:!0,listClass:!0,usernameClass:!0,hashtagClass:!0,cashtagClass:!0,usernameUrlBase:!0,listUrlBase:!0,hashtagUrlBase:!0,cashtagUrlBase:!0,usernameUrlBlock:!0,listUrlBlock:!0,hashtagUrlBlock:!0,linkUrlBlock:!0,usernameIncludeSymbol:!0,suppressLists:!0,suppressNoFollow:!0,targetBlank:!0,suppressDataScreenName:!0,urlEntities:!0,symbolTag:!0,textWithSymbolTag:!0,urlTarget:!0,invisibleTagAttrs:!0,linkAttributeBlock:!0,linkTextBlock:!0,htmlEscapeNonEntities:!0},p={disabled:!0,readonly:!0,multiple:!0,checked:!0};a.txt.tagAttrs=function(b){var c="";for(var d in b){var e=b[d];p[d]&&(e=e?d:null);if(e==null)continue;c+=" "+a.txt.htmlEscape(d)+'="'+a.txt.htmlEscape(e.toString())+'"'}return c},a.txt.linkToText=function(b,c,e,f){f.suppressNoFollow||(e.rel="nofollow"),f.linkAttributeBlock&&f.linkAttributeBlock(b,e),f.linkTextBlock&&(c=f.linkTextBlock(b,c));var g={text:c,attr:a.txt.tagAttrs(e)};return d("<a#{attr}>#{text}</a>",g)},a.txt.linkToTextWithSymbol=function(b,c,d,e,f){var g=f.symbolTag?"<"+f.symbolTag+">"+c+"</"+f.symbolTag+">":c;d=a.txt.htmlEscape(d);var h=f.textWithSymbolTag?"<"+f.textWithSymbolTag+">"+d+"</"+f.textWithSymbolTag+">":d;return f.usernameIncludeSymbol||!c.match(a.txt.regexen.atSigns)?a.txt.linkToText(b,g+h,e,f):g+a.txt.linkToText(b,h,e,f)},a.txt.linkToHashtag=function(b,c,d){var e=c.substring(b.indices[0],b.indices[0]+1),f=a.txt.htmlEscape(b.hashtag),g=q(d.htmlAttrs||{});return g.href=d.hashtagUrlBase+f,g.title="#"+f,g["class"]=d.hashtagClass,f[0].match(a.txt.regexen.rtl_chars)&&(g["class"]+=" rtl"),d.targetBlank&&(g.target="_blank"),a.txt.linkToTextWithSymbol(b,e,f,g,d)},a.txt.linkToCashtag=function(b,c,d){var e=a.txt.htmlEscape(b.cashtag),f=q(d.htmlAttrs||{});return f.href=d.cashtagUrlBase+e,f.title="$"+e,f["class"]=d.cashtagClass,d.targetBlank&&(f.target="_blank"),a.txt.linkToTextWithSymbol(b,"$",e,f,d)},a.txt.linkToMentionAndList=function(b,c,d){var e=c.substring(b.indices[0],b.indices[0]+1),f=a.txt.htmlEscape(b.screenName),g=a.txt.htmlEscape(b.listSlug),h=b.listSlug&&!d.suppressLists,i=q(d.htmlAttrs||{});return i["class"]=h?d.listClass:d.usernameClass,i.href=h?d.listUrlBase+f+g:d.usernameUrlBase+f,!h&&!d.suppressDataScreenName&&(i["data-screen-name"]=f),d.targetBlank&&(i.target="_blank"),a.txt.linkToTextWithSymbol(b,e,h?f+g:f,i,d)},a.txt.linkToUrl=function(b,c,d){var e=b.url,f=e,g=a.txt.htmlEscape(f),h=d.urlEntities&&d.urlEntities[e]||b;h.display_url&&(g=a.txt.linkTextWithEntity(h,d));var i=q(d.htmlAttrs||{});return e.match(a.txt.regexen.urlHasProtocol)||(e="http://"+e),i.href=e,d.targetBlank&&(i.target="_blank"),d.urlClass&&(i["class"]=d.urlClass),d.urlTarget&&(i.target=d.urlTarget),!d.title&&h.display_url&&(i.title=h.expanded_url),a.txt.linkToText(b,g,i,d)},a.txt.linkTextWithEntity=function(b,c){var e=b.display_url,f=b.expanded_url,g=e.replace(/â¦/g,"");if(f.indexOf(g)!=-1){var h=f.indexOf(g),i={displayUrlSansEllipses:g,beforeDisplayUrl:f.substr(0,h),afterDisplayUrl:f.substr(h+g.length),precedingEllipsis:e.match(/^â¦/)?"â¦":"",followingEllipsis:e.match(/â¦$/)?"â¦":""};for(var j in i)i.hasOwnProperty(j)&&(i[j]=a.txt.htmlEscape(i[j]));return i.invisible=c.invisibleTagAttrs,d("<span class='tco-ellipsis'>#{precedingEllipsis}<span #{invisible}>&nbsp;</span></span><span #{invisible}>#{beforeDisplayUrl}</span><span class='js-display-url'>#{displayUrlSansEllipses}</span><span #{invisible}>#{afterDisplayUrl}</span><span class='tco-ellipsis'><span #{invisible}>&nbsp;</span>#{followingEllipsis}</span>",i)}return e},a.txt.autoLinkEntities=function(b,c,d){d=q(d||{}),d.hashtagClass=d.hashtagClass||m,d.hashtagUrlBase=d.hashtagUrlBase||"https://twitter.com/#!/search?q=%23",d.cashtagClass=d.cashtagClass||n,d.cashtagUrlBase=d.cashtagUrlBase||"https://twitter.com/#!/search?q=%24",d.listClass=d.listClass||k,d.usernameClass=d.usernameClass||l,d.usernameUrlBase=d.usernameUrlBase||"https://twitter.com/",d.listUrlBase=d.listUrlBase||"https://twitter.com/",d.htmlAttrs=a.txt.extractHtmlAttrsFromOptions(d),d.invisibleTagAttrs=d.invisibleTagAttrs||"style='position:absolute;left:-9999px;'";var e,f,g;if(d.urlEntities){e={};for(f=0,g=d.urlEntities.length;f<g;f++)e[d.urlEntities[f].url]=d.urlEntities[f];d.urlEntities=e}var h="",i=0;c.sort(function(a,b){return a.indices[0]-b.indices[0]});var j=d.htmlEscapeNonEntities?a.txt.htmlEscape:function(a){return a};for(var f=0;f<c.length;f++){var o=c[f];h+=j(b.substring(i,o.indices[0])),o.url?h+=a.txt.linkToUrl(o,b,d):o.hashtag?h+=a.txt.linkToHashtag(o,b,d):o.screenName?h+=a.txt.linkToMentionAndList(o,b,d):o.cashtag&&(h+=a.txt.linkToCashtag(o,b,d)),i=o.indices[1]}return h+=j(b.substring(i,b.length)),h},a.txt.autoLinkWithJSON=function(b,c,d){var e=[];for(var f in c)e=e.concat(c[f]);for(var g=0;g<e.length;g++)entity=e[g],entity.screen_name?entity.screenName=entity.screen_name:entity.text&&(entity.hashtag=entity.text);return a.txt.modifyIndicesFromUnicodeToUTF16(b,e),a.txt.autoLinkEntities(b,e,d)},a.txt.extractHtmlAttrsFromOptions=function(a){var b={};for(var c in a){var d=a[c];if(o[c])continue;p[c]&&(d=d?c:null);if(d==null)continue;b[c]=d}return b},a.txt.autoLink=function(b,c){var d=a.txt.extractEntitiesWithIndices(b,{extractUrlsWithoutProtocol:!1});return a.txt.autoLinkEntities(b,d,c)},a.txt.autoLinkUsernamesOrLists=function(b,c){var d=a.txt.extractMentionsOrListsWithIndices(b);return a.txt.autoLinkEntities(b,d,c)},a.txt.autoLinkHashtags=function(b,c){var d=a.txt.extractHashtagsWithIndices(b);return a.txt.autoLinkEntities(b,d,c)},a.txt.autoLinkCashtags=function(b,c){var d=a.txt.extractCashtagsWithIndices(b);return a.txt.autoLinkEntities(b,d,c)},a.txt.autoLinkUrlsCustom=function(b,c){var d=a.txt.extractUrlsWithIndices(b,{extractUrlsWithoutProtocol:!1});return a.txt.autoLinkEntities(b,d,c)},a.txt.removeOverlappingEntities=function(a){a.sort(function(a,b){return a.indices[0]-b.indices[0]});var b=a[0];for(var c=1;c<a.length;c++)b.indices[1]>a[c].indices[0]?(a.splice(c,1),c--):b=a[c]},a.txt.extractEntitiesWithIndices=function(b,c){var d=a.txt.extractUrlsWithIndices(b,c).concat(a.txt.extractMentionsOrListsWithIndices(b)).concat(a.txt.extractHashtagsWithIndices(b,{checkUrlOverlap:!1})).concat(a.txt.extractCashtagsWithIndices(b));return d.length==0?[]:(a.txt.removeOverlappingEntities(d),d)},a.txt.extractMentions=function(b){var c=[],d=a.txt.extractMentionsWithIndices(b);for(var e=0;e<d.length;e++){var f=d[e].screenName;c.push(f)}return c},a.txt.extractMentionsWithIndices=function(b){var c=[],d,e=a.txt.extractMentionsOrListsWithIndices(b);for(var f=0;f<e.length;f++)d=e[f],d.listSlug==""&&c.push({screenName:d.screenName,indices:d.indices});return c},a.txt.extractMentionsOrListsWithIndices=function(b){if(!b||!b.match(a.txt.regexen.atSigns))return[];var c=[],d;return b.replace(a.txt.regexen.validMentionOrList,function(b,d,e,f,g,h,i){var j=i.slice(h+b.length);if(!j.match(a.txt.regexen.endMentionMatch)){g=g||"";var k=h+d.length,l=k+f.length+g.length+1;c.push({screenName:f,listSlug:g,indices:[k,l]})}}),c},a.txt.extractReplies=function(b){if(!b)return null;var c=b.match(a.txt.regexen.validReply);return!c||RegExp.rightContext.match(a.txt.regexen.endMentionMatch)?null:c[1]},a.txt.extractUrls=function(b,c){var d=[],e=a.txt.extractUrlsWithIndices(b,c);for(var f=0;f<e.length;f++)d.push(e[f].url);return d},a.txt.extractUrlsWithIndices=function(b,c){c||(c={extractUrlsWithoutProtocol:!0});if(!b||(c.extractUrlsWithoutProtocol?!b.match(/\./):!b.match(/:/)))return[];var d=[];while(a.txt.regexen.extractUrl.exec(b)){var e=RegExp.$2,f=RegExp.$3,g=RegExp.$4,h=RegExp.$5,i=RegExp.$7,j=a.txt.regexen.extractUrl.lastIndex,k=j-f.length;if(!g){if(!c.extractUrlsWithoutProtocol||e.match(a.txt.regexen.invalidUrlWithoutProtocolPrecedingChars))continue;var l=null,m=!1,n=0;h.replace(a.txt.regexen.validAsciiDomain,function(b){var c=h.indexOf(b,n);n=c+b.length,l={url:b,indices:[k+c,k+n]},m=b.match(a.txt.regexen.invalidShortDomain),m||d.push(l)});if(l==null)continue;i&&(m&&d.push(l),l.url=f.replace(h,l.url),l.indices[1]=j)}else f.match(a.txt.regexen.validTcoUrl)&&(f=RegExp.lastMatch,j=k+f.length),d.push({url:f,indices:[k,j]})}return d},a.txt.extractHashtags=function(b){var c=[],d=a.txt.extractHashtagsWithIndices(b);for(var e=0;e<d.length;e++)c.push(d[e].hashtag);return c},a.txt.extractHashtagsWithIndices=function(b,c){c||(c={checkUrlOverlap:!0});if(!b||!b.match(a.txt.regexen.hashSigns))return[];var d=[];b.replace(a.txt.regexen.validHashtag,function(b,c,e,f,g,h){var i=h.slice(g+b.length);if(i.match(a.txt.regexen.endHashtagMatch))return;var j=g+c.length,k=j+f.length+1;d.push({hashtag:f,indices:[j,k]})});if(c.checkUrlOverlap){var e=a.txt.extractUrlsWithIndices(b);if(e.length>0){var f=d.concat(e);a.txt.removeOverlappingEntities(f),d=[];for(var g=0;g<f.length;g++)f[g].hashtag&&d.push(f[g])}}return d},a.txt.extractCashtags=function(b){var c=[],d=a.txt.extractCashtagsWithIndices(b);for(var e=0;e<d.length;e++)c.push(d[e].cashtag);return c},a.txt.extractCashtagsWithIndices=function(b){if(!b||b.indexOf("$")==-1)return[];var c=[];return b.replace(a.txt.regexen.validCashtag,function(a,b,d,e,f,g){var h=f+b.length,i=h+e.length+1;c.push({cashtag:e,indices:[h,i]})}),c},a.txt.modifyIndicesFromUnicodeToUTF16=function(b,c){a.txt.convertUnicodeIndices(b,c,!1)},a.txt.modifyIndicesFromUTF16ToUnicode=function(b,c){a.txt.convertUnicodeIndices(b,c,!0)},a.txt.getUnicodeTextLength=function(b){return b.replace(a.txt.regexen.non_bmp_code_pairs," ").length},a.txt.convertUnicodeIndices=function(a,b,c){if(b.length==0)return;var d=0,e=0;b.sort(function(a,b){return a.indices[0]-b.indices[0]});var f=0,g=b[0];while(d<a.length){if(g.indices[0]==(c?d:e)){var h=g.indices[1]-g.indices[0];g.indices[0]=c?e:d,g.indices[1]=g.indices[0]+h,f++;if(f==b.length)break;g=b[f]}var i=a.charCodeAt(d);55296<=i&&i<=56319&&d<a.length-1&&(i=a.charCodeAt(d+1),56320<=i&&i<=57343&&d++),e++,d++}},a.txt.splitTags=function(a){var b=a.split("<"),c,d=[],e;for(var f=0;f<b.length;f+=1){e=b[f];if(!e)d.push("");else{c=e.split(">");for(var g=0;g<c.length;g+=1)d.push(c[g])}}return d},a.txt.hitHighlight=function(b,c,d){var e="em";c=c||[],d=d||{};if(c.length===0)return b;var f=d.tag||e,g=["<"+f+">","</"+f+">"],h=a.txt.splitTags(b),i,j,k="",l=0,m=h[0],n=0,o=0,p=!1,q=m,r=[],s,t,u,v,w;for(i=0;i<c.length;i+=1)for(j=0;j<c[i].length;j+=1)r.push(c[i][j]);for(s=0;s<r.length;s+=1){t=r[s],u=g[s%2],v=!1;while(m!=null&&t>=n+m.length)k+=q.slice(o),p&&t===n+q.length&&(k+=u,v=!0),h[l+1]&&(k+="<"+h[l+1]+">"),n+=q.length,o=0,l+=2,m=h[l],q=m,p=!1;!v&&m!=null?(w=t-n,k+=q.slice(o,w)+u,o=w,s%2===0?p=!0:p=!1):v||(v=!0,k+=u)}if(m!=null){o<q.length&&(k+=q.slice(o));for(s=l+1;s<h.length;s+=1)k+=s%2===0?h[s]:"<"+h[s]+">"}return k};var r=140,s=[f(65534),f(65279),f(65535),f(8234),f(8235),f(8236),f(8237),f(8238)];a.txt.getTweetLength=function(b,c){c||(c={short_url_length:22,short_url_length_https:23});var d=a.txt.getUnicodeTextLength(b),e=a.txt.extractUrlsWithIndices(b);a.txt.modifyIndicesFromUTF16ToUnicode(b,e);for(var f=0;f<e.length;f++)d+=e[f].indices[0]-e[f].indices[1],e[f].url.toLowerCase().match(a.txt.regexen.urlHasHttps)?d+=c.short_url_length_https:d+=c.short_url_length;return d},a.txt.isInvalidTweet=function(b){if(!b)return"empty";if(a.txt.getTweetLength(b)>r)return"too_long";for(var c=0;c<s.length;c++)if(b.indexOf(s[c])>=0)return"invalid_characters";return!1},a.txt.isValidTweetText=function(b){return!a.txt.isInvalidTweet(b)},a.txt.isValidUsername=function(b){if(!b)return!1;var c=a.txt.extractMentions(b);return c.length===1&&c[0]===b.slice(1)};var t=c(/^#{validMentionOrList}$/);a.txt.isValidList=function(a){var b=a.match(t);return!!b&&b[1]==""&&!!b[4]},a.txt.isValidHashtag=function(b){if(!b)return!1;var c=a.txt.extractHashtags(b);return c.length===1&&c[0]===b.slice(1)},a.txt.isValidUrl=function(b,c,d){c==null&&(c=!0),d==null&&(d=!0);if(!b)return!1;var e=b.match(a.txt.regexen.validateUrlUnencoded);if(!e||e[0]!==b)return!1;var f=e[1],g=e[2],h=e[3],i=e[4],j=e[5];return(!d||u(f,a.txt.regexen.validateUrlScheme)&&f.match(/^https?$/i))&&u(h,a.txt.regexen.validateUrlPath)&&u(i,a.txt.regexen.validateUrlQuery,!0)&&u(j,a.txt.regexen.validateUrlFragment,!0)?c&&u(g,a.txt.regexen.validateUrlUnicodeAuthority)||!c&&u(g,a.txt.regexen.validateUrlAuthority):!1},typeof module!="undefined"&&module.exports&&(module.exports=a.txt);if(typeof window!="undefined")if(window.twttr)for(var v in a)window.twttr[v]=a[v];else window.twttr=a}(),TD.components.Base=klass(function(){this.$node=$.createElement("div").addClass("js-component")}).methods({$find:function(){return this.$node.find.apply(this.$node,arguments)},publishEvent:function(a,b){var c={data:b,target:this};TD.storage.notification.notify(a,c)},bubbleEvent:function(a,b){var c={data:b,target:this};this.$node.trigger(a,[c])},destroy:function(){this.$node.remove()},show:function(){this.$node.show()},hide:function(){this.$node.hide()}}),TD.components.Autocomplete=TD.components.Base.extend(function(a,b){var c={limit:5,dmMode:!1};this.options=_.extend(c,b),this.$input=a,this.isCompletionsOpen=!1,this.dropdownId=_.uniqueId("autocomplete"),this.$node=$.createElement("ul").addClass("lst lst-modal l-compose-box").insertAfter(this.$input),this.$selectedItem=null,this._registerEvents(),c.dmMode?this.usernameRegex=this.constructor.dmUsername:this.usernameRegex=this.constructor.username,$(document).on("dataTypeaheadSuggestions",this.updateDropdown.bind(this))}).mixin(TD.mixins.caretHelper).statics({username:/^[@ï¼ ]([a-zA-Z0-9_]{1,20})$/,dmUsername:/^([a-zA-Z0-9_]{1,20})$/,hashtag:/^[#ï¼]([a-zA-Z0-9_]+)/,SELECT:"td-autocomplete-select",_htmlEscapeAndStrongifyMatches:function(a,b){return TD.util.escape(a.replace(b,"<strong>$1</strong>")).replace(/&lt;(\/?strong)&gt;/g,"<$1>")}}).methods({_registerEvents:function(){var a=this,b="keypress"+($.browser.webkit||$.browser.msie?" keydown":"");this.$input.bind(b,_.bind(this.keypress,this)),this.$input.bind("keyup click",_.bind(this.keyup,this)),this.blurHandler=function(){_.delay(function(){a.hide()},500)},this.$input.bind("blur",this.blurHandler),this.$node.delegate("li","mouseenter",function(b){a.$node.find("li.s-selected").removeClass("s-selected"),$(this).addClass("s-selected")}).delegate("li","click",_.bind(function(b){a.$selectedItem=$(b.target).closest("li").addClass("s-selected"),a.$selectedItem.siblings(".s-selected").removeClass("s-selected"),this.$input.focus(),this.select()},this))},_unregisterEvents:function(){var a="keypress"+($.browser.webkit||$.browser.msie?" keydown":"");this.$input.unbind(a),this.$input.unbind("keyup click keydown"),this.$input.unbind("bind",this.blurHandler)},keyup:function(a){if(!a.keyCode)return;a.stopPropagation();var b="",c=this.getCaret(),d=!1;b=this.getCurrentWord(c),b.match(this.usernameRegex)?(b=RegExp.$1,this.autocompleteType="username",d=!0):b.match(this.constructor.hashtag)&&(b=RegExp.$1,this.autocompleteType="hashtag",d=!0);if(b.length&&d)switch(a.keyCode){case TD.constants.keyCodes.escape:this.hide(),a.stopPropagation();break;case TD.constants.keyCodes.upArrow:case TD.constants.keyCodes.downArrow:break;case TD.constants.keyCodes.tab:case TD.constants.keyCodes.enter:!a.shiftKey&&this.$selectedItem&&this.isCompletionsOpen?this.select():this.options.dmMode&&!this.isCompletionsOpen&&this.select();break;case TD.constants.keyCodes.spacebar:this.options.dmMode&&this.set(this.$input.val());break;default:this.autocompleteType=="hashtag"?this.lookUpHashtag(b):this.lookUpUser(b)}else this.hide()},keypress:function(a){switch(a.keyCode){case TD.constants.keyCodes.spacebar:if(!this.options.dmMode)break;case TD.constants.keyCodes.tab:case TD.constants.keyCodes.enter:case TD.constants.keyCodes.escape:this.isCompletionsOpen&&a.preventDefault();break;case TD.constants.keyCodes.upArrow:this.isCompletionsOpen&&!a.shiftKey&&(this.moveSelection("prev"),a.preventDefault());break;case TD.constants.keyCodes.downArrow:this.isCompletionsOpen&&!a.shiftKey&&(this.moveSelection("next"),a.preventDefault());break;default:this.$selectedItem=null}},sanitize:function(a){return a.replace(/ /g,"")},moveSelection:function(a){var b=a=="next"?"li:first":"li:last",c=this.$selectedItem||this.$node.find("li.s-selected");if(!c.length){this.$selectedItem=this.$node.find(b).addClass("s-selected");return}c=c.removeClass("s-selected"),a==="next"?c=c.nextAll("li:first"):c=c.prevAll("li:first"),c.length?this.$selectedItem=c.addClass("s-selected"):this.$selectedItem=this.$node.find(b).addClass("s-selected")},select:function(){var a,b;this.autocompleteType==="username"?(a=this.$selectedItem.find(".js-screenname").text(),this.options.dmMode||(a="@"+a),b=this.$selectedItem.find("img").attr("src")):a=this.$selectedItem.find(".js-hashtag").text(),this.set(a,b)},set:function(a,b){var c=this.replaceCurrentWord(a);this.$input.val(c.value),this.setCaretPosition(c.cursor),this.$input.change(),this.$node.trigger(this.constructor.SELECT,[a,b]),this.hide()},show:function(){this.$node.show(),this.isCompletionsOpen=!0},hide:function(){this.$node.hide(),this.isCompletionsOpen=!1,this.$node.trigger("dataTypeaheadQueryReset")},lookUpHashtag:function(a){var a=this.sanitize(a);this.$node.trigger("uiNeedsTypeaheadSuggestions",{datasources:["topics"],query:"#"+a,onlyLocalData:!0,dropdownId:this.dropdownId})},lookUpUser:function(a){var a=this.sanitize(a);this.$node.trigger("uiNeedsTypeaheadSuggestions",{datasources:["users"],query:a,onlyLocalData:!0,dropdownId:this.dropdownId})},updateDropdown:function(a,b){var c=new RegExp("("+b.query.split("").join("|")+")","gi"),d,e,f=[];if(b.dropdownId!==this.dropdownId)return;this.autocompleteType==="hashtag"&&b.suggestions.topics?(e=b.suggestions.topics.slice(0,this.options.limit),f=e.map(function(a){return{value:this.constructor._htmlEscapeAndStrongifyMatches(a.topic,c)}},this),d=TD.ui.template.render("compose/autocomplete_hashtag",{results:f})):this.autocompleteType==="username"&&b.suggestions.users&&(e=b.suggestions.users.slice(0,this.options.limit),f=e.map(function(a){return{id:a.id,screenName:this.constructor._htmlEscapeAndStrongifyMatches(a.screen_name,c),name:this.constructor._htmlEscapeAndStrongifyMatches(a.name,c),pic:TD.util.transformTwitterAvatar(a.profile_image_url_https,"mini")}},this),d=TD.ui.template.render("compose/autocomplete_twitter_user",{results:f})),this.$node.html(d),f.length?(this.isCompletionsOpen||this.show(),this.moveSelection("next")):this.isCompletionsOpen&&this.hide()},destroy:function(){this._unregisterEvents(),this.$node.remove()}}),TD.components.Retweeters=TD.components.Base.extend(function(a,b){function f(a){var b,c={stats:[]};this.tweetSummary=a;if(_.isString(a.retweeters_count))b=a.retweeters_count;else{var f=a.retweeters_count||0;b=Math.max(f,d.length)+""}this.tweetSummary.retweeters_count=b,b!=="0"&&c.stats.push({count:TD.util.prettyNumber(b),label:TD.util.pluralise(TD.i("Retweet"),TD.i("Retweets"),b),type:"retweeters"}),a.favoriters_count!=="0"&&c.stats.push({count:TD.util.prettyNumber(a.favoriters_count),label:TD.util.pluralise(TD.i("Favorite"),TD.i("Favorites"),a.favoriters_count),type:"favoriters"});if(c.stats.length>0){var g=TD.ui.template.render("status/tweet_detail_socialstats",c);e.$node.html(g)}else e.destroy()}if(!(a instanceof TD.services.TwitterStatus)||a instanceof TD.services.TwitterDirectMessage)return;this.tweet=a.getMainTweet();var c=TD.controller.clients.getClient(this.tweet.account.getKey()),d=[],e=this;c.getTweetSummary(this.tweet.id,f.bind(this),function(){e.destroy()})}),TD.components.RepliesTo=TD.components.Base.extend(function(a,b){this.chirp=a.getMainTweet(),this.mainTweet=this.chirp.getMainTweet(),this.repliesTo=[],this.mediaPreviewSize=b,this.subscription=$.subscribe("/tweets/conversation/"+this.mainTweet.id,this._handleConversation.bind(this));var c=TD.controller.clients.getClient(this.chirp.account.getKey());c.getConversation(this.mainTweet.id)}).methods({_handleConversation:function(a){this.repliesTo=a.descendants,this.repliesTo.sort(TD.util.chirpAscSort);if(this.repliesTo.length>0){var b=_.map(this.repliesTo,function(a){return a.render({mediaPreviewSize:this.mediaPreviewSize,isInConvo:!0})}.bind(this)).join(""),c=TD.ui.template.render("status/tweet_detail_repliesto",{renderedChirps:b});this.$node.html(c)}},findChirp:function(a){var b=null;return this.chirp.id===a?b=this.chirp:this.mainTweet.id===a?b=this.mainTweet:this.repliesTo&&(b=_.detect(this.repliesTo,function(b){return b.id===a})),b},destroy:function(){$.unsubscribe(this.subscription),this.supr()}}),TD.components.InReplyTo=TD.components.Base.extend(function(a,b,c){var d=this;this.chirp=a,this.mainTweet=this.chirp.getMainTweet(),this.$container=b,this.$detailContentContainer=this.$container.find(".js-detail-container"),this.$detailContent=this.$detailContentContainer.find(".js-detail-content"),this.mediaPreviewSize=c;if(!this.mainTweet.inReplyToID)return;this.$node.html(TD.ui.template.render("status/tweet_detail_inreplyto")),this.$repliesContainer=this.$find(".js-replies-before"),this.$repliesText=this.$find(".in-reply-to").hide(),this.replies=null,_.defer(function(){d.bubbleEvent(TD.components.InReplyTo.BEGIN)}),this.subscription=$.subscribe("/tweets/conversation/"+this.mainTweet.id,_.bind(this._handleRelatedResults,this)),this.client=TD.controller.clients.getClient(this.chirp.account.getKey()),this.client.getConversation(this.mainTweet.id)}).statics({BEGIN:"td-load-convo",END:"td-load-finish",INREPLYTO_PADDING:20}).methods({_handleRelatedResults:function(a){this.replies=a.ancestors,_.isEmpty(this.replies)?this._getTweet():this._showReplies()},_getTweet:function(){var a=this;this.client.show(this.mainTweet.inReplyToID,function(b){a.replies=a.replies||[],a.replies.push(b),a._showReplies()},function(){a.bubbleEvent(TD.components.InReplyTo.END)})},_showReplies:function(){_.defer(_.bind(this._showRepliesInternal,this))},_showRepliesInternal:function(){var a,b,c,d,e,f,g;this.bubbleEvent(TD.components.InReplyTo.END);if(_.isEmpty(this.replies))return;this.replies.sort(TD.util.chirpAscSort),b=this.mainTweet.id,this.replies=_.filter(this.replies,function(a){return a.id!==b}),c=_.map(this.replies,function(a){return a.render({mediaPreviewSize:this.mediaPreviewSize,isInConvo:!0})}.bind(this)).join(""),d=this.$detailContentContainer.outerHeight(),e=this.$detailContent.outerHeight(),this.$repliesContainer.html(c),a=this.$node.outerHeight(),e<d&&this.$detailContent.css("padding-bottom",d-e),this.replies.length<=1?f=0:(g=this.$repliesContainer.children().last().outerHeight()+TD.components.InReplyTo.INREPLYTO_PADDING,f=a-g),this.$detailContentContainer.scrollTop(a),this.$detailContentContainer.animate({scrollTop:f},{duration:"fast"})},findChirp:function(a){var b=null;return this.chirp.id===a?b=this.chirp:this.mainTweet.id===a?b=this.mainTweet:this.replies&&(b=_.detect(this.replies,function(b){return b.id===a})),b},destroy:function(){this.subscription&&$.unsubscribe(this.subscription),this.supr()}}),TD.components.BaseModal=TD.components.Base.extend(function(){this.$node=$(TD.ui.template.render("large_modal")),$(document).trigger("uiCloseModal"),this.$title=this.$find(".js-header-title"),this.$closeButton=this.$find(".js-dismiss"),this.$menuContainer=this.$find(".js-mdl-content"),this.$footer=this.$find("footer");var a=_.bind(this.destroy,this);this.$closeButton.bind("click",function(){a()}),this.$node.bind(TD.components.BaseModal.CLOSE_EVENT,a),this.boundCloseModal=this._handleCloseModal.bind(this),$(document).on("uiCloseModal",this.boundCloseModal);var b=_.bind(this.handleDragStart,this),c=_.bind(this.getDragDropBoundary,this);this.$node.draggable({boundary:c,handle:this.$find(".mdl-drag-handle")}),this.$node.on("start.draggable",b),$("div.ovl.scroll-v").on("click",function(b){this===b.target&&a()}),this.hasFocus=!1,this.focusId=_.uniqueId("focus"),this._boundHandleFocus=this.handleFocus.bind(this),$(document).on("uiFocus",this._boundHandleFocus),$(document).trigger("uiFocusRequest",{id:this.focusId})}).statics({CLOSE_EVENT:"td-close"}).methods({handleFocus:function(a,b){b.id===this.focusId?this.hasFocus=!0:this.hasFocus=!1},getDragDropBoundary:function(){return this.$node.parent()},handleDragStart:function(){this.$node.css({position:"absolute",top:this.$node.offset().top,left:this.$node.offset().left}),this.$node.parent("#open-modal").addClass("is-dragging")},show:function(){this.supr()},_handleCloseModal:function(){this.destroy()},destroy:function(){this.$node.parent("#open-modal").removeClass("is-dragging"),$(document).off("uiFocus",this._boundHandleFocus),$(document).off("uiCloseModal",this.boundCloseModal),$(document).trigger("uiFocusRelease",{id:this.focusId}),this.supr()}}),TD.components.NewFeaturesSplash=TD.components.BaseModal.extend(function(){this.$node.addClass("release-notes-modal"),this.$menuContainer.append(TD.ui.template.render("splash/whats_new")),this.$doneButton=this.$find(".js-done"),this.$doneButton.click(_.bind(this.destroy,this)),$("#splash-modal").empty().append(this.$node).show(),TD.components.NewFeaturesSplash.updateSeenVersion()}).statics({FOR_VERSION:"3.0",shouldShow:function(){var a=TD.components.NewFeaturesSplash.FOR_VERSION,b=TD.settings.getPreviousSplashVersion();return b==="0"?(TD.components.NewFeaturesSplash.updateSeenVersion(),!1):TD.util.versionComparator(a,b)!==1?!1:TD.util.versionComparator(TD.version,a)===-1?!1:!0},updateSeenVersion:function(){TD.settings.setPreviousSplashVersion(TD.version)}}).methods({destroy:function(){this.supr(),$("#splash-modal").hide()}}),TD.components.OpenColumn=TD.components.BaseModal.extend(function(){var a=this;this.$footer.append($(TD.ui.template.render("open_column_footer"))),this.$backButton=this.$find(".js-back"),this.$addButton=this.$find(".js-add-column"),this.history=[],this.menu=null,this.$backButton.bind("click",function(b){b.stopPropagation(),a._previous()})}).statics({GO_URL_REGEX:/^(add|profile)$/,GO_EVENT:"/go",instance:null}).methods({canGo:function(a,b){return TD.components.OpenColumn.GO_URL_REGEX.test(a)},go:function(a,b,c,d){TD.components.OpenColumn.instance=this,d&&(this.history=[d]),this.history.push([a,_.clone(b),c]);var e=b.shift();if(this.menu&&this.menu.canGo&&this.menu.canGo(a,b)){this.history.pop(),this.history[this.history.length-1]=fullUrl,this.menu.go(e,b,c);return}var f,g=!1,h=!1,i=!1;if(a==="add")switch(e){case"home":f=new TD.components.OpenColumnHome,g=!0;break;case"lists":f=new TD.components.OpenLists;break;case"trends":f=new TD.components.OpenTrends;break;default:TD.controller.columnManager.TWITTER_GENERIC[e]&&(f=new TD.components.OpenTwitterGeneric(e))}this._show(e,f,g,h,i),f.go&&f.go(e,b,c)},_show:function(a,b,c,d,e){this.menu&&this.menu.destroy(),this.menu=b,this.$menuContainer.append(b.$node),c||this.menu.setup(this.$addButton),this.$node.toggleClass("s-nonav",c),this.$node.toggleClass("s-narrow",d),this.$backButton.toggle(this.history.length>1).toggleClass("hide",this.history.length===0),a==="home"?this.$title.text(TD.i("Add Column")):a==="profile"?this.$title.text(TD.i("Account profile")):this.$title.text(TD.controller.columnManager.MENU_TITLE[a]||"")},_previous:function(){this.history.pop();var a=this.history.pop();a instanceof Array?this.go.apply(this,a):(this.destroy(),$(a.target).trigger(a.type,[a.data]))},destroy:function(){this.menu&&this.menu.destroy(),_.each(this.eventSubscriptions,function(a){$.unsubscribe(a)}),this.$backButton.unbind(),$("#open-modal").hide(),TD.components.OpenColumn.instance=null,this.supr()}}),TD.components.OpenColumnHome=TD.components.Base.extend(function(){var a=this,b={};TD.storage.accountController.getPostingAccounts().forEach(function(a){b[a.getType()]=!0});var c=TD.controller.columnManager.DISPLAY_ORDER_SINGLETONS.filter(function(a){return _.isEmpty(TD.storage.columnController.getColumnsByType(a.type))}),d=TD.controller.columnManager.DISPLAY_ORDER.filter(function(a){return b[a.service]});this.$node=$(TD.ui.template.render("open_column_home",{options:d,singletons:c,hasSingletons:c.length})),this.$launchers=this.$find(".js-item-launch"),this.$launchers.bind("click",function(b){var c=$(b.currentTarget),d=c.data("action"),e=c.data("type"),f;switch(d){case"add":f=TD.controller.columnManager.makeColumnFor(e,"tweetdeck"),TD.controller.columnManager.addColumnToUI(f),a.bubbleEvent(TD.components.BaseModal.CLOSE_EVENT);break;case"open":a.publishEvent(TD.components.OpenColumn.GO_EVENT,TD.components.OpenColumnHome.URL_BASE+"/"+e)}})}).statics({URL_BASE:"/add"}),TD.components.SplitMenu=TD.components.Base.extend(function(){this.$node=$(TD.ui.template.render("open_split_menu")),this.menuItems=[],this.rightPillarComponent=null,this.$leftPinnedContainer=this.$find(".js-left-pinned"),this.$leftPillarContainer=this.$find(".js-left-column"),this.$rightPillarContainer=this.$find(".js-right-column")}).methods({appendMenuItem:function(a){this.menuItems.push(a),this.$leftPillarContainer.append(a.$node)},removeMenuItem:function(a){a.destroy(),this.menuItems=_.without(this.menuItems,a)},appendPinnedMenuItem:function(a){this.menuItems.push(a),this.$leftPillarContainer.addClass("s-with-pinned"),this.$leftPinnedContainer.html(a.$node)},appendMenuItemElement:function(a){this.$leftPillarContainer.append(a)},setRightPillar:function(a){this.rightPillarComponent&&this.rightPillarComponent.destroy(),this.rightPillarComponent=a,this.$rightPillarContainer.html(a.$node)},destroy:function(){_.each(this.menuItems,function(a){a.destroy()}),this.rightPillarComponent&&this.rightPillarComponent.destroy(),this.supr()}}),TD.components.OpenSplitMenu=TD.components.SplitMenu.extend(function(){this.$addButton=null}).methods({setup:function(a){this.$addButton=a,this.$addButton.hide(),this.$addButton.click(_.bind(this._handleAddClick,this))},setChirpPillar:function(a){this.setRightPillar(a);var b=this;a instanceof TD.components.TemporaryColumn&&_.defer(function(){a.populate(),b.$addButton.show(),b.$addButton.attr("disabled",!1)})},_handleAddClick:function(a){this.$addButton.attr("disabled")||this.makeChirpColumnPermanent()},makeChirpColumnPermanent:function(){this.rightPillarComponent&&(this.rightPillarComponent.makePermanent(),this.$addButton.attr("disabled",!0))},destroy:function(){this.$addButton.unbind("click"),this.$addButton.hide(),this.supr()}}),TD.components.OpenTwitterGeneric=TD.components.OpenSplitMenu.extend(function(a){this.type=a,this.showUserSearch=!TD.controller.columnManager.SELF_ACCOUNTS_ONLY[a],this.userSearch=null,this.helpText=TD.controller.columnManager.HELP_TEXT[a],this.placeHolder=new TD.components.OpenColumnPlaceholder(this.helpText),this.setChirpPillar(this.placeHolder);if(this.showUserSearch){this.userSearch=new TD.components.TwitterUserSearch,this.appendPinnedMenuItem(this.userSearch);var b=this.userSearch.detachResultsContainer();this.appendMenuItemElement(b)}this.profileAccount=new TD.components.ProfileAccount,this.profileAccount.$node.hide(),this.appendMenuItem(this.profileAccount),this.selfAccounts=new TD.components.SelfAccounts("twitter"),this.appendMenuItem(this.selfAccounts),this.$node.bind(TD.components.MenuItemBase.BUBBLE_SELECT_EVENT,_.bind(this._handleSelect,this))}).methods({go:function(a,b,c){c.screenName?(this.profileAccount.setUser(c.screenName),this.profileAccount.$node.show(),this.profileAccount.select()):this.selfAccounts.selectDefault()},_handleSelect:function(a,b){var c;if(b.target.account)c=new TD.components.TemporaryColumn,c.genericTwitter(this.type,b.target.account,undefined);else if(b.target.twitterUser){c=new TD.components.TemporaryColumn;var d=this.userSearch.client.oauth.account;c.genericTwitter(this.type,d,b.target.twitterUser)}c&&(this.setChirpPillar(c),a.stopPropagation())}}),TD.components.OpenLists=TD.components.OpenSplitMenu.extend(function(){this.screenName=null,this.listsComponent=null,this.newListButton=null,this.helpText=TD.controller.columnManager.HELP_TEXT[TD.controller.columnManager.LISTS],this.placeHolder=new TD.components.OpenColumnPlaceholder(this.helpText),this.removePlaceholder=new TD.components.OpenColumnPlaceholder(""),this.setChirpPillar(this.placeHolder),this.$node.bind(TD.components.MenuItemBase.BUBBLE_SELECT_EVENT,_.bind(this._handleListSelect,this)),this.$node.bind(TD.components.Lists.LOADED,_.bind(this._handleListsLoaded,this))}).methods({go:function(a,b,c){c.screenName?(this.screenName=c.screenName,this.listsComponent=new TD.components.Lists(this.screenName,c.slug),this.appendMenuItem(this.listsComponent)):(this.newListButton=new TD.components.NewListButton,this.appendPinnedMenuItem(this.newListButton),this.listsComponent=new TD.components.Lists,this.appendMenuItem(this.listsComponent))},_handleListsLoaded:function(a,b){if(b.target!==this.listsComponent)return;if(b.data===0){this.removeMenuItem(this.listsComponent);var c;this.screenName?c=TD.i("This user has no public lists"):c=TD.i("You are not subscribed to any lists"),this.listsComponent=new TD.components.OpenColumnPlaceholder(c),this.setChirpPillar(this.removePlaceholder),this.appendMenuItem(this.listsComponent)}},_handleListSelect:function(a,b){var c=b.target.list,d=new TD.components.TemporaryColumn;d.list(c),this.setChirpPillar(d),a.stopPropagation()}}),TD.components.OpenTrends=TD.components.OpenSplitMenu.extend(function(){this.trends=new TD.components.Trends,this.appendMenuItem(this.trends),this.helpText=TD.controller.columnManager.HELP_TEXT[TD.controller.columnManager.TRENDS],this.placeHolder=new TD.components.OpenColumnPlaceholder(this.helpText),this.setChirpPillar(this.placeHolder),this.$node.bind(TD.components.MenuItemBase.BUBBLE_SELECT_EVENT,_.bind(this._handleTrendSelect,this))}).methods({_handleTrendSelect:function(a,b){var c=b.target.title,d=new TD.components.TemporaryColumn;d.search(c),this.setChirpPillar(d),a.stopPropagation()}}),TD.components.OpenColumnPlaceholder=TD.components.Base.extend(function(a){this.helperText=a,this.$node=$(TD.ui.template.render("open_column_temp_help",{helpText:a}))}),TD.components.NewListButton=TD.components.Base.extend(function(){var a=this;this.$button=$.createElement("button").addClass("btn").text(TD.i("Create list")),this.$button.click(function(b){a.bubbleEvent(TD.components.BaseModal.CLOSE_EVENT);var c=new TD.components.ListDetails}),this.$node.append(this.$button),this.$node.addClass("sch-list padding-al")}),TD.components.ListDetails=TD.components.BaseModal.extend(function(a){this.theList=a,this.toAutoAdd=[];var b=TD.storage.accountController.getAccountsForService("twitter");this.$editForm=$(TD.ui.template.render("lists/edit_form",{accounts:b})),this.$menuContainer.append(this.$editForm),this.$footer.append($(TD.ui.template.render("lists/edit_footer"))),$("#lists-modal").empty().append(this.$node).show(),this.$account=$("#list-account"),this.$name=$("#list-name"),this.$description=$("#list-description"),this.$modePublic=this.$find('input:radio[value="public"]'),this.$modePrivate=this.$find('input:radio[value="private"]'),this.$saveButton=this.$find(".js-save"),this.$name.focus(),this.$saveButton.click(_.bind(this._handleSaveClick,this)),a?(this.$title.text(TD.i("Edit list")),this.$account.val(TD.storage.Account.generateKeyFor("twitter",a.user.id)),this.$account.attr("disabled",!0),this.$name.val(a.name),this.$description.val(a.description),a.isPrivate?this.$modePrivate.attr("checked",!0):this.$modePublic.attr("checked",!0)):this.$title.text(TD.i("Create list"))}).methods({autoAddMember:function(a){this.toAutoAdd.push(a)},_handleSaveClick:function(){var a=this.$account.val(),b=TD.controller.clients.getClient(a),c=this.$name.val(),d=this.$description.val(),e=Boolean(this.$modePrivate.attr("checked")),f=_.bind(this._handleSaveSuccess,this),g=_.bind(this._handleSaveFailure,this);this.$saveButton.prop("disabled",!0),this.theList?b.updateList(this.theList.id,c,d,e,f,g):b.createList(c,d,e,f,g)},_handleSaveSuccess:function(a){this.destroy();var b=new TD.components.ListMembers(a,this.toAutoAdd)},_handleSaveFailure:function(){this.$saveButton.prop("disabled",!1);var a=TD.i("Problem saving list. Please check the details and try again");TD.controller.progressIndicator.addMessage(a)},destroy:function(){this.supr(),$("#lists-modal").hide()}}),TD.components.ListMembers=TD.components.BaseModal.extend(function(a,b){var c=this;this.theList=a,this.membersIndex={},this.changed=!1,this.client=TD.controller.clients.getClient(a.account.getKey()),this.feedKey=TD.storage.Feed.generateKeyFor(this.theList.account.getKey(),"list",{listId:this.theList.id,ownerId:this.theList.user.id,slug:this.theList.id,screenName:this.theList.user.id}),this.splitMenu=new TD.components.SplitMenu,this.userSearch=new TD.components.TwitterUserSearch(a.user.account,10,TD.components.ListMember),this.suggestedUsers=new TD.components.SuggestedUsers(a.user.account,10,TD.components.ListMember,a.name),this.loadingPane=new TD.components.OpenColumnPlaceholder(TD.i("Loading list members...")),this.memberList=new TD.components.ListMemberList,this.$title.text(TD.i("{{{1}}} by {{2}}",{1:a.name,2:a.user.screenName})),this.$menuContainer.append(this.splitMenu.$node),this.$footer.append($(TD.ui.template.render("lists/edit_members_footer"))),this.splitMenu.appendPinnedMenuItem(this.userSearch),this.splitMenu.appendMenuItemElement(this.userSearch.detachResultsContainer()),this.splitMenu.appendMenuItem(this.suggestedUsers),this.splitMenu.setRightPillar(this.loadingPane),$("#lists-modal").empty().append(this.$node).show(),this.userSearch.searchInput.$inputBox.focus(),this.$memberCount=this.memberList.$find(".js-member-count"),this.$editButton=this.$find(".js-edit"),this.$deleteButton=this.$find(".js-delete"),this.$doneButton=this.$find(".js-done"),this.$addColumnOption=this.$find(".js-add-column-option"),this.$addColumnCheckbox=this.$addColumnOption.find(".js-add-column-checkbox"),TD.storage.columnController.getColumnsContainingFeed(this.feedKey).length===0&&(this.$addColumnCheckbox.prop("checked",!0),this.$addColumnOption.removeClass("is-hidden")),this.$editButton.click(_.bind(this._editDetails,this)),this.$deleteButton.click(_.bind(this._deleteList,this)),this.$doneButton.click(_.bind(this._handleDone,this)),this.$node.bind(TD.components.ListMember.ADD_REMOVE_EVENT,_.bind(this._addRemoveMember,this)),this.$node.bind(TD.components.TwitterUserSearch.SEARCH_COMPLETE,function(a,b){var d=b.target;c._checkResultsState(d),c.splitMenu.$leftPillarContainer.scrollTop(0)}),this._updateMemberCount();var d=this._addMembers(b);d.addBothWith(this,this._loadAllMembers),d.addCallback(function(){c.suggestedUsers.render(),c._checkResultsState(c.userSearch),c._checkResultsState(c.suggestedUsers)})}).methods({_addMembers:function(a){var b;if(_.isEmpty(a))b=TD.core.defer.succeed();else{b=new TD.core.defer.Deferred;var c=_.pluck(a,"screenName");this.client.addUsersToList(this.theList.id,c,_.bind(b.callback,b),_.bind(b.errback,b))}return b},_loadAllMembers:function(){var a=this,b,c=function(b){a._displayMembers(b.users,!1);if(b.next_cursor){var d=a._fetchMemberPage(b.next_cursor_str);return d.addCallback(c),d}};return b=this._fetchMemberPage(-1),b.addCallback(c),b},_fetchMemberPage:function(a){var b=new TD.core.defer.Deferred;return this.client.getListMembers(this.theList.id,a,_.bind(b.callback,b),_.bind(b.errback,b)),b},_displayMembers:function(a,b){var c=this;b&&a.reverse(),_.each(a,function(a){if(!c.membersIndex[a.id]){var d=new TD.components.ListMember(a);c.membersIndex[d.user.id]=d,b?c.memberList.prepend(d):c.memberList.append(d)}}),this.loadingPane&&(this.loadingPane.destroy(),this.loadingPane=null,this.splitMenu.setRightPillar(this.memberList))},_updateMemberCount:function(){this.$memberCount.text(this.theList.memberCount)},_editDetails:function(){this.destroy();var a=new TD.components.ListDetails(this.theList)},_deleteList:function(){var a=this,b=_.uniqueId(),c={id:b,title:TD.i("Deleting list!"),message:TD.i("Are you sure you want to delete this list?"),okLabel:TD.i("Delete"),cancelLabel:TD.i("Cancel")},d=function(c,e){if(e.id!==b)return;$(document).off("uiConfirmationAction",d),e.result&&a.client.destroyList(a.theList.id,function(){a.theList=null,a.destroy()})};$(document).on("uiConfirmationAction",d).trigger("uiShowConfirmationDialog",c)},_addRemoveMember:function(a,b){a.stopPropagation();var c=b.target;this.membersIndex[c.user.id]?this.removeMember(c.user):this.addMember(c.user)},addMember:function(a){var b=this;this._changeUserState(a.id,TD.components.ListMember.STATE_WORKING),this.client.addUserToList(this.theList.id,a.screenName,function(c){b._displayMembers([a],!0),b.theList.memberCount++,b._updateMemberCount(),b._changeUserState(a.id,TD.components.ListMember.STATE_MEMBER),b.changed=!0},function(c){b._changeUserState(a.id,TD.components.ListMember.STATE_NON_MEMBER);var d=TD.i("Problem adding {{userName}} to the list {{listName}}. Please try again",{userName:a.name,listName:b.theList.name});TD.controller.progressIndicator.addMessage(d)})},removeMember:function(a){var b=this;this._changeUserState(a.id,TD.components.ListMember.STATE_WORKING),this.client.removeUserFromList(this.theList.id,a.screenName,function(c){var d=b.membersIndex[a.id];d.destroy(),delete b.membersIndex[a.id],b.theList.memberCount--,b._updateMemberCount(),b._changeUserState(a.id,TD.components.ListMember.STATE_NON_MEMBER),b.changed=!0},function(c){b._changeUserState(a.id,TD.components.ListMember.STATE_MEMBER);var d=TD.i("Problem removing {{userName}} from the list {{listName}}. Please try again",{userName:a.name,listName:b.theList.name});TD.controller.progressIndicator.addMessage(d)})},_changeUserState:function(a,b){this.membersIndex[a]&&this.membersIndex[a].setState(b),b===TD.components.ListMember.STATE_MEMBER&&(b=TD.components.ListMember.STATE_MEMBER_CHECKED);var c=this.userSearch.items.concat(this.suggestedUsers.items);_.each(c,function(c){c.user.id==a&&c.setState(b)})},_checkResultsState:function(a){var b=this,c=a===this.suggestedUsers;_.each(a.items,function(a){b.membersIndex[a.user.id]?(a.setState(TD.components.ListMember.STATE_MEMBER_CHECKED),c&&a.hide()):(a.setState(TD.components.ListMember.STATE_NON_MEMBER),c&&a.show())})},_handleDone:function(){if(this.$addColumnCheckbox.prop("checked")){var a=new TD.components.TemporaryColumn;a.list(this.theList),a.makePermanent()}this.destroy()},destroy:function(){if(this.changed&&this.theList){TD.cache.lists.add(this.theList);var a=TD.controller.feedManager.getPoller(this.feedKey);a&&(a.removeAll(),a.refresh())}$("#lists-modal").hide(),this.splitMenu.destroy(),this.userSearch.destroy(),this.suggestedUsers.destroy(),this.memberList.destroy(),this.loadingPane&&this.loadingPane.destroy(),_.each(this.membersIndex,function(a,b){a.destroy()}),this.supr()}}),TD.components.ListMember=TD.components.Base.extend(function(a){this.user=a,this.state=null;var b={isTwitter:!0,fullname:a.name||a.screenName,username:a.screenName,profileImageURL:a.profileImageURL,description:a.description,isProtected:a.isProtected,isVerified:a.isVerified};this.$node=$(TD.ui.template.render("lists/member",b)),this.$addRemoveButton=this.$find(".js-add-remove"),this.$addRemoveButton.click(_.bind(this._handleAddRemoveClick,this)),this.setMember()}).statics({ADD_REMOVE_EVENT:"td-add-remove",STATE_MEMBER:"member",STATE_MEMBER_CHECKED:"member-checked",STATE_NON_MEMBER:"non-member",STATE_WORKING:"working"}).methods({_handleAddRemoveClick:function(){this.bubbleEvent(TD.components.ListMember.ADD_REMOVE_EVENT)},setState:function(a){switch(a){case TD.components.ListMember.STATE_MEMBER:this.setMember();break;case TD.components.ListMember.STATE_MEMBER_CHECKED:this.setMemberChecked();break;case TD.components.ListMember.STATE_NON_MEMBER:this.setNonMember();break;case TD.components.ListMember.STATE_WORKING:this.setWorking()}},setMember:function(){this.state=TD.components.ListMember.STATE_MEMBER,this.$addRemoveButton.removeClass("s-nonmember s-working s-checked").addClass("s-member"),this.$addRemoveButton.attr("disabled",!1)},setMemberChecked:function(){this.state=TD.components.ListMember.STATE_MEMBER_CHECKED,this.$addRemoveButton.removeClass("s-nonmember s-member s-working").addClass("s-checked"),this.$addRemoveButton.attr("disabled",!1)},setNonMember:function(){this.state=TD.components.ListMember.STATE_NON_MEMBER,this.$addRemoveButton.removeClass("s-member s-checked s-working").addClass("s-nonmember"),this.$addRemoveButton.attr("disabled",!1)},setWorking:function(){this.state=TD.components.ListMember.STATE_WORKING,this.$addRemoveButton.removeClass("s-member s-nonmember s-checked").addClass("s-working"),this.$addRemoveButton.attr("disabled",!0)}}),TD.components.ListMemberList=TD.components.Base.extend(function(){this.$node=$(TD.ui.template.render("lists/member_list")),this.$list=this.$find(".js-member-list")}).methods({append:function(a){this.$list.append(a.$node)},prepend:function(a){this.$list.prepend(a.$node)}}),TD.components.TwitterProfileMenu=TD.components.Base.extend(function(a){var b=TD.controller.columnManager.DISPLAY_ORDER_PROFILE;this.screenName=a,this.$node=$(TD.ui.template.render("open_column_profile",{options:b})),this.$launchers=this.$find(".js-item-launch"),this.$launchers.click(_.bind(this._handleItemClick,this))}).statics({URL_BASE:"/add"}).methods({_handleItemClick:function(a){var b=$(a.currentTarget),c=b.data("action"),d=b.data("type"),e=TD.components.OpenColumnHome.URL_BASE+"/"+d;if(c!=="open")return;this.screenName&&(e+="?screenName="+this.screenName),this.publishEvent(TD.components.OpenColumn.GO_EVENT,e)}}),TD.components.Lists=TD.components.Base.extend(function(a,b){var c=this,d={},e=TD.storage.clientController.client.getDefaultAccount(),f;this.owners=d,this.screenName=a,a?f=TD.i("@{{screenName}}'s lists",this):f=TD.i("My lists"),this.$node=$(TD.ui.template.render("open_column_list_multi_group",{groups:[{title:f,className:"js-my-lists"},{title:TD.i("Subscribed to"),className:"js-others-lists"}]})),this.$myLists=this.$find("ul.js-my-lists"),this.$otherLists=this.$find("ul.js-others-lists"),this.lists=[],this.listComponents=[],this.slug=b,this.listComparator=function(a,b){var c=TD.components.Lists,f,g;return d[a.user.id]&&!d[b.user.id]?-1:!d[a.user.id]&&d[b.user.id]?1:d[a.user.id]&&d[b.user.id]?(f=a.account.getKey()===e,g=b.account.getKey()===e,f===g?c.ownerNameComparator(a,b)||c.nameComparator(a,b):f?-1:1):c.nameComparator(a,b)||c.ownerNameComparator(a,b)};if(a){var g=TD.cache.twitterUsers.getByScreenName(a);g.addCallback(function(b){d[b.id]=!0;var e=TD.controller.clients.getClientsByService("twitter"),f=_.find(e,function(b){if(b.oauth.account.getUsername().toLowerCase()===a.toLowerCase())return b});f?(c._handleLists(TD.cache.lists.getListsFor(f.oauth.account.getKey())),c.bubbleEvent(TD.components.Lists.LOADED,c.lists.length)):(f=TD.controller.clients.getPreferredClient("twitter"),f.getLists(a,function(a){c._handleLists(a),c.bubbleEvent(TD.components.Lists.LOADED,c.lists.length)}))})}else{var h=TD.controller.clients.getClientsByService("twitter");_.each(h,function(a){d[a.oauth.account.getUserID()]=!0}),_.each(h,function(a){c._handleLists(TD.cache.lists.getListsFor(a.oauth.account.getKey()))}),this.bubbleEvent(TD.components.Lists.LOADED,c.lists.length)}}).statics({LOADED:"td-lists-loaded",nameComparator:function(a,b){var c=a.name.toLowerCase(),d=b.name.toLowerCase();return(c>d)-(c<d)},ownerNameComparator:function(a,b){var c=a.user.name.toLowerCase(),d=b.user.name.toLowerCase();return(c>d)-(c<d)}}).methods({_handleLists:function(a){var b=this;if(!_.isArray(a)||a.length===0)return;this.lists=this.lists.concat(a),this.lists.sort(this.listComparator);var c={};this.lists=_.select(this.lists,function(a){var b=!c[a.id];return c[a.id]=!0,b}),_.each(this.listComponents,function(a){a.destroy()});var d;this.listComponents=_.map(this.lists,function(a){var c=(new TD.components.MenuItem).list(a);return b.owners[a.user.id]?(b.$myLists.append(c.$node),b.slug&&a.slug.toLowerCase()===b.slug.toLowerCase()&&a.user.screenName.toLowerCase()===b.screenName.toLowerCase()&&(d=c)):b.$otherLists.append(c.$node),c}),!d&&this.screenName&&this.listComponents.length>0&&(d=this.listComponents[0]),d&&_.defer(function(){d.select()})}}),TD.components.SearchInput=TD.components.Base.extend(function(a){var b=this;_.isString(a)?this.promptText=a:this.promptText=TD.i("Enter a #hashtag or keyword"),this.$node=$(TD.ui.template.render("add_column_search_input",{searchInputClassName:"js-add-column-search-input",searchInputPlaceholder:this.promptText})),this.$inputBox=this.$find(".js-add-column-search-input"),this.$searchButton=this.$find(".js-perform-search"),this.$spinner=this.$find(".js-spinner"),this.$clearButton=this.$find(".js-clear-search"),this.$node.submit(function(a){b._search(),a.preventDefault()}),this.$clearButton.click(function(a){b._clear(),a.preventDefault()}),this.$searchButton.click(function(a){b._search(),a.preventDefault()}),this.boundCancelSearch=this.cancelSearch.bind(this),this.$inputBox.on("uiInputBlur",this.boundCancelSearch)}).methods({cancelSearch:function(){this.$inputBox.val("").blur()},_search:function(){var a=$.trim(this.$inputBox.val());a===""?this._clear():this.prevSearchTerm!==a&&(this.prevSearchTerm=a,this.bubbleEvent("td-search",this.$inputBox.val()))},_clear:function(){this.$inputBox.val(""),this.prevSearchTerm="",this.$inputBox.focus(),this.bubbleEvent("td-search-clear"),this.$clearButton.hide(),this.$searchButton.show()},showActivity:function(){this.$searchButton.hide(),this.$clearButton.hide(),this.$spinner.show()},hideActivity:function(){var a=this.$inputBox.val()!=="";this.$clearButton.toggle(a),this.$searchButton.toggle(!a),this.$spinner.hide()},destroy:function(){$(document).off("uiSearchBlur",this.boundCancelSearch),this.$inputBox.unbind(),this.$node.remove()}}),TD.components.MenuItemBase=TD.components.Base.extend(function(){this.eventSubscriptions=[],this.selected=!1,this.eventSubscriptions.push($.subscribe(TD.components.MenuItemBase.GLOBAL_SELECT_EVENT,_.bind(this._handleSelectionEvent,this))),_.defer(_.bind(this._addClickHandler,this))}).statics({GLOBAL_SELECT_EVENT:"/menuitem/select",BUBBLE_SELECT_EVENT:"td-menuitem-select",deselectAll:function(){var a={target:null};TD.storage.notification.notify(this.GLOBAL_SELECT_EVENT,a)}}).methods({_handleSelectionEvent:function(a){this.selected=a.target===this,this.$node.toggleClass("selected",this.selected)},_addClickHandler:function(){var a=this;this.$node.bind("click",function(b){a.selected||a.select()})},select:function(){this.publishEvent(TD.components.MenuItemBase.GLOBAL_SELECT_EVENT,null),this.bubbleEvent(TD.components.MenuItemBase.BUBBLE_SELECT_EVENT)},deselect:function(){this.selected=!1,this.$node.removeClass("selected")},destroy:function(){_.each(this.eventSubscriptions,function(a){$.unsubscribe(a)}),this.$node.remove()}}),TD.components.MenuItem=TD.components.MenuItemBase.extend(function(){this.type=null}).statics({BASIC:"basic",SUBTITLE:"subtitle",PERSON:"person",LIST:"list"}).methods({basic:function(a){return this.type=TD.components.MenuItem.BASIC,this.title=a,this.$node=$(TD.ui.template.render("list_module_list_item",{title:this.title})),this},subtitle:function(a,b){this.type=TD.components.MenuItem.SUBTITLE,this.title=a,this.subtitle=b;var c={title:a,subtitle:b};return this.$node=$(TD.ui.template.render("list_module_subtitle_item",c)),this},selfAccount:function(a){this.type=TD.components.MenuItem.PERSON,this.account=a;var b=a.getType(),c={isTwitter:b==="twitter",fullname:a.getName()||a.getUsername(),username:a.getUsername(),profileImageURL:a.getProfileImageURL()};return this.$node=$(TD.ui.template.render("list_module_account_item",c)),this},twitterUser:function(a){this.type=TD.components.MenuItem.PERSON,this.twitterUser=a;var b={isTwitter:!0,fullname:a.name||a.screenName,username:a.screenName,profileImageURL:a.profileImageURL};return this.$node=$(TD.ui.template.render("list_module_account_item",b)),this},list:function(a){this.type=TD.components.MenuItem.LIST,this.list=a;var b={title:a.name,by:TD.i("by {{1}}",{1:a.user.name}),description:a.description,subtitle:TD.i("{{1}} members",{1:a.memberCount}),miniProfileURL:a.user.miniProfileImageURL(),isPrivate:a.isPrivate};return this.$node=$(TD.ui.template.render("list_module_twitter_list_item",b)),this}}),TD.components.SelfAccounts=TD.components.Base.extend(function(a){var b=TD.storage.accountController.getPostingAccounts();this.titleText=TD.i("Your Accounts"),this.service=a,this.items=[],this.$node=$(TD.ui.template.render("open_column_list_with_header",{title:this.titleText})),this.$list=this.$find(".js-list-container");for(var c=0;c<b.length;c++){var d=b[c],e=d.getType();if(this.service&&e!==this.service)continue;var f=(new TD.components.MenuItem).selfAccount(b[c]);this.items.push(f),this.$list.append(f.$node)}}).methods({selectDefault:function(){var a,b=TD.storage.accountController.getDefault(),c=b.getKey();for(var d=0;d<this.items.length;d++){a=this.items[d];if(c===a.account.getKey()){a.select();break}}},destroy:function(){_.each(this.items,function(a){a.destroy()}),this.$node.remove()}}),TD.components.ProfileAccount=TD.components.Base.extend(function(){this.titleText=TD.i("Profile Account"),this.screenName=null,this.twitterUser=null,this.$node=$(TD.ui.template.render("open_column_list_with_header",{title:this.titleText})),this.$list=this.$find(".js-list-container"),this.menuItem=null}).methods({setUser:function(a){this.screenName=a;var b=TD.cache.twitterUsers.getByScreenName(this.screenName);b.addCallbackWith(this,this._renderUser)},_renderUser:function(a){this.twitterUser=a,this.menuItem=(new TD.components.MenuItem).twitterUser(a),this.$list.append(this.menuItem.$node)},select:function(){this.menuItem.select()},destroy:function(){this.menuItem&&this.menuItem.destroy(),this.$node.remove()}}),TD.components.Trends=TD.components.Base.extend(function(){var a=this;this.woeid=1,this.locationName=TD.i("Worldwide"),this.$node=$(TD.ui.template.render("list_module_trends",{locationName:this.locationName})),this.$trendList=this.$find(".js-trend-list"),this.trendComponents=[],this.trendLocations=null,this.$changeLocation=this.$find("#change-trends"),this.$changeLocation.bind("click",function(b){a._showTrendLocations()}),this.account=TD.storage.accountController.getPreferredAccount("twitter"),this.client=TD.controller.clients.getClient(this.account.getKey()),a._showTrendsForLocation(this.woeid)}).statics({CLICK_URL_BASE:"/open/search/tweets/"}).methods({_showTrendLocations:function(){var a=this;$.isEmptyObject(a.trendLocations)?this.account&&this.client.getTrendLocations(_.bind(this._displayLocations,this)):this._displayLocations(a.trendLocations.locations)},_showTrendsForLocation:function(a){this.client.getTrends(a,_.bind(this._displayTrends,this))},_displayTrends:function(a){var a=a.trends,b=a.locations,c="",d;for(var e=0;e<a.length;e++){if(a[e].promotedContent)continue;d=(new TD.components.MenuItem).basic(a[e].name),this.trendComponents.push(d),this.$trendList.append(d.$node)}},_displayLocations:function(a){},destroy:function(){_.each(this.trendComponents,function(a){a.destroy()}),this.$trendList.unbind(),this.$changeLocation.unbind(),this.$node.remove()}}),TD.components.TwitterUserSearch=TD.components.Base.extend(function(a,b,c){a||(a=TD.storage.accountController.getPreferredAccount("twitter"));if(!a)return;this.listItemComponent=c,this.client=TD.controller.clients.getClient(a.getKey()),this.maxResults=b||TD.components.TwitterUserSearch.MAX_RESULTS,this.searchInput=new TD.components.SearchInput(TD.i("Enter a @name or full name")),this.items=[],this.resultsTitle=TD.i("Search results"),this.$searchResults=$(TD.ui.template.render("open_column_list_with_header",{title:this.resultsTitle})),this.$searchResults.hide(),this.$node=$(this.searchInput.$node),this.$node.append(this.$searchResults),this.$node.bind("td-search",_.bind(this._handleSearchSubmit,this)),this.$node.bind("td-search-clear",_.bind(this._handleSearchClear,this)),this.$searchResultsList=this.$find(".js-list-container")}).statics({SEARCH_COMPLETE:"td-search-complete",MAX_RESULTS:4}).methods({_handleSearchSubmit:function(a,b){this.searchInput.showActivity();var c=b.data;this._search(c),a.stopPropagation()},_search:function(a){a&&this.client.userSearch(a,_.bind(this._handleUsers,this))},_handleSearchClear:function(a){_.each(this.items,function(a){a.destroy()}),this.$searchResults.hide()},_handleUsers:function(a){this.searchInput.hideActivity();var b,c,d;a=_.first(a,this.maxResults),this.items=[],this.$searchResultsList.empty();for(b=0,c=a.length;b<c;b++)this.listItemComponent?d=new this.listItemComponent(a[b]):d=(new TD.components.MenuItem).twitterUser(a[b]),this.items.push(d),this.$searchResultsList.append(d.$node);this.$searchResults.show(),this.bubbleEvent(TD.components.TwitterUserSearch.SEARCH_COMPLETE)},detachResultsContainer:function(){return this.$searchResults.detach()},destroy:function(){_.each(this.items,function(a){a.destroy()}),this.supr()}}),TD.components.SuggestedUsers=TD.components.TwitterUserSearch.extend(function(a,b,c,d){this.searchTerm=d,this._ready=!1,this._userData=null,this.resultsTitle=TD.i("Suggested"),$(".js-title",this.$searchResults).text(this.resultsTitle),this.$node=this.$searchResults,this.searchInput.$node.detach(),this._search(d)}).methods({_handleUsers:function(a){this._ready?a&&a.length>0&&(this.supr(a),this._userData=null):this._userData=a},render:function(){this._ready||(this._ready=!0,this._handleUsers(this._userData))}}),TD.components.TemporaryColumn=TD.components.Base.extend(function(){this.type=undefined,this.service=undefined,this.accountKey=undefined,this.metaString=undefined,this.column=null,this.$actionButton=null}).methods({_init:function(a,b,c,d,e){this.type=a,this.service=b,this.accountKey=c,this.metaString=d,this.column=TD.controller.columnManager.makeColumnFor(a,b,c,d,e),this.column.visible=!0,this.column.temporary=!0,TD.controller.columnManager.add(this.column);var f=this.column.model,g={columnkey:f.getKey(),columntitle:this.column.getTitleHTML(),columnclass:this.column.getIconClass(),isTemporary:!0};this.$node=$(TD.ui.template.render("column",g)),this.$actionButton=this.$find(".js-action-header-button")},populate:function(){TD.ui.columns.setupColumn(this.column),TD.controller.feedScheduler.addColumn(this.column,!1)},makePermanent:function(){var a=TD.controller.columnManager.makeColumnFor(this.type,this.service,this.accountKey,this.metaString,this.column.getSearchFilter());a.setFeeds(this.column.getFeeds()),TD.controller.columnManager.addColumnToUI(a)},home:function(){this._init("home","tweetdeck")},me:function(){this._init("me","tweetdeck")},inbox:function(){this._init("privateMe","tweetdeck")},scheduled:function(){this._init("scheduled","tweetdeck")},genericTwitter:function(a,b,c){var d,e="twitter",f=b.getKey(),g=c?c.id:undefined,h;c?(d=TD.controller.columnManager.NON_SELF_FEED_TYPE[a]||a,a===TD.controller.columnManager.MENTIONS&&(g="@"+c.screenName),TD.cache.names.addScreenName(c.id,c.screenName)):(a===TD.controller.columnManager.MENTIONS&&(h=new TD.vo.SearchFilter,h.action.fromJSONObject({showMentions:!0})),a===TD.controller.columnManager.FOLLOWERS&&(h=new TD.vo.SearchFilter,h.action.fromJSONObject({showFollowers:!0})),d=TD.controller.columnManager.SELF_FEED_TYPE[a]||a),this._init(d,e,f,g,h)},search:function(a,b){if(!b){var c=TD.storage.accountController.getPreferredAccount("twitter");b=c.getKey()}this._init("search","twitter",b,a)},list:function(a){var b=this,c=a.user.account.getKey(),d=a.user.id+"/"+a.id;TD.cache.names.addScreenName(a.user.id,a.user.screenName),TD.cache.names.addListName(a.id,a.name),this._init("list","twitter",c,d),a.isOwnList()&&(this.$actionButton.text(TD.i("Edit")),this.$actionButton.removeClass("is-hidden"),this.$actionButton.click(function(){b.bubbleEvent(TD.components.BaseModal.CLOSE_EVENT);var c=new TD.components.ListMembers(a)}))},destroy:function(){this.column&&this.column.temporary&&TD.controller.columnManager.removeFromAppLayer(this.column.model.getKey()),this.$node.remove()}}),TD.components.ScheduledDatePicker=TD.components.Base.extend(function(a){var b=this;this.$node=$(TD.ui.template.render("compose/schedule")),a.append(this.$node),this.$minutes=$("#scheduled-minute"),this.$hours=$("#scheduled-hour"),this.$datepicker=$("#datepicker"),this.$nextMonth=$("#next-month"),this.$prevMonth=$("#prev-month"),this.$removeDate=$(".js-remove",this.$node),this.$amToggle=$("#amPm"),this.$hours.bind("change",function(){b._refreshDate(),b.publishDateChanged()}),this.$minutes.bind("change",function(){b._refreshDate(),b.publishDateChanged()}),this.$datepicker=this.$datepicker.dateinput({onHide:function(){return!1},change:function(){b._refreshDate(),b.publishDateChanged()},min:-1}),b.datePickerData=this.$datepicker.data("dateinput").show(),this.$nextMonth.bind("click",function(a){b.datePickerData.addMonth(1)}),this.$prevMonth.bind("click",function(a){b.datePickerData.addMonth(-1)}),this.$removeDate.bind("click",function(a){b.publishRemoval()}),this.$amToggle.bind("click",function(a){var c=$(this),d=c.data("value");b._setAmPm(!d)}),b.setDate(new Date)}).methods({_refreshDate:function(){var a=this.datePickerData.getValue(),b=this.$amToggle.data("value"),c=Number(this.$hours.val())%12;b?a.setHours(c+12):a.setHours(c),a.setMinutes(Number(this.$minutes.val())),this.date=a},_setAmPm:function(a){a?(this.$amToggle.text(TD.i("PM")),this.$amToggle.data("value",!0)):(this.$amToggle.text(TD.i("AM")),this.$amToggle.data("value",!1)),this._refreshDate(),this.publishDateChanged()},setDate:function(a){if(a){var b=a.getHours()%12||12,c=a.getHours()>11,d=c?TD.i("PM"):TD.i("AM"),e=a.getMinutes();this._setAmPm(c),this.datePickerData.setValue(a.getFullYear(),a.getMonth(),a.getDate()),this.$hours.val(b),this.$minutes.val(e)}this.date=a,this.publishDateChanged()},getDate:function(){return this.date},publishDateChanged:function(a){$.publish("/change/date",[a!==undefined?a:this.getDate()])},publishRemoval:function(){this.date=null,this.publishDateChanged(null),$.publish("/removed/date")}}),TD.components.LocationPicker=TD.components.Base.extend(function(a){var b=this,c;this.$node=$(TD.ui.template.render("compose/locations")),a.append(this.$node),this.$locationButton=a.find("button"),this.$locationList=this.$find(".js-location-list"),this.$locationSearchHolder=this.$find(".js-location-search"),this.$locationSearchBox=this.$find("#location-search").keyup(function(a){switch(a.keyCode){case TD.constants.keyCodes.enter:b.getPlaces(b.position,b.$locationSearchBox.val());break;case TD.constants.keyCodes.escape:b.hide()}}),this.$node.on("click",".js-location-item",function(a){b.setLocation(a.currentTarget)}),this.$removeLocation=this.$find(".js-location-remove").click(function(a){b.removeLocation()}),c=TD.controller.clients.getClientsByService("twitter");if(!c.length){this.removeLocation();return}this.client=c[0],TD.util.getCurrentLocation(6e3,_.bind(this.getPlaces,this))}).statics({SELECT:"td-select",canHazGeolocation:function(){return!1}}).methods({getPlaces:function(a,b){var c=a?a.coords:{};this.position=a,b=b||"",this.client.geoSearch(b,c.latitude,c.longitude,c.accuracy,null,_.bind(this.showTwitterPlaces,this),_.bind(this.removeLocation,this))},showTwitterPlaces:function(a){if(a&&a.length>0){this.places=a;var b=$(TD.ui.template.render("compose/location_list_item",this));this.$locationList.find(".js-location-item").remove(),b.insertAfter(this.$locationSearchHolder)}},setTwitterPlace:function(a,b){this.twitterPlaceID=a,this.twitterPlaceName=b},setLocation:function(a,b){var c=$(a).data("place-id"),d,e;for(d=0;d<this.places.length;d++){e=this.places[d];if(e.id==c){this.setTwitterPlace(e.id,e.full_name),this.$locationButton.addClass("set-content"),$("b",this.$locationButton).text(e.name),this.$node.trigger(TD.components.LocationPicker.SELECT),this.hide();break}}},hide:function(){this.$node.hide()},removeLocation:function(){this.setTwitterPlace(null,null),this.$locationButton.removeClass("set-content"),this.$node.trigger(TD.components.LocationPicker.SELECT),this.hide(),TD.storage.store.set(":CACHED_PLACES",null)}}),TD.components.DetailView=TD.components.Base.extend(function(a,b){this.initialised=!1,this.column=a,this.$column=b,this.$detailContainer=$(".js-column-detail",this.$column),this.$columnsContainer=$("#container"),this.$column.on("click",".js-column-back",this._handleHeaderClick.bind(this)),this._render(),this.$detailContainer.html(this.$node),this.column.temporary||this.$node.trigger("uiCloseModal"),this.$holder=$(".js-detail-container",this.$column),this.$header=$(".js-column-header",this.$column),TD.ui.columns.refreshTitle(this.column)}).statics({RETWEETER_COUNT:8}).methods({_render:function(){throw"DetailView._render not implemented"},_handleHeaderClick:function(a){this.destroy()},changed:function(a){},deleted:function(a){a.id===this.chirp.id&&this.destroy()},destroy:function(a){var b=this.supr.bind(this);this.$column.off("click",".js-column-back"),this.$column.trigger("uiDetailViewClosed",{column:this.column}),TD.ui.main.TRANSITION_END_EVENTS?this.$column.one(TD.ui.main.TRANSITION_END_EVENTS,function(){a&&a(),b()}):(a&&a(),this.supr())}}),TD.components.TweetDetailView=TD.components.DetailView.extend(function(a,b){}).statics({CARD_CONTAINER:".js-cards-container",MEDIA_CONTAINER:".js-tweet-media",TWEET_STAT:".js-tweet-stat"}).methods({_render:function(){this.$node=$(TD.ui.template.render("status/tweet_detail_wrapper",{headerClass:"js-detail-header",headerAction:"resetToTopColumn",headerLinkClass:"js-column-back"}))},showChirp:function(a,b){this.parentChirp=b,this._showChirp(a);if(!a.cards&&a.entities&&a.entities.urls&&a.entities.urls.length){var c=TD.controller.clients.getClient(a.account.getKey());c.show(a.id,_.bind(this._showCardsForChirp,this),_.bind(this._chirpRetrievalError,this))}else this._showCardsForChirp(a)},_showCardsForChirp:function(a){var b=TD.settings.getDisplaySensitiveMedia();if(a.cards){a.cards.isPossiblySensitive=a.possiblySensitive&&!b;var c=TD.ui.template.render("cards/card_layouts",a.cards);this.$find(TD.components.TweetDetailView.CARD_CONTAINER).html(c)}this.showMedia(a)},showMedia:function(a){if(!a.getMedia())return;var b=TD.settings.getDisplaySensitiveMedia(),c=a.possiblySensitive&&!b;a.getMedia().forEach(function(a){a.isPossiblySensitive=c});var d=TD.ui.template.render("status/tweet_detail_media",a);this.$find(TD.components.TweetDetailView.MEDIA_CONTAINER).html(d)},_chirpRetrievalError:function(){},_showChirp:function(a){this.chirp=a,this.$tweetDetail=$(TD.ui.template.render("status/tweet_detail",this.chirp.getMainTweet())),this.$find(".js-tweet-detail").html(this.$tweetDetail);var b=this.$find(".spn-loading"),c=this.$header,d=this.$tweetDetail.find(".js-translate-call-to-action"),e=this.column.getMediaPreviewSize();e!==TD.vo.Column.MEDIA_PREVIEW_OFF&&(e=TD.vo.Column.MEDIA_PREVIEW_SIZE_SMALL),this.replies=new TD.components.InReplyTo(this.chirp,this.$detailContainer,e),this.retweeters=new TD.components.Retweeters(this.chirp,TD.components.DetailView.RETWEETER_COUNT),this.repliesTo=new TD.components.RepliesTo(this.chirp,e),this.$find(".js-inreplyto").replaceWith(this.replies.$node),this.$find(".js-tweet-stats").append(this.retweeters.$node),this.$find(".js-tweet-replies").append(this.repliesTo.$node),this._boundShowSocialProof=this.showSocialProof.bind(this),this.$column.on("click",TD.components.TweetDetailView.TWEET_STAT,this._boundShowSocialProof),this.replies.$node.bind(TD.components.InReplyTo.BEGIN,function(){b.show()}),this.replies.$node.bind(TD.components.InReplyTo.END,function(){c.addClass("gradient-top"),b.hide()}),d.on("click",function(){this.chirp.translate()}.bind(this)),this.initialised=!0,this.$tweetDetail.trigger("uiDetailViewActive",{$chirp:this.$tweetDetail,chirp:this.chirp,parentChirp:this.parentChirp})},showSocialProof:function(a){var b=$(a.srcElement).closest(TD.components.TweetDetailView.TWEET_STAT).data("type");this.$column.trigger("uiShowSocialProof",{type:b,tweetSummary:this.retweeters.tweetSummary,$chirp:this.$tweetDetail,chirp:this.chirp,parentChirp:this.parentChirp})},destroy:function(){this.$column.off("click",this._boundShowSocialProof);var a=function(){this.initialised&&(this.replies.destroy(),this.retweeters.destroy(),this.repliesTo.destroy())}.bind(this);this.supr(a)},findChirp:function(a){return this.initialised?this.replies.findChirp(a)||this.repliesTo.findChirp(a):undefined},getMostInteresting$Chirp:function(){return this.$tweetDetail}}),TD.components.MessageDetailView=TD.components.DetailView.extend(function(a,b){}).methods({_render:function(){this.$node=$(TD.ui.template.render("status/message_wrapper",{headerClass:"js-detail-header",headerAction:"resetToTopColumn",headerLinkClass:"js-column-back"}))},showChirp:function(a,b){var c;this.chirp=a,this.parentChirp=b,this.replyBar=new TD.components.ReplyBar(this.chirp),c=this.chirp.renderThread(),this.$find(".js-message-box").replaceWith(this.replyBar.$node),this.$find(".js-message-detail").html(c),this.initialised=!0,this.chirp.markAsRead(),this.$node.trigger("uiDetailViewActive",{$chirp:this.getMostInteresting$Chirp(),chirp:this.chirp,parentChirp:this.parentChirp})},changed:function(a){if(this.initialised&&a.id===this.chirp.id){var b=a.renderThread();this.$find(".js-message-detail").html(b)}},findChirp:function(a){return this.initialised?this.chirp.messageIndex[a]:undefined},getMostInteresting$Chirp:function(){return this.$find(".js-message-detail .js-stream-item").first()},destroy:function(){var a=function(){this.initialised&&(this.replyBar.destroy(),this.chirp.markAsRead())}.bind(this);this.supr(a)}}),TD.components.ReplyBar=TD.components.Base.extend(function(a){if(!a||!a.postComment)return;var b=TD.ui.template.render("text/strong",{text:a.account.getUsername()}),c={from:TD.i("From {{{1}}}",{1:b})};this._boundHandleGlobalKeydown=this._handleGlobalKeydown.bind(this),this._boundSend=this.send.bind(this),this.$node=$(TD.ui.template.render("status/tweet_detail_replybar",c)),this.chirp=a,this.$inputBox=this.$find(".js-reply-tweetbox"),this.$charCount=this.$find(".js-reply-charcount"),this.$sendButton=this.$find(".js-send");switch(a.account.getType()){case"twitter":this.charLimit=140}this.$sendButton.bind("click",this._boundSend),this._reset()}).statics({ACTIVITY_EVENTS:"click change focus blur input keydown keypress keyup mousedown mouseup paste",RESET_EVENT:"td-reset",REPLYING_EVENT:"td-replying",OVER_CHAR_COUNT_CLASS:"over-char-count"}).methods({_updateCharCount:function(){var a=TD.ui.compose.getTextLength(this.$inputBox.val()),b=this.charLimit-a;b<0||b===this.charLimit?this.$sendButton.attr("disabled",!0):this.$sendButton.attr("disabled",!1),b<0?this.$charCount.addClass(TD.components.ReplyBar.OVER_CHAR_COUNT_CLASS):this.$charCount.removeClass(TD.components.ReplyBar.OVER_CHAR_COUNT_CLASS),this.$charCount.val(b)},_reset:function(){var a="";if(this.chirp instanceof TD.services.TwitterStatus){var b=this.chirp.getMainTweet();a=TD.i("Reply to @{{1}}",{1:b.user.screenName})}else this.chirp instanceof TD.services.TwitterMessageThread&&(a=TD.i("Message @{{1}}",{1:this.chirp.correspondent.screenName}));this.$node.removeClass("s-replying"),this.$inputBox.val(a),this.$inputBox.blur().attr("disabled",!1),this.$sendButton.attr("disabled",!1),this.$inputBox.bind(TD.components.ReplyBar.ACTIVITY_EVENTS,_.bind(this._handleActivity,this)),this.bubbleEvent(TD.components.ReplyBar.RESET_EVENT,null),$(window).unbind("keydown",this._boundHandleGlobalKeydown)},_handleActivity:function(a){var b=this;this.$inputBox.unbind(),b.bubbleEvent(TD.components.ReplyBar.REPLYING_EVENT,null),this.$node.addClass("s-replying");var c="",d=[];this.chirp instanceof TD.services.TwitterStatus&&(d=TD.util.getReplyUsers(this.chirp)),d.length>0&&(c=d.join(" ")+" "),this.$inputBox.val(c),this._updateCharCount();var e=c.length,f=c.length;d.length>0&&(e=d[0].length+1),this.$inputBox.bind("keydown change",_.bind(this._handleKeydown,this)),_.defer(function(){b.$inputBox[0].setSelectionRange(e,f)}),this.$inputBox.bind("cut paste",_.bind(this._handleCutPaste,this)),this.$inputBox.bind("keyup",_.bind(this._updateCharCount,this))},_handleCutPaste:function(a){_.defer(_.bind(this._updateCharCount,this))},_handleGlobalKeydown:function(a){a.which===TD.constants.keyCodes.escape&&this._reset()},_handleKeydown:function(a){this._updateCharCount();switch(a.charCode||a.keyCode){case 10:case 13:if(a.ctrlKey||a.metaKey)a.preventDefault(),this.send();break;case TD.constants.keyCodes.escape:this.$inputBox.blur(),$(window).bind("keydown",this._boundHandleGlobalKeydown)}},send:function(){var a=this.$inputBox.val(),b=this;if(!a)return;this.$sendButton.attr("disabled",!0),this.$inputBox.attr("disabled",!0),this.$inputBox.blur(),this.chirp.postComment(a,function(){b._reset()},function(){b.$sendButton.attr("disabled",!1),b.$inputBox.attr("disabled",!1),b.$inputBox.focus()})}}),TD.components.MediaGallery=TD.components.BaseModal.extend(function(a,b,c){var d=this,e=$(window);this.tweet=a,this.column=c,this.clickedLink=b,this.originalLinkHeight=20,this.$node=$(TD.ui.template.render("media/media_gallery")),this.$closeButton=this.$find(".js-dismiss"),this.$prevButton=this.$find("#media-gallery-prev"),this.$nextButton=this.$find("#media-gallery-next"),this.$embed=this.$find(".js-mediaembed"),this.$tweet=this.$find(".med-tweet"),this.$mainframe=this.$find(".js-embeditem"),this._sizeMedia=this._sizeMedia.bind(this),this.sizeMediaInterval=setInterval(this._sizeMedia,300),this.$closeButton.bind("click",function(){d.destroy()}),this.$prevButton.bind("click",function(){d._prev()}),this.$nextButton.bind("click",function(){d._next()}),this._loadTweet(),this.showInModal(),a.hasMedia()||a.cards?(this.media=a.getMedia().concat(a.getCardsForGallery()),this._setupEmbeds()):(TD.util.openURL(b),this.destroy())}).statics({MEDIA_FLAG_NSFW:".js-media-flag-nsfw",MEDIA_FLAGGED_NSFW:".js-media-flagged-nsfw",HIDDEN_CLASS:"is-hidden"}).methods({showInModal:function(){var a=$("#open-modal");a.append(this.$node).show()},_prev:function(){var a=_.indexOf(this.media,this.currentMedia);a===0&&(a=this.embeds.length),this.currentMedia=this.embeds[a-1],this._renderEmbed()},_next:function(){var a=_.indexOf(this.media,this.currentMedia);a==this.media.length-1&&(a=-1),this.currentMedia=this.media[a+1],this._renderEmbed()},_setupEmbeds:function(){if(!this.media||this.media.length===0)return;var a=this;this.currentMedia=this.media[0],this.clickedLink&&_.each(this.media,function(b){b.url===a.clickedLink&&(a.currentMedia=b)}),this._renderEmbed()},_loadTweet:function(){var a=this;this.$tweet.append(this.tweet.renderInMediaGallery()),this.$tweet.bind("click",function(b){$.publish("chirp/click",[b,a.tweet,a.column])})},_sizeMedia:function(){var a=$("img",this.$mainframe),b=this.tweet.translation?this.$tweet.height()+this.originalLinkHeight:this.originalLinkHeight;a.css({"max-width":this.$mainframe.width(),"max-height":this.$mainframe.height()-b+"px"})},_fadeIn:function(){this.$mainframe.addClass("is-loaded"),this.$embed.fadeTo("fast",1)},_renderEmbed:function(){var a=this,b=this.currentMedia,c="";if(b instanceof TD.services.TwitterCard&&b.shouldDisable()){TD.util.openURL(b.url),this.destroy();return}c=b.renderGallery(),this.$embed.html(c),this.$embed.append(TD.ui.template.render("text/gallery_original_link",b)),this.$embed.append(TD.ui.template.render("text/gallery_flag_media",{flagged:b.flaggedNSFW}));var d=$("img",this.$embed);d.length===0?_.delay(function(){a._fadeIn(),a._sizeMedia()},1e3):d.load(function(){d.attr("data-maxwidth",d.width()),d.attr("data-maxheight",d.height()),d.css({"max-width":d.width()+"px",width:"auto"}),a._sizeMedia(),a._fadeIn()}),this.$find(TD.components.MediaGallery.MEDIA_FLAG_NSFW).click(function(c){var d;b.flaggedNSFW=!0,a.$find(TD.components.MediaGallery.MEDIA_FLAG_NSFW).addClass(TD.components.MediaGallery.HIDDEN_CLASS),a.$find(TD.components.MediaGallery.MEDIA_FLAGGED_NSFW).removeClass(TD.components.MediaGallery.HIDDEN_CLASS),d=TD.controller.clients.getClient(a.tweet.account.getKey()),d.flagTweet(a.tweet.id,function(){},function(){var b=TD.i("Problem flagging media. Please try again");TD.controller.progressIndicator.addMessage(b),a.$find(TD.components.MediaGallery.MEDIA_FLAG_NSFW).removeClass(TD.components.MediaGallery.HIDDEN_CLASS),a.$find(TD.components.MediaGallery.MEDIA_FLAGGED_NSFW).addClass(TD.components.MediaGallery.HIDDEN_CLASS)})}),this.media.length>1?(this.$prevButton.removeClass(TD.components.MediaGallery.HIDDEN_CLASS),this.$nextButton.removeClass(TD.components.MediaGallery.HIDDEN_CLASS),this.$mainframe.addClass("s-shorter"),this.$tweet.find(".js-media").show()):(this.$prevButton.addClass(TD.components.MediaGallery.HIDDEN_CLASS),this.$nextButton.addClass(TD.components.MediaGallery.HIDDEN_CLASS),this.$tweet.find(".js-media").hide())},destroy:function(){var a=$(window);$("#open-modal").hide(),clearInterval(this.sizeMediaInterval),this.supr()}}),TD.components.AccountSelector=TD.components.Base.extend(function(a){var b=this;this.$node=$.createElement("ul").addClass("accs cf js-account-selector"),this.cachedSelectedAccounts=[],this.accountIndex={},this.refreshPostingAccounts(),this.$node.delegate(".js-account-item","click",function(a){var c=$(a.currentTarget);a.stopPropagation(),a.shiftKey?($("li",b.$node).removeClass(TD.components.AccountSelector.SELECTED_CLASS),c.addClass(TD.components.AccountSelector.SELECTED_CLASS)):c.toggleClass(TD.components.AccountSelector.SELECTED_CLASS),b.updateSelectedAccounts()}),this.subscription=$.subscribe("/storage/client/account_whitelist_changed",_.bind(this.refreshPostingAccounts,this))}).statics({CHANGE:"td-accounts-change",SELECTED_CLASS:"acc-selected"}).methods({refreshPostingAccounts:function(){var a,b,c=TD.storage.accountController.getPostingAccounts(),d,e=[],f,g,h,i;this.accountIndex={};for(a=0;a<c.length;a++)d=c[a],h=d.getKey(),e.push(h),this.accountIndex[h]={account:h,uid:h,type:"account",username:d.getUsername(),service:d.getType(),picture:d.getProfileImageURL()};var j=function(a,b,c){var d={accounts:[],show_acc_toggle:c};return d.accounts=_.map(a,function(a){return b[a]}),d};e.length&&(i=TD.ui.template.render("compose/accounts",j(e,this.accountIndex,!0)),this.$node.html(i))},getSelectedAccounts:function(){var a,b=[],c;if(this.cachedSelectedAccounts)return this.cachedSelectedAccounts.concat();a=$("."+TD.components.AccountSelector.SELECTED_CLASS,this.$node);for(var d=0;d<a.length;d++)c=a[d].attributes["data-id"].value,b.push(this.accountIndex[c]);return this.cachedSelectedAccounts=b,b},selectAccounts:function(a){var b=this.$node.find(".js-account-item"),c;if(!_.isArray(a))return;b.removeClass(TD.components.AccountSelector.SELECTED_CLASS);if(!a||!a.length)return;for(c=0;c<a.length;c++)a[c]&&b.filter("li[data-id='"+a[c]+"']").addClass(TD.components.AccountSelector.SELECTED_CLASS);this.updateSelectedAccounts()},selectDefaultAccount:function(){var a=TD.storage.accountController.getDefault();a&&this.selectAccounts([a.getKey()])},updateSelectedAccounts:function(){this.cachedSelectedAccounts=null;var a=this.getSelectedAccounts();this.$node.trigger(TD.components.AccountSelector.CHANGE)},destroy:function(){$.unsubscribe(this.subscription),$(".js-account-item",this.$node).die(),this.supr()}}),TD.components.FollowDialog=TD.components.BaseModal.extend(function(a){var b=this;this.$node.removeClass("s-tall-fixed").addClass("s-fluid s-nonav cmp"),this.$find(".js-header-title").html(TD.i("Your relationship to {{>text/user_link_screenname}}",a)),this.$followFromAccountHolder=this.$find(".js-mdl-content"),$("#actions-modal").html(this.$node);var c=TD.storage.accountController.getAccountsForService("twitter");$(".js-dismiss",this.$node).click(_.bind(this.destroy,this)),this.followAccounts=[],_.each(c,function(c){if(c.getUserID()==a.id)return;var d=new TD.components.FollowFrom(a,c);b.followAccounts.push(d),b.$followFromAccountHolder.append(d.$node)}),$("#actions-modal").show()}).methods({destroy:function(a){this.$node.remove(),$("#actions-modal").hide(),a&&a.preventDefault()}}),TD.components.FollowFrom=TD.components.Base.extend(function(a,b,c){var d=this;this.userToFollow=a,this.account=b,this.showAccountMenu=c,this.isSingleAccount=TD.storage.accountController.getAccountsForService("twitter").length===1,this.client=TD.controller.clients.getClient(b.getKey()),this.$node=$(TD.ui.template.render("actions/follow_from",this)),this.$followButton=this.$find(".js-follow-button").click(_.bind(this.handleClick,d)),this.$followButtonHolder=this.$find(".js-action-follow"),this.state="stranger",c&&(this.$profileMenuButton=this.$find(".js-profile-menu").click(_.bind(this._handleProfileMenuButtonClick,this))),b.getUserID()==a.id?(this.state="me",this.updateButtonState()):this.client.showFriendship(b.getUserID(),a.id,null,_.bind(this.handleFollowInfoResponse,this),_.bind(this.handleFollowInfoError,this)),this.subscriptions=[$.subscribe("/user/"+this.userToFollow.screenName+"/block",_.bind(this._handleBlock,this)),$.subscribe("/user/"+this.userToFollow.screenName+"/blocked",_.bind(this._handleBlock,this))]}).methods({_handleProfileMenuButtonClick:function(a){if(!this.profileMenu||!this.profileMenu.$node)this.profileMenu=new TD.components.ProfileMenu(this.$profileMenuButton,this.userToFollow),this.profileMenu.setPosition(TD.components.DropDown.POSITION_LEFT),a.stopPropagation()},_handleBlock:function(a){a.getKey()===this.account.getKey()&&(this.state="blocked",this.updateButtonState())},handleFollowInfoResponse:function(a){var b=this;a.relationship.source.blocking===!0?this.state="blocked":a.relationship.source.following===!0?this.state="following":this.state="stranger",this.updateButtonState()},handleFollowInfoError:function(a){this.following=!1,this.blocking=!1,this.updateButtonState()},handleClick:function(a){var b=this.account;if(this.$followButton.attr("disabled"))return;switch(this.state){case"me":TD.util.openURL("https://twitter.com/settings/profile");break;case"blocked":this.userToFollow.unblock(b,null,_.bind(this.unblockError,this)),this.state="stranger";break;case"pending":case"following":this.userToFollow.unfollow(b,null,_.bind(this.unfollowError,this)),this.state="stranger";break;case"stranger":this.userToFollow.follow(b,_.bind(this.followResponse,this),_.bind(this.followError,this)),this.state="following"}this.updateButtonState()},followError:function(){this.state="stranger",this.updateButtonState()},unfollowError:function(){this.state="following",this.updateButtonState()},unblockError:function(){this.state="blocked",this.updateButtonState()},followResponse:function(a){a.isProtected&&(this.state="pending",this.updateButtonState())},updateButtonState:function(){this.$followButton.attr("disabled",!1),this.$followButtonHolder.removeClass("s-not-following s-following s-pending s-blocking");switch(this.state){case"me":this.$followButtonHolder.addClass("s-thats-you");break;case"blocked":this.$followButtonHolder.addClass("s-blocking");break;case"pending":this.$followButtonHolder.addClass("s-pending");break;case"following":this.$followButtonHolder.addClass("s-following");break;case"stranger":this.$followButtonHolder.addClass("s-not-following")}},destroy:function(){_.each(this.subscriptions,function(a){$.unsubscribe(a)}),this.supr()}}),TD.components.AddToListsDialog=TD.components.BaseModal.extend(function(a){var b=this,c=TD.storage.accountController.getAccountsForService("twitter");this.myLists=[],this.userToAdd=a,_.each(c,function(c){var d=TD.controller.clients.getClient(c.getKey());_.each(TD.cache.lists.getListsFor(c.getKey()),function(a){a.user.id==c.getUserID()&&b.myLists.push(a)}),d.getListMemberships(a.screenName,!0,function(a){_.each(a,function(a){b.$find("#"+a.id).attr("checked","checked")})})}),this.$node.removeClass("s-tall-fixed").addClass("s-fluid cmp"),this.$find(".js-header-title").text(TD.i("Your lists")).after(" "+TD.i("Include {{>text/user_link_screenname}} in:",a)),this.$find(".js-mdl-content").html(TD.ui.template.render("actions/add_to_list_dialog",this)).addClass("with-scroll scroll-v scroll-alt").toggleClass("scroll-styled-v",TD.globalRenderOptions.styledScrollbar),this.$listCheckboxes=this.$find(".js-mdl-content input").click(_.bind(this._changeSubscription,this)),this.$find(".mdl-buttonbar").html(TD.ui.template.render("actions/add_to_list_footer")),this.$createListButton=this.$find(".js-create-list"),$(".js-dismiss",this.$node).click(_.bind(this.destroy,this)),this.$createListButton.click(_.bind(this._createList,this)),$("#actions-modal").html(this.$node).show()}).methods({_changeSubscription:function(a){var b=$(a.target),c=b.attr("id"),d=b.attr("checked")==="checked",e=b.attr("data-account"),f=TD.controller.clients.getClient(e),g=TD.storage.Feed.generateKeyFor(e,"list",{listId:c}),h=TD.controller.feedManager.getPoller(g),i=this;d?f.addUserToList(c,this.userToAdd.screenName,function(){h&&_.delay(function(){h.refresh(!0,!0)},1e3)}):f.removeUserFromList(c,this.userToAdd.screenName,function(){h&&h.removeWhere(function(a){return i.userToAdd.id==a.user.id})})},_createList:function(a){this.destroy();var b=new TD.components.ListDetails;b.autoAddMember(this.userToAdd)},destroy:function(a){this.$node.remove(),$("#actions-modal").hide(),a&&a.preventDefault()}}),TD.components.ActionDialog=TD.components.BaseModal.extend(function(a){var b=this;this.tweet=a,this.$node.removeClass("js-modal-panel s-tall-fixed").addClass("cmp s-fluid s-inreply l-no-txtarea"),this.$find(".mdl-inner").replaceWith($(TD.ui.template.render("actions/action_dialog"))),this.$inreplyToHolder=this.$find(".js-inreply"),this.header=new TD.components.ActionHeader,this.header.$node.bind(TD.components.ActionHeader.CLOSE,function(a){b.destroy()}),this.$find(".mdl-header").prepend(this.header.$node),this.$buttons=this.$find(".js-action-button"),this.$buttons.click(this._handleClick.bind(this)),this._boundRetweet=this._retweet.bind(this),$(document).on("uiSendRetweetAction",this._boundRetweet),this.displayTweet(a),this.header.accountSelector.selectAccounts([a.account.getKey()]),$("#actions-modal").html(this.$node).show()}).methods({displayTweet:function(a){var b=a;b&&(b.withAvatar=!0,this.$inreplyToHolder.html(TD.ui.template.render("status/tweet_single",b)).show())},_quote:function(){var a=this.header.accountSelector.getSelectedAccounts();TD.ui.compose.showComposeWindow(this.tweet.getMainTweet().getQuoteText()),TD.ui.compose.selectAccounts(_.map(a,function(a){return a.account}))},_retweetFromAccount:function(a){var b=TD.controller.clients.getClient(a.account),c=b.create();this.$buttons.attr("disabled","disabled"),c.Retweet(this.tweet.id),c.post(this._handleRetweeted.bind(this),this._handleRetweetFailure.bind(this))},_retweet:function(){var a=this.header.accountSelector.getSelectedAccounts();a.forEach(this._retweetFromAccount,this)},_handleClick:function(a){var b=$(a.target),c=b.data("action");switch(c){case"quote":this._quote(),this.destroy();break;case"retweet":this._retweet()}},_handleRetweeted:function(a){this.tweet.setRetweeted(!0),this.destroy()},_handleRetweetFailure:function(a){var b=TD.i("Failed: Retweet");a.errors&&a.errors.forEach(function(a){b+=" - "+a.message}),TD.controller.progressIndicator.addMessage(b),this.$buttons.removeAttr("disabled")},destroy:function(){$(document).off("uiSendRetweetAction",this._boundRetweet),$("#actions-modal").hide(),this.supr()}}),TD.components.ActionHeader=TD.components.Base.extend(function(){var a=this;this.accountsVisible=!1,this.$node=$.createElement("div"),this.$node.append($(TD.ui.template.render("actions/action_header"))),this.accountSelector=new TD.components.AccountSelector,this.$node.append(this.accountSelector.$node),this.$composeUsernames=this.$find("h3"),this.$actionText=this.$find("span"),this.$showAccountsToggle=this.$find(".js-accounts-toggle"),this.$showAccountsToggle.click(_.bind(this.toggleAccountsVisibility,this)),this.accountSelector.$node.bind(TD.components.AccountSelector.CHANGE,function(){var b=_.map(a.accountSelector.getSelectedAccounts(),function(a){return a.username}),c=TD.i("From {{accounts}}",{accounts:b.join(", ")});a.$composeUsernames.text(c)}),this.accountSelector.selectDefaultAccount(),this.toggleAccountsVisibility()}).statics({CHANGE:"td-accounts-change",CLOSE:"td-dialog-close"}).methods({toggleAccountsVisibility:function(){this.accountsVisible?(this.$actionText.text(TD.i("Change")),this.accountSelector.hide()):(this.$actionText.text(TD.i("Hide")),this.accountSelector.show()),this.accountsVisible=!this.accountsVisible}}),TD.components.GlobalSettings=TD.components.BaseModal.extend(function(){var a=TD.storage.accountController.isEmpty()?"accounts":"general",b={tabs:[{title:TD.i("General"),action:"general"},{title:TD.i("Accounts"),action:"accounts"},{title:TD.i("Services"),action:"services"},{title:TD.i("Mute"),action:"filter"}]};this.$find(".js-header-title").text(TD.i("Settings")),this.$node.removeClass("s-tall-fixed").addClass("s-short s-nonav"),this.$find(".js-mdl-content").html(TD.ui.template.render("settings/global_settings_modal",b)),this.$optionList=this.$find(".js-setting-list li"),$("#settings-modal").append(this.$node),$(".js-dismiss",this.$node).click(_.bind(this.destroy,this)),$("a.list-link",this.$node).click(function(a){var b=$(a.currentTarget),c=b.data("action");this.switchTab(c)}.bind(this)),this.switchTab(a),$("#settings-modal").show()}).methods({switchTab:function(a){if(a===this.currentTabName)return;this.$optionList.removeClass("selected"),this.currentTab&&this.currentTab.destroy();switch(a){case"general":this.currentTab=new TD.components.GeneralSettings;break;case"accounts":this.currentTab=new TD.components.AccountSettings;break;case"services":this.currentTab=new TD.components.ServicesSettings;break;case"filter":this.currentTab=new TD.components.FilterSettings}this.currentTabName=a,this.$optionList.find("[data-action="+a+"]").parent("li").addClass("selected")},destroy:function(a){this.currentTab&&this.currentTab.destroy(),$("#settings-modal").hide(),a&&a.preventDefault(),this.supr()}}),TD.components.AccountSettings=TD.components.Base.extend(function(){this.$node=$(TD.ui.template.render("settings/global_setting_account")),$("#global-settings").append(this.$node),this.$accountHolder=$(".js-account-container"),this.$resetPasswordButton=$(".js-reset-password"),this.$resetPasswordButton.click(this.handleResetPassword.bind(this)),this.$resetPasswordErrorMessage=this.$find(".js-reset-error"),this.$resetPasswordSuccessMessage=this.$find(".js-reset-success"),this.$resetProgressSpinner=this.$find(".js-reset-progress"),this.boundRefreshAccounts=this.refreshAccounts.bind(this),this.subscriptions=[$.subscribe("/storage/account/new",this.boundRefreshAccounts),$.subscribe("/storage/account/blacklisted",this.boundRefreshAccounts),$.subscribe("/storage/client/default_account_changed",this.setDefaultAccount.bind(this))],this.refreshAccounts(),$(".js-add-account").on("click",this.handleAddAccount.bind(this)),this.$node.on("click",".js-remove-account",this.handleRemoveAccount.bind(this)),this.$node.on("click",".js-set-default",this.handleSetDefaultClick.bind(this))}).methods({handleRemoveAccount:function(a){var b=$(a.target),c=b.data("account"),d=_.uniqueId(),e={id:d,title:TD.i("Removing account!"),message:TD.i("Are you sure you want to remove account '{{1}}' from TweetDeck?",{1:TD.storage.accountController.get(c).getUsername()}),okLabel:TD.i("Remove"),cancelLabel:TD.i("Cancel")},f=function(a,b){if(b.id!==d)return;$(document).off("uiConfirmationAction",f),b.result&&TD.controller.clients.removeClient(c)};$(document).on("uiConfirmationAction",f).trigger("uiShowConfirmationDialog",e)},handleAddAccount:function(a){var b=$(a.target);TD.controller.clients.addClient(b.data("service"))},handleSetDefaultClick:function(a){var b=$(a.target),c=b.data("account");c&&TD.storage.accountController.setDefault(c)},refreshAccounts:function(){var a=TD.storage.accountController.getAccountsForService("twitter"),b="";b+=TD.ui.template.render("settings/global_setting_account_row",{accounts:a,isTwitter:!0}),this.$accountHolder.html(b),this.setDefaultAccount()},setDefaultAccount:function(){var a=TD.storage.accountController.getDefault();if(!a)return;var b=a.getKey(),c=$(".js-is-default-account"),d=$(".js-set-default");c.addClass("is-hidden"),d.removeClass("is-hidden"),c.filter('[data-account="'+b+'"]').removeClass("is-hidden"),d.filter('[data-account="'+b+'"]').addClass("is-hidden")},destroy:function(a){this.$node.remove(),$(".js-remove-account").off("click"),$(".js-add-account").off("click"),$(".js-set-default").off("click"),_.each(this.subscriptions,function(a){$.unsubscribe(a)})},handleResetPassword:function(a){var b,c;this.$resetPasswordButton.prop("disabled",!0),this.$resetPasswordErrorMessage.addClass("is-hidden"),this.$resetProgressSpinner.removeClass("is-hidden"),c=TD.storage.store.getTweetdeckAccount(),b=TD.controller.clients.getTDClient().forgotPassword(c),b.addCallbackWith(this,function(a){this.$resetPasswordSuccessMessage.removeClass("is-hidden"),this.$resetPasswordErrorMessage.addClass("is-hidden"),this.$resetProgressSpinner.addClass("is-hidden")}),b.addErrbackWith(this,function(a){this.$resetPasswordErrorMessage.removeClass("is-hidden"),this.$resetProgressSpinner.addClass("is-hidden"),this.$resetPasswordButton.prop("disabled",!1)})}}),TD.components.FilterSettings=TD.components.Base.extend(function(){this.$globalSettings=$("#global-settings"),this.$globalSettings.submit(_.bind(this.handleAddFilter,this)),this.$node=$(TD.ui.template.render("settings/global_setting_filter",{})),this.$globalSettings.append(this.$node),this.$filterHolder=$("#filter-results"),$(".js-remove-filter").live("click",_.bind(this.handleRemoveFilter,this)),this.$addFilterInput=$("#filter-input"),this.$addFilterInput.keyup(_.bind(this._validateFilter,this)),this.$filterTypes=$("#filter-types"),this.$filterTypes.change(_.bind(this.handleFilterTypeChange,this)),this.$addFilterButton=$("#add-filter"),this.$addFilterButton.click(_.bind(this.handleAddFilter,this)),this.handleFilterTypeChange(),this.refreshFilters()}).methods({_validateFilter:function(a){var b=this.$filterTypes.val(),c=this.$addFilterInput.val(),d=TD.controller.filterManager.validateFilter(b,c);return d?this.$addFilterButton.removeAttr("disabled"):this.$addFilterButton.attr("disabled","disabled"),d},handleAddFilter:function(a){a.preventDefault();if(!this._validateFilter())return;var b=this.$filterTypes.val(),c=this.$addFilterInput.val();TD.controller.filterManager.addFilter(b,c),this.refreshFilters(),this.$addFilterInput.val("")},handleRemoveFilter:function(a){var b=$(a.target);TD.controller.filterManager.removeFilter(b.data("id")),this.refreshFilters()},handleFilterTypeChange:function(){var a=this.$filterTypes.val(),b;switch(a){case TD.vo.Filter.PHRASE:b=TD.i("eg iPad");break;case TD.vo.Filter.SENDER:b=TD.i("eg @JohnDoe123");break;case TD.vo.Filter.SOURCE:b=TD.i("eg TweetSpamApp")}this.$addFilterInput.attr("placeholder",b),this._validateFilter()},refreshFilters:function(){var a=TD.controller.filterManager.getAll(),b="";_.each(a,function(a){b+=TD.ui.template.render("settings/global_setting_filter_row",a)}),this.$filterHolder.html(b),this._validateFilter()},destroy:function(a){$(".js-remove-filter").die("click"),this.$globalSettings.unbind("submit"),this.$node.remove()}}),TD.components.ServicesSettings=TD.components.Base.extend(function(){this.$node=$(TD.ui.template.render("settings/global_setting_services",{}));var a=TD.storage.accountController.getAccountsForService("bitly");a.length>0&&(this.bitlyAccount=a[0]),$("#global-settings").append(this.$node),this.$bitlyForm=$("#bitly-form"),this.$bitlyUsername=$("#bitly-email"),this.$bitlyKey=$("#bitly-key"),this.$linkShorteners=$("#link-shortening"),this.$linkShorteners.change(_.bind(this.handleLinkShortenerChange,this)),this.setLinkShortener()}).methods({handleLinkShortenerChange:function(a){var b=this.$linkShorteners.val();b=b.split("-")[1],TD.settings.setLinkShortener(b),this.setLinkShortener()},setLinkShortener:function(){var a=TD.settings.getLinkShortener();this.$linkShorteners.val("link-"+a),a=="bitly"?(this.$bitlyForm.show(),this.bitlyAccount&&(this.$bitlyUsername.val(this.bitlyAccount.getUserID()),this.$bitlyKey.val(this.bitlyAccount.getOAuthToken()))):this.$bitlyForm.hide()},commitBitlyChanges:function(a,b){var c=this.$bitlyUsername.val(),d=this.$bitlyKey.val();a&&b&&TD.storage.accountController.blacklistAccount(a);if(!a||b){a=new TD.storage.Account,a.setType("bitly"),a.setOAuthToken(d),a.setUserID(c),a.computeKey(),TD.storage.accountController.manage(a);return}a.setOAuthToken(d)},destroy:function(){var a=TD.settings.getLinkShortener();if(a=="bitly"){var b=this.bitlyAccount,c=this.$bitlyUsername.val(),d=this.$bitlyKey.val();c&&d&&(!b||b.getUserID()==c&&b.getOAuthToken()==d?b||this.commitBitlyChanges():this.commitBitlyChanges(b,b.getUserID()!=c))}this.$node.remove()}}),TD.components.GeneralSettings=TD.components.Base.extend(function(){var a={version:TD.version,buildIDShort:TD.buildIDShort,appEnv:TD.util.getAppEnv()};TD.util.isWrapperApp()&&deck.getWrapperVersion&&(a.wrapperVersion=deck.getWrapperVersion()),this.$node=$(TD.ui.template.render("settings/global_setting_general",a)),$("#global-settings").append(this.$node),this.$streamingForm=this.$find(".js-streaming-form"),this.$streamingUpdates=$("#streaming-updates"),this.$streamingUpdates.change(this.handleStreamingChange.bind(this)),this.setStreaming(),this.$checkForUpdatesForm=this.$find(".js-check-updates-form"),this.$checkForUpdates=$("#check-for-updates"),this.$checkForUpdates.change(this.handleCheckForUpdatesChange.bind(this)),this.setCheckForUpdates(),this.$showStartupNotifications=$("#show-startup-notifications"),this.$showStartupNotifications.change(this.handleShowStartupNotificationsChange.bind(this)),this.setShowStartupNotifications(),this.$displaySensitiveMedia=$("#display-sensitive-media"),this.$displaySensitiveMedia.change(this.handleDisplaySensitiveMediaChange.bind(this)),this.setDisplaySensitiveMedia(),this.$columnSizeRadios=$(".js-column-size-radio"),this.$columnSizeRadios.change(this.handleColumnWidthChange.bind(this)),this.setColumnWidth(),this.$fontSizeRadioButtons=$(".js-font-size-radio"),this.$fontSizeRadioButtons.change(this.handleFontSizeChange.bind(this)),this.setFontSize(),this.$themeSwitcherRadios=$(".js-theme-radio"),this.$themeSwitcherRadios.change(this.handleThemeSwitcherChange.bind(this)),this.setTheme()}).methods({handleStreamingChange:function(){var a=this.$streamingUpdates.prop("checked");TD.settings.setUseStream(a)},setStreaming:function(){this.$streamingUpdates.prop("checked",TD.settings.getUseStream())},handleCheckForUpdatesChange:function(){var a=this.$checkForUpdates.prop("checked");TD.settings.setCheckForUpdates(a),this.setStreaming()},setCheckForUpdates:function(){this.$checkForUpdatesForm.hide()},handleShowStartupNotificationsChange:function(){var a=this.$showStartupNotifications.prop("checked");TD.settings.setShowStartupNotifications(a)},setShowStartupNotifications:function(){this.$showStartupNotifications.prop("checked",TD.settings.getShowStartupNotifications())},handleDisplaySensitiveMediaChange:function(){var a=this.$displaySensitiveMedia.prop("checked");TD.settings.setDisplaySensitiveMedia(a)},setDisplaySensitiveMedia:function(){this.$displaySensitiveMedia.prop("checked",TD.settings.getDisplaySensitiveMedia())},setFontSize:function(){var a=TD.settings.getFontSize(),b=$('.js-font-size-radio[value="'+a+'"]');b.prop("checked",!0)},handleFontSizeChange:function(a){var b;a.currentTarget.checked&&(b=a.currentTarget.value,TD.settings.setFontSize(b))},setColumnWidth:function(){var a=TD.settings.getColumnWidth(),b=$('.js-column-size-radio[value="'+a+'"]');b.prop("checked",!0)},handleColumnWidthChange:function(a){var b;a.currentTarget.checked&&(b=a.currentTarget.value,TD.settings.setColumnWidth(b))},handleThemeSwitcherChange:function(a){$(document).trigger("uiThemeChangeAction")},setTheme:function(){var a=TD.settings.getTheme(),b=$('.js-theme-radio[value="'+a+'"]');b.prop("checked",!0)}}),TD.components.AccountSelector=TD.components.Base.extend(function(a){var b=this;this.$node=$.createElement("ul").addClass("accs cf js-account-selector"),this.cachedSelectedAccounts=[],this.accountIndex={},this.refreshPostingAccounts(),this.$node.delegate(".js-account-item","click",function(a){var c=$(a.currentTarget);a.stopPropagation(),a.shiftKey?($("li",b.$node).removeClass(TD.components.AccountSelector.SELECTED_CLASS),c.addClass(TD.components.AccountSelector.SELECTED_CLASS)):c.toggleClass(TD.components.AccountSelector.SELECTED_CLASS),b.updateSelectedAccounts()}),this.subscription=$.subscribe("/storage/client/account_whitelist_changed",_.bind(this.refreshPostingAccounts,this))}).statics({CHANGE:"td-accounts-change",SELECTED_CLASS:"acc-selected"}).methods({refreshPostingAccounts:function(){var a,b,c=TD.storage.accountController.getPostingAccounts(),d,e=[],f,g,h,i;this.accountIndex={};for(a=0;a<c.length;a++)d=c[a],h=d.getKey(),e.push(h),this.accountIndex[h]={account:h,uid:h,type:"account",username:d.getUsername(),service:d.getType(),picture:d.getProfileImageURL()};var j=function(a,b,c){var d={accounts:[],show_acc_toggle:c};return d.accounts=_.map(a,function(a){return b[a]}),d};e.length&&(i=TD.ui.template.render("compose/accounts",j(e,this.accountIndex,!0)),this.$node.html(i))},getSelectedAccounts:function(){var a,b=[],c;if(this.cachedSelectedAccounts)return this.cachedSelectedAccounts.concat();a=$("."+TD.components.AccountSelector.SELECTED_CLASS,this.$node);for(var d=0;d<a.length;d++)c=a[d].attributes["data-id"].value,b.push(this.accountIndex[c]);return this.cachedSelectedAccounts=b,b},selectAccounts:function(a){var b=this.$node.find(".js-account-item"),c;if(!_.isArray(a))return;b.removeClass(TD.components.AccountSelector.SELECTED_CLASS);if(!a||!a.length)return;for(c=0;c<a.length;c++)a[c]&&b.filter("li[data-id='"+a[c]+"']").addClass(TD.components.AccountSelector.SELECTED_CLASS);this.updateSelectedAccounts()},selectDefaultAccount:function(){var a=TD.storage.accountController.getDefault();a&&this.selectAccounts([a.getKey()])},updateSelectedAccounts:function(){this.cachedSelectedAccounts=null;var a=this.getSelectedAccounts();this.$node.trigger(TD.components.AccountSelector.CHANGE)},destroy:function(){$.unsubscribe(this.subscription),$(".js-account-item",this.$node).die(),this.supr()}}),TD.components.DropDown=TD.components.Base.extend(function(a){this.$parent=a,this.$body=$("body"),this.$container=this.$parent.closest(TD.components.DropDown.CONTAINER_SELECTOR),this.$container.length===0&&(this.$container=this.$body),this._handleCloseDropdown=_.bind(this._handleCloseDropdown,this),$(document).on("uiCloseDropdown",this._handleCloseDropdown),this._boundHandleGlobalClick=_.bind(this._handleGlobalClick,this)}).statics({CLOSE:"td-dropdown-close",POSITION_RIGHT:"td-dropdown-right",POSITION_LEFT:"td-dropdown-left",CONTAINER_SELECTOR:".js-dropdown-container",dropdown:null}).methods({addToDisplay:function(){var a=TD.components.DropDown.dropdown;if(a){a.destroy(),TD.components.DropDown.dropdown=null;if(a.$parent[0]===this.$parent[0]){this.destroy();return}}this.$parent.addClass("is-selected"),this.$node.insertAfter(this.$parent),this.$node.show(),this.setPosition(),this.$body.on("click","*",this._boundHandleGlobalClick),TD.components.DropDown.dropdown=this},_handleGlobalClick:function(a){this.$node&&this.$find(a.currentTarget).length===0&&this.$parent.find(a.currentTarget).length===0&&this.destroy()},_handleCloseDropdown:function(){this.destroy()},destroy:function(){if(!this.$node)return;this.$parent.removeClass("is-selected"),$(document).off("uiCloseDropdown",this._handleCloseDropdown),this.$body.off("click","*",this._boundHandleGlobalClick),this.bubbleEvent(TD.components.DropDown.CLOSE),this.$node.remove(),this.$node=null,TD.components.DropDown.dropdown=null},setPosition:function(a){var b,c,d,e,f;a===TD.components.DropDown.POSITION_RIGHT?this.$node.addClass("pos-r"):a===TD.components.DropDown.POSITION_LEFT&&this.$node.addClass("pos-l"),this.$container.length>0&&!this.$node.hasClass("pos-t")&&(b=this.$node.offset().top,c=this.$container.offset().top,f=this.$node.outerHeight(),d=b+f,e=c+this.$container.height(),d>=e&&b-f>c&&this.$node.addClass("pos-t"))}}),TD.components.ProfileMenu=TD.components.DropDown.extend(function(a,b,c,d){this.user=b,this.chirp=c,this.isSingleAccount=TD.storage.accountController.getAccountsForService("twitter").length===1,this.showFollow=d||!this.isSingleAccount,this.isFlagged=this.chirp&&this.chirp.getMedia().some(function(a){return a.flaggedNSFW}),this.chirp instanceof TD.services.TwitterDirectMessage?this.$node=$(TD.ui.template.render("menus/profile_directmessage",this)):this.$node=$(TD.ui.template.render("menus/profile",this)),this.actionsMenu=a.closest("ul"),this.setChirpMenuState(),this.$find("a").click(_.bind(this.handleClick,this)),this.addToDisplay()}).methods({_handleFlagTweetSuccess:function(){var a=this.chirp.getMedia();a.forEach(function(a){a.flaggedNSFW=!0}),TD.controller.progressIndicator.addMessage(TD.i("Success: Media flagged"))},_handleFlagTweetError:function(){TD.controller.progressIndicator.addMessage(TD.i("Error: Failed to flag media. Please try again."))},handleClick:function(a){var b=$(a.target).data("action"),c=$(a.target).attr("rel"),d;if(b==="url")return;a.preventDefault(),a.stopPropagation();switch(b){case"mention":TD.ui.compose.mention(this.user.screenName,this.user.account.getKey());break;case"message":TD.ui.compose.directMessage(this.user.screenName,this.user.profileImageURL,this.user.account.getKey());break;case"lists":new TD.components.AddToListsDialog(this.user);break;case"flag-media":TD.controller.progressIndicator.addMessage(TD.i("Flagging media...")),d=TD.controller.clients.getClient(this.chirp.account.getKey()),d.flagTweet(this.chirp.id,this._handleFlagTweetSuccess.bind(this),this._handleFlagTweetError);break;case"block":$(document).trigger("uiBlockAction",{account:this.user.account,twitterUser:this.user});break;case"report-spam":$(document).trigger("uiReportAction",{account:this.user.account,twitterUser:this.user});break;case"followOrUnfollow":var e=new TD.components.FollowDialog(this.user);break;case"follow":this.user.follow(this.user.account,null,null,!0);break;case"unfollow":this.user.unfollow(this.user.account,null,null,!0);break;case"reference-to":this.chirp.referenceTo();break;case"email":this.chirp.email();break;case"destroy":this.chirp.destroy();break;case"embed":$(document).trigger("uiShowEmbedTweet",{tweet:this.chirp.getMainTweet()});break;case"translate":this.chirp.translate()}this.destroy()},setChirpMenuState:function(){this.actionsMenu.addClass("is-visible")},destroy:function(){this.supr(),this.actionsMenu.removeClass("is-visible")}}),TD.components.TopbarMenu=TD.components.DropDown.extend(function(a){this.$node=$(TD.ui.template.render("menus/topbar_menu",{debug:Boolean(TD.config.debug_menu),tdAccount:TD.storage.store.getTweetdeckAccount()})),this.addToDisplay(),this.$find("a").on("click",this.handleClick.bind(this)),this.$node.on("click",this.handleNodeClick.bind(this)),this.boundParentClickHandler=this.handleParentClick.bind(this),a.on("click",this.boundParentClickHandler)}).methods({handleClick:function(a){var b=$(a.target),c=b.data("action");switch(c){case"signOut":TD.controller.init.signOut();break;case"url":TD.util.openURL(b.attr("href"));break;case"globalSettings":var d=new TD.components.GlobalSettings;break;case"do_debug":TD.sync.ui.dispatch_ui_event(b.data("type"));break;case"fileabug":this.sendBugReport();break;case"keyboardShortcutList":$(document).trigger("uiShowKeyboardShortcutList")}a.preventDefault(),this.destroy()},handleParentClick:function(a){a.stopPropagation(),this.destroy()},handleNodeClick:function(a){a.preventDefault(),a.stopPropagation()},sendBugReport:function(){var a,b=TD.config.fileabug,c;c={tdAccount:TD.storage.store.getTweetdeckAccount(),userAgent:navigator.userAgent,version:TD.version,buildID:TD.gitrevshort},a=TD.ui.template.render("emails/fileabug",c),TD.util.openEmail(b,"",a)},destroy:function(){this.$parent.off("click",this.boundParentClickHandler),this.supr()}}),TD.vo.Column=function(a,b){TD.sync.util.assert(a,"must provide sColumn to create aColumn");var c=this;this.model=a,TD.sync.util.assert(this.model.getKey(),"vo.Column will most likely fail if your column has no key"),this._feeds=[],this.filters=[],this.description="",this.updateArray=[],this.updateIndex={},this.scribedImpressionIDs=new TD.cache.LRUQueue(200),this._animating=!1,this._animationQueue=[],this._isUpdating=!0,this.feedSubscriptions={},this.deleteSubscriptions={},this.visible=!0,this.visibility={columnWidth:0,visibleWidth:0,visibleHeight:0,visibleFraction:0},this.temporary=!1,this.chirpContainerSelector=".js-chirp-container[data-column='"+this.model.getKey()+"']",this._$chirpContainer=null,this.detailViewComponent=null,this.feedsFetched=0,this.isFirstFetch=!0,this.isFetchingOlderUpdates=!1,this.lastInfiniteScrollTime=null,this.isShowingLoadMore=!1,this.isExhausted=!1,this.CHIRP_BLOCK_SIZE=20,this.model.getType()==="scheduled"?this.sortFunction=TD.util.chirpAscSort:this.sortFunction=TD.util.chirpDescSort,this.loadFeeds(),this.loadFilters(),b&&this.setFeeds(b),this.isFilterable()||this.updateSearchFilter(new TD.vo.SearchFilter),this.GLOBAL_TPM_ANIMATION_LIMIT=2e3,this.COLUMN_TPM_ANIMATION_LIMIT=120,this.COLUMN_MINIMALIST_TWEET_TPM_THRESHOLD=750,this.doAnimate=!0,this.streamRate=0;var d=this.updateStreamRate.bind(this);$(document).on("dataStreamRate",d),this.tpm=0;var e=this.updateTpm.bind(this),f="dataColumn"+this.model.getKey()+"Tpm";$(document).on(f,e),this.tpmCounter=new TD.util.TpmCounter(500,5e3,f),this.STREAM_ITEM_CONTENT_SELECTOR=".js-stream-item-content",this.STREAM_ITEM_SELECTOR=".js-stream-item",this.INFINITE_SPINNER_SELECTOR=".js-infinitespinner",$.subscribe("/storage/client/settings/display_sensitive_media",this.reloadTweets.bind(this))},TD.vo.Column.CHIRP_STAGGERING_INTERVAL=400,TD.vo.Column.FADE_IN_CLASS="column-opacity-transition",TD.vo.Column.MEDIA_PREVIEW_OFF="off",TD.vo.Column.MEDIA_PREVIEW_SIZE_SMALL="small",TD.vo.Column.MEDIA_PREVIEW_SIZE_MEDIUM="medium",TD.vo.Column.MEDIA_PREVIEW_SIZE_LARGE="large",TD.vo.Column.prototype.reset=function(){this.updateArray=[],this.updateIndex={},this.feedsFetched=0,this.isFirstFetch=!0,this.isFetchingOlderUpdates=!1,this.lastInfiniteScrollTime=null,this.refreshSubscriptions()},TD.vo.Column.prototype.updateStreamRate=function(a,b){this.streamRate=b.itemsPerMinute},TD.vo.Column.prototype.updateTpm=function(a,b){this.tpm=b.itemsPerMinute},TD.vo.Column.prototype.loadFeeds=function(){if(!this.model.managed)return;var a=this.model.getFeedKeys();if(_.isUndefined(a)){TD.sync.util.stateLog("loadFeeds() not loading feeds for",this,"given",this.model.state);return}this._feeds=[];for(var b=0;b<a.length;b++){var c=TD.storage.feedController.get(a[b]);this._feeds.push(c)}this.refreshSubscriptions()},TD.vo.Column.prototype.getFeeds=function(){return this._feeds.concat()},TD.vo.Column.prototype.getFeedCount=function(){return this._feeds.length},TD.vo.Column.prototype.setFeeds=function(a){this._feeds=a;var b=[];for(var c=0;c<this._feeds.length;c++)b.push(this._feeds[c].getKey());this.model.setFeedKeys(b),this.refreshSubscriptions(),this.model.managed&&TD.storage.feedController.manageFeeds(this._feeds)},TD.vo.Column.prototype.addFeed=function(a){var b=[],c;for(var d=0;d<this._feeds.length;d++){c=_feeds[d].getKey();if(c===a.getKey())return;b.push(c)}this._feeds.push(a),b.push(a.getKey()),this.model.setFeedKeys(b),this.refreshSubscriptions(),this.model.managed&&TD.storage.feedController.manageFeeds(this._feeds)},TD.vo.Column.prototype.addFeeds=function(a){if(!a||a.length===0)return;var b=[],c={},d;a=this._feeds.concat(a);for(d=0;d<a.length;d++)c[a[d].getKey()]||(c[a[d].getKey()]=!0,b.push(a[d]));this.setFeeds(b)},TD.vo.Column.prototype.removeFeed=function(a){var b=[],c,d=0;for(var e=this._feeds.length-1;e>=0;e--)c=this._feeds[e].getKey(),c===a.getKey()?(this._feeds.splice(e,1),d++):b.push(c);return d>0&&(this.model.setFeedKeys(b),this.refreshSubscriptions(),this.checkChirpIndex()),d},TD.vo.Column.prototype.findChirp=function(a){var b=this.updateIndex[a];return!b&&this.detailViewComponent&&(b=this.detailViewComponent.findChirp(a)),b},TD.vo.Column.prototype.findMostInterestingChirp=function(a){var b=this.findChirp(a);return b&&b instanceof TD.services.TwitterAction&&(b=b.getRelatedTweet()||b),b},TD.vo.Column.prototype.getChirpContainer=function(){if(!this._$chirpContainer||this._$chirpContainer.length===0)this._$chirpContainer=$(this.chirpContainerSelector);return this._$chirpContainer},TD.vo.Column.prototype.checkChirpIndex=function(){var a=this.model.getFeedKeys(),b=_.map(a,TD.controller.feedManager.getPoller),c=_.filter(this.updateArray,function(a){return!_.find(b,function(b){return b.chirpIndex[a.id]})});this.removeFromIndex(null,c,!0)},TD.vo.Column.prototype.refreshSubscriptions=function(){var a,b={},c=this.model.getFeedKeys(),d=this;if(this.model.getType()==="me"){var e=!1,f=[];_.each(c,function(a){var b=TD.storage.feedController.get(a);if(!b)return;b.getType()==="interactions"&&(e=!0),b.getType()!=="mentions"&&f.push(a)}),e&&(c=f)}for(var g=0;g<c.length;g++)a=c[g],b[a]=!0,this.feedSubscriptions[a]||(this.feedSubscriptions[a]=$.subscribe("/feed/"+a,function(a,b,c){d.addToIndex(a,b,c)})),this.deleteSubscriptions[a]||(this.deleteSubscriptions[a]=$.subscribe("/delete/"+a,function(a,b){d.removeFromIndex(a,b,!0)}));for(a in this.feedSubscriptions)b[a]||($.unsubscribe(this.feedSubscriptions[a]),delete this.feedSubscriptions[a]);for(a in this.deleteSubscriptions)b[a]||($.unsubscribe(this.deleteSubscriptions[a]),delete this.deleteSubscriptions[a])},TD.vo.Column.prototype.removeSubscriptions=function(){var a;for(a in this.feedSubscriptions)$.unsubscribe(this.feedSubscriptions[a]),delete this.feedSubscriptions[a];for(a in this.deleteSubscriptions)$.unsubscribe(this.deleteSubscriptions[a]),delete this.deleteSubscriptions[a]},TD.vo.Column.prototype.fetchUpdatesFromPoller=function(a){if(this.isFetchingOlderUpdates)return;var b=this,c,d=this.updateArray.length,e=0,f=!1,g=0,h,i=function(){var a=b.getFeeds().map(function(a){var d=TD.controller.feedManager.getPoller(a.getKey()),h=d.fetchOlderChirps(c);return h.addCallback(function(c){var h;return c=_.select(c,function(a){return!b.updateIndex[a.id]}),b.lastInfiniteScrollTime=(new Date).getTime(),h=b.addItemsToIndex(c,!0,a,a.getLatestTime()),f=!d.isExhausted||f,e+=h,c.length&&(g=Math.max(g,c[c.length-1].created.getTime())),c}),h});return new TD.core.defer.DeferredList(a)},j=function(){b.feedsFetched=0,c=g,g=0;if(e===0){if(f)return i();b.isExhausted=!0}};return this.updateArray.length&&!a?c=this.updateArray[this.updateArray.length-1].created.getTime():c=Number.MAX_VALUE,this.isFetchingOlderUpdates=!0,this.addInfiniteScrollSpinner(),h=i(),h.addCallback(j),h.addCallback(function(){b.removeInfiniteScrollSpinner(),b.showLoadMoreButton(),b.isFetchingOlderUpdates=!1,b.truncate(d+b.CHIRP_BLOCK_SIZE)}),h},TD.vo.Column.prototype.addToIndex=function(a,b,c){var d;this._isUpdating&&(this.getChirpContainer().trigger("dataColumnFeedUpdated"),this.hideIsUpdatingMessage(),this._isUpdating=!1);if(b.length===0){this.updateArray.length===0&&this.temporary&&this.showNoResultsMessage();return}this.hideNoResultsMessage(),d=b.concat(),this.addItemsToIndex(d,this.updateArray.length,a.feed,c),this.isFirstFetch&&(this.feedsFetched++,this.feedsFetched==this.getFeedCount()&&(this.truncate(this.CHIRP_BLOCK_SIZE),this.feedsFetched=0,this.isFirstFetch=!1)),this.showLoadMoreButton()},TD.vo.Column.prototype.addItemsToIndex=function(a,b,c,d){var e,f=[],g,h=this.updateArray.length?this.updateArray[this.updateArray.length-1].created.getTime():0,i=this.model.getClearedTimestamp(),j=[],k=0;this.updateArray.length===0&&this.removeInfiniteScrollSpinner(),a.sort(this.sortFunction),e=a.length;for(var l=0;l<e;l++){g=a[l];if(!b&&g.created.getTime()<h)continue;if(g.created.getTime()<=i)continue;if(!g.passFilters(this.filters))continue;_.isUndefined(this.updateIndex[g.id])||(this.removeFromIndex(null,[g],!1),this.detailViewComponent&&this.detailViewComponent.changed(g)),this.updateIndex[g.id]=g,f.push(g),_.isUndefined(d)||(j=j.concat(g.getUnreadChirps(d)));if(f.length>this.CHIRP_BLOCK_SIZE)break}k=f.length;if(k){var m="",n=[],o=this.updateArray;while(f.length>0||o.length>0)if(f.length===0)n=n.concat(o),o=[];else if(o.length===0)n=n.concat(f),this.addToView(c,m,f),f=[];else{var p=[],q=o[0],r=f[0];while(this.sortFunction(q,r)>0&&f.length>0)g=f.shift(),p.push(g),f.length>0&&(r=f[0]);p.length>0?(this.addToView(c,m,p),n=n.concat(p)):(g=o.shift(),n.push(g),g.passFilters(this.filters)&&(m=g.id))}this.updateArray=n}return $.publish("/notifications/new",[{column:this,feed:c,items:j}]),this.isMessageColumn()&&this.getChirpContainer().trigger("uiReadStateChange",{}),k},TD.vo.Column.prototype.removeFromIndex=function(a,b,c){for(var d=0;d<b.length;d++){var e=b[d];this.removeChirp(e),c&&this.detailViewComponent&&this.detailViewComponent.deleted(e)}},TD.vo.Column.prototype.removeChirp=function(a){var b=this.updateIndex[a.id];if(b){for(var c=0;c<this.updateArray.length;c++){a=this.updateArray[c];if(a===b){this.updateArray.splice(c,1);break}}delete this.updateIndex[a.id],$('[data-key="'+a.id+'"]',this.getChirpContainer()).remove(),$(document).trigger("uiColumnChirpsChanged",{id:this.model.getKey()})}},TD.vo.Column.prototype.clear=function(){if(this.updateArray.length===0)return;var a=this.updateArray[0].created.getTime();this.model.setClearedTimestamp(a),this.truncate(0)},TD.vo.Column.prototype.truncate=function(a){var b,c,d,e=-1,f=this.getFeeds(),g;this.feedsFetched=0;for(b=0;b<f.length;b++){c=TD.controller.feedManager.getPoller(f[b].getKey());if(!c)continue;d=c.getRangeStartTime(),d>e&&(e=d)}g=null;for(b=this.updateArray.length-1;b>=0;b--)if(this.updateArray[b].created.getTime()>=e){g=b;break}if(g!==null){g=Math.min(a,g+1);for(b=this.updateArray.length-1;b>=g;b--)this.annihilateChirp(this.updateArray[b].id.toString(),this.getChirpContainer()),this.isExhausted=!1;this.updateArray.splice(g,Number.MAX_VALUE)}},TD.vo.Column.prototype.trimUpdates=function(a){var b,c,d;if(this.lastInfiniteScrollTime){b=(new Date).getTime()-this.lastInfiniteScrollTime;if(b>1e4)d=Math.floor((this.updateArray.length-20)*(1-b/6e5)),this.maxUpdatesPerColumn=Math.max(20+d,20);else return}a=a||Math.max(this.maxUpdatesPerColumn||20,20),c=this.updateArray.splice(a,Math.max(this.updateArray.length-a,0));for(var e=0;e<c.length;e++)this.annihilateChirp(c[e].id.toString(),this.getChirpContainer())},TD.vo.Column.prototype.annihilateChirp=function(a,b){var c=this,d=this.findChirp(a);b.children('[data-key="'+a+'"]').remove(),delete this.updateIndex[a]},TD.vo.Column.prototype.addToView=function(a,b,c){var d,e=this.getChirpContainer(),f,g,h,i,j=TD.controller.columnManager.isStreaming(this.model.getKey());if(c.length===0)return;this.updateArray.length===0?(h=TD.util.getPreciseTime(),d=this.renderChirps(c),i=TD.util.getPreciseTime(),TD.util.logTimeToRenderColumn(i-h,c.length)):(j&&this.tpmCounter.incrementCounter(c.length),d=this.renderChirps(c)),f=$(d).filter(this.STREAM_ITEM_SELECTOR),g=e.children(this.STREAM_ITEM_SELECTOR).size()===0,b===""?g?(e.html(f),this.isShowingLoadMore=!1):(!TD.ui.columns.isFrozen(this.model.getKey())&&TD.controller.columnManager.isStreaming(this.model.getKey())&&this.trimUpdates(100-f.size()),e.prepend(f)):e.children('[data-key="'+b+'"]').after(f),g?this._fadeInContent(e):this._slideInChirps(f)},TD.vo.Column.prototype.getMediaPreviewSize=function(){var a,b=this.model.getMediaPreviewSize();return b||(this.isMessageColumn()&&(b=TD.vo.Column.MEDIA_PREVIEW_OFF),a=this.getSearchFilter(),a.content.hasActiveMediaFilter()?b=TD.vo.Column.MEDIA_PREVIEW_SIZE_LARGE:this.getColumnType()===TD.util.columnUtils.columnMetaTypes.INTERACTIONS?b=TD.vo.Column.MEDIA_PREVIEW_SIZE_SMALL:b=TD.vo.Column.MEDIA_PREVIEW_SIZE_MEDIUM),b},TD.vo.Column.prototype.setMediaPreviewSize=function(a){var b=this.getMediaPreviewSize();a!==b&&this.model.setMediaPreviewSize(a),this.reloadTweets()},TD.vo.Column.prototype.renderChirps=function(a){var b=[],c,d,e=this.tpm>this.COLUMN_MINIMALIST_TWEET_TPM_THRESHOLD,f=this.getMediaPreviewSize();for(d=0;d<a.length;d++)c=a[d].render({isTemporaryColumn:this.temporary,mediaPreviewSize:f,isMinimalist:e}),b.push(c);return b.join("")},TD.vo.Column.prototype._fadeInContent=function(a){var b=this;_.defer(function(){a.css("opacity",1),TD.ui.main.TRANSITION_END_EVENTS?a.one(TD.ui.main.TRANSITION_END_EVENTS,function(){a.removeClass(TD.vo.Column.FADE_IN_CLASS).removeAttr("style"),$(document).trigger("uiColumnChirpsChanged",{id:b.model.getKey()})}):(a.removeClass(TD.vo.Column.FADE_IN_CLASS).removeAttr("style"),$(document).trigger("uiColumnChirpsChanged",{id:b.model.getKey()}))})},TD.vo.Column.prototype._slideInChirps=function(a){var b,c,d=[],e=this.temporary&&this.getChirpContainer().closest(".is-hidden").length;this.doAnimate=!e&&this.streamRate<this.GLOBAL_TPM_ANIMATION_LIMIT&&this.tpm<this.COLUMN_TPM_ANIMATION_LIMIT,a&&(a.each(function(){d.push($(this).toggleClass("is-animating"))}),d.reverse(),this._animationQueue=this._animationQueue.concat(d));if(this._animating||this._animationQueue.length===0)return;c=TD.ui.columns.freezeScroll(this.model.getKey()),c?(this.isFetchingOlderUpdates||this.getChirpContainer().trigger("uiReadStateChange",{read:!1}),_.each(this._animationQueue,function(a){a.removeClass("is-animating")}),this._animationQueue=[]):TD.controller.columnManager.isStreaming(this.model.getKey())?(_.each(this._animationQueue,this._slideInChirp.bind(this)),this._animationQueue=[]):(this._animating=!0,b=this._animationQueue.shift(),this._slideInChirp(b),setTimeout(function(){this._animating=!1,this._slideInChirps()}.bind(this),TD.vo.Column.CHIRP_STAGGERING_INTERVAL)),this.isFetchingOlderUpdates||TD.ui.columns.unfreezeScroll(this.model.getKey()),$(document).trigger("uiColumnChirpsChanged",{id:this.model.getKey()})},TD.vo.Column.prototype._slideInChirp=function(a){var b,c=function(){a.removeClass("is-animating"),a.removeAttr("style"),$(document).trigger("uiColumnChirpsChanged",{id:this.model.getKey()})}.bind(this);this.doAnimate&&TD.ui.main.TRANSITION_END_EVENTS?(b=a.find(".js-stream-item-content").outerHeight(),a.css({opacity:1,height:b+"px"}),a.one(TD.ui.main.TRANSITION_END_EVENTS,c)):c()},TD.vo.Column.prototype.showLoadMoreButton=function(){return},TD.vo.Column.prototype.hideLoadMoreButton=function(){return},TD.vo.Column.prototype.addInfiniteScrollSpinner=function(){this.hideLoadMoreButton(),this.getChirpContainer().append(TD.ui.template.render("spinner_large"))},TD.vo.Column.prototype.removeInfiniteScrollSpinner=function(){$(this.INFINITE_SPINNER_SELECTOR,this.getChirpContainer()).remove()},TD.vo.Column.prototype.showIsUpdatingMessage=function(){this.$loadingMessage=$(TD.ui.template.render("column_loading_placeholder",{isUpdating:!0})),this.getChirpContainer().html(this.$loadingMessage)},TD.vo.Column.prototype.hideIsUpdatingMessage=function(){var a=this.getChirpContainer();a.css("opacity",0),_.defer(function(){a.addClass(TD.vo.Column.FADE_IN_CLASS)}),a.find(".js-column-loading-placeholder").remove(),this.showLoadMoreButton()},TD.vo.Column.prototype.showNoResultsMessage=function(){var a=this.getChirpContainer();a.css("opacity",1).removeClass(TD.vo.Column.FADE_IN_CLASS),this.$noResults=$(TD.ui.template.render("search_no_tweets_placeholder")),a.html(this.$noResults)},TD.vo.Column.prototype.hideNoResultsMessage=function(){this.$noResults&&this.$noResults.remove()},TD.vo.Column.prototype.getTitleHTML=function(){return TD.util.columnUtils.getColumnTitleHTML(this)},TD.vo.Column.prototype.getDetailTitleHTML=function(){return TD.util.columnUtils.getColumnTitleHTML(this)},TD.vo.Column.prototype.getColumnType=function(){return TD.util.columnUtils.getColumnType(this)},TD.vo.Column.prototype.getIconClass=function(){return TD.util.columnUtils.getColumnIconClassByColumnType(this.getColumnType())},TD.vo.Column.prototype.isMessageColumn=function(){return TD.util.columnUtils.isMessageColumn(this)},TD.vo.Column.prototype.isSearchColumn=function(){return this.getColumnType()===TD.util.columnUtils.columnMetaTypes.SEARCH},TD.vo.Column.prototype.isActionsColumn=function(){return TD.util.columnUtils.actionColumnTypes.indexOf(this.getColumnType())>-1},TD.vo.Column.prototype.isSingleActionTypeColumn=function(){return TD.util.columnUtils.singleActionColumnTypes.indexOf(this.getColumnType())>-1},TD.vo.Column.prototype.isActivityColumn=function(){return this.getColumnType()===TD.util.columnUtils.columnMetaTypes.ACTIVITY},TD.vo.Column.prototype.isEmbeddable=function(){return _.include(TD.util.columnUtils.embeddableColumnTypes,this.getColumnType())},TD.vo.Column.prototype.isClearable=function(){var a=this.getColumnType();return a!==TD.util.columnUtils.columnMetaTypes.SCHEDULED},TD.vo.Column.prototype.isOwnList=function(){var a=!1;return _.find(this.getFeeds(),function(b){if(b.getType()==="list"){var c=b.getMetadata();a=TD.cache.lists.find(c.listId,c.screenName,c.slug,!0)}return Boolean(a)}),a},TD.vo.Column.prototype.updateMetadata=function(a){var b,c=this.getFeeds()[0];this._isUpdating=!0,this.showIsUpdatingMessage(),a.term=null,b=TD.storage.feedController.getOrCreateFeed(c.getType(),c.getService(),c.getAccountKey(),a),this.getChirpContainer().trigger("dataColumnUpdatingFeed",{column:this,oldFeed:c,newFeed:b}),TD.controller.feedManager.replaceFeed(c,b,[this.model.getKey()])},TD.vo.Column.prototype.loadFilters=function(){var a=new TD.vo.SearchFilter(this.model.getFilters()),b=a.getFilters();_.isEqual(_.pluck(this.filters,"id"),_.pluck(b,"id"))||(this.filters=b,this.reloadTweets())},TD.vo.Column.prototype.isFilterable=function(){return TD.util.columnUtils.filterableColumnTypes.indexOf(this.getColumnType())!==-1},TD.vo.Column.prototype.reloadTweets=function(){this._isUpdating||(this.truncate(0),this.fetchUpdatesFromPoller(!0),this.showLoadMoreButton())},TD.vo.Column.prototype.getBaseQuery=function(){var a=null,b=this.getFeeds();if(this.isSearchColumn()&&b&&b.length>0){var c=b[0].getMetadata();c&&(c.baseQuery?a=c.baseQuery:a=c.term)}return a},TD.vo.Column.prototype.updateSearchFilter=function(a){var b,c,d,e,f;if(!a)return;this.isSearchColumn()?this.updateSearchFeedFilter(a):(d=this.getFeeds()[0],d&&this.isActionsColumn()&&!this.isActivityColumn()&&(c=d.getType(),b=TD.util.columnUtils.inferFeedTypeFromActionFilter(a.action),b!==c&&(f=_.clone(d.getMetadata()),e=TD.storage.feedController.getOrCreateFeed(b,d.getService(),d.getAccountKey(),f),this.getChirpContainer().trigger("dataColumnUpdatingFeed",{column:this,oldFeed:d,newFeed:e}),TD.controller.feedManager.replaceFeed(d,e,[this.model.getKey()]))),this.model.setFilters(a.toJSONObject()),this.getChirpContainer().trigger("dataColumnFiltersUpdated"))},TD.vo.Column.prototype.updateSearchFeedFilter=function(a){var b=!1,c=this.getFeeds()[0],d=_.clone(c.getMetadata());d.baseQuery||(d.baseQuery=d.term),a.content&&a.content.matching&&a.content.matching!==d.baseQuery&&(b=!0,d.baseQuery=a.content.matching);var e=new TD.vo.SearchFilter(d.searchFilterData);if(b||e.getQueryString()!==a.getQueryString())d.searchFilterData=a.toJSONObject(),this.updateMetadata(d)},TD.vo.Column.prototype.getSearchFilter=function(){var a,b;return this.isSearchColumn()?(b=this.getFeeds()[0].getMetadata(),a=new TD.vo.SearchFilter(b.searchFilterData),a.content.matching||a.content.setMatching(b.baseQuery||b.term)):a=new TD.vo.SearchFilter(this.model.getFilters()),a},TD.vo.Column.prototype.hasActiveSearchFilters=function(){var a=this.getSearchFilter(),b=this.hasActiveUserFilters()||this.hasActiveContentFilters()||this.hasActiveEngagementFilters()||this.hasActiveActionFilters()&&!this.isSingleActionTypeColumn();return this.isSearchColumn()||(b=a.content.matching||b),Boolean(b)},TD.vo.Column.prototype.hasActiveContentFilters=function(){var a=this.getSearchFilter(),b;return this.isSearchColumn()?b=a.content.getQueryString():b=a.content.matching||a.content.getQueryString(),Boolean(b)},TD.vo.Column.prototype.hasActiveUserFilters=function(){var a=this.getSearchFilter(),b=a.user.getQueryString();return Boolean(b)},TD.vo.Column.prototype.hasActiveActionFilters=function(){var a=this.getSearchFilter(),b=a.action.getFilters().length;return Boolean(b)},TD.vo.Column.prototype.hasActiveEngagementFilters=function(){var a=this.getSearchFilter(),b=a.engagement.getQueryString();return Boolean(b)},TD.vo.Column.prototype.hasFilterError=function(){var a=this.getSearchFilter(),b;return this.getColumnType()===TD.util.columnUtils.columnMetaTypes.ACTIVITY?b=a.action.getFilters().length===TD.vo.ActionFilter.MAX_ACTIVITY_FILTERS:b=a.action.getFilters().length===TD.vo.ActionFilter.MAX_INTERACTION_FILTERS,b},TD.vo.Column.prototype.markAllMessagesAsRead=function(){this.isMessageColumn()&&this.updateArray.forEach(function(a){a instanceof TD.services.TwitterMessageThread&&a.markAsRead()})},TD.vo.Column.prototype.hasUnreadMessages=function(){var a=!1;return this.isMessageColumn()&&(a=this.updateArray.some(function(a){return a.unread})),a},TD.vo.Filter=function(a,b,c){this.type=a,this.value=b,this.positive=c,_.isString(b)&&(this.value=b.toLowerCase());switch(this.type){case TD.vo.Filter.PHRASE:this.exact=!1;break;case TD.vo.Filter.SENDER:this.exact=!0,this.fuzzy=!0,this.filterTarget="parent";break;case TD.vo.Filter.SOURCE:this.exact=!0,this.fuzzy=!1;break;case TD.vo.Filter.FOLLOWERS:this.exact=!1,this.range=!0;break;case TD.vo.Filter.IS_RETWEET:this.exact=!0;break;case TD.vo.Filter.IS_FROM_VERIFIED:this.exact=!0,this.filterTarget="parent";break;case TD.vo.Filter.CHIRP_TYPE:this.exact=!0,this.filterTarget="parent"}this.id=this.generateLocalID()},TD.vo.Filter.PHRASE="phrase",TD.vo.Filter.SENDER="sender",TD.vo.Filter.SOURCE="source",TD.vo.Filter.FOLLOWERS="followers",TD.vo.Filter.IS_RETWEET="is_retweet",TD.vo.Filter.IS_MENTION="is_mention",TD.vo.Filter.IS_FAVORITE="is_favorite",TD.vo.Filter.IS_FOLLOW="is_follow",TD.vo.Filter.HAS_IMAGE="has_image",TD.vo.Filter.HAS_VIDEO="has_video",TD.vo.Filter.HAS_MEDIA="has_media",TD.vo.Filter.HAS_LINK="has_link",TD.vo.Filter.IS_FROM_VERIFIED="verified",TD.vo.Filter.CHIRP_TYPE="chirp_type",TD.vo.Filter.prototype.id=null,TD.vo.Filter.prototype.value=null,TD.vo.Filter.prototype.type=TD.vo.Filter.PHRASE,TD.vo.Filter.prototype.positive=!0,TD.vo.Filter.prototype.exact=!0,TD.vo.Filter.prototype.fuzzy=!1,TD.vo.Filter.prototype.range=!1,TD.vo.Filter.prototype.filterTarget="child",TD.vo.Filter.prototype.generateLocalID=function(){return"filter"+TD.util.deterministicObjectHash(this.toBackendState())},TD.vo.Filter.prototype.pass=function(a){var b=this;a=this._getFilterTarget(a),text=a.getFilterableText(),text=text?text.toLowerCase():null,senders=a.getSenders(),senders=senders?_.map(senders,function(a){return a.toLowerCase()}):null,source=a.getSource(),source=source?source.toLowerCase():null;switch(this.type){case TD.vo.Filter.PHRASE:return this._testString(text);case TD.vo.Filter.SENDER:return this.positive?_.any(senders,function(a){return b._testString(a)}):_.every(senders,function(a){return b._testString(a)});case TD.vo.Filter.SOURCE:return this._testString(source);case TD.vo.Filter.FOLLOWERS:return this._testNumber(followers);case TD.vo.Filter.IS_RETWEET:return this._testBoolean(a.isRetweetedStatus());case TD.vo.Filter.IS_FROM_VERIFIED:return this._testBoolean(a.isFromVerifiedUser());case TD.vo.Filter.HAS_IMAGE:return this._testBoolean(a.hasImage());case TD.vo.Filter.HAS_VIDEO:return this._testBoolean(a.hasVideo());case TD.vo.Filter.HAS_MEDIA:return this._testBoolean(a.hasImage()||a.hasVideo());case TD.vo.Filter.HAS_LINK:return this._testBoolean(a.hasLink());case TD.vo.Filter.CHIRP_TYPE:return this._testString(a.getChirpType())}return!0},TD.vo.Filter.prototype.getDisplayType=function(){switch(this.type){case TD.vo.Filter.PHRASE:return"";case TD.vo.Filter.SENDER:return TD.i("user");case TD.vo.Filter.SOURCE:return TD.i("source");case TD.vo.Filter.FOLLOWERS:return TD.i("followers");case TD.vo.Filter.IS_RETWEET:return TD.i("retweets");case TD.vo.Filter.HAS_MEDIA:return TD.i("media");case TD.vo.Filter.HAS_LINK:return TD.i("links");case TD.vo.Filter.IS_FROM_VERIFIED:return TD.i("verified")}return""},TD.vo.Filter.prototype._getFilterTarget=function(a){return this.filterTarget!=="parent"&&a.targetTweet?a.targetTweet:a},TD.vo.Filter.prototype._testString=function(a){if(!a||!this.value)return!0;if(this.exact){if(a===this.value)return this.positive;if(this.fuzzy&&"@"+a===this.value)return this.positive}else if(a.indexOf(this.value)!==-1)return this.positive;return!this.positive},TD.vo.Filter.prototype._testNumber=function(a){if(!_.isNumber(a)||!_.isNumber(this.value))return!0;if(this.exact){if(a===this.value)return this.positive}else if(this.range&&a>=this.value)return this.positive;return!this.positive},TD.vo.Filter.prototype._testBoolean=function(a){return!_.isBoolean(a)||!_.isBoolean(this.value)?!0:a===this.value?this.positive:!this.positive},TD.vo.Filter.prototype.toBackendState=function(){return{type:this.type,value:this.value,positive:this.positive,exact:this.exact,fuzzy:this.fuzzy,range:this.range}},TD.vo.Filter.prototype.fromBackendState=function(a){this.type=a.type,this.value=a.value,this.positive=a.positive,this.exact=a.exact,this.fuzzy=a.fuzzy,this.range=a.range,this.id=this.generateLocalID()},TD.vo.SearchFilter=function(a){this.fromJSONObject(a)},TD.vo.SearchFilter.prototype.action=null,TD.vo.SearchFilter.prototype.content=null,TD.vo.SearchFilter.prototype.engagement=null,TD.vo.SearchFilter.prototype.user=null,TD.vo.SearchFilter.prototype.toJSONObject=function(){var a={action:this.action.toJSONObject(),content:this.content.toJSONObject(),engagement:this.engagement.toJSONObject(),user:this.user.toJSONObject()};return a},TD.vo.SearchFilter.prototype.fromJSONObject=function(a){a=a||{},this.action=new TD.vo.ActionFilter(a.action),this.content=new TD.vo.ContentFilter(a.content),this.engagement=new TD.vo.EngagementFilter(a.engagement),this.user=new TD.vo.UserFilter(a.user)},TD.vo.SearchFilter.prototype.getQueryString=function(){var a=[this.content.getQueryString(),this.engagement.getQueryString(),this.user.getQueryString()];return a.join(" ").trim()},TD.vo.SearchFilter.prototype.getFilters=function(){var a=this.action.getFilters();return a=a.concat(this.content.getFilters()),a=a.concat(this.engagement.getFilters()),a=a.concat(this.user.getFilters()),a},TD.vo.ActionFilter=function(a){this.fromJSONObject(a)},TD.vo.ActionFilter.prototype.showMentions=!0,TD.vo.ActionFilter.prototype.showRetweets=!0,TD.vo.ActionFilter.prototype.showFavorites=!0,TD.vo.ActionFilter.prototype.showFollowers=!0,TD.vo.ActionFilter.prototype.showLists=!0,TD.vo.ActionFilter.MAX_INTERACTION_FILTERS=6,TD.vo.ActionFilter.MAX_ACTIVITY_FILTERS=4,TD.vo.ActionFilter.prototype.setShowMentions=function(a){this.showMentions=Boolean(a)},TD.vo.ActionFilter.prototype.setShowRetweets=function(a){this.showRetweets=Boolean(a)},TD.vo.ActionFilter.prototype.setShowFavorites=function(a){this.showFavorites=Boolean(a)},TD.vo.ActionFilter.prototype.setShowFollowers=function(a){this.showFollowers=Boolean(a)},TD.vo.ActionFilter.prototype.setShowLists=function(a){this.showLists=Boolean(a)},TD.vo.ActionFilter.prototype.toJSONObject=function(){return{showMentions:this.showMentions,showRetweets:this.showRetweets,showFavorites:this.showFavorites,showFollowers:this.showFollowers,showLists:this.showLists}},TD.vo.ActionFilter.prototype.fromJSONObject=function(a){if(!a)return;this.setShowMentions(a.showMentions),this.setShowRetweets(a.showRetweets),this.setShowFavorites(a.showFavorites),this.setShowFollowers(a.showFollowers),this.setShowLists(a.showLists)},TD.vo.ActionFilter.prototype.getSummaryText=function(a){var b=[],c,d,e,f=a===TD.util.columnUtils.columnMetaTypes.ACTIVITY;f?e=TD.vo.ActionFilter.MAX_ACTIVITY_FILTERS:e=TD.vo.ActionFilter.MAX_INTERACTION_FILTERS;var g=this.getFilters();return g.length===e?c=TD.i("Filter error"):g.length===0?c=f?TD.i("All activity"):TD.i("All interactions"):g.length===1&&!f?this.showMentions?this.showRetweets?this.showFavorites?this.showFollowers?this.showLists||(c=TD.i("All except lists")):c=TD.i("All except followers"):c=TD.i("All except favorites"):c=TD.i("All except retweets"):c=TD.i("All except mentions"):(f||(this.showMentions&&b.push(TD.i("mentions")),this.showRetweets&&b.push(TD.i("retweets"))),this.showFavorites&&b.push(TD.i("favorites")),this.showFollowers&&b.push(TD.i("followers")),this.showLists&&b.push(TD.i("lists")),d=b.pop(),g.length===e-1||this.showLists&&g.length===e-2?c=TD.i("{{actionType}} only",{actionType:d}):(b=b.join(", "),c=TD.i("{{actionTypes}} and {{lastActionType}}",{actionTypes:b,lastActionType:d}))),c},TD.vo.ActionFilter.prototype.getFilters=function(){var a=[],b;return this.showMentions||(b=new TD.vo.Filter(TD.vo.Filter.CHIRP_TYPE,TD.services.TwitterAction.MENTION,!1),a.push(b)),this.showRetweets||(b=new TD.vo.Filter(TD.vo.Filter.CHIRP_TYPE,TD.services.TwitterAction.RETWEET,!1),a.push(b)),this.showFavorites||(b=new TD.vo.Filter(TD.vo.Filter.CHIRP_TYPE,TD.services.TwitterAction.FAVORITE,!1),a.push(b)),this.showFollowers||(b=new TD.vo.Filter(TD.vo.Filter.CHIRP_TYPE,TD.services.TwitterAction.FOLLOW,!1),a.push(b)),this.showLists||(b=new TD.vo.Filter(TD.vo.Filter.CHIRP_TYPE,TD.services.TwitterAction.LIST_CREATED,!1),a.push(b),b=new TD.vo.Filter(TD.vo.Filter.CHIRP_TYPE,TD.services.TwitterAction.LIST_MEMBER_ADDED,!1),a.push(b)),a},TD.vo.ContentFilter=function(a){this.fromJSONObject(a)},TD.vo.ContentFilter.TYPE_ANYTHING="anything",TD.vo.ContentFilter.TYPE_IMG="img",TD.vo.ContentFilter.TYPE_VID="vid",TD.vo.ContentFilter.TYPE_IMG_AND_VID="img_vid",TD.vo.ContentFilter.TYPE_LINKS="links",TD.vo.ContentFilter.LANG_ANY="any",TD.vo.ContentFilter.prototype.matching="",TD.vo.ContentFilter.prototype.excluding="",TD.vo.ContentFilter.prototype.type="anything",TD.vo.ContentFilter.prototype.lang="any",TD.vo.ContentFilter.prototype.includeRTs=!0,TD.vo.ContentFilter.prototype.setMatching=function(a){this.matching=a||""},TD.vo.ContentFilter.prototype.setExcluding=function(a){this.excluding=a||""},TD.vo.ContentFilter.prototype.setType=function(a){this.type=a||TD.vo.ContentFilter.TYPE_ANYTHING},TD.vo.ContentFilter.prototype.setLanguage=function(a){this.lang=a||TD.vo.ContentFilter.LANG_ANY},TD.vo.ContentFilter.prototype.setIncludeRTs=function(a){this.includeRTs=a===undefined?!0:Boolean(a)},TD.vo.ContentFilter.prototype.toJSONObject=function(){return{matching:this.matching,excluding:this.excluding,type:this.type,lang:this.lang,includeRTs:this.includeRTs}},TD.vo.ContentFilter.prototype.fromJSONObject=function(a){if(!a)return;this.setMatching(a.matching),this.setExcluding(a.excluding),this.setType(a.type),this.setLanguage(a.lang),this.setIncludeRTs(a.includeRTs)},TD.vo.ContentFilter.prototype.getQueryString=function(){var a=[];switch(this.type){case TD.vo.ContentFilter.TYPE_IMG:a.push("(filter:images)");break;case TD.vo.ContentFilter.TYPE_VID:a.push("(filter:videos)");break;case TD.vo.ContentFilter.TYPE_IMG_AND_VID:a.push("(filter:images OR filter:videos)");break;case TD.vo.ContentFilter.TYPE_LINKS:a.push("filter:links")}return this.lang!==TD.vo.ContentFilter.LANG_ANY&&a.push("lang:"+this.lang),this.includeRTs||a.push("exclude:nativeretweets exclude:retweets"),this.excluding&&a.push(this.getExcludingQuery()),a.join(" ")},TD.vo.ContentFilter.prototype.getSummaryText=function(){var a=[],b;switch(this.type){case TD.vo.ContentFilter.TYPE_IMG:a.push(TD.i("showing images"));break;case TD.vo.ContentFilter.TYPE_VID:a.push(TD.i("showing videos"));break;case TD.vo.ContentFilter.TYPE_IMG_AND_VID:a.push(TD.i("showing images and videos"));break;case TD.vo.ContentFilter.TYPE_LINKS:a.push(TD.i("showing links"))}this.matching&&a.push(TD.i("matching â{{{matching}}}â",{matching:this.matching})),this.excluding&&a.push(TD.i("excluding â{{{excluding}}}â",{excluding:this.excluding}));if(this.lang!==TD.vo.ContentFilter.LANG_ANY){var c=TD.languages.getLanguageFromISOCode(this.lang);a.push(TD.i("written in {{{lang}}}",{lang:c.localized_name}))}return this.includeRTs||a.push(TD.i("retweets excluded")),a.length===0?b=TD.i("any"):b=a.join(", "),b},TD.vo.ContentFilter.prototype.getExcludingQuery=function(){if(!this.excluding)return"";var a=TD.services.TwitterSearchParser.extractPhrases(this.excluding,!0);return a=a.map(function(a){return"-"+a}),a.join(" ")},TD.vo.ContentFilter.prototype.getFilters=function(){var a=[],b,c;switch(this.type){case TD.vo.ContentFilter.TYPE_IMG:b=new TD.vo.Filter(TD.vo.Filter.HAS_IMAGE,!0,!0),a.push(b);break;case TD.vo.ContentFilter.TYPE_VID:b=new TD.vo.Filter(TD.vo.Filter.HAS_VIDEO,!0,!0),a.push(b);break;case TD.vo.ContentFilter.TYPE_IMG_AND_VID:b=new TD.vo.Filter(TD.vo.Filter.HAS_MEDIA,!0,!0),a.push(b);break;case TD.vo.ContentFilter.TYPE_LINKS:b=new TD.vo.Filter(TD.vo.Filter.HAS_LINK,!0,!0),a.push(b)}return this.matching&&(c=TD.services.TwitterSearchParser.extractPhrases(this.matching,!1),c.forEach(function(c){b=new TD.vo.Filter(TD.vo.Filter.PHRASE,c,!0),a.push(b)})),this.excluding&&(c=TD.services.TwitterSearchParser.extractPhrases(this.excluding,!1),c.forEach(function(c){b=new TD.vo.Filter(TD.vo.Filter.PHRASE,c,!1),a.push(b)})),this.includeRTs||(b=new TD.vo.Filter(TD.vo.Filter.IS_RETWEET,!1,!0),a.push(b)),a},TD.vo.ContentFilter.prototype.hasActiveMediaFilter=function(){return[TD.vo.ContentFilter.TYPE_IMG,TD.vo.ContentFilter.TYPE_VID,TD.vo.ContentFilter.TYPE_IMG_AND_VID].indexOf(this.type)>-1},TD.vo.EngagementFilter=function(a){this.fromJSONObject(a)},TD.vo.EngagementFilter.prototype.minReplies=0,TD.vo.EngagementFilter.prototype.minRetweets=0,TD.vo.EngagementFilter.prototype.minFavorites=0,TD.vo.EngagementFilter.prototype.setMinReplies=function(a){this.minReplies=parseInt(a,10)},TD.vo.EngagementFilter.prototype.setMinRetweets=function(a){this.minRetweets=parseInt(a,10)},TD.vo.EngagementFilter.prototype.setMinFavorites=function(a){this.minFavorites=parseInt(a,10)},TD.vo.EngagementFilter.prototype.toJSONObject=function(){return{minReplies:this.minReplies,minRetweets:this.minRetweets,minFavorites:this.minFavorites}},TD.vo.EngagementFilter.prototype.fromJSONObject=function(a){if(!a)return;this.setMinReplies(a.minReplies),this.setMinRetweets(a.minRetweets),this.setMinFavorites(a.minFavorites)},TD.vo.EngagementFilter.prototype.getQueryString=function(){if(!TD.decider.get(TD.decider.ENGAGEMENT_FILTER))return"";var a=[];return this.minReplies>0&&a.push("min_replies:"+this.minReplies),this.minRetweets>0&&a.push("min_retweets:"+this.minRetweets),this.minFavorites>0&&a.push("min_faves:"+this.minFavorites),a.join(" ")},TD.vo.EngagementFilter.prototype.getSummaryText=function(){var a=[],b;this.minReplies>0&&a.push({count:this.minReplies,label:TD.i("replies")}),this.minRetweets>0&&a.push({count:this.minRetweets,label:TD.i("retweets")}),this.minFavorites>0&&a.push({count:this.minFavorites,label:TD.i("favorites")});switch(a.length){case 0:b=TD.i("any");break;case 1:b=TD.i("at least {{#0}}{{count}} {{label}}{{/0}}",a);break;case 2:b=TD.i("at least {{#0}}{{count}} {{label}}{{/0}} and {{#1}}{{count}} {{label}}{{/1}}",a);break;case 3:b=TD.i("at least {{#0}}{{count}} {{label}}{{/0}}, {{#1}}{{count}} {{label}}{{/1}} and {{#2}}{{count}} {{label}}{{/2}}",a)}return b},TD.vo.EngagementFilter.prototype.getFilters=function(){return[]},TD.vo.UserFilter=function(a){this.fromJSONObject(a)},TD.vo.UserFilter.FROM_ALL="all",TD.vo.UserFilter.FROM_USER="user",TD.vo.UserFilter.FROM_VERIFIED="verified",TD.vo.UserFilter.FROM_LIST="list",TD.vo.UserFilter.prototype.from_type=null,TD.vo.UserFilter.prototype.from_name=null,TD.vo.UserFilter.prototype.mention_name=null,TD.vo.UserFilter.prototype.setFrom=function(a,b){if(!b||a===TD.vo.UserFilter.FROM_VERIFIED||a===TD.vo.UserFilter.FROM_ALL)b="";this.from_type=a,this.from_name=TD.util.deMentionify(b)},TD.vo.UserFilter.prototype.setMentioned=function(a){this.mention_name=a||"",this.mention_name=TD.util.deMentionify(this.mention_name)},TD.vo.UserFilter.prototype.toJSONObject=function(){return{from_type:this.from_type,from_name:this.from_name,mention_name:this.mention_name}},TD.vo.UserFilter.prototype.fromJSONObject=function(a){if(!a)return;this.setFrom(a.from_type,a.from_name),this.setMentioned(a.mention_name)},TD.vo.UserFilter.prototype.getQueryString=function(){var a=[];switch(this.from_type){case TD.vo.UserFilter.FROM_USER:a.push("from:"+this.from_name);break;case TD.vo.UserFilter.FROM_VERIFIED:a.push("filter:verified");break;case TD.vo.UserFilter.FROM_LIST:a.push("list:"+this.from_name)}return this.mention_name&&a.push("@"+this.mention_name),a.join(" ")},TD.vo.UserFilter.prototype.getSummaryText=function(){var a=[],b;switch(this.from_type){case TD.vo.UserFilter.FROM_USER:b=TD.storage.accountController.getAccountFromUsername(this.from_name).length>0,b?a.push(TD.i("by me (@{{{name}}})",{name:this.from_name})):a.push(TD.i("by @{{{name}}}",{name:this.from_name}));break;case TD.vo.UserFilter.FROM_VERIFIED:a.push(TD.i("by verified users"));break;case TD.vo.UserFilter.FROM_LIST:a.push(TD.i("by members of @{{{name}}}",{name:this.from_name}))}return this.mention_name&&(b=TD.storage.accountController.getAccountFromUsername(this.mention_name).length>0,b?a.push(TD.i("mentioning me (@{{{name}}})",{name:this.mention_name})):a.push(TD.i("mentioning @{{{name}}}",{name:this.mention_name}))),a.length===0&&a.push(TD.i("any")),a.join(", ")},TD.vo.UserFilter.prototype.getFilters=function(){var a=[],b;this.mention_name&&(b=new TD.vo.Filter(TD.vo.Filter.PHRASE,TD.util.atMentionify(this.mention_name),!0),a.push(b));switch(this.from_type){case TD.vo.UserFilter.FROM_USER:b=new TD.vo.Filter(TD.vo.Filter.SENDER,this.from_name,!0),a.push(b);break;case TD.vo.UserFilter.FROM_VERIFIED:b=new TD.vo.Filter(TD.vo.Filter.IS_FROM_VERIFIED,!0,!0),a.push(b)}return a},TD.util.columnUtils=function(){var a={};return a.storageColumnTypes={OTHER:"other",HOME:"home",ME:"me",INBOX:"privateMe",SCHEDULED:"scheduled"},a.feedTypes={HOME:"home",USERTIMELINE:"usertimeline",INTERACTIONS:"interactions",MENTIONS:"mentions",SEARCH:"search",LIST:"list",DIRECT:"direct",USERTWEETS:"usertweets",FAVORITES:"favorites",NETWORKACTIVITY:"networkactivity"},a.columnMetaTypes={TIMELINE:"col_timeline",INTERACTIONS:"col_interactions",MENTIONS:"col_mentions",FOLLOWERS:"col_followers",SEARCH:"col_search",LIST:"col_list",MESSAGES:"col_messages",USERTWEETS:"col_usertweets",FAVORITES:"col_favorites",ACTIVITY:"col_activity",HOME:"col_home",ME:"col_me",INBOX:"col_inbox",SCHEDULED:"col_scheduled",UNKNOWN:"col_unknown"},a.columnMetaTypeToScribeNamespace={},TD.util.extendObjectWith(a.columnMetaTypeToScribeNamespace,[[a.columnMetaTypes.TIMELINE,{page:"home",section:""}],[a.columnMetaTypes.INTERACTIONS,{page:"connect",section:"activity"}],[a.columnMetaTypes.MENTIONS,{page:"connect",section:"mentions"}],[a.columnMetaTypes.SEARCH,{page:"search",section:"tweets"}],[a.columnMetaTypes.LIST,{page:"list",section:"tweets"}],[a.columnMetaTypes.USERTWEETS,{page:"profile_tweets",section:""}],[a.columnMetaTypes.FAVORITES,{page:"favorites",section:""}],[a.columnMetaTypes.ACTIVITY,{page:"network_activity",section:""}],[a.columnMetaTypes.HOME,{page:"home",section:""}],[a.columnMetaTypes.ME,{page:"connect",section:"mentions"}]]),a.columnIconClasses={TWITTER:"icon-twitter",HOME:"icon-home",INTERACTIONS:"icon-interactions",ACTIVITY:"icon-activity",MENTIONS:"icon-mention",FOLLOWERS:"icon-new-followers",MESSAGES:"icon-message",SEARCH:"icon-search",LIST:"icon-list",TWEETS:"icon-tweets",FAVORITES:"icon-favorite",SCHEDULED:"icon-scheduled",TRENDS:"icon-trends"},a.columnMetaTypeToIconClass={},TD.util.extendObjectWith(a.columnMetaTypeToIconClass,[[a.columnMetaTypes.TIMELINE,a.columnIconClasses.HOME],[a.columnMetaTypes.INTERACTIONS,a.columnIconClasses.INTERACTIONS],[a.columnMetaTypes.MENTIONS,a.columnIconClasses.MENTIONS],[a.columnMetaTypes.FOLLOWERS,a.columnIconClasses.FOLLOWERS],[a.columnMetaTypes.SEARCH,a.columnIconClasses.SEARCH],[a.columnMetaTypes.LIST,a.columnIconClasses.LIST],[a.columnMetaTypes.MESSAGES,a.columnIconClasses.MESSAGES],[a.columnMetaTypes.USERTWEETS,a.columnIconClasses.TWEETS],[a.columnMetaTypes.FAVORITES,a.columnIconClasses.FAVORITES],[a.columnMetaTypes.ACTIVITY,a.columnIconClasses.ACTIVITY],[a.columnMetaTypes.HOME,a.columnIconClasses.HOME],[a.columnMetaTypes.ME,a.columnIconClasses.MENTIONS],[a.columnMetaTypes.INBOX,a.columnIconClasses.MESSAGES],[a.columnMetaTypes.SCHEDULED,a.columnIconClasses.SCHEDULED],[a.columnMetaTypes.UNKNOWN,a.columnIconClasses.TWITTER]]),a.columnMetaTypeToTitleTemplateData={},TD.util.extendObjectWith(a.columnMetaTypeToTitleTemplateData,[[a.columnMetaTypes.TIMELINE,{title:TD.i("Timeline",null,!0),needsUserAttribution:!0}],[a.columnMetaTypes.INTERACTIONS,{title:TD.i("Interactions",null,!0),needsUserAttribution:!0}],[a.columnMetaTypes.MENTIONS,{title:TD.i("Mentions",null,!0),needsUserAttribution:!0}],[a.columnMetaTypes.FOLLOWERS,{title:TD.i("Followers",null,!0),needsUserAttribution:!0}],[a.columnMetaTypes.SEARCH,{needsUserAttribution:!0}],[a.columnMetaTypes.LIST,{needsUserAttribution:!0}],[a.columnMetaTypes.MESSAGES,{title:TD.i("Messages",null,!0),needsUserAttribution:!0}],[a.columnMetaTypes.USERTWEETS,{title:TD.i("Tweets",null,!0),needsUserAttribution:!0}],[a.columnMetaTypes.FAVORITES,{title:TD.i("Favorites",null,!0),needsUserAttribution:!0}],[a.columnMetaTypes.ACTIVITY,{title:TD.i("Activity",null,!0),needsUserAttribution:!0}],[a.columnMetaTypes.HOME,{title:TD.i("Home",null,!0)}],[a.columnMetaTypes.ME,{title:TD.i("Me",null,!0)}],[a.columnMetaTypes.INBOX,{title:TD.i("Inbox",null,!0)}],[a.columnMetaTypes.SCHEDULED,{title:TD.i("Scheduled",null,!0),needsUserAttribution:!0}],[a.columnMetaTypes.UNKNOWN,{title:TD.i("Custom Column",null,!0)}]]),a.embeddableColumnTypes=[a.columnMetaTypes.FAVORITES,a.columnMetaTypes.USERTWEETS,a.columnMetaTypes.SEARCH,a.columnMetaTypes.LIST],a.filterableColumnTypes=[a.columnMetaTypes.TIMELINE,a.columnMetaTypes.INTERACTIONS,a.columnMetaTypes.MENTIONS,a.columnMetaTypes.FOLLOWERS,a.columnMetaTypes.SEARCH,a.columnMetaTypes.LIST,a.columnMetaTypes.MESSAGES,a.columnMetaTypes.USERTWEETS,a.columnMetaTypes.FAVORITES,a.columnMetaTypes.ACTIVITY,a.columnMetaTypes.HOME,a.columnMetaTypes.ME,a.columnMetaTypes.INBOX,a.columnMetaTypes.SCHEDULED],a.actionColumnTypes=[a.columnMetaTypes.INTERACTIONS,a.columnMetaTypes.MENTIONS,a.columnMetaTypes.ACTIVITY,a.columnMetaTypes.FOLLOWERS],a.singleActionColumnTypes=[a.columnMetaTypes.MENTIONS,a.columnMetaTypes.FOLLOWERS],a.mediaPreviewableColumnTypes=[a.columnMetaTypes.TIMELINE,a.columnMetaTypes.INTERACTIONS,a.columnMetaTypes.MENTIONS,a.columnMetaTypes.SEARCH,a.columnMetaTypes.LIST,a.columnMetaTypes.USERTWEETS,a.columnMetaTypes.FAVORITES,a.columnMetaTypes.ACTIVITY,a.columnMetaTypes.HOME,a.columnMetaTypes.ME],a.getColumnType=function(b){var c=b.model.getType(),d=b.getFeeds();switch(c){case a.storageColumnTypes.HOME:return a.columnMetaTypes.HOME;case a.storageColumnTypes.ME:return a.columnMetaTypes.ME;case a.storageColumnTypes.INBOX:return a.columnMetaTypes.INBOX;case a.storageColumnTypes.SCHEDULED:return a.columnMetaTypes.SCHEDULED;default:return d.length===1?a._inferColumnTypeFromFeed(d[0],b):a.columnMetaTypes.UNKNOWN}},a.isMessageColumn=function(b){var c=a.getColumnType(b);return c===a.columnMetaTypes.MESSAGES},a._twitterFeedTypeToColumnMetaType={},TD.util.extendObjectWith(a._twitterFeedTypeToColumnMetaType,[[a.feedTypes.HOME,a.columnMetaTypes.TIMELINE],[a.feedTypes.USERTIMELINE,a.columnMetaTypes.TIMELINE],[a.feedTypes.INTERACTIONS,a.columnMetaTypes.INTERACTIONS],[a.feedTypes.MENTIONS,a.columnMetaTypes.MENTIONS],[a.feedTypes.SEARCH,a.columnMetaTypes.SEARCH],[a.feedTypes.LIST,a.columnMetaTypes.LIST],[a.feedTypes.DIRECT,a.columnMetaTypes.MESSAGES],[a.feedTypes.USERTWEETS,a.columnMetaTypes.USERTWEETS],[a.feedTypes.FAVORITES,a.columnMetaTypes.FAVORITES],[a.feedTypes.NETWORKACTIVITY,a.columnMetaTypes.ACTIVITY]]),a._inferColumnTypeFromFeed=function(b,c){var d=b.getService(),e=b.getType(),f=b.getMetadata(),g,h,i,j=a.columnMetaTypes.UNKNOWN;if(d==="twitter"){j=a._twitterFeedTypeToColumnMetaType[e]||j;switch(e){case a.feedTypes.SEARCH:var k=twttr.txt.extractMentionsWithIndices(f.term);if(k.length===1){var l=k[0];l.indices[0]===0&&l.indices[1]===f.term.length&&(j=a.columnMetaTypes.MENTIONS)}break;case a.feedTypes.INTERACTIONS:g=c.model.getFilters(),g&&(h=new TD.vo.ActionFilter(g.action),i=TD.vo.ActionFilter.MAX_INTERACTION_FILTERS,h.getFilters().length===i-1&&h.showFollowers&&(j=a.columnMetaTypes.FOLLOWERS))}}return j},a.getColumnIconClassByColumnType=function(b){return a.columnMetaTypeToIconClass[b]},a.getColumnTitleHTML=function(b){var c=!1,d=b.getColumnType(),e=b.getFeeds(),f=b.model.getTitle(),g,h,i,j,k,l=a.columnMetaTypeToTitleTemplateData[d],m={},n,o,p;for(var q=0;q<e.length;q++){g=e[q],h=g.getType(),i=g.getMetadata();if(i)switch(h){case a.feedTypes.LIST:n=TD.cache.names.getScreenName(i.ownerId),p=TD.cache.names.getListName(i.listId,i.ownerId),p?m.title=p:c=!0;break;case a.feedTypes.SEARCH:d===a.columnMetaTypes.MENTIONS?n=i.term:i.baseQuery?o=i.baseQuery:o=i.term;if(o)m.title=o,o.indexOf('"')===-1&&(m.quote=!0);else c:!0;break;default:i.id?(n=TD.cache.names.getScreenName(i.id),n||(c=!0)):d===a.columnMetaTypes.SCHEDULED&&(n=TD.i("All accounts")),m.title=l.title}n||(j=TD.storage.accountController.get(g.getAccountKey()),k=j.getType(),k!=="tweetdeck"&&(n=j.getUsername(),k==="twitter"&&(n=TD.util.atMentionify(n))))}return l.needsUserAttribution&&(n?(m.needsUserAttribution=l.needsUserAttribution,m.screenName=n):c=!0),c?TD.util.escape(f):d===a.columnMetaTypes.UNKNOWN?f?TD.util.escape(f):TD.ui.template.render("column_title",m):TD.ui.template.render("column_title",m)},a.inferFeedTypeFromActionFilter=function(a){var b=this.feedTypes.INTERACTIONS;return a.getFilters().length===TD.vo.ActionFilter.MAX_INTERACTION_FILTERS-1&&a.showMentions&&(b=this.feedTypes.MENTIONS),b},a}(),TD.cache.lists=function(){function c(b){var c=a[b]||{};return a[b]=c,c}var a={},b={};return b.add=function(a){var b=c(a.account.getKey());b[a.id]=a,TD.controller.feedManager.fixListFeeds(),TD.cache.names.updateScreenName(a.user.id,a.user.screenName),TD.cache.names.updateListName(a.id,a.name)},b.unsubscribe=function(a){var b=c(a.account.getKey());delete b[a.id]},b.purge=function(b){var c;_.each(a,function(a,d){c=c||a[b],delete a[b]});if(c){var d=TD.storage.Feed.generateKeyFor(c.account.getKey(),"list",{listId:b});TD.controller.feedManager.deleteFeedsWhere(function(a){return a.getKey()===d})}},b.getListsFor=function(a){return _.values(c(a))},b.find=function(b,c,d,e,f){var g,h=undefined,i=undefined;return c&&d&&(g="@"+c.toLowerCase()+"/"+d.toLowerCase()),_.each(a,function(a,c){if(f&&f!==c)return;_.each(a,function(a,c){if(b&&a.id===b||a.fullName.toLowerCase()===g)a.isOwnList()?h=a:i=a})}),e?h:h||i},b.getAll=function(){var b={};return _.each(a,function(a,c){_.extend(b,a)}),_.values(b)},b}(),TD.cache.LRUQueue=klass(function(a){this.maxSize=a,this.length=0,this._first=undefined,this._last=undefined,this._index={},this._lefts={},this._rights={}}).methods({enqueue:function(a,b){this.dequeue(a),this.length==0?this._first=this._last=a:(this._lefts[this._first]=a,this._rights[a]=this._first,this._first=a),this._index[a]=b,this.length++,this.prune()},dequeue:function(a){if(_.isUndefined(this._index[a]))return;var b=this._lefts[a],c=this._rights[a];b?this._rights[b]=c:this._first=c,c?this._lefts[c]=b:this._last=b,delete this._index[a],delete this._rights[a],delete this._lefts[a],this.length--},prune:function(){while(this.maxSize&&this.length>this.maxSize)this.dequeue(this._last)},get:function(a){return this._index[a]},take:function(a){var b=[],c=this._first;a=Math.min(a,this.length);for(var d=0;d<a;d++)b.push(this._index[c]),c=this._rights[c];return b}}),TD.cache.names=function(){return self={SECONDS_IN_ONE_WEEK:604800,_cache:null},self.init=function(){self._cache=TD.settings.getNameCache(),$.subscribe("/storage/client/column_order_changed",function(){self.prune(),self.commit()}),$.subscribe("/storage/column/feeds_changed",function(a,b,c){var d=TD.storage.columnController.get(c.getKey());d&&!d.temporary&&self.commit()})},self.getScreenName=function(a){var b,c,d=TD.util.unixTime(new Date),e=TD.storage.Account.generateKeyFor("twitter",a),f=TD.storage.accountController.get(e);return f?(c=TD.util.atMentionify(f.getUsername()),self.addScreenName(a,c)):(b=self._cache.users[a],b&&(c=b.name),(!b||b.timestamp+self.SECONDS_IN_ONE_WEEK<d)&&self._fetchUser(a)),c},self.getListName=function(a,b){var c,d,e=TD.util.unixTime(new Date),f=TD.cache.lists.find(a,"","");return f?(c=f.name,self.addListName(a,c)):(d=self._cache.lists[a],d&&(c=d.name),(!d||d.timestamp+self.SECONDS_IN_ONE_WEEK<e)&&self._fetchList(a,b)),c},self.addScreenName=function(a,b){if(!self._cache)return;var c=self._cache.users[a]||{},d=TD.util.atMentionify(b),e=d!==c.name;c.name=d,c.timestamp=TD.util.unixTime(new Date),self._cache.users[a]=c,self.commit(),e&&TD.storage.notification.notify("/cache/names/change")},self.addListName=function(a,b){if(!self._cache)return;var c=self._cache.lists[a]||{},d=b!==c.name;c.name=b,c.timestamp=TD.util.unixTime(new Date),self._cache.lists[a]=c,self.commit(),d&&TD.storage.notification.notify("/cache/names/change")},self.updateScreenName=function(a,b){if(!self._cache)return;var c=self._cache.users[a];c&&self.addScreenName(a,b)},self.updateListName=function(a,b){if(!self._cache)return;var c=self._cache.lists[a];c&&self.addScreenName(a,b)},self._fetchUser=function(a){var b=TD.cache.twitterUsers.getById(a);b.addCallback(function(b){self.addScreenName(a,b.screenName)})},self._fetchList=function(a,b){var c=TD.storage.Account.generateKeyFor("twitter",b),d=TD.controller.clients.getClient(c);d=d||TD.controller.clients.getPreferredClient("twitter"),d.getList(a,null,null,function(b){self.addListName(a,b.name)})},self.commit=_.debounce(function(){TD.settings.setNameCache(self._getPrunedCache())},100),self.prune=function(){self._cache=self._getPrunedCache()},self._getPrunedCache=function(){var a={users:{},lists:{}},b=TD.storage.feedController.getAll();return _.each(b,function(b){var c=b.getMetadata();if(c){var d=c.id||c.ownerId;d&&self._cache.users[d]&&(a.users[d]=self._cache.users[d]);var e=c.listId;e&&self._cache.lists[e]&&(a.lists[e]=self._cache.lists[e])}}),a},self}(),TD.cache.twitterUsers=function(){function f(){_.each(d.splice(e),function(a){delete b[a.id],delete c[a.screenName.toLowerCase()]})}function g(a,d){var e=this,f,g,h,i;return a||d?(a?f=b[a]:f=c[d.toLowerCase()],f?i=TD.core.defer.succeed(f):(g=TD.storage.accountController.getPreferredAccount("twitter"),h=TD.controller.clients.getClient(g.getKey()),i=new TD.core.defer.Deferred,h.showUser(a,d,function(a){i.callback(a)},function(b,c,e){i.errback(new TD.core.defer.XMLHttpRequestError(b,e)),b&&b.errors&&b.errors.forEach(function(b){b===h.ERRORS.SUSPENDED_USER&&$.publish("/user/suspended",[a,d])})}))):i=TD.core.defer.fail("Must provide user ID or screen name"),i}var a={},b={},c={},d=[],e=500;return a.add=function(a){var e=b[a.id];e?delete c[e.screenName.toLowerCase()]:d.unshift(a),b[a.id]=a,c[a.screenName.toLowerCase()]=a,f()},a.getById=function(a){return g(a,null)},a.getByScreenName=function(a){return g(null,a)},a}(),TD.controller.clients=function(){var a={},b=function(a,b){switch(a){case"twitter":return new TD.services.TwitterClient(b);case"tweetdeck":return new TD.services.TweetDeckClient}};return{init:function(){$.subscribe("/storage/account/new",function(a){TD.controller.clients.initialiseClients()}),TD.controller.clients.initialiseClients()},initialiseClients:function(){var c,d=TD.storage.accountController.getPostingAccounts();for(var e=0;e<d.length;e++)c=a[d[e].getKey()],c||(c=b(d[e].getType(),d[e]),a[d[e].getKey()]=c);a.tweetdeck||(a.tweetdeck=new TD.services.TweetDeckClient),TD.controller.scheduler.schedulePeriodicTask(1200,TD.controller.clients.refreshRetweetBlockLists)},getClient:function(b){return a[b]},getTDClient:function(){return a.tweetdeck},getClientsByService:function(b){var c=[];for(var d in a)a[d].type==b&&c.push(a[d]);return c},getPreferredClient:function(a){var b=TD.storage.accountController.getPreferredAccount(a);return b?this.getClient(b.getKey()):undefined},addClient:function(a,b,c){var d=this,e,f,g=function(){TD.storage.accountController.manage(b),d.initialiseClients();return},h=this.getClientsByService(a).length>0;b?c?(f=TD.controller.auth.create(a,b),f.start(b,g,h)):g():(b=new TD.storage.Account,b.setType(a),f=TD.controller.auth.create(a,b),f.start(b,g,h))},removeClient:function(b){var c=TD.storage.accountController.get(b);a[b]&&a[b].cleanUp&&a[b].cleanUp(),delete a[b],TD.controller.feedManager.deleteFeedsWhere(function(a){return a.getAccountKey()===b}),TD.storage.accountController.blacklistAccount(c)},refreshRetweetBlockLists:function(){if(!TD.util.shouldStream())return;var a=TD.controller.clients.getClientsByService("twitter");_.each(a,function(a){a.populateRetweetBlockList()})}}}(),TD.controller.scheduler=function(){var a={};return a.QUERY_INTERVAL=10,a.SLEEP_THRESHOLD=20,a._tickInterval,a._tasks={},a._lastTickTime=null,a.init=function(){this._tickInterval=setInterval(this._handleTick,this.QUERY_INTERVAL*1e3),a._lastTickTime=Date.now(),this._jQueryCleanupTaskId=TD.controller.scheduler.schedulePeriodicTask(600,function(){jQuery.fragments={}}),TD.controller.feedScheduler.init()},a._handleTick=function(){var b=Date.now(),c=(b-a._lastTickTime)/1e3-a.QUERY_INTERVAL;a._lastTickTime=b,c>a.SLEEP_THRESHOLD&&$(document).trigger("dataAppWokenFromSleep",{lateness:c}),_.each(a._tasks,function(c){var d=b-c.cycleStartTime;d>c.period&&(a._fireTask(c),c.cycleStartTime=Date.now())})},a._fireTask=function(a){try{a.callback()}catch(b){console.log("Error in periodic task:",a,"Error:",b)}},a.schedulePeriodicTask=function(a,b,c){var d={id:_.uniqueId("sched_task_"),callback:b,period:a*1e3,cycleStartTime:Date.now()};return c&&this._fireTask(d),this._tasks[d.id]=d,d.id},a.updatePeriodicTask=function(a,b,c){var d=this._tasks[a];d&&(d.period=b*1e3,d.callback=c||d.callback)},a.restartPeriodicTask=function(a){var b=this._tasks[a];b&&(b.cycleStartTime=Date.now())},a.removePeriodicTask=function(a){delete this._tasks[a]},a}(),TD.controller.feedScheduler=function(){var a={};return a.DEFAULT_REFRESH_PERIOD=45,a._activeColumns={},a._temporaryColumns={},a._taskIndex={},a.init=function(){this._refreshTaskId=TD.controller.scheduler.schedulePeriodicTask(45,this._trimColumns.bind(this),!1),this._streamingTaskId=TD.controller.scheduler.schedulePeriodicTask(120,this._startStreams.bind(this),!1),$.subscribe("/storage/column/feeds_changed",function(b,c,d){var e=d.getKey(),f=TD.controller.columnManager.get(e);a.addColumn(f,!f.temporary)}),$.subscribe("/storage/column/change",function(b){var c=b.getKey(),d=TD.controller.columnManager.get(c),e=d.model.getFeedKeys(),f=b.getFeedKeys();_.isEqual(e,f)||a.addColumn(d,!d.temporary)}),$(document).on("dataRateLimit",this._handleRateLimitData.bind(this)),$(document).on("dataUserStreamStatus",this._handleStreamStatus.bind(this)),$(document).on("dataAppWokenFromSleep",this._handleAppWoken.bind(this))},a._getTask=function(a,b){if(this._taskIndex[a])return this._taskIndex[a][b]},a._setTask=function(a,b,c){this._taskIndex[a]=this._taskIndex[a]||{},this._taskIndex[a][b]=c},a._handleRateLimitData=function(a,b){var c=this._getTask(b.accountKey,b.feedType);c&&(c.rateLimitData=b.rateLimitData,this._setPeriodicTask(c))},a._handleStreamStatus=function(b,c){var d=this._taskIndex[c.accountKey];_.each(d,a._setPeriodicTask.bind(this))},a._handleAppWoken=function(a,b){_.each(this._taskIndex,function(a){_.each(a,function(a){a.doTask(!0,!0),TD.controller.scheduler.restartPeriodicTask(a.taskId)})}),TD.controller.stats.appWokenFromSleep(b.lateness)},a.addColumn=function(a,b){var c,d=a.getFeeds(),e=a.model.getKey();this._activeColumns[e]&&this.removeColumn(e),this._activeColumns[e]=a,a.temporary&&(this._temporaryColumns[e]=a);for(var f=0;f<d.length;f++)c=TD.controller.feedManager.addFeed(d[f]),c.publishChirpsOrFetch(),this._addFeed(d[f]);b&&this._startStreams()},a._addFeed=function(a){var b=a.getAccountKey(),c=a.getType(),d=a.getKey(),e;e=this._getTask(b,c)||{accountKey:b,feedType:c,feeds:{},taskId:null,rateLimitData:null,doTask:null},e.doTask||(e.doTask=this._doTaskFactory(e)),this._setTask(b,c,e),e.feeds[d]=a,this._setPeriodicTask(e)},a._setPeriodicTask=function(a){var b=this._calculatePeriod(a);a.taskId?TD.controller.scheduler.updatePeriodicTask(a.taskId,b):a.taskId=TD.controller.scheduler.schedulePeriodicTask(b,a.doTask,!1)},a._doTaskFactory=function(b){return function(c,d){var e=_.map(b.feeds,function(b,e){return a._refreshFeed(e,c,d)});return TD.core.defer.gatherResults(e)}},a._calculatePeriod=function(b){var c=this.DEFAULT_REFRESH_PERIOD,d,e,f,g,h,i,j;return b.rateLimitData&&(d=b.rateLimitData.rateLimitRemaining-10,e=b.rateLimitData.rateLimitTotal,f=b.rateLimitData.rateLimitReset+10,g=Date.now()/1e3,h=f-g,j=_.filter(b.feeds,function(b){var c=b.getKey(),d=Boolean(_.some(a._temporaryColumns,function(a){return a.model.getFeedKeys().indexOf(c)!==-1}));return d||!TD.controller.feedManager.isStreaming(c)}),h>0&&d>0&&j.length>0?(i=d/j.length,c=h/i,c=Math.min(c,h)):h<=0?c=this.DEFAULT_REFRESH_PERIOD:c=h),c=Math.round(c),c=Math.max(c,10),c=Math.min(c,900),c},a._refreshFeed=function(a,b,c){var b=b||Boolean(_.some(this._temporaryColumns,function(b){return b.model.getFeedKeys().indexOf(a)!==-1})),d=TD.controller.feedManager.getPoller(a);return c&&d.removeAll(),d.refresh(b,c)},a.removeColumn=function(a){delete this._activeColumns[a],delete this._temporaryColumns[a],this._rebuildTaskIndex(),TD.controller.feedManager.cleanupFeeds()},a._rebuildTaskIndex=function(){_.each(this._taskIndex,function(a){_.each(a,function(a){a.feeds={}})}),_.each(this._activeColumns,function(b){_.each(b.getFeeds(),function(b){a._addFeed(b)})}),_.each(this._taskIndex,function(a){_.each(a,function(a){_.isEmpty(a.feeds)&&(TD.controller.scheduler.removePeriodicTask(a.taskId),a.taskId=null)})})},a.refreshColumn=function(a){var b=this._activeColumns[a],c;if(b){c=b.getFeeds();for(var d=0;d<c.length;d++)this._refreshFeed(c[d].getKey())}},a.refreshAccountFeeds=function(a,b){_.each(this._taskIndex[a],function(a){a.doTask(b)})},a._startStreams=function(){var a=TD.storage.accountController.getAccountsForService("twitter");for(var b=0;b<a.length;b++)TD.controller.clients.getClient(a[b].getKey()).checkUserStream()},a._trimColumns=function(){_.each(this._activeColumns,function(a,b){a.trimUpdates()})},a}(),TD.controller.FeedPoller=function(a){var b=this;this.OPTIMUM_ARRAY_LENGTH=200,this.CLEANUP_WAIT_PERIOD=12e4,this.TWEET_ID_QUEUE_LENGTH=500,this.feed=a,this.mark="",this.chirpArray=[],this.chirpIndex={},this.seenTweetIDs=new TD.cache.LRUQueue(this.TWEET_ID_QUEUE_LENGTH),this.refreshLock=0,this.REFRESH_LOCK_EXPIRY=6e4,this.isExhausted=!1,this.lastInfiniteScrollTime=0,this.shouldSetLatestTime=!1,this._checkNotifications=function(){var b=this;this.shouldSetLatestTime=!1;if(this.feed.getService()==="twitter"&&this.feed.getType()==="direct")this.shouldSetLatestTime=!0;else{var c=TD.storage.columnController.getColumnsContainingFeed(a.getKey());this.shouldSetLatestTime=Boolean(_.find(c,function(a){return a.getHasSound()||a.getHasNotification()}))}};var c=function(b,c,d){if(b!=="has_notification"&&b!=="has_sound")return;d&&_.include(d.getFeedKeys(),a.getKey())&&this._checkNotifications()};this.subscription=$.subscribe("/storage/column/column_flags_changed",_.bind(c,this)),this._checkNotifications(),this.reorderChirp=function(a){var b=this.chirpIndex[a];b&&(this.removeChirp(a),this.acceptChirps([b]))},this.sortFunction=function(a,b){return b.created.getTime()-a.created.getTime()},this.removeChirp=function(a){var b=this.chirpIndex[a],c;if(b){for(var d=0;d<this.chirpArray.length;d++){c=this.chirpArray[d];if(c===b){this.chirpArray.splice(d,1);break}}delete this.chirpIndex[a],$.publish("/delete/"+this.feed.getKey(),[this,[b]])}},this.removeWhere=function(a){var b=_.filter(this.chirpArray,a),c=b.length;while(c--)this.removeChirp(b[c].id)},this.removeAll=function(){var a=this.chirpArray.length;while(a--)this.removeChirp(this.chirpArray[a].id)},this.getRangeStartTime=function(){var a,b,c=Number.MAX_VALUE,d=this.feed;return this.isExhausted?0:d.getService()==="twitter"&&d.getType()==="direct"?0:d.getService()==="tweetdeck"?0:(a=this.getOldestChirp(),a?a.created.getTime():0)},this.acceptChirps=function(b){var c;if(b){c=this.addChirpsToMemCache(b),this.publishChirps(c);var d=0;for(var e=0;e<c.length;e++)d=Math.max(d,c[e].created.getTime());this.shouldSetLatestTime&&a.setLatestTime(Math.max(a.getLatestTime(),d))}},this.refresh=function(a,b){var c=this,d=this.feed,e=c.chirpArray,f=(new Date).getTime();if(!(!this.refreshLock||f>this.refreshLock+this.REFRESH_LOCK_EXPIRY))return TD.core.defer.succeed();var g=TD.controller.clients.getClient(d.getAccountKey());if(!g)return TD.core.defer.fail();this.refreshLock=f;try{var h=new TD.core.defer.Deferred;return h.addCallback(function(a){c.refreshLock=0,c.acceptChirps(a)}),h.addErrback(function(){c.refreshLock=0}),g.refreshFeed(this,!1,_.bind(h.callback,h),_.bind(h.errback,h),a,b),h}catch(i){return console.log("Error refreshing",this,":",i),this.refreshLock=0,TD.core.defer.fail()}},this.publishChirpsOrFetch=function(){this.chirpArray&&this.chirpArray.length?this.publishAll():this.refresh()},this.getOldestChirp=function(){return this.chirpArray[this.chirpArray.length-1]},this.addChirpsToMemCache=function(a){var b,c,d=[],e=[],f,g,h,i;for(b=0;b<a.length;b++)c=a[b],f=this.chirpIndex[c.id],g=this.isRepeatedRetweet(c),f?f.update(c)&&e.push(f):g||(d.push(c),e.push(c),this.chirpIndex[c.id]=c);return d.sort(TD.util.chirpDescSort),this.chirpArray.length&&d.length&&(h=this.chirpArray[0].created.getTime(),i=d[d.length-1].created.getTime()),this.chirpArray=d.concat(this.chirpArray),h&&i&&i<h&&this.chirpArray.sort(TD.util.chirpDescSort),e},this.isRepeatedRetweet=function(a){var b=!1,c,d;return a instanceof TD.services.TwitterStatus&&(c=a.getMainTweet().id,d=this.seenTweetIDs.get(c)||0,b=a.isRetweetedStatus()&&d>0,this.seenTweetIDs.enqueue(c,d+1)),b},this.fetchOlderChirps=function(a){this.lastInfiniteScrollTime=(new Date).getTime();var b=this,c=b.feed,d=new TD.core.defer.Deferred;this.feed.getService()==="tweetdeck"&&(this.isExhausted=!0);if(this.getRangeStartTime()<a)d.callback(this.chirpArray);else{var e=TD.controller.clients.getClient(c.getAccountKey());e.refreshFeed(this,!0,function(a){b.addChirpsToMemCache(a),a.length===0&&(b.isExhausted=!0),d.callback(b.chirpArray)},function(a){d.errback(a)})}return d},this.trimChirps=function(){if(this.chirpArray.length<this.OPTIMUM_ARRAY_LENGTH)return;var a=(new Date).getTime()-this.lastInfiniteScrollTime;if(a<this.CLEANUP_WAIT_PERIOD)return;var b=this.chirpArray.splice(this.OPTIMUM_ARRAY_LENGTH,Number.MAX_VALUE);for(var c=0;c<b.length;c++)delete this.chirpIndex[b[c].id];this.isExhausted=!1},this.addChirps=function(a){var b=this.addChirpsToMemCache(a);this.publishChirps(b)},this.publishAll=function(){this.publishChirps(this.chirpArray)},this.publishChirps=function(a){$.publish("/feed/"+this.feed.getKey(),[this,a,this.feed.getLatestTime()])},this.destroy=function(){var a,b=this.feed;this.chirpArray=[],this.chirpIndex={},$.unsubscribeAll("/feed/"+b.getKey()),$.unsubscribeAll("/delete/"+b.getKey()),$.unsubscribe(this.subscription)}},TD.controller.feedManager=function(){function c(){var a=TD.storage.accountController.getDefault(),b=a.getKey(),c;a.getType()==="twitter"&&(c=TD.storage.feedController.getAll(),c=_.filter(c,function(a){return a.getType()==="search"&&a.getAccountKey()!==b}),_.each(c,function(a){var c=TD.storage.feedController.getOrCreateFeed(a.getType(),a.getService(),b,a.getMetadata());TD.controller.feedManager.replaceFeed(a,c)}))}function d(a,b){var c=b&&b.toLowerCase(),d;b?d=TD.i("User @{{screenName}} has been suspended",{screenName:b}):d=TD.i("User has been suspended"),TD.controller.progressIndicator.addMessage(d),TD.controller.feedManager.deleteWhere(function(d){var e=d.getMainUser&&d.getMainUser();return e?a&&a==e.id||b&&c===e.screenName.toLowerCase():!1})}var a={},b={};return a.init=function(){var a=TD.storage.feedController.getAll(),e=this,f;for(f=0;f<a.length;f++){var g=a[f];b[g.getKey()]=new TD.controller.FeedPoller(g)}TD.controller.scheduler.schedulePeriodicTask(120,TD.controller.feedManager.trimPollers),$.subscribe("/user/removeTweets",function(a,b,c){e.deleteUserChirps(a,b,c)}),$.subscribe("/user/suspended",d),$.subscribe("/storage/client/default_account_changed",c)},a.getPoller=function(a){return b[a]},a.trimPollers=function(){for(var a in b)b[a].trimChirps()},a.addFeed=function(a){var c=a.getKey(),d=b[c];return d?d:(d=new TD.controller.FeedPoller(a),b[c]=d,d)},a.removeFeed=function(a){var c=a.getKey(),d=b[c];delete b[c],d.destroy(),a.getService()=="twitter"&&(client=TD.controller.clients.getClient(a.getAccountKey()),client&&client.checkUserStream())},a.cleanupFeeds=function(){var c=TD.controller.columnManager.getAll(),d={};for(var e in c){var f=c[e].getFeeds();for(var g=0;g<f.length;g++)d[f[g].getKey()]=!0}for(var h in b)if(!d[h]){var i=b[h].feed;a.removeFeed(i),TD.storage.feedController.remove(i.getKey())}},a.deleteChirp=function(b){a.deleteWhere(function(a){if(a.id===b)return!0;if(a.getRelatedTweet){var c=a.getRelatedTweet();return c&&c.id===b}return!1})},a.deleteWhere=function(a,c){var d,e;for(var f in b)d=b[f],e=d.feed.getType(),(!c||e==="home"||e==="networkactivity")&&d.removeWhere(a)},a.deleteUserChirps=function(b,c,d){b=b.toLowerCase();var e=function(a){try{var d=a.getCreator&&a.getCreator();return d&&d.screenName.toLowerCase()===b&&a.account.getUserID()==c}catch(e){}return!1};a.deleteWhere(e,d)},a.deleteFeedsWhere=function(a){var b=TD.storage.clientController.client.getColumnOrder(),c,d,e,f,g;for(f=0;f<b.length;f++){c=TD.controller.columnManager.get(b[f]),d=c.getFeeds();for(g=d.length-1;g>=0;g--)e=d[g],a(e)&&(TD.storage.feedController.remove(e),c.removeFeed(e));c.getFeedCount()===0&&TD.controller.columnManager.deleteColumn(c.model.getKey())}},a.replaceFeed=function(b,c,d){var e=TD.controller.columnManager.getAll();d&&(e=_.filter(e,function(a){return d.indexOf(a.model.getKey())!==-1})),_.each(e,function(a){a.removeFeed(b)>0&&a.addFeed(c)}),a.cleanupFeeds()},a.fixListFeeds=_.debounce(_.once(function(){var a=function(a,b){var c=TD.storage.feedController.getOrCreateFeed(a.getType(),a.getService(),a.getAccountKey(),{listId:b.id,ownerId:b.user.id});TD.controller.feedManager.replaceFeed(a,c)},b=[],c=TD.storage.feedController.getAll();c=_.filter(c,function(a){var b=a.getType(),c=a.getMetadata();if(a.getType()==="list")if(!c.listId||!c.ownerId)return!0;return!1}),_.each(c,function(c){var d=c.getMetadata(),e=TD.cache.lists.find(null,d.screenName,d.slug);e?a(c,e):b.push(c)}),_.each(b,function(b){var c=TD.controller.clients.getClient(b.getAccountKey()),d=b.getMetadata(),e=function(c){a(b,c)},f=function(){};c.getList(null,d.screenName,d.slug,e,f)})}),5e3),a.isStreaming=function(a){var b=this.getPoller(a),c=!1,d,e;return b&&(d=b.feed,e=TD.controller.clients.getClient(d.getAccountKey()),c=e.feedIsStreaming(a)),c},a}(),TD.controller.progressIndicator=function(){function m(){i=$(".js-progress-indicator"),i.on("click",".js-dismiss",o)}function n(){var c=null,e,g;(!i||!i.length)&&m();if(l)switch(l.state){case d:c=TD.i("Failed: {{1}}",{1:l.message});break;case a:c=TD.i("Success: {{1}}",{1:l.message});break;case b:case f:c=l.message}if(c){var h=TD.ui.template.render("topbar/alert_message",{message:c});i.html(h);var k=i.find(".js-status-message");e=j,j=k.height(),e!==j?(e||k.css("bottom",-j),k.animate({bottom:0},200)):k.css("bottom",0)}else o()}function o(){var a=i.find(".js-status-message");a.animate({bottom:-j},200,function(){i.empty(),l=null}),j=0}var a="complete",b="working",c="ok",d="failed",e="warning",f="message",g=7e3,h=3e3,i,j=0,k={},l=null;return k.addTask=function(a){var c=_.uniqueId("msg_");return l={key:c,message:a,state:b,timeout:null},n(),c},k.addMessage=function(a){var b=_.uniqueId("msg_");return l={key:b,message:a,state:f,timeout:null},l.timeout=setTimeout(function(){k.deleteTask(b)},g),n(),b},k.deleteTask=function(a){l&&l.key===a&&(l=null,n())},k.taskComplete=function(b,c){l&&l.key===b&&(l.state=a,l.message=c||l.message,l.timeout=setTimeout(function(){k.deleteTask(b)},h),n())},k.taskFailed=function(a,b){l&&l.key===a&&(l.state=d,l.message=b||l.message,l.timeout=setTimeout(function(){k.deleteTask(a)},g),n())},k.changeMessage=function(a,b){l&&l.key===a&&(l.message=b,n())},k}(),TD.controller.notifications=function(){var a=500,b={},c,d=!1,e,f=[],g={},h=!1,i,j=window.webkitNotifications,k=!1,l="growl",m="webkit",n=function(b){var d=b.feed,j=b.column,n=b.items;if(!d.managed)return;n=n.filter(function(a){return a.passFilters(j.filters)&&!a.isOwnChirp()});if(n.length===0)return;var q=[];if(j.model.getHasNotification()&&k)for(var r=0;r<n.length;r++){var s=n[r],t=g[s.id];if(t)p(j.type)>p(t.columnType)&&(t.columnKey=j.model.getKey(),t.columnTitle=j.getTitleHTML(),t.columnType=j.model.getType(),t.accountKey=s.account.getKey());else{var u={chirpID:s.messageThreadId||s.id,accountKey:s.account.getKey(),columnKey:j.model.getKey(),columnTitle:j.getTitleHTML(),columnType:j.model.getType()};if(k===l){var v=s.getGrowlData();if(!v)continue;v.img=v.img||"/web/assets/logos/32.png",_.extend(u,v)}else if(k===m){u.html=s.renderNotification();if(!u.html)continue}q.push(u),g[n[r].id]=u}}e?c.port.postMessage({updates:q}):(h=h||j.model.getHasSound(),f=f.concat(q),!i&&(f.length>0||h)&&(i=setTimeout(o,a)))},o=function(){var a;i=null,h&&(TD.util.getAppEnv()==="win"?deck.playSound("tweet.wav"):document.getElementById("update-sound").play(),h=!1);if(f.length!==0&&k)if(k===l){for(var c=0;c<Math.min(f.length,5);c++)a=f[c],deck.doGrowl(a.title,a.text,a.img,a.chirpID,a.columnKey);h=!1,g={},f=[]}else k===m&&(e=webkitNotifications.createHTMLNotification("/web/templates/notification.html"),e.onclose=b.reset,e.show())},p=function(a){switch(a){case"privateMe":return 5;case"direct":return 4;case"me":return 3;case"mentions":return 2;case"home":return 1;case"search":return-1;default:return 0}},q=function(a){var b=TD.controller.columnManager.get(a.info.columnKey),d=!1,e=!0,f,g,h;switch(a.action){case"url":TD.util.openURL(a.href),e=!1;break;case"user":h=_.last(a.href.split("/")),$(document).trigger("uiShowProfile",{id:h});break;case"hashtag":$(document).trigger("uiPerformSearch",{query:a.text});break;case"showColumn":d=!0;break;case"showChirp":d=!0,f=b.findMostInterestingChirp(a.info.chirpID),g=b.findChirp(a.info.chirpID),TD.ui.updates.showDetailView(b,f,g)}e&&(TD.util.isChromeApp()?chrome.extension.getBackgroundPage().TD.bg.utils.showTDTab():TD.util.isWrapperApp()&&deck.showPrimaryWindow()),d&&TD.ui.columns.scrollColumnToCenter(a.info.columnKey),c.port.postMessage("closeNotification")},r=function(){return TD.util.isWrapperApp()?!0:j.checkPermission()===0};return b.init=function(){if(!TD.settings.getShowStartupNotifications()){var a=(new Date).getTime();_.each(TD.storage.feedController.getAll(),function(b){var c=TD.storage.columnController.getColumnsContainingFeed(b.getKey()),d=Boolean(_.find(c,function(a){return a.getHasSound()||a.getHasNotification()}));d&&b.setLatestTime(a)})}TD.util.isWrapperApp()?deck.showNotification?k=m:k=l:j&&window.SharedWorker&&b.getPermission(),k===m&&b.setUpWorker(),$.subscribe("/notifications/new",n.bind(this))},b.hasNotifications=function(){return k!==!1},b.setUpWorker=function(){c=new SharedWorker("/web/scripts/unbundled/nfn_worker.js"),c.port.addEventListener("message",function(a){a.data==="ready"?(d=!0,c.port.postMessage({updates:f}),f=[]):a.data.action&&q(a.data)}),c.port.start()},b.reRender=function(a){var b=g[a.id];if(b){var e=a.renderNotification();b.html=e,d&&c.port.postMessage({replaceID:a.id,accountKey:a.account.getKey(),html:e})}},b.getPermission=function(){r()?k=m:j.requestPermission(function(){r()&&(k=m,b.setUpWorker())})},b.reset=function(){e=null,g={},h=!1},b}(),TD.controller.stats=function(){var a={},b="performance",c={INIT:"init",MAIN:"main_init",COLUMN_MANAGER:"column_manager_init",COLUMN_SCHEDULER:"column_scheduler_init",NOTIFICATIONS:"notifications_init",FILTER_MANAGER:"filter_manager_init",RENDER_TWEET:"render_tweet"},d="twid",e="interval",f="f",g="oid",h="tsn",i="spam_uid",j="token",k="tw",l=10,m={};TD.util.extendObjectWith(m,[[TD.util.columnUtils.columnMetaTypes.MENTIONS,{legacyId:2,namespace:{section:"twitter",component:"mention"}}],[TD.util.columnUtils.columnMetaTypes.FOLLOWERS,{legacyId:3,namespace:{section:"twitter",component:"followers"}}],[TD.util.columnUtils.columnMetaTypes.TIMELINE,{legacyId:3,namespace:{section:"twitter",component:"home"}}],[TD.util.columnUtils.columnMetaTypes.SEARCH,{legacyId:4,namespace:{section:"twitter",component:"search"}}],[TD.util.columnUtils.columnMetaTypes.MESSAGES,{legacyId:5,namespace:{section:"twitter",component:"inbox"}}],[TD.util.columnUtils.columnMetaTypes.FAVORITES,{legacyId:8,namespace:{section:"twitter",component:"favorites"}}],[TD.util.columnUtils.columnMetaTypes.LIST,{legacyId:22,namespace:{section:"twitter",component:"list"}}],[TD.util.columnUtils.columnMetaTypes.SCHEDULED,{legacyId:28,namespace:{section:"tweetdeck",component:"scheduledupdates"}}],[TD.util.columnUtils.columnMetaTypes.USERTWEETS,{legacyId:32,namespace:{section:"twitter",component:"usertweets"}}],[TD.util.columnUtils.columnMetaTypes.USERTIMELINE,{legacyId:33,namespace:{section:"twitter",component:"usertimeline"}}],[TD.util.columnUtils.columnMetaTypes.HOME,{legacyId:34,namespace:{section:"tweetdeck",component:"home"}}],[TD.util.columnUtils.columnMetaTypes.ME,{legacyId:35,namespace:{section:"tweetdeck",component:"me"}}],[TD.util.columnUtils.columnMetaTypes.INBOX,{legacyId:36,namespace:{section:"tweetdeck",component:"inbox"}}],[TD.util.columnUtils.columnMetaTypes.INTERACTIONS,{legacyId:37,namespace:{section:"twitter",component:"interactions"}}],[TD.util.columnUtils.columnMetaTypes.ACTIVITY,{legacyId:38,namespace:{section:"twitter",component:"networkactivity"}}]]);var n="http://tracking.tweetdeck.com/track/",o,p,q="Twitter-TweetDeck-{{{client_name}}}/{{{client_version}}} {{{platform}}}/{{{platform_version}}}",r="deck",s,t,u,v,w=function(){if(!p){var a=TD.storage.store.getTweetdeckAccount();a&&(p=TD.core.sha1(a))}return p},x=function(a,b){a=a||{},b=b||{},a.client=r,b.user_agent=t,b.guest_id=s,v.scribe(a,b),TD.config.scribe_debug_level>1&&console.log("Scribing:",a,b)},y=function(){var a=TD.storage.accountController.getPreferredAccount("twitter"),b={};return a&&(b[k]=a.getUserID()),b};return a.generateScribeUserAgent=function(a,b,c,d){var e={client_name:a,client_version:b,platform:c,platform_version:d},f=TD.ui.template.toHtml(q,e);return f},a.generateScribeGuestId=function(a,b){var c="tweetdeck:"+a+":"+b,d=TD.core.sha1(c),e=parseInt(d.substr(0,13),16);return e},a.flushScribeQueue=function(){u&&u.flush(u.getBuffer())},a.init=function(){var b=TD.util.getAppEnv();o=TD.config.client_name+"-"+b,t=a.generateScribeUserAgent(o,TD.version,b,"1"),s=a.generateScribeGuestId(t,w());var c={bufferEvents:!0,useAjax:!1,flushOnUnload:!0};u=new ScribeTransport(c),v=new ClientEvent(u),TD.config.scribe_debug_level>0&&this.setupDebugMode(),TD.controller.scheduler.schedulePeriodicTask(900,a.impression,!0),TD.controller.scheduler.schedulePeriodicTask(60,TD.controller.stats.flushScribeQueue)},a.setupDebugMode=function(){var a=!1,b={},c=function(c){var d,e=c.validationLevel==="error"&&c.parentFieldName==="event_namespace",f="scribe error",g="";if(e&&a){d=[c.fieldName,c.fieldValue].join(" ");if(b[d])return;b[d]=!0}c.validationLevel==="warning"&&(f="scribe warning"),e&&(g="Please add "+c.fieldName+" â"+c.fieldValue+"â to go/namespace"),console.error(f.toUpperCase(),g,c)};u.updateOptions({debug:!0,bufferEvents:!1,useAjax:!0,flushOnUnload:!0,debugHandler:function(a){a.errors.forEach(c),a.warnings.forEach(c)}}),u.options.url="https://twitter.com"+u.SCRIBE_API_ENDPOINT},a.impression=function(){var a={action:"impression",page:"main"},b=y();b[e]="900",b[f]=TD.controller.feather.latestFeatherId,x(a,b)},a.favorite=function(a,b,c){var e={page:"column",section:"tweet",action:"favorite"},f={};f[g]=a,f[d]=b,f[k]=c,x(e,f)},a.unfavorite=function(a,b,c){var e={page:"column",section:"tweet",action:"unfavorite"},f={};f[g]=a,f[d]=b,f[k]=c,x(e,f)},a.retweet=function(a,b,c){var e={page:"column",section:"tweet",action:"retweet"},f={};f[g]=a,f[d]=b,f[k]=c,x(e,f)},a.embedTweetDialogOpen=function(a){var b={page:"main",section:"embed_tweet_dialog",action:"open"},c={};c[d]=a,x(b,c)},a.translate=function(a,b,c,e,f){var h={page:"column",section:"tweet",action:"translate"},i={};i[g]=a,i[d]=b,i[k]=c,i.dest_lang=e,i.src_lang=f,x(h,i)},a.spam=function(a,b,c){var d={page:"column",section:"tweet",component:"screen_name",action:"report_as_spam"},e={};e[h]=a,e[i]=b,e[j]=TD.core.sha1(String(c)),x(d,e)},a._genericColumnEvent=function(a,b){var c=m[a],d={page:"column",section:"unknown",component:"unknown",action:b};c&&c.namespace?_.extend(d,c.namespace):console.log("Tracking: Unknown column type",a),x(d)},a.addColumn=function(b){a._genericColumnEvent(b,"add")},a.removeColumn=function(b){a._genericColumnEvent(b,"remove")},a.postTweet=function(a){var b={page:"compose",action:"send_tweet"},c={};a&&a.getType()==="twitter"&&(c[k]=a.getUserID()),x(b,c)},a.postReply=function(a){var b={page:"compose",action:"send_reply"},c={};a&&a.getType()==="twitter"&&(c[k]=a.getUserID()),x(b,c)},a.postMessage=function(a){var b={page:"compose",action:"send_dm"},c={};a&&a.getType()==="twitter"&&(c[k]=a.getUserID()),x(b,c)},a.messageBannerImpression=function(a){var b={page:"main",section:"message_banner",action:"impression"},c={message_id:a};x(b,c)},a.messageBannerDismiss=function(a){var b={page:"main",section:"message_banner",action:"dismiss"},c={message_id:a};x(b,c)},a.messageBannerClick=function(a,b){var c={page:"main",section:"message_banner",action:"click"},d={message_id:a,button_id:b};x(c,d)},a.searchboxFocus=function(){var a={page:"main",component:"search_box",action:"focus_field"};x(a)},a.searchboxPerformSearch=function(){var a={page:"main",component:"search_box",action:"search"};x(a)},a.typeaheadItemSelected=function(a,b,c){var d={page:"main",component:"search_box",element:"typeahead",action:"search"},e={queryLength:a,type:b,index:c};x(d,e)},a.typeaheadRecentItemSelected=function(a,b,c){var d={page:"main",component:"search_box",element:"recent",action:"search"},e={queryLength:a,type:b,index:c};x(d,e)},a.viewedTweetSocialProof=function(a){var b={page:"column",section:"social_proof",component:a,action:"impression"};switch(a){case"retweeters":b.component="retweeted_by";break;case"favoriters":b.component="favorited_by";break;default:throw"Social proof type â"+a+"â not recognised"}x(b)},a.setting=function(a,b){var c={page:"settings",section:a},d={section:{condensed:"narrow","full-size":"wide"}};_.isBoolean(b)?c.action=b?"on":"off":(c.component=d.section[b]||b,c.action="select"),x(c)},a.apiErrorResponse=function(a,b,c){var d={page:"api",action:"request"},e={status_code:a};if(TD.util.random(0,99)<l)b&&(e.event_info=b),c&&(e.url=c),x(d,e);else return},a.performance=function(){var a={},b=function(){return a[c.RENDER_TWEET]&&a[c.INIT]&&a[c.MAIN]&&a[c.COLUMN_MANAGER]&&a[c.COLUMN_SCHEDULER]&&a[c.FILTER_MANAGER]&&a[c.NOTIFICATIONS]};return{log:function(c,d){a[c]=d,b()&&(a={})},keys:c}}(),a.advancedSearchSettings=function(a,b,c,d){var e={section:{},component:{action:"interactions"},element:{written_in:"language"}},f={page:"main",section:e.section[a]||a,component:e.component[b]||b,element:e.element[c]||c,action:"change"},g={value:d};x(f,g)},a.actionFilterError=function(){var a={page:"main",section:"column_options",component:"interactions",action:"validation_error"},b={error:"No interaction types selected"};x(a,b)},a.columnActionClick=function(a,b){var c={page:"main",section:"column_options",element:a,action:"click"};b=b||{},x(c,b)},a.unknownStreamData=function(a){var b={page:"api",section:"userstream",action:"unrecognized_data"};x(b,a)},a.navbarListsClick=function(){var a={page:"main",section:"navbar",element:"lists",action:"click"};x(a)},a.navbarAddColumnClick=function(){var a={page:"main",section:"navbar",element:"add_column",action:"click"};x(a)},a.navbarPageLeft=function(){var a={page:"main",section:"navbar",component:"column_nav",element:"page_left",action:"click"};x(a)},a.navbarReorderColumns=function(){var a={page:"main",section:"navbar",component:"column_nav",action:"reorder"};x(a)},a.navbarJumpToColumn=function(){var a={page:"main",section:"navbar",component:"column_nav",element:"column_item",action:"click"};x(a)},a.navbarPageRight=function(){var a={page:"main",section:"navbar",component:"column_nav",element:"page_right",action:"click"};x(a)},a.navbarSettingsClick=function(){var a={page:"main",section:"navbar",element:"settings",action:"click"};x(a)},a.navbarComposeClick=function(){var a={page:"main",section:"navbar",element:"compose",action:"click"};x(a)},a.tweetStreamImpression=function(a,b){var c={component:"stream",action:"results"},d={items:b},e=TD.util.columnUtils.columnMetaTypeToScribeNamespace[a];e&&b.length>0&&(c=_.extend(c,e),x(c,d))},a.appWokenFromSleep=function(a){var b={page:"main",action:"wake"},c={secondsSinceSleep:a};x(b,c)},a.purgedServices=function(a){a.forEach(function(a){var b={page:"main",section:"service",action:"remove"};x(b,{service:a})})},a.purgedFeed=function(a){var b={page:"main",section:"feed",action:"remove"};x(b,a)},a}(),TD.controller.filterManager=function(){var a={},b=[],c=function(){var a=[];_.each(b,function(b){a.push(b.toBackendState())}),TD.settings.setGlobalFilter(a)};return a.init=function(){var c=TD.settings.getGlobalFilter();_.each(c,function(a){var c=new TD.vo.Filter;c.fromBackendState(a),b.push(c)}),a.reapplyAllFilters()},a.reapplyAllFilters=function(){_.each(TD.controller.columnManager.getAll(),function(a){a.reloadTweets()})},a.pass=function(a,c){var d,e;for(d=0,e=b.length;d<e;d++)if(!b[d].pass(a))return!1;if(c)for(d=0,e=c.length;d<e;d++)if(!c[d].pass(a))return!1;return!0},a.getAll=function(a,c){return b},a.addFilter=function(d,e,f){var g=new TD.vo.Filter(d,e,Boolean(f));return b.push(g),a.reapplyAllFilters(),c(),g},a.validateFilter=function(a,c){return!a||!c?!1:_.trim(c).length==0?!1:_.any(b,function(b){return b.type===a&&b.value===c})?!1:!0},a.removeFilter=function(d){var e;_.each(b,function(a,b){a.id===d&&(e=b)}),b.splice(e,1),a.reapplyAllFilters(),c()},a}(),TD.decider=function(){var a=function(){var a={};this.DM_READ_STATE="dm_read_state",this.ENGAGEMENT_FILTER="engagement_filter",this.TRANSLATE_TWEET="machine_translated_tweets",this.updateFromBackend=function(b){a=b||{}},this.get=function(b){return a[b]},this.getAll=function(){return _.clone(a)}};return new a}(),TD.sync.util=function(a){var b={},c=0,d=2,e=4,f=8;b.maybe_log=function(a,b){var c=_.isUndefined(b)?1:b;TD.config.debug_level>=c&&console.log(a)},b.NotJsonable=function(a){_.extend(this,a),this.___=a.toString()},b.NotJsonable.prototype={};var g=function(a){console.log(_.map(a,function(a){if(_.isUndefined(a))return void 0;try{return JSON.parse(JSON.stringify(a))}catch(c){return new b.NotJsonable(a)}}))};return b.stateLog=function(){TD.config.debug_level>=d&&g(_.toArray(arguments))},b.verboseLog=function(){TD.config.debug_level>=e&&g(_.toArray(arguments))},b.warn=function(){TD.config.debug_level>=c&&console.log.apply(console,_.toArray(arguments))},b.trace=function(a,c){b.maybe_log("TRACE: "+a+": "+(c||""),1)},b.printStacktrace=function(){if(!TD.config.debug_menu)return;try{throw new Error("stack trace or gtfo")}catch(a){console.log(a.stack)}},b.getStack=function(){try{throw new Error("stack trace or gtfo")}catch(a){return TD.util.isChromeApp()?a.stack.split("\n").slice(2).join("\n"):""}},b.errmark=function(a,c){return a||(a=c,c="missing message"),console.log("---ERROR--->>>>>->>>>->>>->>->--"+c+"--<-<<--"),b.maybe_log(a),console.log(a.stack),a},b.assert=function(a,c,d){if(!a)throw console.log("------------------------------------------"),console.log(["ASSERT FAILURE",c,d]),b.printStacktrace(),console.log("------------------------------------------"),TD.sync.trace&&TD.sync.trace.assert(c,d),"AssertionError"},b.precondition=function(a,c,d){if(!a)throw console.log("------------------------------------------"),console.log(["PRECONDITION FAILURE",c,d]),b.printStacktrace(),console.log("------------------------------------------"),TD.sync.trace&&TD.sync.trace.assert("PRECONDITION "+c,d),"PreconditionAssertionError"},b._break=function(){console.log("you might want to set a breakpoint here ;-)")},b.warning=function(a){data=_.toArray(arguments).slice(1),console.log(["WARNING",a,b.pformat(data)])},b.error=function(a){data=_.toArray(arguments).slice(1),console.log(["ERROR",a,b.pformat(data)])},b.list_to_set=function(a){var b={};return _.each(a,function(a){b[a]=!0}),b},b.pprint=function(a){return b.maybe_log(JSON.stringify(a,null,"  "),d),a},b.pformat=function(a){return JSON.stringify(a,null,"  ")},b.repr=function(a){return JSON.stringify(a)},b.clone=function(a){if(a===null||_.isUndefined(a))return a;try{return JSON.parse(JSON.stringify(a))}catch(c){return b.stateLog("util.clone couldn't parse object",a,c),["<not jsonable>",a]}},b.dictMap=function(a,b,c){var d={};return _.each(_.map(a,b,c),function(a){d[a[0]]=a[1]}),d},b.stall=function(b,c){_.isUndefined(c)&&(c=0);var d=new a.Deferred;return _.delay(_.bind(d.callback,d),1e3*c,b),d},b.autoRetry=function(a,b,c){var d=a();return b.forEach(function(b){d.addErrback(function(d){if(!c||c(d)){var e=new TD.core.defer.Deferred;return e.addCallback(a),setTimeout(function(){e.callback()},b),e}return d})}),d},b.makeThingScheduler=function(c,d,e,g,h){var i=!1,j=!1;g=g||function(){return!0},h=_.isUndefined(h)?1:h;var k=[],l=function(){b.maybe_log(["_maybe_do_stuff",e,"want stuff done:",i,"am doing stuff:",j],f);if(!i){b.maybe_log("not doing stuff; someone else did stuff before us",f);return}if(j){b.maybe_log("am already doing stuff",f);return}j=!0,i=!1;var g=TD.controller.progressIndicator;if(d)var h=g.addTask(d);var m=a.maybeDeferred(c);m.addCallback(function(a){j=!1,d&&g.deleteTask(h);if(i)l();else{var b=k;k=[];for(var c=0;c<b.length;c++)try{b[c].callback(a)}catch(e){_.defer(_.bind(b[c].errback,b[c]),e)}}}),m.addErrback(function(a){b.errmark(a,'do_stuff for "'+e+'" yielded error when calling; '+c),j=!1,d&&g.taskFailed(h);var f=k;k=[];for(var i=0;i<f.length;i++)try{f[i].errback(a)}catch(l){_.defer(_.bind(f[i].errback,f[i]),l)}})};return function(c){if(!g())return b.maybe_log("not triggering (guarded): "+e,f),a.succeed();c=_.isUndefined(c)?h:c,b.maybe_log('trigger func called "'+e+'"',f),i=!0;var d=new a.Deferred;return k.push(d),setTimeout(l,c*1e3),d}},b}(TD.core.defer),TD.storage.store=function(a,b){var c={};c._storage=null;var d="TweetDeck",e=function(a){return a?a:c._storage?c._storage:new c.MemoryStore};c.getTweetdeckAccount=function(b){b=e(b);if(b){var c=b.getItem("tweetdeck_account");if(c){c=JSON.parse(c);if(c.email)return c.email;a.stateLog("store.getTweetdeckAccount(): tdacct invalid",c)}return null}},c.setTweetdeckAccount=function(b,c){c=e(c);if(!c)throw new Error("No storage given or configured");a.assert(b,"email must be given to set tweetdeck account");var d={email:b};c.setItem("tweetdeck_account",JSON.stringify(d))},b.isWrapperApp()&&!TD.config.suppress_keychain&&(c.getPasshash=function(a,b){var d=null,e=c.getSecret(a,b);return e&&(d=TD.core.sha1(e)),d},c.getTweetdeckAccountAndPasshash=function(b){b=e(b);if(!b)return null;var d=b.getItem("tweetdeck_account");if(d){d=JSON.parse(d);if(d.email){var f=c.getSecret(d.email,b);f&&(d.passhash=TD.core.sha1(f));if(d.passhash)return d}a.stateLog("store.getTweetdeckAccountAndPassword(): invalid",d)}return null},c.setTweetdeckAccountAndPassword=function(b,d,f){f=e(f);if(!f)throw new Error("No storage given or configured");a.assert(b,"email must be given to set tweetdeck account"),c.storeSecret(b,d);var g={email:b};f.setItem("tweetdeck_account",JSON.stringify(g))},c.storeSecret=function(a,b){var e=deck.storePassword(a,d,b);if(deck.osname()==="windows"){var f=c.get("hoard");f[a]=e,c.set("hoard",f)}},c.getSecret=function(b,e){var f;if(deck.osname()==="windows"){if(_.isUndefined(e))a.assert(c._storage!==null,"can't read hoard: storage is not set up!"),f=c.get("hoard");else{var g=e.getItem("hoard");if(g)f=JSON.parse(g);else return""}var h=f[b];return deck.getPassword(b,d,h)}return deck.getPassword(b,d)},c.deleteSecrets=function(a){if(deck.osname()==="osx")_.each(a,function(a){deck.deletePassword(a,d)});else{var b=c.get("hoard");_.each(a,function(a){delete b[a]}),c.set("hoard",b)}}),c.init=function(a,b){var d;a&&TD.storage.storeUtils.localStorageOK&&(c._storage=localStorage,console.log("Using localStorage")),!c._storage&&TD.storage.storeUtils.sessionStorageOK&&(c._storage=sessionStorage,console.log("Using sessionStorage")),c._storage||(c._storage=new c.MemoryStore,console.log("Using memory store")),d=c.getTweetdeckAccount(),b!==d&&TD.storage.storeUtils.clearWebstorage()},c.reset=function(){c._storage=null},c.get=function(b){a.assert(c._storage!==null,"can't read ("+b+") storage is not set up!");var d=c._storage.getItem(b);try{return JSON.parse(d)||{}}catch(e){return console.log("ERROR: failed to parse store key ("+b+") value;"),console.log(d),console.log(e),d}},c.set=function(a,b){var d=JSON.stringify(b);try{c._storage.setItem(a,d)}catch(e){if(e.code===DOMException.QUOTA_EXCEEDED_ERR){try{$(document).trigger("dataStorageFull")}catch(e){}c._storage.setItem(a,d)}}},c.nonCriticalSet=function(a,b){c._storage.setItem(a,JSON.stringify(b))},c.size=function(){return c._storage.length},c.remove=function(a){c._storage.removeItem(a)},c.dumpAll=function(){_.each({local:localStorage,session:sessionStorage},function(a,b){console.log("--------------------------------",b,"storage");var c=a.length;for(var d=0;d<c;d++){var e=a.key(d);console.log(e,":");var f=a.getItem(e);try{TD.sync.util.pprint(JSON.parse(f))}catch(g){console.log("Not JSON:",f)}}}),console.log("------------------------------------------")},c.jsonDump=function(){var a={};return _.each({local:localStorage,session:sessionStorage},function(b,c){console.log("--------------------------------",c,"storage"),a[c]={};var d=b.length;for(var e=0;e<d;e++){var f=b.key(e);console.log(f,":");var g=b.getItem(f);a[c][f]=g}}),a},c.dbgCapture=function(a){var b={};_.isUndefined(a)&&(a=localStorage);var c=a.length;for(var d=0;d<c;d++){var e=a.key(d);console.log(e,":");var f=a.getItem(e);console.log(":",f),console.log("X",b),b[e]=f}return TD.core.base64.encode(JSON.stringify(b))},c.dbgImport=function(a,b){_.isUndefined(b)&&(b=localStorage);var c=JSON.parse(TD.core.base64.decode(a));_.each(c,function(a,c){b.setItem(c,a)})},c.storageKeys=function(a){var b=[],c=a.length;for(var d=0;d<c;d++)b.push(a.key(d));return b};var f="__upgrade__";return c.stashUpgrade=function(a,b,c,d){a.setItem(f,JSON.stringify({from:b,to:c,data:d}))},c.getUpgradeState=function(){var a=c._storage.getItem(f);return a===null&&c._storage===sessionStorage&&(a=localStorage.getItem(f)),a===null?null:JSON.parse(a)},c.flushUpgradeState=function(){c._storage===sessionStorage&&localStorage.getItem(f)!==null&&localStorage.removeItem(f),c._storage.getItem(f)!==null&&c._storage.removeItem(f)},c.checkVersion=function(a){var b=c._storage.getItem("__version__");if(b!==null&&Number(b)!==a)throw new Error("Wrong version number found in store (curr "+b+")")},c.recordVersion=function(a,b){var d=b?b:c._storage;d.setItem("__version__",a)},c.MemoryStore=function(){this.data={},this.length=0},c.MemoryStore.prototype.clear=function(){this.data={},this.length=0},c.MemoryStore.prototype.getItem=function(a){var b=this.data[a];return b!==undefined?b:null},c.MemoryStore.prototype.key=function(a){throw"MemoryStore.key not implemented"},c.MemoryStore.prototype.removeItem=function(a){this.getItem(a)!==null&&(delete this.data[a],this.length--)},c.MemoryStore.prototype.setItem=function(a,b){this.getItem(a)===null&&this.length++,this.data[a]=b},c}(TD.sync.util,TD.util),TD.storage.storeUtils=function(){var a={};return a.localStorageOK=!1,a.sessionStorageOK=!1,a.init=function(){a.localStorageOK=window.localStorage&&a._testStore(localStorage,!0),a.sessionStorageOK=window.sessionStorage&&a._testStore(sessionStorage,!0),console.log("localStorage:",a.localStorageOK?"OK":"BROKEN"),console.log("sessionStorage:",a.sessionStorageOK?"OK":"BROKEN"),a._upgradeWebstorage()},a.getSessionData=function(){var b={email:null,staySignedIn:!0,sessionExists:!1,passhash:null};try{a.localStorageOK&&(b=a._getSessionDataFromStore(localStorage)),!b.email&&a.sessionStorageOK&&(b=a._getSessionDataFromStore(sessionStorage),b.email&&(b.staySignedIn=!1))}catch(c){}return b},a._getSessionDataFromStore=function(a){var b,c={email:null,staySignedIn:!0,sessionExists:!1,passhash:null};try{b=TD.storage.store.getTweetdeckAccount(a),b&&(c.session=a.getItem("_session"),TD.sync.tdapi.setSession(c.session),c.email=b,c.sessionExists=TD.sync.tdapi.isLoggedIn(),TD.storage.store.getSecret&&(c.passhash=TD.storage.store.getSecret(c.email,a)))}catch(d){}return c},a._upgradeWebstorage=function(){TD.sync.util.trace("upgrading web storage");try{a.localStorageOK&&TD.storage.upgrade.doUpgrade(localStorage),a.sessionStorageOK&&TD.storage.upgrade.doUpgrade(sessionStorage)}catch(b){TD.sync.util.warn("ERROR in store upgrade:",b.message,b),a.clearWebstorage()}},a._testStore=function(b,c){var d=!1,e=!1,f="__test__",g="test",h=1024;while(g.length<h)g+=g;try{b.setItem(f,g),d=b.getItem(f)===g,b.removeItem(f)}catch(i){d=!1,e=i.code===DOMException.QUOTA_EXCEEDED_ERR,e&&b.length===0&&TD.sync.util.warn(i,"In Safari private browsing mode")}if(c&&e)try{a.flushDataFromStore(b),d=a._testStore(b,!1)}catch(i){d=!1}return d},a.clearWebstorage=function(b){TD.sync.util.trace("clearing web storage");try{a.flushDataFromStore(localStorage,b),a.flushDataFromStore(sessionStorage,b)}catch(c){}},a.flushDataFromStore=function(a,b){var c={};b=b||[],b.push("__version__"),b.forEach(function(b){var d=a.getItem(b);d&&(c[b]=d)}),a.clear(),_.each(c,function(b,c){a.setItem(c,b)})},a.hasAlreadyReloaded=function(){var b;return a.localStorageOK?b=Boolean(localStorage.getItem("__hasAlreadyReloaded")):b=!0,b},a.setReloadedFlag=function(){a.localStorageOK&&localStorage.setItem("__hasAlreadyReloaded",!0)},a.removeReloadedFlag=function(){a.localStorageOK&&localStorage.removeItem("__hasAlreadyReloaded")},a}(),TD.sync.trace=function(a){var b={},c=[];return b.record=function(){var b=(new Date).toLocaleTimeString();c.push([b].concat(_.toArray(arguments))),TD.config.debug_trace&&a.stateLog.apply(null,["-------- TRACE: "+b].concat(_.toArray(arguments))),TD.config.debug_menu||c.length>200&&c.splice(0,100)},b.request=function(a,c,d){b.record("request",a,d.type,c,_.clone(d))},b.response=function(a,c,d,e){b.record("response",a,c,_.clone(d),_.clone(e))},b.objInit=function(a,c,d){b.record("obj init",a,_.clone(c),_.clone(d))},b.manage=function(c,d){b.record("manage",c,d,a.clone(d.getStateForLocalstorage()))},b.update=function(a,c,d){b.record("update",a,c,_.clone(d))},b.push=function(c,d,e,f){b.record("push",c,d,_.clone(e),a.clone(f))},b.tsResults=function(a,c,d,e,f,g){b.record("t+s results",a,_.clone(c),_.clone(d),_.clone(e),_.clone(f),g)},b.tsResult=function(a,c,d,e,f,g){b.record("t+s result",a,_.clone(c),_.clone(d),e,_.clone(f),g)},b.conflicts=function(a,c,d,e,f){b.record("conflicts",a,_.clone(c),_.clone(d),_.clone(e),f)},b.conflict=function(a,c,d,e,f){b.record("conflict",a,_.clone(c),_.clone(d),_.clone(e),f)},b.assert=function(c,d){b.record("ASSERT",c,d,a.getStack())},b.clear=function(){c=[]},b.logDump=function(){var a="-------------------------------------------------------------";console.log(a+" TRACE dump "+a),_.each(c,function(a){console.log.call(console,a)}),console.log(a+"  END dump  "+a)},b.logSummarise=function(){var b="-------------------------------------------------------------";console.log(b+" TRACE dump "+b);var d=a.list_to_set(["obj init","update"]);_.each(c,function(a){d[a[1]]||console.log.call(console,a)}),console.log(b+"  END dump  "+b)},b}(TD.sync.util),TD.sync.tdapi=function(a,b,c,d){var e={},f=null,g=null,h=function(a,b){return"Basic "+d.encode(a+":"+b)},i=function(){if(!f)throw new Error("Not Logged In");return"X-TD-Session "+f};e.getAccounts=function(a){var b="/verify_user?accounts=true";return a&&(b="/verify_user?all=true"),e.drequest(b,e.getReq())};var j=function(a){return _.isUndefined(a.session)||(f=a.session),a},k=function(a){return f=null,a};e.login=function(a,b){var c="/login?session=true",d={type:"GET",headers:{Authorization:h(a,b)}},f=e.drequest(c,d,{});return f.addCallback(j),f},e.logout=function(){var a=e.drequest("/logout",e.getReq({method:"POST"}));return a.addCallback(k),a},e.isLoggedIn=function(){return Boolean(f)},e.setSession=function(a){var b=null;a&&(b=JSON.parse(a)),b&&(f=b)},e.saveSession=function(){TD.storage.store.set("_session",f)},e.onAuthFail=function(a,b){g=a},e.createAccount=function(a,b,c,d){var f=TD.util.iso8601(new Date),g="/user"+TD.config.td_create_key+f,i=new window.jsSHA(g,"ASCII"),k=i.getHMAC(TD.config.td_create_secret,"ASCII","SHA-256","B64"),l="/user?session=true&mail_list=False",m={type:"PUT",headers:{Authorization:h(a,b),"x-td-sig":k,"x-td-timestamp":f,"x-td-create":TD.config.td_create_key}},n=e.drequest(l,m);return n.addCallback(j),n},e.Conflict=function(a){this.body=a};var l=new RegExp("^([^:]*): (.*)$"),m=function(a,b){_.isUndefined(b)&&(b={});var c=a.getAllResponseHeaders(),d=c.split("\r\n");return d.length==1&&(d=c.split("\n")),_.each(d,function(a){var c=a.match(l);c&&(b[c[1].toLowerCase()]=c[2])}),b};return e.drequest=function(d,f,h,j){var k=_.uniqueId(f&&f.reqid?"["+f.reqid+"]rq:":"rq:");a.stateLog("drequest",k,d,f);if(f===null||_.isUndefined(f))f=e.getReq();c.request(k,d,f),d.charAt(0)=="/"&&(d=TD.config.api_root+d);if(!_.startsWith(d,"http://")&&!_.startsWith(d,"https://"))return b.fail(new Error("Malformed url"));var l=function(c,d){var e=jQuery.ajax(c,d),f=new b.Deferred;return e.done(function(a,b,c){f.callback(c)}),e.fail(function(c,d,e){c.status===409?(a.assert(e==="Conflict","409 should be Conflict"),f.callback(c)):f.errback(new b.XMLHttpRequestError(c,e))}),f},n=l(d,f);n.reqid=k;var o=function(a){var b=a.req;if(b.status===401&&!j){var c=m(b);if(c["www-authenticate"]==="X-TD-Session"){if(TD.storage.store.getTweetdeckAccountAndPasshash){var h=TD.storage.store.getTweetdeckAccountAndPasshash();if(h&&h.email&&h.passhash){var k=e.login(h.email,h.passhash);return k.addCallback(function(){return e.saveSession(),f.headers.Authorization=i(),l(d,f)}),k.addErrback(function(){g&&g()}),k}}if(g)throw g(),a}}throw a};n.addErrback(o);var p=function(b,g){var i,j,l=function(b){if(b==="")return b;try{return JSON.parse(b)}catch(c){return _.isEmpty(b)||a.warn(["failed to json parse drequest response;",b,"for request",d,f]),b}},n;return b.status===409?n=new e.Conflict(l(b.responseText)):n=l(b.responseText),h&&m(b,h),h&&h.date&&TD.storage.notification.notify("/date",h.date),a.stateLog("drequest ret",k,d,n,b.getAllResponseHeaders().split("\n")),c.response(k,d,n,h),n};return n.addCallback(p,k),n},e.requestWithBody=function(a,b,c,d,f,g,h){var i=e.getReq({type:b,reqid:g,headers:f||{},data:JSON.stringify(c),contentType:"application/json"});return e.drequest(a,i,d,h)},e.getReq=function(a){var b={type:"GET",headers:{}};for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b.headers.Authorization=i(),a&&a.method&&(b.type=a.method),b},e}(TD.sync.util,TD.core.defer,TD.sync.trace,TD.core.base64),TD.storage.notification=function(a){var b={},c=[],d=function(){var a=c.splice(0,c.length);_.each(a,function(a){if(a.topic)try{jQuery.publish(a.topic,a.args)}catch(b){console.log("FAILURE publishing event",a,b)}else a.d&&a.d.callback()})};return b.notify=function(a){var b=Array.prototype.slice.call(arguments,1);c.push({topic:a,args:b}),_.defer(d)},b.flush=function(){var b=new a.Deferred;return c.push({d:b}),_.defer(d),b},b}(TD.core.defer),TD.storage.StoredObj=function(a,b,c,d,e,f,g){function h(a){this.controller=a}return h.prototype.controller=null,h.prototype.managed=!1,h.prototype.stateCache=null,h.prototype.state=null,h.prototype.privateState=null,h.prototype.eventname="/storage/object",h.prototype._init=function(c){c||(c={}),g.objInit(this,c),this.state={},this.privateState={},_.isEmpty(c)?(this.deltaQ=[],this.stateCache=null):(this.deltaQ=[new a.StoredDelta("init",c)],this.stateCache=_.clone(c)),b.verboseLog("StoredObj.init",this,c,this.deltaQ)},h.prototype.getApiid=function(){var a=this.getPrivate("apiid");return b.assert(a,"missing apiid",this),a},h.prototype.hasApiid=function(){return Boolean(this.getPrivate("apiid"))},h.prototype.setApiid=function(a){return g.update("set apiid",this,[a]),this.setPrivate("apiid",a)},h.prototype.getKey=function(){return this.getPrivate("key")},h.prototype.setKey=function(a){return this.setPrivate("key",a)},h.prototype._prepCache=function(){return this.stateCache===null&&(b.assert(this.deltaQ.length===0,"empty stateCache must coincide with empty ÎQ"),this.stateCache=_.clone(this.state)),this.stateCache},h.prototype.set=function(c,d){return g.update("set",this,[c,d]),b.assert(c!=="columns","you should be setting column_order, not columns"),this._prepCache(),this.deltaQ.push(new a.StoredDelta("set",c,d)),this.stateCache[c]=d,f.notify(this.eventname+"/change",this),this.controller.triggerPush()},h.prototype.setListPermutation=function(c,d){TD.config.debug_checks&&this.checkCache();var h=this.get(c);if(_.isEqual(d,h))return g.update("set null list permutation",this,[c,h,d]),b.stateLog("ignoring request to change list at",c),e.succeed();g.update("set list permutation",this,[c,h,d]);var i=a.StoredDelta.listPermutator(c,h,d);return b.verboseLog("set list permutation",h,"â",d,"Îs:",i),this.deltaQ=this.deltaQ.concat(i),this.stateCache=a.StoredDelta.applyMultiple(this.deltaQ,this.state),TD.config.debug_checks&&this.checkCache(),f.notify(this.eventname+"/change",this),this.controller.triggerPush()},h.prototype.listPrepend=function(b,c){g.update("list prepend",this,[b,c]);var d=this.get(b);return d||(d=[]),this._prepCache(),this.deltaQ.push(new a.StoredDelta("linsert",b,c,0)),this.stateCache[b]=[c].concat(d),f.notify(this.eventname+"/change",this),this.controller.triggerPush()},h.prototype.listAppend=function(b,c){g.update("list append",this,[b,c]);var d=this.get(b);return d||(d=[]),this._prepCache(),this.deltaQ.push(new a.StoredDelta("linsert",b,c,d.length)),this.stateCache[b]=d.concat([c]),f.notify(this.eventname+"/change",this),this.controller.triggerPush()},h.prototype.listTruncate=function(b,c){g.update("list truncate",this,[b,c]);var d=this.get(b);return d||(d=[]),this._prepCache(),this.deltaQ.push(new a.StoredDelta("ltrunc",b,c)),d.length>c&&d.splice(c,d.length-c),this.stateCache[b]=d,f.notify(this.eventname+"/change",this),this.controller.triggerPush()},h.prototype.listRemove=function(b,c){g.update("list remove",this,[b,c]);var d=this.get(b)||[];return this._prepCache(),this.deltaQ.push(new a.StoredDelta("ldel",b,c)),this.stateCache[b]=_.without(d,c),f.notify(this.eventname+"/change",this),this.controller.triggerPush()},h.prototype.dictSet=function(b,c,d){g.update("dict set",this,[b,c,d]),this._prepCache();var e=_.clone(this.get(b));return this.deltaQ.push(new a.StoredDelta("hset",b,c,d)),e||(e={}),e[c]=d,this.stateCache[b]=e,f.notify(this.eventname+"/change",this),this.controller.triggerPush()},h.prototype.setPrivate=function(a,b){return this.privateState[a]=b,e.succeed()},h.prototype.getPrivate=function(a){return this.privateState[a]},h.prototype.immutableSet=function(a,c){var d=this.state[a];if(c!=d)throw b.warn("ERROR: attempt to change",a,"of",this,"from",d,"to",c),new Error("attempt to modify immutable field "+a);return e.succeed()},h.prototype.setValueIffDifferent=function(a,c,d,g){var h=this.get(a);return _.isEqual(h,c)?e.succeed(null):(b.verboseLog(this,"setValueIffDifferent",a,"from",h,"to",c),d&&f.notify(d,c,h,this),g&&g(c,h),f.notify(this.eventname+"/change",this),this.set(a,c))},h.prototype.get=function(a){return this.stateCache===null?this.state[a]:this.stateCache[a]},h.prototype.latestDelta=function(){return _.isEmpty(this.deltaQ)?null:this.deltaQ[this.deltaQ.length-1].id},h.prototype.getStateForBackend=function(){TD.config.debug_checks&&(b.precondition(this.isDirty(),"don't call getStateForBackend unless isDirty"),this.checkCache());var a=_.clone(this.stateCache!==null?this.stateCache:this.state);return!a.mtime&&this.state.mtime&&(a.mtime=this.state.mtime),{"Îid":this.latestDelta(),state:this.transformForRemote(a,this.privateState)}},h.prototype.postProcessNewRemoteState=function(){},h.prototype.newRemoteState=function(c){g.update("new remote state",this,c),TD.config.debug_checks&&(b.stateLog("checking cache"),this.checkCache()),b.verboseLog("transforming to local:",this,b.clone(c)),this.state=this.transformToLocal(c),this.deltaQ.length!==0?(b.assert(this.stateCache!==null,"if we have Îs, we should have cache"),b.verboseLog("applying pending deltas",this,b.clone(this.deltaQ)),this.stateCache=a.StoredDelta.applyMultiple(this.deltaQ,this.state)):b.assert(this.stateCache===null,"if no Îs, should have no cache"),this.postProcessNewRemoteState(),TD.config.debug_checks&&(b.stateLog("checking cache"),this.checkCache()),f.notify(this.eventname+"/change",this)},h.prototype.commit=function(c,d){g.update("commit",this,[c+" : "+d]);var e=_.pluck(this.deltaQ,"id").indexOf(c);if(e===-1)throw b.stateLog("asked to commit "+c+" but it doesn't exist in "+_.map(this.deltaQ,function(a){return a.toString()})),new Error("invalid deltaId supplied");TD.config.debug_checks&&this.checkCache();if(e===this.deltaQ.length-1)this.deltaQ=[],this.state=_.clone(this.stateCache),this.state.mtime=d,this.stateCache=null,TD.config.debug_checks&&this.checkCache();else{var f=this.deltaQ.splice(0,e+1),h=a.StoredDelta.applyMultiple(f,this.state);this.state=h,this.state.mtime=d,this.stateCache.mtime=d,TD.config.debug_checks&&this.checkCache(),this.controller.triggerPush()}},h.prototype.checkCache=function(){var c=a.StoredDelta.checkStateCache(this.state,this.deltaQ,this.stateCache);b.assert(c,"cache != state+Îs")},h.prototype.checkInvariants=function(){this.hasApiid()||b.assert(_.isEmpty(this.state),'must have no "state" if no apiid'),b.assert(this.state&&_.isUndefined(this.state.apiid),"apiid in non-priv state, bad"),this.isDirty()?(b.assert(!_.isEmpty(this.deltaQ),"deltaQ must be non-empty if dirty"),b.assert(this.stateCache!==null,"cache must be present if dirty"),this.checkCache(),this.hasApiid()&&b.assert(this.latestDelta()!==null,"latestDelta() must not return null for Îid for dirty object")):(b.assert(_.isEmpty(this.deltaQ),"deltaQ must be empty if not dirty"),b.assert(this.stateCache===null,"cache must be absent if not dirty"))},h.prototype.isDirty=function(){return this.hasApiid()?this.deltaQ.length!==0:(b.assert(this.deltaQ.length!==0,"should be dirty if no apiid"),!0)},h}(TD.storage,TD.sync.util,TD.sync.tdapi,TD.util,TD.core.defer,TD.storage.notification,TD.sync.trace),TD.storage.StoredDelta=function(a,b,c,d,e){function f(b){this.type=b,a.assert(i[b]&&g,"unknown type "+b),this.args=_.toArray(arguments).slice(1),this.id="Î"+(new Date).getTime()+_.uniqueId(":"),h(b,this.args),b==="init"&&(a.verboseLog("initialisation delta",this.id,this.args[0]),"mtime"in this.args[0]&&(a.warn("WARNING init Î contains mtime!",a.clone(this.args[0])),a._break()))}var g={init:1,set:2,del:1,lmove:3,ldel:2,linsert:3,ladd:3,ltrunc:2,hset:3,other:0},h=function(b,c){var d=g[b];a.assert(c.length===d,"wrong no. args for "+b+", expected "+d+" got "+c.length);switch(b){case"ltrunc":a.assert(typeof c[1]=="number","ltrunc: length must be number");break;case"linsert":case"ladd":case"ldel":case"lmove":a.assert(typeof c[1]=="string","list elements must be strings")}};f.prototype.toString=function(){return"StoredDelta["+this.id+"]("+this.type+": "+JSON.stringify(this.args)+")"},f.prototype.serialise=function(){return[this.type].concat(this.args)};var i={init:function(b,c){if(!_.isEqual(b,{})){var d=a.clone(b),e=a.clone(c);delete d.mtime,delete e.mtime;if(_.isEqual(d,e))return a.warn("WARNING Î init_state === state",a.clone(b),"init:",c.mtime,"state:",b.mtime),b;a.warn("WARNING discarding init_state",a.clone(c),"in favour of",a.clone(b));return}return _.clone(c)},set:function(a,b,c){return a[b]=c,a},del:function(a,b){return delete a[b],a},lmove:function(a,b,c,d){var e=_.clone(a[b]),f=e.indexOf(c);if(f==-1)return;return e.splice(f,1),e.splice(f+d,0,c),a[b]=e,a},ldel:function(a,b,c){var d;return _.isUndefined(a[b])?d=[]:d=_.without(a[b],c),a[b]=d,a},linsert:function(a,b,c,d){var e;return _.isUndefined(a[b])?e=[]:e=_.clone(a[b]),e.splice(d,0,c),a[b]=e,a},ladd:function(a,b,c,d){if(_.include(a[b],c))return a;var e;return _.isUndefined(a[b])?e=[]:e=_.clone(a[b]),e.splice(d,0,c),a[b]=e,a},ltrunc:function(a,b,c){var d;return _.isUndefined(a[b])?d=[]:d=a[b],d.length>c&&d.splice(c,d.length-c),a[b]=d,a},hset:function(a,b,c,d){var e=_.clone(a[b]);return e||(e={}),e[c]=d,a[b]=e,a}};f.prototype.apply=function(b){var c=_.clone(b),d=i[this.type],e=d.apply(this,[c].concat(this.args));return e?e:(a.warn("WARNING: unable to apply Î",this.toString(),"to",a.clone(b)),_.clone(b))},f.listPermutator=function(b,c,d){var e=[],g=_.clone(c);a.verboseLog("StoredDelta.listPermutator",c,"â",d);if(c.length!=_.union(c).length||d.length!=_.union(d).length)throw a.stateLog("Duplicate error in listPermutator",{original:c,original_:_.union(c),target:d,targetu:_.union(d)}),new TypeError("lists must not contain duplicates");_.each(_.difference(c,d),function(a){e.push(new f("ldel",b,a)),g.splice(g.indexOf(a),1)});for(var h=0;h<d.length;h++)if(g[h]!=d[h]){var i=d[h],j=g.indexOf(i);j===-1?(e.push(new f("ladd",b,i,h)),g.splice(h,0,i)):(e.push(new f("lmove",b,i,h-j)),g.splice(j,1),g.splice(h,0,i))}return e},f.applyMultiple=function(a,b){return _.reduce(a,function(a,b){return b.apply(a)},b)};var j=function(a,b){function c(){return a.apply(this,b)}return c.prototype=a.prototype,new c};return f.deserialiseDeltas=function(a){return _.map(a,function(a){return j(f,a)})},f.checkStateCache=function(b,c,d){if(d===null&&c.length===0)return!0;ccache=_.clone(d),delete ccache.mtime;var e=f.applyMultiple(c,_.clone(b));return delete e.mtime,_.isEqual(ccache,e)?!0:(a.stateLog("cache",d,"!= goal",e,"for",b,"+",c),!1)},f}(TD.sync.util,TD.sync.tdapi,TD.util,TD.core.defer,TD.storage.notification),TD.storage.SobjController=function(a,b,c,d,e,f){var g=function(){var a=this;this._objects=null,this._objectsByApiid=null,this.reqsinflight=null,this.apiEndpoint=null,this._moduleName=null};return g.prototype.toString=function(){return"<SobjController["+(this._moduleName||"unknown")+"]>"},g.prototype.triggerPush=function(){throw b.printStacktrace(),new Error("NotImplemented")},g.prototype.bindTrigger=function(c){var d=b.makeThingScheduler,e=a.store.getTweetdeckAccount;this.triggerPush=d(_.bind(this.pushDirty,this),null,c,e)},g.prototype.remove=function(a){var b=this._objects[a];b&&(b.managed=!1,b.hasApiid()&&delete this._objectsByApiid[b.getApiid()]),delete this._objects[a]},g.prototype.getAll=function(){return _.values(this._objects)},g.prototype.getByApiid=function(a){return b.assert(a,"must provide apiid; "+b.repr(a)),b.assert(a!="undefined","huh? where did that come from?"),this._objectsByApiid[a]},g.prototype.pushPreflight=function(){return e.succeed(null)},g.prototype.pushDirty=function(){TD.config.debug_checks&&this.checkInvariants();var a=_.uniqueId("pD:");f.push(this,"pushDirty",null,a);var b=this,c=this.pushPreflight();return c.addCallback(function(){var c=_.filter(b._objects,function(a){return a.isDirty()});if(_.isEmpty(c))return f.push(b,"(not dirty)",null,a),e.succeed();var d=b.pushObjects(c,a);return d.addCallback(function(){return b.pushDirty()}),d}),c},g.prototype.prePushCheckInvariants=function(a){return},g.prototype.pushObjects=function(a,d){b.verboseLog(this.toString()+".pushObjects()",this,a),d||(d=_.uniqueId("pO:")),f.push(this,"pushObjects",a,d),b.assert(this.apiEndpoint,"api endpoint must be set");if(_.isEmpty(a))return f.push(this,"(empty)",a,d),e.succeed([]);TD.config.debug_checks&&this.prePushCheckInvariants(a);var g=_.map(a,function(a){return a.getStateForBackend()}),h=_.pluck(g,"Îid"),i=_.pluck(g,"state");f.push(this,"objs+Îs",a,h,d),TD.config.debug_checks&&(_.each(i,function(a){b.assert(a.mtime||!a.id,"for a test and set request, we expect (require) either mtime (modify) or absence of id (create) for every object")}),_.isEmpty(this.reqsinflight)||(b.warn("WARNING! called pushObjects",a,"when already have requests in flight",b.clone(this.reqsinflight)),b._break()));var j={},k=c.requestWithBody(this.apiEndpoint,"POST",i,j,{"x-td-mtime-check":"partial"},d);if(TD.config.debug_checks){this.reqsinflight.push(k.reqid);var l=this;k.addBoth(function(a){return l.reqsinflight=_.without(l.reqsinflight,k.reqid),a})}return k.addCallbackWith(this,this._processTSResults,a,h,j,d),k},g.prototype._processTSResults=function(a,d,e,g,h){f.tsResults(this,a,d,e,g,h),a instanceof c.Conflict&&(f.conflicts(this,a.body,d,g,h),a=a.body),b.assert(a.length==d.length,"wrong number of responses/objects!"),b.assert(a.length==e.length,"wrong number of responses/deltas!"),b.verboseLog("objects",d,"deltas",e),_.each(e,function(a){b.assert(a!==null,"Îid must not be null")});var i=g["x-td-mtime"];b.assert(i,"require x-td-mtime header in object PUT");var j,k=this,l=function(a,c){b.verboseLog("_processTSResults:check_set_apiid",a,c),a.hasApiid()?b.assert(a.getApiid()==c,"apiid mismatch"):(k._objectsByApiid[c]=a,a.setApiid(c))};for(var m=0;m<a.length;m++)j=a[m],_.isString(j)?(b.verboseLog("_processTSResults",d[m],a[m]),l(d[m],a[m]),d[m].commit(e[m],i)):(f.conflict(this,j,d[m],g,h),b.verboseLog("_processTSResults: not an apiid:",j),d[m].newRemoteState(a[m]))},g.prototype.pushObject=function(a,d){b.verboseLog(this.toString()+".pushObject()",this,a,d),f.push(this,"object",a);var e=a.getStateForBackend(),g=e["Îid"],h=e.state;b.assert(h.mtime,"for a test and set request, we expect (require) mtime");var i={},j=c.requestWithBody(d,"PUT",h,i,{"x-td-iff-mtime":h.mtime});return j.addCallbackWith(this,this._processTSResult,a,g,i),j},g.prototype._processTSResult=function(a,d,e,g){f.tsResult(this,a,d,e,g),b.verboseLog("object",d,"delta",e),b.assert(e!==null,"Îid must not be null");var h;if(a instanceof c.Conflict)b.verboseLog("_processTSResult: got a conflict:",a),h=d.newRemoteState(a.body);else{b.assert(_.isString(a),"don't know how to handle response");var i=g["x-td-mtime"];b.assert(i,"require x-td-mtime header in object PUT"),b.verboseLog("_processTSResult",d,a),h=d.commit(e,i)}return h},g.prototype.checkInvariants=function(){var a=this;_.each(this._objects,function(c){var d=c.checkInvariants;d&&d.call(c),c.hasApiid()&&b.assert(a._objectsByApiid[c.getApiid()],"all managed objects with apiid must be in _objectsByApiid")})},g}(TD.storage,TD.sync.util,TD.sync.tdapi,TD.storage.notification,TD.core.defer,TD.sync.trace),TD.storage.FeedController=function(a,b,c,d,e){var f=function(){var c=this;this.apiEndpoint="/feeds",this._moduleName="feeds",this.reqsinflight=[],this.bindTrigger("feedctr"),c._objects={},c._objectsByApiid={},this.toString=function(){return"<FeedController>"},this.init=function(){b.trace("feedController init"),TD.config.debug_checks&&this.checkInvariants()},this.reset=function(){this._objects={},this._objectsByApiid={}},this.updateFromBackend=function(c){var e=this;b.stateLog("feedController.updateFromBackend:",c),_.each(c,function(b,c){var f=e._objectsByApiid[c];f?(f.newRemoteState(b),d.notify("/storage/feed/updated",f)):(f=a.Feed.newFromBackendState(b),f.setApiid(c),e.manage(f),d.notify("/storage/feed/new",f))})},this.get=function(a){return this._objects[a]},this.manage=function(a){a.managed=!0;var d=this._objects[a.getKey()];return d&&a===d?c.triggerPush():(d&&(b.warn("WARNING replacing feed",d,"with",a,"please use feedController.getOrCreateFeed",[b.getStack().split("\n")]),d.getLatestTime()>a.getLatestTime()&&b.warn("Warning: latestTime weirdness:",d.getLatestTime(),a.getLatestTime()),d.hasApiid()&&a.setApiid(d.getApiid()),d.isDirty()&&(!!_.isEmpty(d.deltaQ)||d.deltaQ[0].type!="init")&&b.assert(!d.isDirty(),"houston, we have a problem")),this._objects[a.getKey()]=a,a.hasApiid()&&(this._objectsByApiid[a.getApiid()]=a),c.triggerPush())},this.manageFeeds=function(a){for(var b=0;b<a.length;b++)c.manage(a[b])},this._selfcheckapiids=function(){for(var a in this._objects){var b=this._objects[a];b.apiid&&_assert(b==c.getByApiid(b.apiid),"lookup failed")}},c.isEmpty=function(){return _.isEmpty(this._objects)},c.getOrCreateFeed=function(b,c,d,e,f){var g,h,i,j;b==="search"&&!e.term&&e.baseQuery&&e.searchFilterData&&(g="xq"+Math.floor(Math.random()*1e5),h=new TD.vo.SearchFilter(e.searchFilterData),e.term=[e.baseQuery,h.getQueryString(),"-"+g].join(" ")),j=a.Feed.generateKeyFor(d,b,e),i=this._objects[j],b==="list"&&(e.screenName=e.ownerId,e.slug=e.listId);if(!i){var k={type:b,service:c,accountkey:d,metadata:e,apiid:f};i=new a.Feed(k)}return f&&(i.apiid=f,this._objectsByApiid[f]=i),i}};return f.prototype=new a.SobjController,a.feedController=new f,f}(TD.storage,TD.sync.util,TD.sync.tdapi,TD.storage.notification,TD.core.defer),TD.storage.ColumnController=function(a,b,c,d,e){var f=function(){var c=this;this.apiEndpoint="/columns",this._moduleName="columns",this.reqsinflight=[],this.bindTrigger("colctr"),$.subscribe("/storage/account/new",function(a){c.addToCombinedColumns(a)}),this._objects={},this._objectsByApiid={},this.toString=function(){return"<ColumnController>"},this.init=function(){b.trace("columnController init"),TD.config.debug_checks&&this.checkInvariants()},this.reset=function(){this._objects={},this._objectsByApiid={}},this.updateFromBackend=function(c){var e=this;b.stateLog("columnController.updateFromBackend:",c),_.each(c,function(b,c){var f=e._objectsByApiid[c];f?f.newRemoteState(b):(f=a.Column.newFromBackendState(b),f.setApiid(c),e.manage(f),d.notify("/storage/column/new",f))})},this.get=function(a){return this._objects[a]},this.getColumnsContainingFeed=function(a){var b=[];return _.each(this._objects,function(c){_.each(c.getFeedKeys(),function(d){d==a&&b.push(c)})}),b},this.getColumnsByType=function(a){return _.filter(this._objects,function(b){return b.getType()===a})},this.manage=function(a){return a.managed=!0,b.assert(a.getKey(),"columns must have valid keys to be managed!"),this._objects[a.getKey()]=a,a.hasApiid()&&(this._objectsByApiid[a.getApiid()]=a),this.triggerPush()},this.remove=function(a){var b=this._objects[a];b&&(b.managed=!1),delete this._objects[a]},this.getAll=function(){return _.values(this._objects)},this.getByApiid=function(a){b.assert(a,"must provide apiid; "+b.repr(a)),b.assert(a!=="undefined","huh? where did that come from?");var c=this._objectsByApiid[a];return c||(b.warn("WARNING: col ",a," not found in cols_by_apiid ",_.keys(this._objectsByApiid)),b.stateLog("this._objects, apiids; ",b.pformat(_.map(this._objects,function(a,b){return[b,a.getApiid()]})))),c},this.isEmpty=function(){return _.isEmpty(this._objects)},this._selfcheckapiids=function(){for(var a in this._objects){var b=this._objects[a];b.hasApiid()&&_assert(b==this.getByApiid(b.getApiid()),"lookup failed")}},this.addToCombinedColumns=function(c){b.stateLog("ADDING ACCOUNT TO COMBINED COLS",c);var d=a.clientController.client.getColumnOrder(),e,f={home:!0,me:!0,privateMe:!0},g,h,i,j,k,l=function(a){return a.getKey()};m:for(var n=0;n<d.length;n++){e=this.get(d[n]);if(!e){b.warn("Warning: Column not found!"),b._break();continue}g=e.getType();if(f[g]){j=null;switch(g){case"me":j=this.getMeFeeds([c]);break;case"privateMe":j=this.getInboxFeeds([c])}j&&(k=_.map(j,l),e.setFeedKeys(e.getFeedKeys().concat(k)),e.managed&&a.feedController.manageFeeds(j))}}};var e=function(b,c){var d=a.feedController;return d.getOrCreateFeed(b,c.getType(),c.getKey(),{})};this.getMeFeeds=function(a){var b=[];for(var c=0;c<a.length;c++)a[c].getType()==="twitter"&&b.push(e("mentions",a[c]));return b},this.getInboxFeeds=function(a){var b=[];for(var c=0;c<a.length;c++)a[c].getType()==="twitter"&&b.push(e("direct",a[c]));return b},this.prePushCheckInvariants=function(c){_.each(c,function(c){_.each(c.getFeedKeys(),function(c){b.assert(a.feedController.get(c),"feeds must exist + be managed in columns push; "+c),b.assert(a.feedController.get(c).hasApiid(),"feeds must all have apiid in columns push; "+c)})})}};return f.prototype=new a.SobjController,f.prototype.pushPreflight=function(){return a.feedController.triggerPush(.05)},a.columnController=new f,f}(TD.storage,TD.sync.util,TD.sync.tdapi,TD.storage.notification,TD.core.defer),TD.storage.AccountController=function(a,b,c,d,e){var f=function(){var f=this;this._moduleName="accounts",this.LAST_VERIFIED_STORAGE_KEY="accounts_last_verified",this.reqsinflight=[],f.ACCEPTED_ACCOUNT_TYPES={twitter:!0,bitly:!0},this._objects={};var g={};f.blacklistAccount=function(c){b.stateLog("blacklisting",c);var e=c.getKey();a.clientController.client.addToAccountBlacklist(e),this._objects[e]&&f.remove(e),a.clientController.client.delFromAccountWhitelist(e),d.notify("/storage/account/blacklisted",c)},f.whitelistAccounts=function(c){b.stateLog("whitelisting",c),a.clientController.client?_.each(c,function(b){a.clientController.client.addToAccountWhitelist(b.getKey()),a.clientController.client.delFromAccountBlacklist(b.getKey())}):b.warn("Can't update whitelist: client not initialised")},f.isEmpty=function(){return _.isEmpty(this._objects)},f.getDefault=function(){var b=a.clientController.client.getDefaultAccount();return b&&this._objects[b]?this._objects[b]:f.isEmpty()?null:(f.setDefault(f.getAll()[0].getKey()),this._objects[a.clientController.client.getDefaultAccount()])},f.setDefault=function(b){a.clientController.client.setDefaultAccount(b)},f.getAccountsForService=function(a){return _.select(this._objects,function(b){return b.getType()===a})},f.getAccountFromUsername=function(a){var b=f.getAccountsForService("twitter");return a=a.toLowerCase(),_.select(b,function(b){return b.getUsername().toLowerCase()===a})},f.getPreferredAccount=function(a){var b=f.getDefault();return b&&(!a||b.getType()==a)?b:f.getAccountsForService(a)[0]},this.init=function(){b.trace("accountController init"),jQuery.subscribe("/storage/client/change",function(a){_.each(a.getAccountBlacklist(),function(a){f._objects[a]&&f.remove(a)})})},this.reset=function(){this._objects={}},this.triggerPush=function(){b.assert(!1,"triggerPush() should not be called on account controller")};var h=function(c,d){var e=b.list_to_set(d.settings.account_whitelist||[]),h=b.list_to_set(d.settings.account_blacklist||[]),i={},j=c||[],k=[],l=[];return _.each(j,function(b){var c=a.Account.generateKeyFor(b.service,b.uid);if(h[c])return;if(e[c]){if(!f.ACCEPTED_ACCOUNT_TYPES[b.service])return;i[b.service]=!0,k.push(b)}else{if(!f.ACCEPTED_ACCOUNT_TYPES[b.service])return;if(b.uid==1e3)return;if(b.service!=="bitly"&&(!b.key||!b.secret))return;if(b.service==="bitly"&&!b.key)return;l.push(b)}}),_.each(f.getAll(),function(a){h[a.getKey()]||(i[a.getType()]=!0)}),l.sort(f.accountComparator),l=_.select(l,function(b){var c=a.Account.generateKeyFor(b.service,b.uid);if(b.service==="twitter"||!i[b.service]){i[b.service]=!0;if(!f._objects[c])return!0}return!1}),g=_.map(l,function(b){return a.Account.newFromBackendState(b)}),k};this.updateFromBackend=function(c,d){b.stateLog("accountController.updateFromBackend:",c),c=h(c,d);var e=this;_.each(c,function(c){var d=a.Account.generateKeyFor(c.service,c.uid),f=e._objects[d];f?(b.stateLog("updating existing",f,"with",c),f.newRemoteState(c)):(b.stateLog("creating new Account with",c),f=a.Account.newFromBackendState(c),e.manage(f))})},this.get=function(a){return a==="tweetdeck"?{getKey:function(){return"tweetdeck"},getUserID:function(){return"tweetdeck"},getType:function(){return"tweetdeck"}}:this._objects[a]},this.manage=function(a){if(!a.getKey())throw{name:"TypeError",message:"account must have its .key set"};return a.managed=!0,this._objects[a.getKey()]||d.notify("/storage/account/new",a),this._objects[a.getKey()]=a,this.whitelistAccounts([a]),this.saveLastVerifiedTimestamp(a),this.pushAccount(a)},this.getLastVerifiedTimestamp=function(b){var c=a.store.get(this.LAST_VERIFIED_STORAGE_KEY),d=c[b.getKey()]||0,e=b.getUpdated()||0;return Math.max(d,e)},this.saveLastVerifiedTimestamp=function(b){var c=a.store.get(this.LAST_VERIFIED_STORAGE_KEY),d=c[b.getKey()]||0,e=b.getUpdated()||0,f=Math.max(d,e);f!==d&&(c[b.getKey()]=f,a.store.set(this.LAST_VERIFIED_STORAGE_KEY,c))},this.removeLastVerifiedTimestamp=function(b){var c=a.store.get(this.LAST_VERIFIED_STORAGE_KEY);delete c[b.getKey()],a.store.set(this.LAST_VERIFIED_STORAGE_KEY,c)},f.remove=function(a){var b=this._objects[a];b.managed=!1,delete this._objects[a],d.notify("/storage/account/removed",b),this.removeLastVerifiedTimestamp(b)},f.getAll=function(){var a=_.values(this._objects);return a.sort(f.accountComparator),a},f.getPostingAccounts=function(){return _.filter(f.getAll(),function(a){return a.getType()!=="bitly"})},f.accountComparator=function(a,b){var c=a.getType?a.getType():a.service,d=b.getType?b.getType():b.service,e=a.getUserID?a.getUserID():a.uid,f=b.getUserID?b.getUserID():b.uid,g=c=="twitter"?2:1,h=d=="twitter"?2:1;return g<h?1:g>h?-1:g==2&&h==2?e>f?1:-1:c>d?1:-1},f.getDefaults=function(){var a=f.getAll(),b=f.getDefault(),c=[],d={};b&&(d[b.getType()]=!0,c.push(b));for(var e=0;e<a.length;e++)d[a[e].getType()]||(d[a[e].getType()]=!0,c.push(a[e]));return c},f.loginTweetdeck=function(a,d,e){b.stateLog("aC.loginTweetdeck()",a,d,e),d!==null&&(e=TD.core.sha1(d));var f=c.login(a,e);return f.addCallback(function(b){return{tweetdeck_account:{email:a,password:e,plaintext_password:d},data:b}}),f},f.createTweetdeckAccount=function(a,d){b.stateLog("aC.createTweetdeckAccount()",a,d);var e=TD.core.sha1(d),f=c.createAccount(a,e);return f.addErrback(b.errmark,"accountController.js:createTweetDeckAccount():->tdapi.createAccount()"),f.addCallback(function(){return{tweetdeck_account:{email:a,password:e,plaintext_password:d},data:{accounts:[]}}}),f.addErrback(b.errmark,"accountController.js:createTweetDeckAccount()"),f},f.pushAccounts=function(){return e.gatherResults(_.map(this._objects,function(a){return f.pushAccount(a)}))},f.pushAccount=function(a){if(!c.isLoggedIn())return;var b=a.getKey();if(!b||!this._objects[b])return;var d=a.getStateForBackend(),e="/accounts/"+a.getType()+"/"+a.getUserID();return c.requestWithBody(e,"POST",d)},f.deleteAccount=function(a){b.stateLog("sync.controller.deleteAccount:",a);var d="/accounts/"+a.getType()+"/"+a.getUserID();return c.drequest(d,c.getReq({method:"DELETE"}))},f.verifyStoredAccounts=function(){var a=!0,b=!1,c=[],d=Date.now()-TD.constants.time.oneDay,h=f.getAll(),i=function(a,b){var c=TD.controller.auth.create(a.getType(),a),d=new e.Deferred;return c.verifyAccount(_.bind(d.callback,d),_.bind(d.errback,d)),b&&d.addErrback(function(){}),d.addCallback(function(){TD.storage.accountController.manage(a)}),d};return _.each(h,function(a){(b||this.getLastVerifiedTimestamp(a)<d||!a.getProfileImageURL()||!a.getUsername()||!a.getName())&&c.push(i(a,!0))}.bind(this)),a&&(_.each(g,function(a){if(!f.ACCEPTED_ACCOUNT_TYPES[a.getType()])return;c.push(i(a,!1))}),g=[]),new e.DeferredList(c)}};return f.prototype=new a.SobjController,a.accountController=new f,f}(TD.storage,TD.sync.util,TD.sync.tdapi,TD.storage.notification,TD.core.defer),TD.storage.ClientController=function(a,b,c,d,e,f,g){var h=function(){var c=this;this.apiEndpoint="/clients",_.defer(function(){var d=b.makeThingScheduler,e=a.store.getTweetdeckAccount;c.triggerPush=d(_.bind(c.pushIfDirty,c),null,"clisync",e)}),this._moduleName="clients",this.reqsinflight=[],this._objects={},this._objectsByApiid=this._objects,this.client=null,this.toString=function(){return"<ClientController>"},this.init=function(){b.stateLog("client controller init start",this.client),b.trace("clientController init"),TD.config.sync_name in this._objects?(this.client=this._objects[TD.config.sync_name],b.assert(this.client.getName(),"need name!"),b.stateLog("client controller new client:",this.client)):b.stateLog("no initial client state; deferring client creation"),b.stateLog("clientController.init: client: ",this.client)},this.reset=function(){this.client=null},this.createNewClient=function(){b.stateLog("clientController.createNewClient()");var c=this,e={name:TD.config.sync_name,columns:[],settings:{}},f={},g=d.requestWithBody("/clients","POST",e,f);return g.addCallback(function(){b.stateLog("createNewClient resp headers; ",f);var d=f["x-td-mtime"];return b.assert(d,"require x-td-mtime header in client POST"),e.mtime=d,c.client=a.Client.newFromBackendState(e),b.assert(c.client.getName(),"Client should have name at this point"),c._objects[c.client.getName()]=c.client,b.stateLog("clientController.createNewClient with",c.client.state),c.triggerPush()}),g},this.updateFromBackend=function(c){this.client===null?(this.client=a.Client.newFromBackendState(c),this._objects[this.client.getName()]=this.client,b.stateLog("client controller (ufb) new client:",this.client)):this.client.newRemoteState(c)},this.pushIfDirty=function(){TD.config.debug_checks&&this.checkInvariants(),g.push(this,"dirty",null);if(this.client.isDirty()){g.push(this,"dirty",this.client);var c=this,d=a.columnController.triggerPush();return d.addCallback(function(){return b.assert(c.client.isDirty(),"?!? push dirty, but not dirty"),c.pushObject(c.client,"/clients/"+c.client.getName())}),d.addCallback(function(){return c.pushIfDirty()}),d}return g.push(this,"not dirty",null),f.succeed()}};return h.prototype=new a.SobjController,a.clientController=new h,h}(TD.storage,TD.sync.util,TD.util,TD.sync.tdapi,TD.storage.notification,TD.core.defer,TD.sync.trace),TD.storage.Feed=function(a,b,c,d){var e=function(a,b){this._init(a),_.isUndefined(b)||(this.state=this.transformToLocal(b)),this.setKey(e.generateKeyFor(this.getAccountKey(),this.getType(),this.getMetadata()))};return e.prototype=new a.StoredObj(a.feedController),e.prototype.eventname="/storage/feed",e.generateKeyFor=function(a,c,d){d=d||{};var e=TD.util.deterministicObjectHash(d),f=[a,c,e];return b.assert(a,"accountkey not set in Feed.generateKey"),b.assert(c,"type not set in Feed.generateKey"),encodeURI(f.join(":"))},e.prototype.getType=function(){return this.get("type")},e.prototype.setType=function(a){return this.immutableSet("type",a)},e.prototype.getService=function(){return this.get("service")},e.prototype.setService=function(a){return this.immutableSet("service",a)},e.prototype.getAccountKey=function(){return this.get("accountkey")},e.prototype.setAccountKey=function(a){return this.immutableSet("accountkey",a)},e.prototype.getLatestTime=function(){var a=this.get("marks");if(!a||_.isEmpty(a))return 0;var b=a[0];return b.last_notification||0},e.prototype.setLatestTime=function(a){var b=this.get("marks");return!b||_.isEmpty(b)?this.set("marks",[{last_notification:a}]):(b[0].last_notification=a,this.set("marks",b))},e.prototype.getMetadata=function(){return _.clone(this.get("metadata"))},e.prototype.setMetadata=function(a){return this.immutableSet("metadata",a)},e.prototype.transformForRemote=function(c,d){var e=a.accountController.get(c.accountkey);b.assert(e&&e.getUserID(),"must have acct + uid for feed transform");var f=e.getUserID(),g={type:c.type,service:c.service,account:{userid:f.toString()},metadata:JSON.stringify(c.metadata),marks:c.marks};return c.mtime&&(g.mtime=c.mtime),d.apiid&&(g.id=d.apiid),g},e.prototype.reprocessNotificationMarks=function(a,b){var c=null,d=null;b&&b.marks&&!_.isEmpty(b.marks)&&(c=b.marks[0].last_notification,d=b.marks);if(a.marks&&!_.isEmpty(a.marks)){d=a.marks;var e=a.marks[0].last_notification;c&&e?c=Math.max(c,e):e&&(c=e)}return d?d[0].last_notification=c:c?d=[{last_notification:c}]:d=[],d},e.prototype.transformToLocal=function(b){var c={type:b.type,service:b.service,accountkey:a.Account.generateKeyFor(b.service,b.account.userid),metadata:JSON.parse(b.metadata),mtime:b.mtime,marks:b.marks};return c},e.newFromBackendState=function(a){return new e(null,a)},e}(TD.storage,TD.sync.util,TD.sync.tdapi,TD.util),TD.storage.Column=function(a,b,c,d,e){var f=function(a){this._init(a),this.privateState.key||(this.privateState.key="c"+(new Date).getTime()+_.uniqueId("s"))};f.prototype=new a.StoredObj(a.columnController),f.prototype.eventname="/storage/column",f.prototype.getTitle=function(){var a=this.get("title");return _.isUndefined(a)?"loadingâ¦":a},f.prototype.setTitle=function(a){return this.set("title",a)},f.prototype.getDescription=function(){return this.get("description")},f.prototype.setDescription=function(a){return this.set("description",a)},f.prototype.getType=function(){return this.get("type")},f.prototype.setType=function(a){return this.set("type",a)},f.prototype.getFilters=function(){return this.get("filters")},f.prototype.setFilters=function(a){return this.setValueIffDifferent("filters",a)},f.prototype.getHasSound=function(){var a=this.get("settings");return Boolean(a&&a.has_sound)},f.prototype.setHasSound=function(a){return a=Boolean(a),e.notify("/storage/column/column_flags_changed","has_sound",a,this),this.dictSet("settings","has_sound",a)},f.prototype.getHasNotification=function(){var a=this.get("settings");return Boolean(a&&a.has_notification)},f.prototype.setHasNotification=function(a){return a=Boolean(a),e.notify("/storage/column/column_flags_changed","has_notification",a,this),this.dictSet("settings","has_notification",a)},f.prototype.getMediaPreviewSize=function(){var a=this.get("settings");return a?a.media_preview_size:null},f.prototype.setMediaPreviewSize=function(a){return $(document).trigger("dataColumnSettings",{columnKey:this.getKey(),mediaPreviewSize:a}),this.dictSet("settings","media_preview_size",a)},f.prototype.getClearedTimestamp=function(){var a=this.get("settings");return a&&a.cleared_timestamp?a.cleared_timestamp:0},f.prototype.setClearedTimestamp=function(a){return e.notify("/storage/column/column_marks_changed","cleared_timestamp",a,this),this.dictSet("settings","cleared_timestamp",a)},f.prototype.getFeedKeys=function(){return this.get("feedkeys")},f.prototype.setFeedKeys=function(a){return this.setValueIffDifferent("feedkeys",_.isArray(a)?_.uniq(a.sort(),!0):a,"/storage/column/feeds_changed")};var g=["mtime","type","title","description","settings","position","bookmarks","filters"];return f.prototype.transformForRemote=function(c,d){var e=function(c){var d=a.feedController.get(c);return b.assert(d&&d.hasApiid(),"feeds must have apiid when transforming column for remote"),d.getApiid()},f={};return _.each(g,function(a){f[a]=c[a]}),f.feeds=_.map(c.feedkeys,e),c.mtime&&(f.mtime=c.mtime),d.apiid&&(f.id=d.apiid),f},f.prototype.transformToLocal=function(c){TD.config.debug_checks&&_.each(c.feeds,function(d){b.assert(a.feedController.getByApiid(d),"feed not found by apiid in "+b.pformat(c.feeds))});var d={};return _.each(g,function(a){d[a]=c[a]}),d.feedkeys=_.map(c.feeds,function(b){return a.feedController.getByApiid(b).getKey()}),d.apiid=c.id,d},f.newFromBackendState=function(a){var b=new f;return b.newRemoteState(a),b},f}(TD.storage,TD.sync.util,TD.sync.tdapi,TD.util,TD.storage.notification),TD.storage.Account=function(a,b,c,d,e){var f={oauth_token:"t",token_secret:"s"},g=function(c){c?(this.state=_.clone(c),this.privateState={}):(this.state={},this.privateState={});var d=this,e=function(){d.controller.pushAccount(d)},f=a.store.getTweetdeckAccount;this.triggerPush=b.makeThingScheduler(e,null,"account",f,.2)};g.prototype=new a.StoredObj(a.accountController),g.prototype.eventname="/storage/account",g.generateKeyFor=function(a,b){return a==="tweetdeck"?"tweetdeck":encodeURI(a+":"+b)},g.prototype.computeKey=function(){if(!this.getType()||!this.getUserID())throw{name:"NotReadyError",message:"cannot computeKey on account; insufficient data"};this.setKey(g.generateKeyFor(this.getType(),this.getUserID()))},g.prototype.set=function(a,b){return this.state[a]=b,c.notify(this.eventname+"/change",this),this.triggerPush()},g.prototype.checkInvariants=function(){b.assert(_.isEmpty(this.deltaQ),"Accounts must not have Îs"),b.assert(this.stateCache===null,"Accounts do not use stateCache")},g.prototype.getUsername=function(){return this.get("username")},g.prototype.setUsername=function(a){return this.set("username",a)},g.prototype.getName=function(){return this.get("name")},g.prototype.setName=function(a){return this.set("name",a)},g.prototype.getUserID=function(){return this.get("userId")},g.prototype.setUserID=function(a){return this.set("userId",a)},g.prototype.getType=function(){return this.get("type")},g.prototype.setType=function(a){return this.set("type",a)},g.prototype.getOAuthToken=function(){return this.get("oauth_token")},g.prototype.setOAuthToken=function(a){return this.set("oauth_token",a)},g.prototype.getTokenSecret=function(){return this.get("token_secret")},g.prototype.setTokenSecret=function(a){return this.set("token_secret",a)},g.prototype.getProfileImageURL=function(){return this.get("profileImageURL")},g.prototype.setProfileImageURL=function(a){return this.set("profileImageURL",a)},g.prototype.getIsPrivate=function(){return this.getPrivate("isPrivate")},g.prototype.setIsPrivate=function(a){return this.setPrivate("isPrivate",a)},g.prototype.getUpdated=function(){return this.getPrivate("updated")},g.prototype.setUpdated=function(a){return this.setPrivate("updated",a)},g.prototype.getStateForBackend=function(){var a={secret:this.getTokenSecret(),screen_name:this.getUsername(),name:this.getName(),avatar:this.getProfileImageURL(),key:this.getOAuthToken()};return a};var h={key:"oauth_token",token:"oauth_token",secret:"token_secret",screen_name:"username",service:"type",uid:"userId",avatar:"profileImageURL",name:"name"};return g.prototype.newRemoteState=function(a){var c=this;b.stateLog(this,".updateFromBackend(",a,")"),_.each(h,function(b,d){a[d]&&c.set(b,a[d])})},g.newFromBackendState=function(a){var b=new g;return b.newRemoteState(a),b.computeKey(),b},g.prototype.isSameUser=function(a){return this.getUsername().toLowerCase()===a.toLowerCase()},g}(TD.storage,TD.sync.util,TD.storage.notification,TD.util,TD.core.base64),TD.storage.Client=function(a,b,c,d,e,f,g){var h=10,i=function(a){b.trace("Client constructor:"),b.stateLog("Client constructor: ",a);var c=a&&a.column_order;c&&!_.isEqual(c,_.union(c))&&(b.warn("WARNING! removing duplicates in column_order",_.clone(c)),a.column_order=_.union(c)),b.assert(!a||!a.columns,'"columns" should not be in local client state'),this._init(a),this.managed=!0,TD.config.debug_checks&&this.checkInvariants()};i.prototype=new a.StoredObj(a.clientController),i.prototype.eventname="/storage/client",i.prototype.recent_searches_limit=h,i.prototype.getName=function(){return this.get("name")},i.prototype.getApiid=function(){return this.get("name")},i.prototype.hasApiid=function(){return!0},i.prototype.getColumnOrder=function(){return _.clone(this.get("column_order")||[])},i.prototype.setColumnOrder=function(a){_.each(a,function(a){b.precondition(typeof a=="string","must provide string column keys")});var c=this.get("column_order");if(!_.isEqual(a,_.union(a)))throw b.warn("ERROR: column_order contains duplicates:",a),new Error("column_order must not contain duplicates");return e.notify("/storage/client/column_order_changed"),this.setListPermutation("column_order",a)},i.prototype.removeColumn=function(a){return e.notify("/storage/client/column_order_changed"),this.listRemove("column_order",a)},i.prototype.appendColumn=function(a){return e.notify("/storage/client/column_order_changed"),this.listAppend("column_order",a)},i.prototype.getAccountBlacklist=function(){return _.clone(this.get("account_blacklist")||[])},i.prototype.addToAccountBlacklist=function(b){var c=this.get("account_blacklist")||[];if(_.include(c,b))return f.succeed(null);var d=this.listAppend("account_blacklist",b);return e.notify("/storage/client/account_blacklist_changed",c,this.get("account_blacklist"),this),a.accountController.remove(b),d},i.prototype.delFromAccountWhitelist=function(a){var b=this.get("account_whitelist")||[];if(!_.include(b,a))return f.succeed(null);var c=this.listRemove("account_whitelist",a);return e.notify("/storage/client/account_whitelist_changed",b,this.get("account_whitelist"),this),c},i.prototype.addToAccountWhitelist=function(a){var b=this.get("account_whitelist")||[];if(_.include(b,a))return f.succeed(null);var c=this.listAppend("account_whitelist",a);return e.notify("/storage/client/account_whitelist_changed",b,this.get("account_whitelist"),this),c},i.prototype.delFromAccountBlacklist=function(a){var b=this.get("account_blacklist")||[];if(!_.include(b,a))return f.succeed(null);var c=this.listRemove("account_blacklist",a);return e.notify("/storage/client/account_blacklist_changed",b,this.get("account_blacklist"),this),c},i.prototype.getAccountWhitelist=function(){return _.clone(this.get("account_whitelist"))},i.prototype.getDefaultAccount=function(){return this.get("default_account")},i.prototype.addRecentSearch=function(a){return f.gatherResults([this.listRemove("recent_searches",a),this.listPrepend("recent_searches",a),this.listTruncate("recent_searches",this.recent_searches_limit)])},i.prototype.getRecentSearches=function(){return this.get("recent_searches")||[]},i.prototype.clearRecentSearches=function(){this.set("recent_searches",[])},i.prototype.postProcessNewRemoteState=function(){var a=this.getColumnOrder(),c=_.union(a);_.isEqual(c,a)||(b.warn("WARNING! found duplicates in column order, collapsing",a),this.state.column_order=c)},i.prototype.setDefaultAccount=function(a){return b.assert(!_.isUndefined(a),"huh? you wanted to do what now?"),this.setValueIffDifferent("default_account",a,"/storage/client/default_account_changed")};var j=["account_blacklist","account_whitelist","default_account","settings","recent_searches"];return i.prototype.transformForRemote=function(c,d){b.stateLog("Client.transformToLocal L",c);var e={};_.each(j,function(a){c[a]&&(e[a]=c[a])});var f={settings:e,name:c.name};return f.columns=_.map(c.column_order||[],function(c){var d=a.columnController.get(c);return b.assert(d.hasApiid(),"Column "+c+" does not have apiid",d),d.getApiid()}),c.mtime&&(f.mtime=c.mtime),b.stateLog("Client.transformToLocal R",f),f},i.prototype.transformToLocal=function(c){b.stateLog("Client.transformToLocal R",c);var d={},e=!1;d.column_order=_.filter(_.map(c.columns,function(d){if(!d)return b.warn("WARNING: bogus data in rstate.columns!",b.pformat(c.columns)),null;var f=a.columnController.getByApiid(d);return f||(b.stateLog("allocating new empty local sColumn for",d),f=new a.Column,f.setApiid(d),a.columnController.manage(f),e=!0),f.getKey()}),Boolean),e&&TD.sync.controller.ueberpull();var f=c.settings||{};return _.each(j,function(a){f[a]&&(d[a]=f[a])}),d.mtime=c.mtime,d.name=c.name,b.stateLog("Client.transformToLocal L",d),d},i.prototype.setApiid=function(a){b.assert(!1,"no-one should ever set apiid on Client")},i.newFromBackendState=function(a){var b=new i;return b.newRemoteState(a),b},i}(TD.storage,TD.sync.util,TD.sync.tdapi,TD.util,TD.storage.notification,TD.core.defer,TD.sync.trace),TD.settings=function(a,b){function z(a,c){return b.notify(e+a,c),_.isEqual(c,A(a))?TD.core.defer.succeed():(y.indexOf(a)===-1&&(_.isString(c)||_.isBoolean(c)||_.isNumber(c))&&TD.controller.stats.setting(a,c),f.dictSet("settings",a,c))}function A(a){var b=f.get("settings"),c=void 0;b&&(c=b[a]),_.isUndefined(c)&&(c=d[a]);if(_.isArray(c)||_.isObject(c))c=TD.sync.util.clone(c);return c}var c={},d={},e="/storage/client/settings/",f,g="use_stream",h="use_notification_sound",i="language",j="check_for_updates",k="use_narrow_columns",l="column_width",m="font_size",n="theme",o="scheduled_col_autoadded",p="link_shortener",q="use_jmp",r="global_filter",s="previous_splash_version",t="show_startup_notifications",u="name_cache",v="seen_message_ids",w="navbar_width",x="display_sensitive_media",y=[s];return c.linkShorteners=[{id:"twitter",title:"Twitter"},{id:"bitly",title:"Bit.ly"}],c.init=function(){f=a.clientController.client},d[g]=!0,c.getUseStream=function(){return Boolean(A(g))},c.setUseStream=function(a){return z(g,Boolean(a))},d[h]=!0,c.getUseNotificationSound=function(){return Boolean(A(h))},c.setUseNotificationSound=function(a){return z(h,Boolean(a))},c.getLanguage=function(){return String(A(i))},c.setLanguage=function(a){return z(i,String(a))},d[j]=!0,c.getCheckForUpdates=function(){return Boolean(A(j))},c.setCheckForUpdates=function(a){return z(j,Boolean(a))},d[k]=!1,d[l]="medium",c.getColumnWidth=function(){var a=A(k);if(_.isBoolean(a)){z(k,null);if(a)return c.setColumnWidth("narrow"),"narrow"}return A(l)},c.setColumnWidth=function(a){return z(l,a)},d[m]="medium",c.getFontSize=function(){return A(m)},c.setFontSize=function(a){return z(m,a)},d[n]="light",c.getTheme=function(){return A(n)},c.setTheme=function(a){return z(n,String(a))},d[p]="twitter",c.getLinkShortener=function(){return String(A(p))},c.setLinkShortener=function(a){return z(p,String(a))},d[q]=!1,c.getUseJmp=function(){return Boolean(A(q))},c.setUseJmp=function(a){return z(q,Boolean(a))},c.getGlobalFilter=function(){return A(r)},c.setGlobalFilter=function(a){return z(r,a)},d[t]=!0,c.getShowStartupNotifications=function(){return Boolean(A(t))},c.setShowStartupNotifications=function(a){return z(t,Boolean(a))},d[x]=!1,c.getDisplaySensitiveMedia=function(){return Boolean(A(x))},c.setDisplaySensitiveMedia=function(a){return z(x,Boolean(a))},d[o]=!1,c.getScheduledColAdded=function(){return Boolean(A(o))},c.setScheduledColAdded=function(a){return z(o,Boolean(a))},d[s]="0",c.getPreviousSplashVersion=function(){return A(s)},c.setPreviousSplashVersion=function(a){return z(s,String(a))},d[u]={users:{},lists:{}},c.getNameCache=function(){return A(u)},c.setNameCache=function(a){return z(u,a)},d[v]=[],c.getIdsForSeenMessages=function(){return A(v)},c.setIdsForSeenMessages=function(a){return z(v,a)},d[w]="condensed",c.getNavbarWidth=function(){return A(w)},c.setNavbarWidth=function(a){return z(w,a)},c}(TD.storage,TD.storage.notification),TD.storage.upgrade=function(a,b,c,d){var e={};return e.CURRENT_VERSION=4,e.getVersion=function(a){var b=a.getItem("__version__");return b===null?e.guessVersion(a):Number(b)},e.guessVersion=function(a){var b=a.getItem("settings"),c=a.getItem("clients"),d=a.getItem("columns");if(c&&!b){c=JSON.parse(c);if(!_.isEmpty(c)){var e=_.values(c)[0];if("ÎQ"in e)return 2}}return!c&&b&&d?0:null},e.doUpgrade=function(a){fromVersion=e.getVersion(a),(!fromVersion||fromVersion<4)&&e._upgradeAllToV4(a)},e._upgradeAllToV4=function(b){console.log("Upgrading store to v4"),TD.storage.storeUtils.flushDataFromStore(b,TD.sync.controller.PERSISTENT_STORAGE_ITEMS),a.store.recordVersion(4,b)},e}(TD.storage,TD.config,TD.sync.util,TD.core.defer),TD.sync.controller=function(a,b,c){var d={};return d.PERSISTENT_STORAGE_ITEMS=["tweetdeck_account","_session","__hasAlreadyReloaded","hoard"],d.debugFlushAndReload=function(){TD.storage.storeUtils.clearWebstorage(),TD.util.isWrapperApp()&&deck.tearDown(),window.location.reload()},d.flushSyncDataAndReload=function(){TD.storage.storeUtils.setReloadedFlag(),TD.storage.storeUtils.clearWebstorage(d.PERSISTENT_STORAGE_ITEMS),TD.util.isWrapperApp()&&deck.tearDown(),window.location.reload()},d.debugInstallOldChromeData=function(){TD.storage.storeUtils.clearWebstorage();var a=/^[a-zA-Z0-9\+\/=]*$/,b=TD.debug.spoof_data;b.match(a)&&(b=TD.core.base64.decode(b));var c=JSON.parse(b);_.each(c,function(a,b){localStorage.setItem(b,a)})},d.debugQueryRemote=function(b,c){var e=d.fetchAllBackendData();return e.addCallback(a.pprint),e},d.fetchAllBackendData=function(){var d=b.drequest("/accounts"),e=TD.storage.clientController,f=e.client&&e.client.getName()||TD.config.sync_name,g="/clients/"+f+"/all",h=b.drequest(g),i=!1;h.addErrback(function(c){if(c.number==404){a.stateLog("Controller.fetchAllBackendData(): client didn't exist!");var d=e.createNewClient();return d.addCallback(function(){return i=!0,b.drequest(g)}),d}return c});var j=new c.gatherResults([d,h]);return j.addCallback(function(a){var b;return b=a[1],b.accounts=a[0],b.isNewClient=i,b}),j},d.ueberpull=function(){a.trace("Ã¼berpull");var b=c.succeed();return b.addCallback(function(){return TD.storage.columnController.triggerPush(.05)}),b.addErrback(a.errmark,"d.Eb:triggerPush"),b.addCallback(function(){return d.fetchAllBackendData()}),b.addErrback(a.errmark,"d.Eb:fetchAllBackendData"),b.addCallback(function(a){TD.storage.accountController.updateFromBackend(a.accounts,a.client),TD.storage.feedController.updateFromBackend(a.feeds),TD.storage.columnController.updateFromBackend(a.columns),TD.storage.clientController.updateFromBackend(a.client),TD.decider.updateFromBackend(a.decider),$(document).trigger("dataMessages",{messages:a.messages})}),b.addErrback(a.errmark,"d.Eb:sync.controller.updateFromBackend"),b},d.initFromTdLogin=function(b){var e=c.succeed(b),f=!1;return e.addCallback(d.init),e.addErrback(function(b){return a.warn("WARNING! sync.controller.init() failed",b),b}),e.addCallback(d.fetchAllBackendData),e.addErrback(function(b){return a.warn("WARNING! sync.controller get all sunc data failed",b),b}),e.addCallback(function(a){TD.storage.accountController.updateFromBackend(a.accounts,a.client),TD.storage.feedController.updateFromBackend(a.feeds),TD.storage.columnController.updateFromBackend(a.columns),TD.storage.clientController.updateFromBackend(a.client),TD.decider.updateFromBackend(a.decider),f=a.isNewClient}),e.addErrback(function(b){return a.warn("WARNING! sync.controller update all failed",b),b}),e.addCallback(function(a){return{isNewClient:f}}),e},d.debuggery=function(){jQuery.subscribe("/storage/object/change",function(){a.warn("ERROR; untyped StoredObj change notification",_.toArray(arguments)),a._break()})},d.checkInvariants=function(){var a=[TD.storage.feedController,TD.storage.columnController,TD.storage.accountController,TD.storage.clientController];_.each(a,function(a){var b=a.checkInvariants;b&&b.call(a)})},d.init=function(b){a.trace("sync controller init"),d.store=b,d.debuggery(),TD.storage.feedController.init(b),TD.storage.columnController.init(b),TD.storage.accountController.init(b),TD.storage.clientController.init(b);var c=TD.config.sync_period;_.isUndefined(c)&&(c=600),d.loop=setInterval(d.ueberpull,c*1e3)},d.reset=function(){d.loop&&(clearInterval(d.loop),delete d.loop),TD.storage.columnController.reset(),TD.storage.feedController.reset(),TD.storage.accountController.reset(),TD.storage.clientController.reset()},d}(TD.sync.util,TD.sync.tdapi,TD.core.defer),TD.sync.ui=function(a,b){var c={};return c.dispatch_ui_event=function(c){var d={flushreload:a.debugFlushAndReload,dumptrace:TD.sync.trace.logDump,cleartrace:TD.sync.trace.clear,queryremote:a.debugQueryRemote,ueberpull:a.ueberpull,junk:function(){console.log("junk fondled")}}[c];if(!d)alert('no handler for event "'+c+'"');else{var e;try{e=b.maybeDeferred(d)}catch(f){console.log(f);return}e.addCallback(function(a,b){util.stateLog('result for event "'+b+'": ',a)},c),e.addErrback(function(a,b){util.warn("ERROR for event",b,": ",a),console.log(a.stack)},c)}},c}(TD.sync.controller,TD.core.defer),TD.ui.template=function(){function h(a){var b;try{b=$.ajax(a,{async:!1,isLocal:TD.util.getAppEnv()!=="web"})}catch(c){return null}return b.status!==200?"":_.trim(b.responseText)}function i(f){f=f.replace(b,"/");var g=c[f];return g===undefined&&(g=a.getHogan(f),g=e.compile(g,d),c[f]=g),g}function j(a,b){var c=this.partials[a];return b=b||{},b[c.name]||(b[c.name]=i(c.name)),Hogan.Template.prototype.ep.call(this,a,b)}function k(a,b,c){var d=Hogan.parse.call(this,a,b,c),e="";for(var f=0;f<d.length;f++)if(d[f].tag==="_v"&&d[f].n.indexOf("%TRANSLATION-HINT")===0){var g=d.splice(f,1)[0];f--,e=g.n.substring(g.n.indexOf("mode=")+"mode=".length)}return l(d,e,b,c)}function l(a,b,c,d){var e=[];for(var f=0;f<a.length;f++)if(a[f].tag==="#"&&a[f].n==="_i"){var g=n(c.substring(a[f].i,a[f].end),b);g.tag==="raw"?e.push(g):Array.prototype.push.apply(e,Hogan.parse(Hogan.scan(g,d.delimiters),c,d))}else a[f].tag==="#"||a[f].tag==="^"||a[f].tag==="<"||a[f].tag==="$"?(a[f].nodes=l(a[f].nodes,b,c,d),e.push(a[f])):e.push(a[f]);return m(e)}function m(a){if(a.length===0)return a;var b=[a[0]];for(var c=1;c<a.length;c++)b[b.length-1].tag!=="_t"||a[c].tag!=="\n"&&a[c].tag!=="_t"?b.push(a[c]):b[b.length-1].text+=a[c].text||"\n";return b}function n(a,b){var c;return b!==""?c={text:a,mode:b}:c=a,TD.i(c,null,!0)}var a={},b=/\\/g,c={},d={sectionTags:[{o:"_i",c:"i"}]},e,f,g;return g=function(a,b,c,d){this.ep=j,Hogan.Template.call(this,a,b,c,d)},g.prototype=Hogan.Template.prototype,f=function(){},f.prototype=Hogan,e=new f,e.template=g,e.parse=k,a.getHogan=function(a){var b=TD.mustaches[a+".mustache"];return b===undefined&&(b=h("../mustaches/"+a+".mustache"),b===""&&(b=a),TD.mustaches[a+".mustache"]=b),b},a.render=function(a,b,c){var d=i(a),e=_.clone(TD.globalRenderOptions)||{};return _.extend(e,b),d.render(e,c)},a.toHtml=function(a,b,c){var f=e.compile(a,d);return f.render(b,c)},a}(),TD.ui.startflow=function(a,b,c,d){function A(a){a.preventDefault();var b=$(a.currentTarget),c=b.data("action");switch(c){case"url":var d=window.open(b.attr("href"));d.focus();break;case"signin":C();break;case"showRegister":L(i);break;case"login":L(h);break;case"forgotPassword":B();break;case"resetReload":TD.sync.controller.debugFlushAndReload();break;case"spoofData":TD.sync.controller.debugInstallOldChromeData()}}function B(){if(y)return;var a=$("#tdRegEmail",m).val();if(!a||!a.match(f)){J(TD.i("That doesn't seem to be a valid email address. Remember: TweetDeck accounts are different from Twitter accounts."),[p]);return}var b=new TD.services.TweetDeckClient;y=!0,J(TD.i("Sending password reset instructionsâ¦"),[p],!0);var c=b.forgotPassword(a);c.addCallback(function(){J(TD.i("We have sent an email to {{email}} with instructions to reset your password.",{email:a}),[],!0),y=!1}),c.addErrback(function(b){var c;b&&b.number===403?c=TD.i("We couldn't find a TweetDeck account associated with {{email}}.",{email:a}):c=TD.i("Sorry, something went wrong. It's not you, it's us. Please try again later."),J(c,[p]),y=!1})}function C(){var a=$("#tdRegEmail",m).val(),b=$("#tdRegPassword",m).val(),c=$("#tdRegRememberMe",m)[0].checked;D(a,b,c)}function D(a,b,d){if(a&&b!==""){L(j);var e=c.accountController.loginTweetdeck(a,b);e.addCallbacks(E,F,[d])}else L(h),J(TD.i("Please check your email & password."),[q,p])}function E(a,b){a.stay_signed_in=b,x.callback(a)}function F(a){L(h);var b,c=[],e,f;if(a.req.status===401)e=JSON.parse(a.req.responseText).error,e==TD.constants.TDApi.ERROR_ACCOUNT_DOESNT_EXIST?(f=$("#tdRegEmail",m).val(),b=TD.i("We couldn't find a TweetDeck account associated with: {{{email}}}",{email:f}),c=[p]):e==TD.constants.TDApi.ERROR_BAD_PASSWORD&&(b=TD.i("Please check your password. Remember: TweetDeck accounts are different from Twitter accounts."),c=[q]);else if(a.req.status===0)b=TD.i("Unable to connect. Please check your network.");else try{e=JSON.parse(a.req.responseText).error,b=TD.i("Unable to sign in: {{{1}}}",{1:e})}catch(g){b=TD.i("Sorry, something went wrong. It's not you, it's us. Please try again later."),console.log("An unknown error occurred at sign in"),console.log(a.req.responseText)}d.warn(a.message,a),J(b,c)}function G(){var a=$("#tdRegEmail",m).val(),b=$("#tdRegPassword",m).val(),c=$("#tdRegPasswordConfirm",m).val(),d=$("#tdRegRememberMe",m)[0].checked;if(!a||!a.match(f)){J(TD.i("That doesn't seem to be a valid email address. Remember: TweetDeck accounts are different from Twitter accounts."),[p]);return}if(b!==c){J(TD.i("Passwords must match!"),[q]);return}if(b.length<7){J(TD.i("Your password must be 7 characters or longer."),[q]);return}var e=H(a,b,d);e.addErrback(I),L(j)}function H(a,b,e){var f=c.accountController.loginTweetdeck(a,b);return f.addCallback(E,e),f.addErrback(function(){d.trace("register//login failed//going to try to create account");var f=c.accountController.createTweetdeckAccount(a,b);return f.addCallback(function(a){return a.created_account=!0,a}),f.addCallback(E,e),f}),f}function I(a){var b;L(i),a&&a.number&&a.number===401?b=TD.ui.template.render("text/already_registered"):b=TD.i("Registration unsuccessful. Please check your email & password"),a&&d.warn(a.message,a),J(b,[q,p])}function J(a,b,c){c?n.removeClass(v).addClass(w):n.removeClass(w).addClass(v),a&&(n.html(a),n.show()),b&&_.each(b,function(a){a.addClass("s-error")})}function K(){q.removeClass("s-error"),p.removeClass("s-error"),n.hide()}function L(a){k=a,K();switch(a){case h:t.fadeOut("fast"),$("#tdRegPasswordConfirm").attr("disabled",!0),r.attr("disabled",!1),m.addClass("s-login").removeClass("s-register is-loading");break;case i:t.fadeOut("fast"),$("#tdRegPasswordConfirm").attr("disabled",!1),s.attr("disabled",!1),m.addClass("s-register").removeClass("s-login is-loading");break;case j:t.fadeIn("fast"),r.attr("disabled",!0),s.attr("disabled",!0)}}var e={},f=/^[a-zA-Z0-9_\-\.+]+@[a-zA-Z0-9_\-\.]+\.[a-zA-Z]{2,4}$/,g=-1,h=0,i=1,j=2,k=g,l=null,m=null,n,o,p,q,r,s,t,u="form-error",v="srt-error-msg",w="srt-success-msg",x=null,y;e.doLogin=function(b,c,d){x=new a.Deferred;try{z(b,c),L(h),d&&J(d)}catch(e){var f="Unable to initialise login UI. Please contact your friendly dev team for assistance.";$("body").html(f),console.log("login UI init error:",[e]),TD.util.isChromeApp()&&console.log("stack trace:",[e.stack.split("\n")])}return x};var z=function(a,c){var d={email:a||"",spoofData:Boolean(TD.debug.spoof_data),debugMenu:Boolean(TD.config.debug_menu),version:TD.version,buildIDShort:TD.buildIDShort,appEnv:TD.util.getAppEnv()};TD.util.isWrapperApp()&&deck.getWrapperVersion&&(d.wrapperVersion=deck.getWrapperVersion());var e=b.render("startup/signin",d);$(".js-signin-ui").html(e),TD.util.isWrapperApp()&&deck.closeLoadingScreen&&deck.closeLoadingScreen(),m=$(".js-signin-form"),n=$(".js-start-message",m),p=$(".js-email"),q=$(".js-password"),r=$(".js-signin"),s=$(".js-register"),t=$(".js-loader"),$("#tdRegRememberMe",m)[0].checked=Boolean(c),$("#tdAccountForm").submit(function(a){return k===h?C():G(),a.preventDefault(),!1}),$("a",m).live("click",A),m.live("keypress",function(a){a.keyCode==13&&$("tdAccountForm").submit()})};return e}(TD.core.defer,TD.ui.template,TD.storage,TD.sync.util),TD.net.StreamRequest=function(a,b){var c=function(){console.log((new Date).toUTCString(),">",b.getUsername(),">",arguments)};this.receivedChars=0,this.readChars=0;var d=100,e=this,f,g,h,i,j,k=!1,l=function(a,b){var c=new XMLHttpRequest;return"withCredentials"in c?c.open(a,b,!0):c=null,c},m=function(a){c("Signer HTTP status:",a.xhr.status),a.xhr.status===200&&(h=a.data.headers.Authorization,n())},n=function(){j=l("GET",a);if(!j){r("CORS not supported",0);return}j.setRequestHeader("Authorization",h),j.setRequestHeader("X-User-Agent","TweetDeck Chrome "+TD.version),j.send(),o()},o=function(){p(),j.readyState!==XMLHttpRequest.DONE&&setTimeout(o,d)},p=function(){switch(j.readyState){case XMLHttpRequest.LOADING:var a=j.responseText.lastIndexOf("\r"),b;k||(c("Stream HTTP status:",j.status),k=!0),e.receivedChars=j.responseText.length;if(a>=e.readChars){b=j.responseText.substring(e.readChars,a+1),e.readChars+=b.length;try{q(b)}catch(d){console.log("Callback error:",d)}}break;case XMLHttpRequest.DONE:r("Stream interrupted",j.status)}},q=function(a){f&&f(a)},r=function(a,b){g&&g(a,b)};this.onStreaming={connect:function(a){f=a},disconnect:function(a){f===a&&(f=null)}},this.onFailure={connect:function(a){g=a},disconnect:function(a){g===a&&(g=null)}},this.goStreaming=function(){var c=TD.net.ajax.signRequest(b,a,"GET");c.addCallback(m),c.addErrback(function(a){r("Failed to sign request",0)})},this.deleteLater=function(){c("Closing stream connection"),i&&(i.onreadystatechange=null),j&&(j.onreadystatechange=null,j.abort()),q=null,r=null}},TD.net.util=function(){var a={},b=encodeURIComponent,c=/[!'()]/g,d=/\*/g;return encodeURIComponent=function(a){return b(a).replace(c,escape).replace(d,"%2A")},a.addURLParam=function(b,c,d){var e={};return e[c]=d,a.addURLParameters(b,e)},a.addURLParameters=function(b,c){var d=a.buildQueryString(c),e=b;return d?(b.indexOf("?")===-1?e+="?":e+="&",e+d):b},a.buildQueryString=function(a){var b=[],c;if(a)for(var d in a)c=d+"="+encodeURIComponent(a[d]),b.push(c);return b.join("&")},a.formDecode=function(a){var b=a.split("&"),c={},d,e;for(var f in b)e=b[f].split("="),e.length==2&&(c[decodeURIComponent(e[0])]=decodeURIComponent(e[1]));return c},a.decodeURL=function(b){var c=b.split("?");return c.length>1?a.formDecode(c[1]):{}},a.formEncode=function(a){var b=[];for(var c in a)b.push(c+"="+encodeURIComponent(a[c]));return b.join("&")},a.getQueryStringParams=function(){var a=window.location.href.split("?");if(a.length>=2){var b=a.slice(1).join("?");return this.formDecode(b)}return{}},a}(),TD.controller.init=function(a,b,c,d,e,f,g,h,i){var j={},k=null,l=!1,m=!1,n=2592e3;j.purgedServices=[],j.start=function(b,e){var f=TD.core.defer.succeed(),i=TD.util.getAppEnv(),k;if(i==="chrome"&&chrome.extension.getViews({type:"tab"}).length>1){d.warn("Duplicate Chrome App tab. Aborting init.");return}TD.util.isWrapperApp()&&(TD.util.isUnsupportedWebWrapperVersion()?(deck.closeLoadingScreen&&deck.closeLoadingScreen(),window.location.assign("https://web.tweetdeck.com/web/deprecated.html?appenv="+i)):TD.controller.scheduler.schedulePeriodicTask(n,function(){window.location.reload(!0)}));if(window.location.protocol==="http:"||window.location.protocol==="https:"){var o=window.location.protocol+"//"+window.location.host;o!==TD.config.api_root&&(console.log("NOTE: overwriting api_root of",TD.config.api_root,"with",o),TD.config.api_root=o)}return f.addCallback(function(){var a;return TD.util.getOSName()==="windows"&&$("html").addClass("os-windows"),k=TD.controller.feather.loadFeathers(!1),j.certCheck(),TD.storage.storeUtils.init(),a=TD.storage.storeUtils.getSessionData(),j.doLogin(a,e)}),f.addCallback(function(a){return k.addBoth(function(){return a}),k}),l=!1,f.addCallback(function(a){return l=a.created_account,a}),f.addCallback(p),m=!1,f.addCallback(function(a){return m=a.isNewClient,a}),f.addCallback(a.notification.flush),f.addCallback(q),f.addCallback(function(){return h.gatherResults([a.feedController.triggerPush(.05),a.columnController.triggerPush(.05)])}),f.addCallback(function(){a.store.checkVersion(a.upgrade.CURRENT_VERSION)}),f.addCallback(q),f.addCallback(function(){if(l){var b=a.clientController.client,d=c.upgrade.CURRENT_VERSION;return console.log("freshly created account; no upgrades, recording v",d),b.dictSet("settings","version",d)}return c.upgrade.doUpgrades()}),f.addCallback(function(){return m?a.accountController.verifyStoredAccounts():TD.core.defer.succeed()}),f.addCallback(function(){TD.storage.storeUtils.removeReloadedFlag()}),f.addErrback(function(a){throw TD.storage.storeUtils.hasAlreadyReloaded()||TD.sync.controller.flushSyncDataAndReload(),a}),f.addCallback(u),f.addErrback(function(b){d.warn(b,"controller.init.start failed, restarting",b.message);if(b.stackTrace)try{console.log(b.stackTrace.join("\n"))}catch(c){console.log("Unable to get stackTrace to report error:",c)}return a.store.reset(),g.controller.reset(),j.start(null,b.message)}),f},j.certCheck=function(){var a=TD.config.cert_reminder||TD.config.api_root==="https://smfd-akc-08-sr1.devel.twitter.com:8443";a&&e.isChromeApp()&&jQuery.ajax(TD.config.api_root+"/time").fail(function(){chrome.tabs.create({selected:!0,url:TD.config.api_root+"/time"})})},j.doLogin=function(c,e){d.trace("init.doLogin()");var f=c.email,g=c.passhash,j=c.sessionExists,k=c.staySignedIn,l=null;if(!f)return b.startflow.doLogin(null,k,e);if(e)return b.startflow.doLogin(f,k,e);if(f&&g){var m=function(){return a.accountController.loginTweetdeck(f,null,g)};l=TD.sync.util.autoRetry(m,[5e3,1e4],o),l.addCallback(function(a){return a.stay_signed_in=k,a})}else if(j){var n=function(){return i.drequest("/verify_user",null,null,!0)};l=TD.sync.util.autoRetry(n,[5e3,1e4],o),l.addCallback(function(a){var b={tweetdeck_account:{email:f},stay_signed_in:k};return b})}else l=h.fail(!1);return l.addErrback(function(a){var c;return d.warn("TD login of existing account/session failed",a),o(a)?c=TD.i("Unable to connect. Please check your network."):a.req.status!=401&&(c=TD.i("Sorry, something went wrong. It's not you, it's us. Please try again later.")),b.startflow.doLogin(f,k,c)}),l};var o=function(a){return a.req.status==0||a.req.status==12007},p=function(b){d.trace("init.initFromLogin()"),a.store.init(b.stay_signed_in,b.tweetdeck_account.email),i.saveSession(),i.onAuthFail(j.abort);var c=b.tweetdeck_account;return c.plaintext_password!==null&&(a.store.setTweetdeckAccountAndPassword?a.store.setTweetdeckAccountAndPassword(c.email,c.plaintext_password):a.store.setTweetdeckAccount(c.email)),g.controller.initFromTdLogin(a.store)},q=function(){d.trace("init.purgeDeprecatedAccounts()"),s("buzz"),s("foursquare"),s("facebook"),r(),j.purgedServices.length>0&&TD.controller.stats.purgedServices(j.purgedServices),t(function(a){var b=a.getService()==="twitter"&&a.getType()==="sentdirect";return b&&TD.controller.stats.purgedFeed({service:a.getService(),type:a.getType(),message:"Purged sentdirect feed (no longer supported)"}),b}),t(function(b){var c=_.isUndefined(a.accountController.get(b.getAccountKey()));return c&&TD.controller.stats.purgedFeed({service:b.getService(),type:b.getType(),accountKey:b.getAccountKey(),message:"Purged feed due to bad account key"}),c})},r=function(){a.columnController.getAll().forEach(function(a){if(a.getFeedKeys().length!==1)return;switch(a.getType()){case TD.util.columnUtils.storageColumnTypes.HOME:case TD.util.columnUtils.storageColumnTypes.INBOX:case TD.util.columnUtils.storageColumnTypes.ME:a.setType(TD.util.columnUtils.storageColumnTypes.OTHER);break;default:return}})},s=function(b){var c=a.accountController.getAccountsForService(b);_.isEmpty(c)||(j.purgedServices.push(b),_.each(c,function(b){a.accountController.blacklistAccount(b)})),t(function(a){return a.getService()===b})},t=function(b){var c,d,e,f;c=_.filter(a.feedController.getAll(),b),d=_.map(c,function(b){var c=b.getKey();return a.feedController.remove(c),c}),e=_.filter(a.columnController.getAll(),function(a){var b=_.difference(a.getFeedKeys(),d);return a.setFeedKeys(b),_.isEmpty(b)}),f=_.map(e,function(a){return a.getKey()});if(!_.isEmpty(f)){var g=a.clientController.client;g.setColumnOrder(_.difference(g.getColumnOrder(),f)),_.each(f,function(b){a.columnController.remove(b)})}},u=function(){TD.util.fnPerformanceWrapper(v,null,c.stats.performance.keys.INIT)()},v=function(){d.trace("init.initControllerAndUI()");var e;TD.settings.init(),$(document).trigger("uiNeedsSettings"),c.clients.init(),c.feedManager.init(),c.stats.init(),TD.cache.names.init(),TD.util.getAppEnv()==="web"&&delete TD.services.TwitterMedia.SERVICES.instagram,TD.util.fnPerformanceWrapper(b.main.init,b.main,c.stats.performance.keys.MAIN)(),TD.util.fnPerformanceWrapper(c.columnManager.init,c.columnManager,c.stats.performance.keys.COLUMN_MANAGER)(),TD.util.fnPerformanceWrapper(c.scheduler.init,c.scheduler,c.stats.performance.keys.COLUMN_SCHEDULER)(),TD.util.fnPerformanceWrapper(c.notifications.init,c.notifications,c.stats.performance.keys.NOTIFICATIONS)(),TD.util.fnPerformanceWrapper(c.filterManager.init,c.filterManager.init,c.stats.performance.keys.FILTER_MANAGER)(),a.accountController.isEmpty()?(new TD.components.GlobalSettings,TD.components.NewFeaturesSplash.updateSeenVersion()):TD.components.NewFeaturesSplash.shouldShow()&&new TD.components.NewFeaturesSplash,TD.ready=!0,d.trace("init: TD.ready"),$(document).trigger("TD.ready"),m||setTimeout(function(){var b=a.accountController.verifyStoredAccounts()},2e4),TD.controller.init.purgedServices.indexOf("facebook")!==-1&&$(document).trigger("dataFacebookAccountRemoved",{})};return j.signOut=function(){if(e.isWrapperApp()&&deck.osname()==="osx"){var b=a.store.getTweetdeckAccount();b&&a.store.deleteSecrets([b]);var c=_.map(TD.storage.accountController.getAll(),function(a){return a.getKey()});a.store.deleteSecrets(c)}TD.storage.storeUtils.clearWebstorage();var d=i.logout();return TD.util.isWrapperApp()&&d.addBoth(function(){deck.tearDown()}),d.addBoth(function(){window.location.reload()}),d},j.abort=function(){window.location.reload()},j}(TD.storage,TD.ui,TD.controller,TD.sync.util,TD.util,TD.net.util,TD.sync,TD.core.defer,TD.sync.tdapi),TD.controller.upgrade=function(a,b,c,d){var e={};return e.CURRENT_VERSION=2,e.doUpgrades=function(){var b=null,f=a.clientController.client.get("settings");_.isUndefined(f)||_.isUndefined(f.version)?b=0:b=Number(f.version);var g=function(b,c){return a.clientController.client.dictSet("settings","version",c)},h=d.succeed();for(var i=1;i<=e.CURRENT_VERSION;i++)if(b<i){var j="version_"+i.toString();e.hasOwnProperty(j)&&(console.log("performing upgrade to v",i,j),h.addCallback(e[j]),h.addCallback(g,i))}return h.addErrback(function(a){throw c.warn("WARNING: controller.upgrade failed!!!"),console.log(a),a}),h},e.version_1=function(){a.columnController.getAll().forEach(function(a){var b=TD.storage.feedController.get(a.getFeedKeys()[0]).getType(),c;b===TD.util.columnUtils.feedTypes.MENTIONS&&(c=new TD.vo.SearchFilter(a.getFilters()),c.action.fromJSONObject({showMentions:!0,showRetweets:!1,showFavorites:!1,showFollowers:!1,showLists:!1}),a.setFilters(c.toJSONObject()))})},e.version_2=function(){var b=TD.storage.clientController.client.get("settings").show_inline_media;b===!1&&a.columnController.getAll().forEach(function(a){a.setMediaPreviewSize(TD.vo.Column.MEDIA_PREVIEW_OFF)})},e}(TD.storage,TD.config,TD.sync.util,TD.core.defer),TD.controller.columnManager=function(a,b,c){var d={},e={},f=[];d.TIMELINE="timeline",d.MENTIONS="mentions",d.FOLLOWERS="followers",d.SEARCH="search",d.LISTS="lists",d.MESSAGES="messages",d.TRENDS="trends",d.TWEETS="tweets",d.FAVORITES="favorites",d.HOME="home",d.ME="me",d.INBOX="privateMe",d.SCHEDULED="scheduled",d.NETWORKACTIVITY="networkactivity",d.INTERACTIONS="interactions",d.columnTypeToIconClass={},TD.util.extendObjectWith(d.columnTypeToIconClass,[[d.TIMELINE,TD.util.columnUtils.columnIconClasses.HOME],[d.INTERACTIONS,TD.util.columnUtils.columnIconClasses.INTERACTIONS],[d.MENTIONS,TD.util.columnUtils.columnIconClasses.MENTIONS],[d.FOLLOWERS,TD.util.columnUtils.columnIconClasses.FOLLOWERS],[d.SEARCH,TD.util.columnUtils.columnIconClasses.SEARCH],[d.LISTS,TD.util.columnUtils.columnIconClasses.LIST],[d.MESSAGES,TD.util.columnUtils.columnIconClasses.MESSAGES],[d.TWEETS,TD.util.columnUtils.columnIconClasses.TWEETS],[d.FAVORITES,TD.util.columnUtils.columnIconClasses.FAVORITES],[d.NETWORKACTIVITY,TD.util.columnUtils.columnIconClasses.ACTIVITY],[d.HOME,TD.util.columnUtils.columnIconClasses.HOME],[d.ME,TD.util.columnUtils.columnIconClasses.MENTIONS],[d.INBOX,TD.util.columnUtils.columnIconClasses.MESSAGES],[d.SCHEDULED,TD.util.columnUtils.columnIconClasses.SCHEDULED],[d.TRENDS,TD.util.columnUtils.columnIconClasses.TRENDS]]),d.SELF_ACCOUNTS_ONLY={},d.SELF_ACCOUNTS_ONLY[d.MESSAGES]=!0,d.SELF_ACCOUNTS_ONLY[d.NETWORKACTIVITY]=!0,d.SELF_ACCOUNTS_ONLY[d.INTERACTIONS]=!0,d.TWITTER_GENERIC={},d.TWITTER_GENERIC[d.TIMELINE]=!0,d.TWITTER_GENERIC[d.MENTIONS]=!0,d.TWITTER_GENERIC[d.FOLLOWERS]=!0,d.TWITTER_GENERIC[d.MESSAGES]=!0,d.TWITTER_GENERIC[d.TWEETS]=!0,d.TWITTER_GENERIC[d.FAVORITES]=!0,d.TWITTER_GENERIC[d.NETWORKACTIVITY]=!0,d.TWITTER_GENERIC[d.INTERACTIONS]=!0,d.SELF_FEED_TYPE={},d.SELF_FEED_TYPE[d.TIMELINE]="home",d.SELF_FEED_TYPE[d.MESSAGES]="direct",d.SELF_FEED_TYPE[d.TWEETS]="usertweets",d.SELF_FEED_TYPE[d.FOLLOWERS]="interactions",d.NON_SELF_FEED_TYPE={},d.NON_SELF_FEED_TYPE[d.TIMELINE]="usertimeline",d.NON_SELF_FEED_TYPE[d.TWEETS]="usertweets",d.NON_SELF_FEED_TYPE[d.MENTIONS]="search",d.MENU_TITLE={},d.MENU_TITLE[d.TIMELINE]=TD.i("Timeline"),d.MENU_TITLE[d.MENTIONS]=TD.i("Mentions"),d.MENU_TITLE[d.FOLLOWERS]=TD.i("Followers"),d.MENU_TITLE[d.SEARCH]=TD.i("Search"),d.MENU_TITLE[d.LISTS]=TD.i("Lists"),d.MENU_TITLE[d.MESSAGES]=TD.i("Messages"),d.MENU_TITLE[d.TRENDS]=TD.i("Trends"),d.MENU_TITLE[d.TWEETS]=TD.i("Tweets"),d.MENU_TITLE[d.FAVORITES]=TD.i("Favorites"),d.MENU_TITLE[d.HOME]=TD.i("Home"),d.MENU_TITLE[d.ME]=TD.i("Me"),d.MENU_TITLE[d.INBOX]=TD.i("Inbox"),d.MENU_TITLE[d.SCHEDULED]=TD.i("Scheduled"),d.MENU_TITLE[d.NETWORKACTIVITY]=TD.i("Activity"),d.MENU_TITLE[d.INTERACTIONS]=TD.i("Interactions"),d.DISPLAY_ORDER=[{type:d.TIMELINE,service:"twitter"},{type:d.INTERACTIONS,service:"twitter"},{type:d.MENTIONS,service:"twitter"},{type:d.FOLLOWERS,service:"twitter"},{type:d.MESSAGES,service:"twitter"},{type:d.SEARCH,service:"twitter"},{type:d.LISTS,service:"twitter"},{type:d.TWEETS,service:"twitter"},{type:d.FAVORITES,service:"twitter"},{type:d.TRENDS,service:"twitter"},{type:d.NETWORKACTIVITY,service:"twitter"}],d.DISPLAY_ORDER_SINGLETONS=[{type:d.ME},{type:d.INBOX},{type:d.SCHEDULED}],d.DISPLAY_ORDER_PROFILE=[{type:d.TWEETS,service:"twitter",profile:!0},{type:d.MENTIONS,service:"twitter",profile:!0},{type:d.LISTS,service:"twitter",profile:!0},{type:d.TIMELINE,service:"twitter",profile:!0},{type:d.FAVORITES,service:"twitter",profile:!0}];var g=d.DISPLAY_ORDER.concat(d.DISPLAY_ORDER_SINGLETONS).concat(d.DISPLAY_ORDER_PROFILE);_.each(g,function(a){a.title=d.MENU_TITLE[a.type],a.columnIconClass=d.columnTypeToIconClass[a.type]}),d.HELP_TEXT={},d.HELP_TEXT[d.TIMELINE]=TD.i("Add a Timeline column for your own accounts, or search for a user and add theirs"),d.HELP_TEXT[d.MENTIONS]=TD.i("Add a Mentions column for your own accounts, or search for a user and add theirs"),d.HELP_TEXT[d.SEARCH]=TD.i("Add a column for a saved or recent Search, or enter a new search in the box"),d.HELP_TEXT[d.LISTS]=TD.i("Create a new list, or select an existing list to edit or add a column"),d.HELP_TEXT[d.MESSAGES]=TD.i("Add a Direct Messages column for your accounts"),d.HELP_TEXT[d.TRENDS]=TD.i("Add a column to monitor Tweets for any Trend"),d.HELP_TEXT[d.TWEETS]=TD.i("Add a column for Tweets sent from your own accounts, or search for a user and add theirs"),d.HELP_TEXT[d.FAVORITES]=TD.i("Add a Favorites column for your own accounts, or search for a user and add theirs"),d.HELP_TEXT[d.INTERACTIONS]=TD.i("Add a column to monitor your mentions, retweets, favourites, follows and list additions in real time"),d.HELP_TEXT[d.NETWORKACTIVITY]=TD.i("Add a column to view favourites, follows and list additions by your friends in real time"),d.STREAMING_FULL="streaming_full",d.STREAMING_NONE="streaming_none",d.STREAMING_PARTIAL="streaming_partial",d.init=function(){h(),d.checkColumns(),$.subscribe("/storage/client/column_order_changed",h),$.subscribe("/storage/client/change",h),$.subscribe("/storage/column/feeds_changed",function(a,b,c){var e=d.get(c.getKey());e&&e.loadFeeds()}),$.subscribe("/storage/column/change",function(a){var c=d.get(a.getKey());if(c){var e=c.model.getFeedKeys(),f=a.getFeedKeys();_.isEqual(e,f)||c.loadFeeds();if(a.managed&&a.hasApiid()){var c=d.getByApiid(a.getApiid());TD.ui.columns.refreshTitle(c)}c.loadFilters()}else b.stateLog("loading new new column",a),h()}),$.subscribe("/cache/names/change",function(){_.each(d.getAll(),function(a){TD.ui.columns.refreshTitle(a)})}),$.subscribe("/storage/account/new",function(a){TD.storage.accountController.getAll().length===1&&d.checkColumns()})},d.checkColumns=function(){var b=TD.storage.accountController.getPreferredAccount("twitter");a.clientController.client.getColumnOrder().length===0&&b&&d.makeDefaultColumns(b)},d.get=function(a){return e[a]},d.getByApiid=function(a){return _.find(e,function(b){return b.model.hasApiid()&&b.model.getApiid()===a?b:null})},d.getAll=function(){return _.clone(e)},d.getAllOrdered=function(){var a=this.getAll(),b=[];for(var c=0;c<f.length;c++)b.push(a[f[c]]);return b},d.add=function(a){e[a.model.getKey()]=a},d.deleteColumn=function(b){var c=e[b];c&&!c.temporary&&TD.controller.stats.removeColumn(c.getColumnType());var d=a.clientController.client.removeColumn(b)},d.removeFromAppLayer=function(b){var c=e[b];c&&c.removeSubscriptions(),delete e[b],a.columnController.remove(b),TD.controller.feedScheduler.removeColumn(b),TD.ui.columns.removeColumn(b)},d.move=function(a,b){var c=f.indexOf(a),e,g=f.concat(),i;if(b==="right")i=Math.min(c+1,f.length-1);else if(b==="left")i=Math.max(c-1,0);else return;e=f[i],g[i]=g[c],g[c]=e,TD.storage.clientController.client.setColumnOrder(g),h(),d.showColumn(a)};var h=function(){var b=a.clientController.client.getColumnOrder(),c=!_.isEqual(f,b);c&&i(b),$(document).trigger("dataColumnsLoaded")},i=function(c){var e=_.difference(f,c),g=_.difference(c,f),h=[];_.each(e,function(a){d.removeFromAppLayer(a),TD.ui.columns.removeColumn(a)}),_.each(g,function(e){var f=d.get(e),g;if(!f){g=a.columnController.get(e);if(!g){b.stateLog("WARNING: column not found for",e,"all columns:",a.columnController.getAll(),"in column_order",c);return}f=new TD.vo.Column(g),d.add(f)}h.push(f)}),TD.ui.columns.addColumnsToView(h),TD.ui.columns.reorderColumns(c),f=c,$(document).trigger("dataColumnOrder",{columns:d.getAllOrdered()}),_.each(g,function(a){var b=d.get(a);TD.controller.feedScheduler.addColumn(b,!0)})};return d.addColumnToUI=function(b){var c=b.model.getKey(),e;return b.reset(),d.add(b),a.feedController.manageFeeds(b.getFeeds()),a.columnController.manage(b.model),e=a.clientController.client.appendColumn(c),h(),_.defer(d.showColumn,c),TD.controller.stats.addColumn(b.getColumnType()),e},d.makeColumnFor=function(b,c,e,f,g){var h={},i,j;if(c=="tweetdeck")switch(b){case"me":j=a.columnController.getMeFeeds(a.accountController.getAll()),i=d.makeColumn("me",j);break;case"privateMe":j=a.columnController.getInboxFeeds(a.accountController.getAll()),i=d.makeColumn("privateMe",j);break;case"scheduled":j=[a.feedController.getOrCreateFeed("scheduled","tweetdeck","tweetdeck",{})],i=d.makeColumn("scheduled",j)}else{switch(b){case"usertimeline":case"favorites":case"usertweets":f&&(h.id=parseInt(f,10));break;case"search":var g=new TD.vo.SearchFilter;h.searchFilterData=g.toJSONObject(),h.baseQuery=f;break;case"list":var k=f.split("/");TD.sync.util.assert(k.length===2,"List meta should contain both ownerId and listId",k),h.ownerId=k[0],h.listId=k[1];break;case"group":case"page":h.id=f}i||(i=d.makeOtherColumnAndFeeds(b,c,e,h,g))}return i.model.setTitle(TD.util.htmlToText(i.getTitleHTML())),i},d.makeDefaultColumns=function(a){var b=[];a.getType()==="twitter"&&(b=["home","interactions","direct","networkactivity"]),_.each(b,function(b){var c=d.makeColumnFor(b,a.getType(),a.getKey());d.addColumnToUI(c)})},d.makeColumn=function(b,c,d){var e={type:b,feedkeys:[],settings:{}};if(b==="me"||b==="privateMe")e.settings.has_notification=!0,e.settings.has_sound=!0;d&&(e.filters=d.toJSONObject());var f=new TD.vo.Column(new a.Column(e),c);return f},d.makeOtherColumnAndFeeds=function(b,c,e,f,g){var h=a.feedController,i=[];return i.push(h.getOrCreateFeed(b,c,e,f)),d.makeColumn("other",i,g)},d.showColumn=function(a){$(document).trigger("uiColumnFocus",{columnKey:a})},d.isStreaming=function(a){var b=d.getStreamingState(a);return b!==d.STREAMING_NONE},d.getStreamingState=function(a){var b=d.STREAMING_NONE,c=d.get(a),e=0,f;return c&&(f=c.model.getFeedKeys(),_.each(f,function(a){TD.controller.feedManager.isStreaming(a)&&e++}),e===0?b=d.STREAMING_NONE:e===f.length?b=d.STREAMING_FULL:b=d.STREAMING_PARTIAL),b},d}(TD.storage,TD.sync.util,TD.core.defer),TD.controller.auth=function(){var a={},b={twitter:"TwitterAuth",bitly:"BitlyValidate"};return a.create=function(a,c){return TD.sync.util.assert(b[a],'bad name for auth "'+a+'"'),new TD.controller.auth[b[a]](c)},a}(),TD.controller.auth.AuthorisationProcessor=function(){this.start=function(a,b,c){TD.util.isChromeApp()?this.start_chrome(a,b,c):TD.util.isWrapperApp()?this.start_wrapper(a,b,c):this.start_web(a,b,c)},this.start_wrapper=function(a,b,c){var d=deck.authenticateOn(this.getAuthURL(a,c)),e=this,f=function(c){var f=e.getTokenFromURL(a.getType(),c);f&&(f.access_token?e.updateAccount(f.access_token,b):e.updateAccount(f.oauth_token,f.oauth_token_secret,b),d.hide(),d.deleteLater())};d.loadedUrl.connect(f),d.show()},this.start_web=function(a,b,c){var d=window.open(this.getAuthURL(a,c),"mywindow","width=800,height=450"),e=this,f=function(){var c,g;try{d&&d.location&&d.location.href&&(c=d.location.href)}catch(h){console.log(h)}if(c){g=e.getTokenFromURL(a.getType(),c);if(g){g.access_token?e.updateAccount(g.access_token,b):e.updateAccount(g.oauth_token,g.oauth_token_secret,b),d.close();return}}setTimeout(f,100)};setTimeout(f,500)},this.getAuthURL=function(a,b){var c="oauth",d=a.getType(),e={};if(d==="twitter"){var f=Boolean(b),g=a.getUsername();f&&(e.force_login=f),g&&(e.screen_name=g)}return TD.net.util.addURLParameters(TD.config.api_root+"/"+c+"/authorize/"+d,e)},this.getTokenFromURL=function(a,b){var c,d;if(_.contains(b,"/oauth/success/"+a)||_.contains(b,"/oauth2/success/"+a))d=b.split("?")[1],c=TD.net.util.formDecode(d);return c},this.start_chrome=function(a,b,c){var d=this,e,f;chrome.tabs.getSelected(null,function(a){e=a.id}),f={url:this.getAuthURL(a,c)},chrome.tabs.create(f,function(c){var f=c.id;chrome.tabs.onUpdated.addListener(function(c,g,h){var i,j;c===f&&h.url&&h.status=="complete"&&(j=d.getTokenFromURL(a.getType(),h.url),j&&(j.access_token?d.updateAccount(j.access_token,b):d.updateAccount(j.oauth_token,j.oauth_token_secret,b),chrome.tabs.update(e,{selected:!0}),chrome.tabs.remove(c)))})})}},TD.controller.auth.TwitterAuth=function(a){var b=this;b.account=a,this.verifyAccount=function(a,c){var d=b.account,e=TD.config.TWITTER_API_ROOT||"https://api.twitter.com/1.1/",f=e+"account/verify_credentials.json",g=TD.net.ajax.request(f,{account:d,isSigned:!0});g.addCallback(function(b){var e=b.data,f=d.getUserID();f&&f!=e.id?(console.log("Attempting to update wrong account:",d,"Using data:",e),TD.sync.util.printStacktrace(),c()):(d.setUsername(e.screen_name),d.setName(e.name),d.setProfileImageURL(e.profile_image_url_https),d.setUserID(e.id),d.setIsPrivate(e["protected"]),d.setUpdated((new Date).getTime()),d.computeKey(),a(d))}),c&&g.addErrback(c)},this.updateAccount=function(a,c,d){var e=b.account;e.setUsername(""),e.setUserID(""),e.setType("twitter"),e.setOAuthToken(a),e.setTokenSecret(c),this.verifyAccount(d)}},TD.controller.auth.BitlyValidate=function(a){var b=this;b.account=a,this.updateAccount=function(a,b){this.verifyAccount(b)},this.verifyAccount=function(a,c){var d=b.account,e="https://api-ssl.bitly.com/v3/validate",f={x_login:d.get("userId"),x_apiKey:d.get("oauth_token"),apiKey:"R_b8032856b71a14fabfe64f6845689ddf",login:"tweetdeckapi",format:"json"},g=TD.net.ajax.jsonp(e,f);g.addCallback(function(b){var e=b.data;if(!e.data||e.data.valid!=1){c();return}d.setUpdated((new Date).getTime()),d.computeKey(),a(d)}),g.addErrback(c)}},TD.controller.auth.TwitterAuth.prototype=new TD.controller.auth.AuthorisationProcessor,TD.services.ChirpBase=function(a){this.account=a},TD.services.ChirpBase.kMEDIA_CLASS="s-media",TD.services.ChirpBase.RETWEET_CLASS="is-retweet",TD.services.ChirpBase.FAVORITE_CLASS="is-favorite",TD.services.ChirpBase.UNREAD_CLASS="is-unread",TD.services.ChirpBase.TWEET="tweet",TD.services.ChirpBase.MESSAGE="message",TD.services.ChirpBase.MESSAGE_THREAD="message_thread",TD.services.ChirpBase.SCHEDULED_STATUS="scheduled_status",TD.services.ChirpBase.SCHEDULED_GROUP="scheduled_group",TD.services.ChirpBase.prototype.id="",TD.services.ChirpBase.prototype.chirpType="unknown",TD.services.ChirpBase.prototype.text="",TD.services.ChirpBase.prototype.created=null,TD.services.ChirpBase.prototype.htmlText="",TD.services.ChirpBase.prototype.creatorAccount=null,TD.services.ChirpBase.prototype.embeds=null,TD.services.ChirpBase.prototype._hasImage=null,TD.services.ChirpBase.prototype._hasVideo=null,TD.services.ChirpBase.prototype.fromJSONObject=function(){throw"fromJSONObject Not Implemented"},TD.services.ChirpBase.prototype.isOwnChirp=function(){throw"isOwnChirp Not Implemented"},TD.services.ChirpBase.prototype.destroy=function(){throw"destroy Not Implemented"},TD.services.ChirpBase.prototype.render=function(){throw"render Not Implemented"},TD.services.ChirpBase.prototype.renderNotification=function(){return null},TD.services.ChirpBase.prototype.getGrowlData=function(){return null},TD.services.ChirpBase.prototype.email=function(){throw"email Not Implemented"},TD.services.ChirpBase.prototype.postComment=function(){throw"postComment Not Implemented"},TD.services.ChirpBase.prototype.getChirpURL=function(){throw"getChirpURL Not Implemented"},TD.services.ChirpBase.prototype.toHTML=function(a){return TD.util.transform(a)},TD.services.ChirpBase.prototype.isTranslatable=function(){return!1},TD.services.ChirpBase.prototype.translate=function(){throw"translate Not Implemented"},TD.services.ChirpBase.prototype.getChirpType=function(){return this.chirpType},TD.services.ChirpBase.prototype.getScribeItemData=function(){throw"getScribeItemData not implemented"},TD.services.ChirpBase.prototype._changed=function(){TD.controller.notifications.reRender(this)},TD.services.ChirpBase.prototype.getDOMChirps=function(){var a="[data-key$='"+this.id+"'][data-account-key='"+this.account.getKey()+"']";return $(a)},TD.services.ChirpBase.prototype.update=function(a){return!1},TD.services.ChirpBase.prototype.passFilters=function(a){return TD.controller.filterManager.pass(this,a)},TD.services.ChirpBase.prototype._generateHTMLText=function(){this.htmlText=this.toHTML(this.text)},TD.services.ChirpBase.prototype.createdPretty=function(){return TD.util.prettyDate(this.created)},TD.services.ChirpBase.prototype.createdPrettyFull=function(){return TD.util.prettyTimeString(this.created)},TD.services.ChirpBase.prototype.reorder=function(){TD.controller.feedManager.reorderChirp(this.id)},TD.services.ChirpBase.prototype.getSinceId=function(){return this.id},TD.services.ChirpBase.prototype.getUnreadChirps=function(a){return!this.isOwnChirp()&&this.created.getTime()>a?[this]:[]},TD.services.ChirpBase.prototype.getFilterableText=function(){return this.text},TD.services.ChirpBase.prototype.getSenders=function(){return null},TD.services.ChirpBase.prototype.getSource=function(){return null},TD.services.ChirpBase.prototype.isRetweetedStatus=function(){return null},TD.services.ChirpBase.prototype.getMedia=function(){return this._media?this._media:[]},TD.services.ChirpBase.prototype.hasMedia=function(){return this.getMedia().length>0},TD.services.ChirpBase.prototype.hasImage=function(){return this._hasImage===null&&(this._hasImage=this.getMedia().some(function(a){return!a.isVideo})),this._hasImage},TD.services.ChirpBase.prototype.hasVideo=function(){return this._hasVideo===null&&(this._hasVideo=this.getMedia().some(function(a){return a.isVideo})),this._hasVideo},TD.services.ChirpBase.prototype.hasLink=function(){return!1},TD.services.ChirpBase.prototype.isFromVerifiedUser=function(){return!1},TD.services.ChirpBase.msFudge=0,TD.services.ChirpBase.prototype.fudgeCreatedTime=function(a){var b=TD.services.ChirpBase.msFudge;a.setMilliseconds(b),b++,b%=1e3,TD.services.ChirpBase.msFudge=b},TD.services.TwitterComposer=function(a){this.message={},this.id=null,this.url="statuses/update.json",this.isDm=!1,this.isRT=!1,this.isReply=!1,this.client=a,this.retweetID=null},TD.services.TwitterComposer.prototype={Retweet:function(a){return this.url="statuses/retweet/:id.json".replace(":id",a),this.isRT=!0,this.retweetID=a,this},DirectlyTo:function(a){return this.url="direct_messages/new.json",this.isDm=!0,this.message.screen_name=a,this},InReplyTo:function(a){return a&&(this.message.in_reply_to_status_id=a,this.isReply=!0),this.isDm=!1,this},WithMessage:function(a){return this.isDm?this.message.text=a:this.message.status=a,this},WithMedia:function(a){this.file=a},toSchedulableObject:function(){var a={},b={};a.service="twitter",a.user={id:this.client.oauth.account.getUserID()},b.user={name:this.client.oauth.account.getUsername(),avatar_url:this.client.oauth.account.getProfileImageURL()};var c={};return this.isRT?(c.type="retweet",c.body=this.retweetID):this.isDm?(c.type="direct_message",c.screen_name=this.message.screen_name,c.body=this.message.text):(c.type="tweet",c.body=this.message.status,this.message.in_reply_to_status_id&&(c.in_reply_to_status_id=this.message.in_reply_to_status_id)),a.meta=b,a.update=c,a},post:function(a,b){var c,d=function(c){var d;c.error?b&&(c.errorMessage=c.error,b(c)):(this.isDm?(d=this.client.processDM(c),this.client.processMessages([d],!0)):(d=this.client.processTweet(c),this.client.processMiscTweet(d)),a&&a(d),this.isRT?TD.controller.stats.retweet(d.retweetedStatus.user.id,d.retweetedStatus.id,d.account.getUserID()):this.isDm?TD.controller.stats.postMessage(this.client.oauth.account):this.isReply?TD.controller.stats.postReply(this.client.oauth.account):TD.controller.stats.postTweet(this.client.oauth.account))}.bind(this);if(this.file){var e=this.client.oauth.account;url=TD.config.api_root+"/oauth/media/twitter";var f=new FormData;_.each(this.message,function(a,b){f.append(b,a)}),f.append("media[]",this.file),c=TD.net.ajax.upload(url,f,e),c.addCallback(function(a){d(a.data)}),c.addErrback(b)}else this.client.makeTwitterCall(this.client.API_BASE_URL+this.url,this.message,"POST",null,d,b)}},TD.services.TwitterStatus=function(a){this.account=a},TD.services.TwitterStatus.prototype=new TD.services.ChirpBase,TD.services.TwitterStatus.prototype.chirpType=TD.services.ChirpBase.TWEET,TD.services.TwitterStatus.prototype.user=null,TD.services.TwitterStatus.prototype.inReplyToID="",TD.services.TwitterStatus.prototype.inReplyToUserID="",TD.services.TwitterStatus.prototype.inReplyToScreenName="",TD.services.TwitterStatus.prototype.isFavorite=!1,TD.services.TwitterStatus.prototype.isRetweeted=!1,TD.services.TwitterStatus.prototype.retweetCount=0,TD.services.TwitterStatus.prototype.retweetedStatus=null,TD.services.TwitterStatus.prototype.entities=null,TD.services.TwitterStatus.prototype.source="",TD.services.TwitterStatus.prototype.sourceNoHTML="",TD.services.TwitterStatus.prototype.cards=null,TD.services.TwitterStatus.prototype._media=null,TD.services.TwitterStatus.prototype._filterableText=null,TD.services.TwitterStatus.prototype.fromJSONObject=function(a){var b,c,d,e,f=this,g=!1,h;return this.id=a.id_str||a.id,a.user&&(this.user=(new TD.services.TwitterUser(this.account)).fromJSONObject(a.user),this.creatorAccount=TD.storage.accountController.get(TD.storage.Account.generateKeyFor("twitter",this.user.id))),a.source&&(h=$("<div>"+a.source+"</div>"),h.find("a").attr("rel","url").attr("target","_blank"),this.source=h.html(),this.sourceNoHTML=h.text()),this.inReplyToUserID=a.in_reply_to_user_id,this.inReplyToScreenName=a.in_reply_to_screen_name,this.isFavorite=a.favorited,this.isRetweeted=a.retweeted,this.retweetCount=a.retweet_count,this.currentUserRetweet=a.current_user_retweet,this.possiblySensitive=a.possibly_sensitive,this.inReplyToID=a.in_reply_to_status_id_str||a.in_reply_to_status_id,a.retweeted_status?(this.text=a.retweeted_status.text,this.retweetedStatus=(new TD.services.TwitterStatus(this.account)).fromJSONObject(a.retweeted_status),a.retweeted_status.entities&&(this.entities=a.retweeted_status.entities)):(this.text=a.text,a.entities&&(this.entities=a.entities)),this.entities=this.entities||{},this._media=TD.services.TwitterMedia.getMediaFromEntities(this.entities),a.cards&&(this.cards={},_.each(TD.services.TwitterCard.SUPPORTED_CARD_TYPES,function(b){if(a.cards[b]){f.cards[b]=[];for(d=0;d<a.cards[b].length;d++)f.cards[b].push((new TD.services.TwitterCard(f.account)).fromJSONObject(a.cards[b][d]));g=!0}}),g||(this.cards=null)),this.lang=a.lang,e=TD.util.parseDateString(a.created_at),this.fudgeCreatedTime(e),this.created=a.created=e,this._generateHTMLText(),this},TD.services.TwitterStatus.prototype.toHTML=function(a){return TD.util.transform(a,this.entities)},TD.services.TwitterStatus.prototype.getMainUser=function(){return this.retweetedStatus?this.retweetedStatus.user:this.user},TD.services.TwitterStatus.prototype.getCreator=function(){return this.user},TD.services.TwitterStatus.prototype.getMainTweet=function(){return this.retweetedStatus?this.retweetedStatus:this},TD.services.TwitterStatus.prototype.hasLocationData=function(){var a=this.getMainTweet();return a.coordinates||a.place},TD.services.TwitterStatus.prototype.isOwnChirp=function(){return Boolean(this.creatorAccount)},TD.services.TwitterStatus.prototype.isRetweetedStatus=function(){return Boolean(this.retweetedStatus)},TD.services.TwitterStatus.prototype.isTranslatable=function(){var a=this.getMainTweet();return TD.decider.get(TD.decider.TRANSLATE_TWEET)&&a.lang&&a.lang!==TD.languages.getSystemLanguageCode(!0)&&TD.languages.isSupportedTranslationSourceLanguage(a.lang)&&TD.languages.isSystemLangSupportedDestinationLanguage()&&!a.isOwnChirp()&&!a.user.isProtected&&!a.getTranslation()},TD.services.TwitterStatus.prototype.translate=function(){var a=TD.controller.clients.getClient(this.account.getKey()),b=this.getMainTweet().lang,c=TD.languages.getSupportedDestinationSystemLanguage(),d=function(a){var b=this.getDOMChirps(),c=b.find(".js-translate-call-to-action"),d=b.find(".js-tweet-text"),e=b.find(".js-tweet-translation"),f;a.htmltext=TD.util.transform(a.text,a.entities),a.localizedLanguageName=this.getLocalizedLanguageName(),e.length||(d.after(TD.ui.template.render("status/tweet_translation",a)),e=b.find(".js-tweet-translation")),f=e.find(".js-tweet-translation-text"),d.addClass("tweet-translation-original-text margin-bn"),f.html(a.htmltext),c.remove(),this.setTranslation(a)}.bind(this),e=function(a){TD.controller.progressIndicator.addMessage(TD.i("Translation failed"))}.bind(this);a.translateTweet(this.getMainTweet().id,c,d,e),TD.controller.stats.translate(this.getMainUser().id,this.id,this.account.getUserID(),c,b)},TD.services.TwitterStatus.prototype.setTranslation=function(a){this.getMainTweet().translation=a},TD.services.TwitterStatus.prototype.getTranslation=function(){return this.getMainTweet().translation},TD.services.TwitterStatus.prototype.getChirpURL=function(){var a=this.getMainTweet();return"https://twitter.com/"+a.user.screenName+"/status/"+a.id},TD.services.TwitterStatus.prototype.getLocalizedLanguageName=function(){var a=TD.languages.getLanguageFromISOCode(this.getMainTweet().lang);return a?a.localized_name:""},TD.services.TwitterStatus.prototype.destroy=function(){if(!this.isOwnChirp()){TD.controller.progressIndicator.addMessage(TD.i("You don't own this account - can't delete"));return}this._action("delete",function(a){TD.controller.feedManager.deleteChirp(a.id)})},TD.services.TwitterStatus.prototype.getQuoteText=function(){var a={username:this.user.screenName,text:TD.util.removeHTMLCodes(this.text)};return TD.ui.template.toHtml("RT @{{username}}: {{{text}}}",a)},TD.services.TwitterStatus.prototype.renderMinimalist=function(a){return a.isMinimalist=!0,this.render(a)},TD.services.TwitterStatus.prototype.render=function(a){a=a||{};var b=TD.settings.getDisplaySensitiveMedia(),c={tweet:this,withMediaPreview:a.mediaPreviewSize!==TD.vo.Column.MEDIA_PREVIEW_OFF,isMediaPreviewSmall:a.mediaPreviewSize===TD.vo.Column.MEDIA_PREVIEW_SIZE_SMALL,isMediaPreviewLarge:a.mediaPreviewSize===TD.vo.Column.MEDIA_PREVIEW_SIZE_LARGE,mediaPreviewSrc:function(){return this.getMediaSrcForPreviewSize(a.mediaPreviewSize)},thumbSizeClass:TD.services.TwitterMedia.thumbSizeClasses[a.mediaPreviewSize],isPossiblySensitive:this.possiblySensitive&&!b,isMinimalist:Boolean(a.isMinimalist),withTweetActions:!0,withFooter:!0,withAvatar:!0,withLinebreaks:!0},d=$.extend({},c,a);return TD.ui.template.render("status/tweet_in_stream",d)},TD.services.TwitterStatus.prototype.renderInMediaGallery=function(){return TD.ui.template.render("status/tweet_in_box",{tweet:this,withTweetActions:!0,withTweetActionsVisible:!0,withFooter:!0,withAvatar:!0})},TD.services.TwitterStatus.prototype.renderNotification=function(){return TD.ui.template.render("status/tweet_in_box",{tweet:this,withAvatar:!0})},TD.services.TwitterStatus.prototype.getGrowlData=function(){var a=this.getMainTweet(),b={};return a.sender?b.title=a.sender.screenName+" > "+a.recipient.screenName:a.user&&a.user.screenName&&(b.title=a.user.screenName),b.img=a.getMainUser().profileImageURL,b.text=$("<div>"+a.htmlText+"</div>").text(),b},TD.services.TwitterStatus.prototype.favorite=function(a){function h(){TD.controller.progressIndicator.taskFailed(c)}function i(a){a.error?h():(b.setFavorite(!b.isFavorite),TD.controller.progressIndicator.taskComplete(c))}var b=this,c,d=b.getMainUser(),e=b.getMainTweet(),f,g;this.isFavorite?(g=TD.i("Unfavoriting"),TD.controller.clients.getClient(b.account.getKey()).unfavorite(b.id,i,h),f=TD.controller.stats.unfavorite):(g=TD.i("Favoriting"),TD.controller.clients.getClient(b.account.getKey()).favorite(b.id,i,h),f=TD.controller.stats.favorite),c=TD.controller.progressIndicator.addTask(g),f(d.id,e.id,b.account.getUserID())},TD.services.TwitterStatus.prototype.email=function(){var a=TD.i("Tweet forwarded by @{{1}}",{1:this.account.getUsername()}),b=[],c;b.push(this.text),b.push(TD.i("Original Tweet: {{1}}",{1:this.getChirpURL()})),b.push(TD.i("Sent via TweetDeck")),c=b.join("\n\n"),TD.util.openEmail(null,a,c)},TD.services.TwitterStatus.prototype.reply=function(){TD.ui.compose.reply(this,this.account.getKey())},TD.services.TwitterStatus.prototype.retweet=function(){var a=new TD.components.ActionDialog(this)},TD.services.TwitterStatus.prototype.referenceTo=function(){var a=this.account.getKey();TD.ui.compose.referenceTo(this.getChirpURL(),a)},TD.services.TwitterStatus.prototype._action=function(a,b){function h(){TD.controller.progressIndicator.taskFailed(e)}function i(a){a.error?(TD.controller.progressIndicator.changeMessage(e,f+" - "+a.error),h()):(TD.controller.progressIndicator.taskComplete(e),b&&b(c))}var c=this,d=TD.controller.clients.getClient(this.account.getKey()),e,f,g;switch(a){case"delete":this.retweetedStatus?f=TD.i("Undoing Retweet"):f=TD.i("Deleting"),d=TD.controller.clients.getClient(this.creatorAccount.getKey()),d.destroy(this.id,i,h);break;case"deleteDM":f=TD.i("Deleting"),this.creatorAccount&&(d=TD.controller.clients.getClient(this.creatorAccount.getKey())),d.destroyDM(this.id,i,h)}e=TD.controller.progressIndicator.addTask(f)},TD.services.TwitterStatus.prototype._entitySort=function(a,b){return b.indices[0]-a.indices[0]},TD.services.TwitterStatus.prototype.getFilterableText=function(){var a="",b;return this._filterableText?a=this._filterableText:this.entities.urls.length===0&&this.entities.media.length===0?a=this.text:(b=[this.text],b=b.concat(_.pluck(this.entities.urls,"expanded_url")),b=b.concat(_.pluck(this.entities.media,"expanded_url")),b=_.compact(b),a=b.join(" "),this._filterableText=a),a},TD.services.TwitterStatus.prototype.getSenders=function(){var a=[this.user.screenName];return this.isRetweetedStatus()&&a.push(this.retweetedStatus.user.screenName),a},TD.services.TwitterStatus.prototype.getSource=function(){return this.sourceNoHTML},TD.services.TwitterStatus.prototype.setRetweeted=function(a){this.isRetweeted=a,this.getDOMChirps().toggleClass(TD.services.ChirpBase.RETWEET_CLASS,a),this._changed()},TD.services.TwitterStatus.prototype.setFavorite=function(a){this.isFavorite=a,this.getDOMChirps().toggleClass(TD.services.ChirpBase.FAVORITE_CLASS,a).find('a[rel="favorite"]').attr("title",TD.ui.template.render("text/favorite_action",this)),this._changed()},TD.services.TwitterStatus.prototype.isMention=function(){var a=String(this.account.getUserID()),b=this.account.getUsername().toLowerCase(),c=this.entities.user_mentions.length,d;for(var e=0;e<c;e++){d=this.entities.user_mentions[e];if(d.id_str){if(d.id_str===a)return!0}else if(d.screen_name.toLowerCase()===b)return!0}return!1},TD.services.TwitterStatus.prototype.getMedia=function(){return this.retweetedStatus?this.retweetedStatus.getMedia():this._media||[]},TD.services.TwitterStatus.prototype.getUniqueMedia=function(){var a=this.getMedia(),b={},c=[],d=this;return this.cards&&_.each(TD.services.TwitterCard.SUPPORTED_CARD_TYPES,function(a){var c=d.cards[a];c&&_.each(c,function(a){b[a.url]=!0})}),_.each(a,function(a){b[a.shortUrl]||c.push(a)}),c},TD.services.TwitterStatus.prototype.getCardsForGallery=function(){var a=this.getMedia(),b={},c=[],d=this;return _.each(a,function(a){b[a.shortUrl]=!0}),this.cards&&_.each(["photos","players"],function(a){var e=d.cards[a];e&&_.each(e,function(a){b[a.url]||c.push(a)})}),c},TD.services.TwitterStatus.prototype.hasLink=function(){var a=this.entities.media||[],b=this.entities.urls||[];return Boolean(a.length||b.length)},TD.services.TwitterStatus.prototype.isFromVerifiedUser=function(){return this.getMainTweet().user.isVerified},TD.services.TwitterStatus.prototype.hasImage=function(){return this._hasImage===null&&(this._hasImage=TD.services.ChirpBase.prototype.hasImage.call(this)||TD.services.TwitterMedia.entitiesContainImage(this.entities)),this._hasImage},TD.services.TwitterStatus.prototype.hasVideo=function(){return this._hasVideo===null&&(this._hasVideo=TD.services.ChirpBase.prototype.hasVideo.call(this)||TD.services.TwitterMedia.entitiesContainVideo(this.entities)),this._hasVideo},TD.services.TwitterStatus.prototype.getScribeItemData=function(){var a;return this.isRetweetedStatus()?(a=this.getMainTweet().getScribeItemData(),a.retweeting_tweet_id=this.id):(a={item_type:0,id:this.id},this.cards&&(this.cards.photos?a.card_type=2:this.cards.players?a.card_type=3:this.cards.summaries&&(a.card_type=4))),a},TD.services.TwitterCard=function(a){this.account=a},TD.services.TwitterCard.prototype={url:null,title:null,description:null,author:null,site:null,images:null,players:null},TD.services.TwitterCard.SUPPORTED_CARD_TYPES=["summaries","photos","players"],TD.services.TwitterCard.prototype.fromJSONObject=function(a){return this.url=a.url,this.title=a.title,this.description=a.description,a.author_user&&(this.author=(new TD.services.TwitterUser(this.account)).fromJSONObject(a.author_user)),a.site_user&&(this.site=(new TD.services.TwitterUser(this.account)).fromJSONObject(a.site_user)),a.images&&(this.images=a.images),a.players&&(this.players=a.players.filter(function(a){return a.aspectRatio=a.height/a.width*100,a.source_type==="text/html"})),this},TD.services.TwitterCard.prototype.shouldDisable=function(){return TD.util.getAppEnv()==="win"&&this.players},TD.services.TwitterCard.prototype.renderGallery=function(){var a;return this.players?a=TD.ui.template.render("cards/media_player_gallery",this):(params={url:this.url,imageSrc:this.images.web.image_url,thumbClass:TD.services.TwitterMedia.IMAGE_CLASS},a=TD.ui.template.render("status/media_thumb",params)),a},TD.services.TwitterMedia=function(){},TD.services.TwitterMedia.TWITPIC_RE=/(http:\/\/|www.)?twitpic.com\/\w+/,TD.services.TwitterMedia.YFROG_RE=/(http:\/\/|www.)?yfrog.com\/\w+/,TD.services.TwitterMedia.PLIXI_RE=/(http:\/\/|www.)?plixi.com\/p\/[0-9]+/,TD.services.TwitterMedia.LOCKERZ_RE=/(http:\/\/|www.)?lockerz.com\/s\/[0-9]+/,TD.services.TwitterMedia.INSTAGRAM_RE=/(http:\/\/|www.)?instagr.am\/p\/[\w-]+(\/)/,TD.services.TwitterMedia.YOUTUBE_LONG_RE=/(?:(?:https?\:\/\/)?(?:www\.)?)?youtube\.com\/watch[a-zA-Z0-9_\-\?\&\=\/]+/,TD.services.TwitterMedia.YOUTUBE_TINY_RE=/(http:\/\/|www.)?youtu\.be\/([a-zA-Z0-9_\-\?\&\=\/]+)/,TD.services.TwitterMedia.YOUTUBE_RE=new RegExp(TD.services.TwitterMedia.YOUTUBE_LONG_RE.source+"|"+TD.services.TwitterMedia.YOUTUBE_TINY_RE.source),TD.services.TwitterMedia.VIMEO_RE=/https?:\/\/(www\.|player\.)?vimeo\.com\/(.+)/i,TD.services.TwitterMedia.VINE_RE=/https?:\/\/(www\.)?vine\.co\/v\/(.+)/i,TD.services.TwitterMedia.FLICKR_RE=/https?:\/\/(www\.)?(flic.kr|flickr.com\/photos)\/(.+)/i,TD.services.TwitterMedia.IMGUR_RE=/https?:\/\/([a-z0-9]+\.)?imgur.com\/(.+)/i,TD.services.TwitterMedia.PHOTOZOU_RE=/https?:\/\/photozou\.jp\/photo\/(show|photo_only)\/(.+)/i,TD.services.TwitterMedia.FILTERABLE_VIDEO_SERVICES=[TD.services.TwitterMedia.VIMEO_RE,TD.services.TwitterMedia.VINE_RE],TD.services.TwitterMedia.FILTERABLE_IMAGE_SERVICES=[TD.services.TwitterMedia.FLICKR_RE,TD.services.TwitterMedia.IMGUR_RE,TD.services.TwitterMedia.PHOTOZOU_RE],TD.services.TwitterMedia.YOUTUBE_GALLERY_WIDTH=640,TD.services.TwitterMedia.YOUTUBE_GALLERY_HEIGHT=390,TD.services.TwitterMedia.MAX_THUMB_WIDTH=90,TD.services.TwitterMedia.MAX_THUMB_HEIGHT=65,TD.services.TwitterMedia.THUMBNAIL_CONTAINER_CLASS="media-thumb-container",TD.services.TwitterMedia.THUMBNAIL_IMG_CLASS="media-thumb-img",TD.services.TwitterMedia.thumbSizeClasses={off:"",small:"media-size-small",medium:"media-size-medium",large:"media-size-large"},TD.services.TwitterMedia.IMAGE_CLASS="media-img",TD.services.TwitterMedia.SERVICES={twitpic:TD.services.TwitterMedia.TWITPIC_RE,yfrog:TD.services.TwitterMedia.YFROG_RE,lockerz:TD.services.TwitterMedia.LOCKERZ_RE,instagram:TD.services.TwitterMedia.INSTAGRAM_RE,youtube:TD.services.TwitterMedia.YOUTUBE_RE},TD.services.TwitterMedia.getMediaFromEntities=function(a){var b=[],c={};_.each(a.media,function(a){b.push((new TD.services.TwitterMedia).fromMediaEntity(a))});var d=_.map(a.urls,function(a){var b=a.expanded_url||a.url;return c[b]=a.url,_.startsWith(b,"http")||(b="http://"+b),b});return _.each(d,function(a){var d;for(var e in TD.services.TwitterMedia.SERVICES)d=a.match(TD.services.TwitterMedia.SERVICES[e]),d&&d[0]==a&&b.push((new TD.services.TwitterMedia).fromURL(e,c[a],a))}),b},TD.services.TwitterMedia.entitiesContainImage=function(a){return TD.services.TwitterMedia.FILTERABLE_IMAGE_SERVICES.some(function(b){return a.urls.some(function(a){return b.test(a.expanded_url)})})},TD.services.TwitterMedia.entitiesContainVideo=function(a){return TD.services.TwitterMedia.FILTERABLE_VIDEO_SERVICES.some(function(b){return a.urls.some(function(a){return b.test(a.expanded_url)})})},TD.services.TwitterMedia.prototype={flaggedNSFW:!1,isVideo:!1},TD.services.TwitterMedia.prototype.fromMediaEntity=function(a){return this.entity=a,this.service="twitter",this.url=this.shortUrl=a.url,this.sizes=a.sizes,this},TD.services.TwitterMedia.prototype.fromURL=function(a,b,c){return this.url=c,this.shortUrl=b,this.service=a,this.service==="instagram"&&_.endsWith(this.url,"/")?this.url=this.url.substring(0,this.url.length-1):this.service==="youtube"&&(this.isVideo=!0,this.url.match(TD.services.TwitterMedia.YOUTUBE_LONG_RE)?this.mediaId=TD.net.util.decodeURL(this.url).v:this.mediaId=this.url.split("/").pop().split("?")[0]),this},TD.services.TwitterMedia.prototype.thumb=function(){switch(this.service){case"twitter":return this.entity.media_url_https+":thumb";case"twitpic":return"https://twitpic.com/show/thumb/"+this.url.split("/").pop();case"yfrog":return this.url.replace("http://","https://")+":small";case"lockerz":return"https://api.plixi.com/api/tpapi.svc/imagefromurl?size=thumbnail&url="+this.url;case"instagram":return"https://instagr.am/p/"+this.url.split("/").pop()+"/media/?size=t";case"youtube":return"https://img.youtube.com/vi/"+this.mediaId+"/default.jpg"}},TD.services.TwitterMedia.prototype.small=function(){switch(this.service){case"twitter":return this.entity.media_url_https+":small";case"twitpic":case"yfrog":case"lockerz":return this.large();case"instagram":return"https://instagr.am/p/"+this.url.split("/").pop()+"/media/?size=m";case"youtube":return"https://img.youtube.com/vi/"+this.mediaId+"/mqdefault.jpg"}},TD.services.TwitterMedia.prototype.medium=function(){switch(this.service){case"twitter":return this.entity.media_url_https;case"twitpic":case"yfrog":case"lockerz":return this.large();case"instagram":return"https://instagr.am/p/"+this.url.split("/").pop()+"/media/?size=l";case"youtube":return"https://img.youtube.com/vi/"+this.mediaId+"/mqdefault.jpg"}},TD.services.TwitterMedia.prototype.large=function(){switch(this.service){case"twitter":return this.entity.media_url_https+":large";case"twitpic":return"https://twitpic.com/show/full/"+this.url.split("/").pop();case"yfrog":return this.url.replace("http://","https://")+":iphone";case"lockerz":return"https://api.plixi.com/api/tpapi.svc/imagefromurl?size=medium&url="+this.url;case"instagram":return"https://instagr.am/p/"+this.url.split("/").pop()+"/media/?size=l";case"youtube":return"https://img.youtube.com/vi/"+this.mediaId+"/hqdefault.jpg"}},TD.services.TwitterMedia.prototype.getMediaSrcForPreviewSize=function(a){var b=TD.util.isRetina();switch(a){case TD.vo.Column.MEDIA_PREVIEW_SIZE_SMALL:return b?this.small():this.thumb();case TD.vo.Column.MEDIA_PREVIEW_SIZE_MEDIUM:return b?this.medium():this.small();case TD.vo.Column.MEDIA_PREVIEW_SIZE_LARGE:return b?this.large():this.medium()}},TD.services.TwitterMedia.prototype.renderThumb=function(a){var b={url:this.url,imageSrc:this.thumb(),isVideo:this.isVideo,thumbSizeClass:TD.services.TwitterMedia.thumbSizeClasses[a]};return TD.ui.template.render("status/media_thumb",b)},TD.services.TwitterMedia.prototype.renderDetailView=function(){var a;return this.service==="youtube"&&!TD.settings.getUseNarrowColumns()?(a={id:this.mediaId,width:"100%",height:"auto"},TD.ui.template.render("media/youtube",a)):(a={isPossiblySensitive:this.isPossiblySensitive,url:this.url,imageSrc:this.small(),isVideo:this.isVideo,thumbClass:TD.services.TwitterMedia.IMAGE_CLASS},TD.ui.template.render("status/media_thumb",a))},TD.services.TwitterMedia.prototype.renderGallery=function(){var a,b;if(this.service==="youtube"){var b={id:this.mediaId,width:TD.services.TwitterMedia.YOUTUBE_GALLERY_WIDTH,height:TD.services.TwitterMedia.YOUTUBE_GALLERY_HEIGHT};a=TD.ui.template.render("media/youtube",b)}else b={url:this.url,imageSrc:this.large(),thumbClass:TD.services.TwitterMedia.IMAGE_CLASS},a=TD.ui.template.render("status/media_thumb",b);return a},TD.services.TwitterDirectMessage=function(a){this.account=a},TD.services.TwitterDirectMessage.prototype=new TD.services.TwitterStatus,TD.services.TwitterDirectMessage.prototype.chirpType=TD.services.ChirpBase.MESSAGE,TD.services.TwitterDirectMessage.prototype.messageThreadId=null,TD.services.TwitterDirectMessage.prototype.fromJSONObject=function(a){return this.id=a.id_str||String(a.id),this.text=a.text,this.sender=(new TD.services.TwitterUser(this.account)).fromJSONObject(a.sender),this.recipient=(new TD.services.TwitterUser(this.account)).fromJSONObject(a.recipient),this.creatorAccount=TD.storage.accountController.get(TD.storage.Account.generateKeyFor("twitter",this.sender.id)),this.created=TD.util.parseDateString(a.created_at),this.createdDate=TD.util.prettyDate(this.created),this.entities=a.entities||{},this.htmlText=TD.util.transform(this.text,this.entities),this.read=a.read||this.sender.isMe(),this},TD.services.TwitterDirectMessage.prototype.hasLocationData=function(){return!1},TD.services.TwitterDirectMessage.prototype.getMainUser=function(){return this.sender},TD.services.TwitterDirectMessage.prototype.isOwnChirp=function(){return Boolean(this.creatorAccount)},TD.services.TwitterDirectMessage.prototype.dm=function(){var a=this.sender;this.isOwnChirp()&&(a=this.recipient),TD.ui.compose.directMessage(a.screenName,this.account.getKey())},TD.services.TwitterDirectMessage.prototype.getChirpURL=function(){return""},TD.services.TwitterDirectMessage.prototype.destroy=function(){var a=this;this._action("deleteDM",function(){var b=TD.controller.clients.getClient(a.account.getKey());b.deleteMessage(a.id)})},TD.services.TwitterDirectMessage.prototype.render=function(){return TD.ui.template.render("status/message_in_stream",{message:this,withFooter:!0,withAvatar:!0})},TD.services.TwitterDirectMessage.prototype.renderNotification=function(){return TD.ui.template.render("status/message_in_box",{message:this,withAvatar:!0})},TD.services.TwitterDirectMessage.prototype.getSenders=function(){return[this.sender.screenName]},TD.services.TwitterDirectMessage.prototype.getCorrespondent=function(){var a=this.account.getUserID();return this.sender.id==a?this.recipient:this.sender},TD.services.TwitterMessageThread=function(a,b){this.account=a,this.correspondent=b,this.id="messagethread-"+a.getUserID()+"-"+b.id,this.messages=[],this.messageIndex={}},TD.services.TwitterMessageThread.prototype=new TD.services.ChirpBase,TD.services.TwitterMessageThread.prototype.chirpType=TD.services.ChirpBase.MESSAGE_THREAD,TD.services.TwitterMessageThread.prototype.correspondent=null,TD.services.TwitterMessageThread.prototype.unread=!1,TD.services.TwitterMessageThread.prototype.replied=!1,TD.services.TwitterMessageThread.prototype.messages=null,TD.services.TwitterMessageThread.prototype.messageIndex=null,TD.services.TwitterMessageThread.prototype.addMessages=function(a){var b,c,d=!1,e=this.account.getUserID(),f=TD.config.internal_build||TD.decider.get(TD.decider.DM_READ_STATE);if(a.length===0)return;for(b=0,c=a.length;b<c;b++){var g=a[b];if(this.messageIndex[g.id])continue;d=!0;if(g.recipient.id!=e||g.sender.id!=this.correspondent.id)if(g.recipient.id!=this.correspondent.id||g.sender.id!=e)throw new Error("Wrong thread!");g.messageThreadId=this.id,this.messages.push(g),this.messageIndex[g.id]=g,f&&!g.read&&(this.unread=!0)}return this.messages.sort(TD.util.chirpDescSort),this.calculateAttributes(),d},TD.services.TwitterMessageThread.prototype.removeMessage=function(a){var b=this.messageIndex[a];return b?(delete this.messageIndex[a],this.messages=_.select(this.messages,function(b){return b.id!==a}),this.calculateAttributes(),this.getDOMChirps().trigger("uiReadStateChange",{}),!0):!1},TD.services.TwitterMessageThread.prototype.getMainUser=function(){return this.correspondent},TD.services.TwitterMessageThread.prototype.calculateAttributes=function(){var a=this.account.getUserID();if(this.messages.length===0)return;this.messages[0].sender.id==a&&(this.replied=!0,this.unread=!1),this.created=this.messages[0].created;var b=_.detect(this.messages,function(b){return b.recipient.id==a});this.messages.length>0&&(this.text=this.messages[0].text,this.htmlText=this.messages[0].htmlText)},TD.services.TwitterMessageThread.prototype.render=function(a){return TD.ui.template.render("status/message_thread",{chirp:this,withAvatar:!0})},TD.services.TwitterMessageThread.prototype.renderThread=function(){var a=[];return this.messages.forEach(function(b){a.push(b.render())}),a.join("")},TD.services.TwitterMessageThread.prototype.update=function(a){return!0},TD.services.TwitterMessageThread.prototype.getSinceId=function(){var a="",b=_.first(this.messages);return b&&(a=b.id),a},TD.services.TwitterMessageThread.prototype.getUnreadChirps=function(a){var b,c=[],d=TD.config.internal_build||TD.decider.get(TD.decider.DM_READ_STATE),e;if(d){for(e=0;e<this.messages.length;e++)b=this.messages[e],b.isOwnChirp()||(b.read||(b.unread=!0,c.push(b)),e===0&&(this.replied=!1));this.replied&&(c=[])}else for(e=0;e<this.messages.length;e++){b=this.messages[e];if(b.created.getTime()<=a)break;b.isOwnChirp()||(c.push(b),e===0&&(this.unread=!0,this.replied=!1))}return c},TD.services.TwitterMessageThread.prototype.postComment=function(a,b,c){function g(a){TD.controller.progressIndicator.taskComplete(f),b&&b()}function h(a){TD.controller.progressIndicator.taskFailed(f,a.errors[0].message),c&&c()}var d=TD.controller.clients.getClient(this.account.getKey()),e=d.create(),f;if(!a.length){c();return}e.DirectlyTo(this.correspondent.screenName),e.WithMessage(a),f=TD.controller.progressIndicator.addTask(TD.i("Sending...")),e.post(g,h)},TD.services.TwitterMessageThread.prototype.markAsRead=function(){var a=TD.controller.clients.getClient(this.account.getKey()),b=TD.config.internal_build||TD.decider.get(TD.decider.DM_READ_STATE),c=!1,d=0;this.unread=!1,this.getDOMChirps().removeClass(TD.services.ChirpBase.UNREAD_CLASS).trigger("uiReadStateChange",{});var e=function(){},f=function(a){this.unread=!0,TD.controller.progressIndicator.addMessage(TD.i("Failed to mark message as read.")),this.getDOMChirps().addClass(TD.services.ChirpBase.UNREAD_CLASS),this._changed()};b&&(c=this.messages.some(function(a){return!a.read}),c&&a.markMessagesAsRead(this.messages[0].id,this.correspondent.id,e,f.bind(this))),this._changed()},TD.services.TwitterMessageThread.prototype.getSenders=function(){return[this.correspondent.screenName]},TD.services.TwitterUser=function(a){this.account=a},TD.services.TwitterUser.MINI_SUFFIX="_mini",TD.services.TwitterUser.NORMAL_SUFFIX="_normal",TD.services.TwitterUser.BIGGER_SUFFIX="_bigger",TD.services.TwitterUser.REASONABLY_SMALL_SUFFIX="_reasonably_small",TD.services.TwitterUser.NORMAL_SUFFIX_REGEXP=new RegExp(TD.services.TwitterUser.NORMAL_SUFFIX+"(?!.*"+TD.services.TwitterUser.NORMAL_SUFFIX+")"),TD.services.TwitterUser.BIGGER_SUFFIX_REGEXP=new RegExp(TD.services.TwitterUser.BIGGER_SUFFIX+"(?!.*"+TD.services.TwitterUser.BIGGER_SUFFIX+")"),TD.services.TwitterUser.prototype.fromJSONObject=function(a){return this.id=a.id_str,this.screenName=a.screen_name,this.profileImageURL=a.profile_image_url_https,this.avatarSuffixRegex=TD.services.TwitterUser.NORMAL_SUFFIX_REGEXP,TD.util.isRetina()&&(this.profileImageURL=this.profileImageURL.replace(this.avatarSuffixRegex,TD.services.TwitterUser.BIGGER_SUFFIX),this.avatarSuffixRegex=TD.services.TwitterUser.BIGGER_SUFFIX_REGEXP),this.name=a.name,this.location=a.location,this.description=a.description,this.entities=a.entities,this.friendsCount=a.friends_count,this.listedCount=a.listed_count,this.followersCount=a.followers_count,this.statusesCount=a.statuses_count,this.favoritesCount=a.favourites_count,this.listedCount=a.listed_count,this.url=a.url,this.isProtected=a["protected"],this.isVerified=a.verified,this.isTranslator=a.is_translator,this.following=a.following,this.lang=a.lang,this._profileBannerURL=a.profile_banner_url?a.profile_banner_url+"/web":null,TD.util.isRetina()&&this._profileBannerURL&&(this._profileBannerURL+="_retina"),a.status&&(this.lastStatus=(new TD.services.TwitterStatus(this.account)).fromJSONObject(a.status),this.lastStatus.user=this),TD.cache.twitterUsers.add(this),this},TD.services.TwitterUser.prototype.isSameUser=function(a){var b;return a instanceof TD.services.TwitterUser?b=a.screenName.toLowerCase():b=a.toLowerCase(),this.screenName.toLowerCase()===b},TD.services.TwitterUser.prototype.isMe=function(){return this.account.getUserID()==this.id},TD.services.TwitterUser.prototype.reasonablySmallProfileImageURL=function(){return this.profileImageURL.replace(this.avatarSuffixRegex,TD.services.TwitterUser.REASONABLY_SMALL_SUFFIX)},TD.services.TwitterUser.prototype.biggerProfileImageURL=function(){return TD.util.isRetina()?this.reasonablySmallProfileImageURL():this.profileImageURL.replace(this.avatarSuffixRegex,TD.services.TwitterUser.BIGGER_SUFFIX)},TD.services.TwitterUser.prototype.miniProfileImageURL=function(){return TD.util.isRetina()?this.profileImageURL.replace(this.avatarSuffixRegex,TD.services.TwitterUser.NORMAL_SUFFIX):this.profileImageURL.replace(this.avatarSuffixRegex,TD.services.TwitterUser.MINI_SUFFIX)},TD.services.TwitterUser.prototype.prettyFollowersCount=function(){return TD.util.prettyNumber(this.followersCount)},TD.services.TwitterUser.prototype.prettyFriendsCount=function(){return TD.util.prettyNumber(this.friendsCount)},TD.services.TwitterUser.prototype.prettyListedCount=function(){return TD.util.prettyNumber(this.listedCount)},TD.services.TwitterUser.prototype.prettyStatusesCount=function(){return TD.util.prettyNumber(this.statusesCount)},TD.services.TwitterUser.prototype.follow=function(a,b,c,d){var e=TD.controller.clients.getClient(a.getKey()),f=this,g,h=function(a){f.following=!0,d&&(g=TD.i("Successfully followed @{{screenName}}",f),TD.controller.progressIndicator.addMessage(g)),b&&b(a)},i=function(a){d&&(g=TD.i("Unable to follow @{{screenName}}",f),TD.controller.progressIndicator.addMessage(g)),c&&c()};e.followUser(this.screenName,h,i)},TD.services.TwitterUser.prototype.unfollow=function(a,b,c,d){var e=TD.controller.clients.getClient(a.getKey()),f=this,g,h=function(c){f.removeFromView(a,!0),f.following=!1,d&&(g=TD.i("Successfully unfollowed @{{screenName}}",f),TD.controller.progressIndicator.addMessage(g)),b&&b(c)},i=function(){d&&(g=TD.i("Unable to unfollow @{{screenName}}",f),TD.controller.progressIndicator.addMessage(g)),c&&c()};e.unfollowUser(this.screenName,h,i)},TD.services.TwitterUser.prototype.unblock=function(a,b,c){var d=TD.controller.clients.getClient(a.getKey());d.unfollowUser(this.screenName,b,c),$.publish("/user/"+this.screenName+"/unblock",[this.account])},TD.services.TwitterUser.prototype.block=function(a,b,c,d){var e=this,f=TD.controller.clients.getClient(a.getKey()),g=function(c){TD.controller.progressIndicator.addMessage(h),e.following=!1,$.publish("/user/"+e.screenName+"/blocked",[e.account]),e.removeFromView(a,!1),b&&TD.controller.stats.spam(e.screenName,e.id,e.account.getUserID())},h;$.publish("/user/"+this.screenName+"/block",[this.account]),b?(f.blockAndReportUser(this.screenName,g,d),h=TD.i("Successfully blocked and reported @{{screenName}}",{screenName:this.screenName})):(f.blockUser(this.screenName,g,d),h=TD.i("Successfully blocked @{{screenName}}",{screenName:this.screenName}))},TD.services.TwitterUser.prototype.removeFromView=function(a,b){$.publish("/user/removeTweets",[this.screenName,a.getUserID(),b])},TD.services.TwitterUser.prototype.bio=function(){var a=this.entities&&this.entities.description||{};return TD.util.transform(this.description,a)},TD.services.TwitterUser.prototype.htmlLocation=function(){var a=this.entities&&this.entities.location||{};return TD.util.transform(this.location,a)},TD.services.TwitterUser.prototype.hasLocation=function(){return Boolean(this.htmlLocation())},TD.services.TwitterUser.prototype.getFollowerURL=function(){return"http://twitter.com/"+this.screenName+"/followers"},TD.services.TwitterUser.prototype.getFriendURL=function(){return"http://twitter.com/"+this.screenName+"/following"},TD.services.TwitterUser.prototype.getProfileURL=function(){return"http://twitter.com/"+this.screenName},TD.services.TwitterUser.prototype.getListedURL=function(){return"http://twitter.com/"+this.screenName+"/lists/memberships"},TD.services.TwitterUser.prototype.getDisplayURL=function(){var a=this.entities;return a&&a.url&&a.url.urls&&a.url.urls.length&&a.url.urls[0].display_url?a.url.urls[0].display_url:this.url},TD.services.TwitterUser.prototype.profileBannerURL=function(){return this._profileBannerURL||"/web/assets/global/backgrounds/td_profile_empty"+(TD.util.isRetina()?"@2x.jpg":".jpg")},TD.services.TrendingTopic=function(){},TD.services.TrendingTopic.prototype.name="",TD.services.TrendingTopic.prototype.query="",TD.services.TrendingTopic.prototype.url="",TD.services.TrendingTopic.prototype.description="",TD.services.TrendingTopic.prototype.attribution="",TD.services.TrendingTopic.prototype.created=0,TD.services.TrendingTopic.prototype.promotedContent=null,TD.services.TrendingTopic.prototype.events=null,TD.services.TrendingTopic.prototype.fromJSONObject=function(a){return this.name=a.name,this.query=a.query,this.promotedContent=a.promoted_content,this.events=a.events,this.created=(new Date).getTime(),this.query=encodeURIComponent(this.name),this.url||(this.url="http://search.twitter.com/search?q="+this.query),this.promotedContent&&this.promotedContent.description&&(this.description=TD.util.escape(this.promotedContent.description)),this},TD.services.TrendLocation=function(){},TD.services.TrendLocation.prototype.PLACE_TYPE_SUPERNAME=19,TD.services.TrendLocation.prototype.PLACE_TYPE_COUNTRY=12,TD.services.TrendLocation.prototype.PLACE_TYPE_TOWN=7,TD.services.TrendLocation.prototype.placeType=null,TD.services.TrendLocation.prototype.name="",TD.services.TrendLocation.prototype.woeid=-1,TD.services.TrendLocation.prototype.url="",TD.services.TrendLocation.prototype.countryCode="",TD.services.TrendLocation.prototype.country="",TD.services.TrendLocation.prototype.label="",TD.services.TrendLocation.prototype.sortString="",TD.services.TrendLocation.prototype.isTown=!1,TD.services.TrendLocation.prototype.fromJSONObject=function(a){this.name=a.name,this.woeid=a.woeid,this.url=a.url,this.countryCode=a.countryCode,this.country=a.country,this.placeType=a.placeType;switch(this.placeType.code){case this.PLACE_TYPE_TOWN:this.label="â"+this.name,this.sortString=this.country+this.name,this.isTown=!0;break;case this.PLACE_TYPE_SUPERNAME:this.label=this.name.toUpperCase(),this.sortString="";break;default:this.label=this.name,this.sortString=this.name}return this},TD.services.TwitterList=function(a){this.account=a},TD.services.TwitterList.prototype.fromJSONObject=function(a){return this.id=a.id_str,this.name=a.name,this.description=a.description,this.slug=a.slug,this.fullName=a.full_name,this.memberCount=a.member_count,this.isPrivate=a.mode==="private",this.user=(new TD.services.TwitterUser(this.account)).fromJSONObject(a.user),this},TD.services.TwitterList.prototype.isOwnList=function(){var a=TD.storage.Account.generateKeyFor("twitter",this.user.id),b=TD.storage.accountController.get(a);return Boolean(b)},TD.services.TwitterSearchParser=function(a){this.query=a,this.terms=[],this.init()},TD.services.TwitterSearchParser.PUNCT=new RegExp("["+twttr.txt.regexen.punct.source+"]","g"),TD.services.TwitterSearchParser.ALLOWED_CHARS=["@","#",'"',"-"],TD.services.TwitterSearchParser.isStreamable=function(a){var b=a.match(TD.services.TwitterSearchParser.PUNCT),c=_.difference(b,TD.services.TwitterSearchParser.ALLOWED_CHARS);return c.length===0},TD.services.TwitterSearchParser.prototype.PHRASE="phrase",TD.services.TwitterSearchParser.prototype.NEGATIVE_PHRASE="negPhrase",TD.services.TwitterSearchParser.prototype.AND="and",TD.services.TwitterSearchParser.prototype.OR="or",TD.services.TwitterSearchParser.prototype.query="",TD.services.TwitterSearchParser.prototype.trackQuery="",TD.services.TwitterSearchParser.prototype.thePhrase="",TD.services.TwitterSearchParser.prototype.type="",TD.services.TwitterSearchParser.prototype.init=function(){if(this.trackQuery)return;var a,b;typeof this.query=="string"?b=TD.services.TwitterSearchParser.extractPhrases(this.query,!1):b=this.query;if(b.length!==0)if(b.length===1)this.thePhrase=b[0].toLowerCase(),this.thePhrase.charAt(0)==="-"&&this.thePhrase.indexOf(" ")===-1?(this.type=this.NEGATIVE_PHRASE,this.thePhrase=this.thePhrase.slice(1),this.trackQuery=""):(this.type=this.PHRASE,this.trackQuery=this.thePhrase);else{var c=[[]],d=!0,e;for(e=0;e<b.length;e++){a=b[e];if(a==="OR"){_.last(c).push(a),d=!0;continue}if(a==="AND")continue;d?_.last(c).push(a):c.push([a]),d=!1}c=_.reject(c,function(a){return _.isEmpty(a)});if(c.length>1){this.type=this.AND;for(e=0;e<c.length;e++){var f=c[e];f.length>0&&this.terms.push(new TD.services.TwitterSearchParser(f))}this.trackQuery=this.calculateANDTrackQuery(c)}else{this.type=this.OR;for(e=0;e<c[0].length;e++)a=c[0][e],a!="OR"&&(this.terms.push(new TD.services.TwitterSearchParser([a])),a.charAt(0)!="-"&&(this.trackQuery&&(this.trackQuery+=","),this.trackQuery+=a))}}},TD.services.TwitterSearchParser.prototype.calculateANDTrackQuery=function(a){var b=[""];for(var c=0;c<a.length;c++){var d=a[c],e=[];for(var f=0;f<d.length;f++){var g=d[f];if(g=="OR")continue;if(g.charAt(0)=="-")e=b;else for(var h=0;h<b.length;h++){var i=b[h],j=i?i+" ":"";j+=g,e.push(j)}}b=e}return b.join(",")},TD.services.TwitterSearchParser.extractPhrases=function(a,b){var c,d=[],e=a.split('"');for(var f=0;f<e.length;f++){if(!e[f])continue;if(f%2==1&&f<e.length-1)c=e[f].trim(),c&&(b&&(c='"'+c+'"'),d.push(c));else{var g=e[f].split(" ");for(var h=0;h<g.length;h++)c=g[h],c=c.trim(),c&&d.push(c)}}return d},TD.services.TwitterSearchParser.prototype.match=function(a,b){var c,d;b||(a=a.toLowerCase());switch(this.type){case this.PHRASE:return a.indexOf(this.thePhrase)!==-1;case this.NEGATIVE_PHRASE:return a.indexOf(this.thePhrase)===-1;case this.AND:for(c=0;c<this.terms.length;c++){d=this.terms[c];if(!d.match(a,!0))return!1}return!0;case this.OR:for(c=0;c<this.terms.length;c++){d=this.terms[c];if(d.match(a,!0))return!0}return!1;default:return!1}},TD.services.StreamEngine=klass(function(a,b){this._account=a,this._callback=b,this._url="",this._state=TD.services.StreamEngine.DISCONNECTED,this._stream=null,this._backoffLimit=0,this._backoffTimeout=null,this._keepaliveTimeout=null,this._handleData=TD.util.bind(this._handleData,this),this._handleStreamInterruption=TD.util.bind(this._handleStreamInterruption,this),this.connect=_.debounce(this._connect,50)}).statics({BACKOFF_PERIOD_MIN:2e4,BACKOFF_PERIOD_MAX:24e4,BACKOFF_PERIOD_MAX_EXTENDED:72e4,KEEPALIVE_PERIOD:9e4,XHR_BYTE_LIMIT:5e7,DISCONNECTED:"disconnected",CONNECTING:"connecting",STREAMING:"streaming",DEBUG:!1}).methods({log:function(){TD.services.StreamEngine.DEBUG&&(console.log((new Date).toUTCString(),">",this._account.getUsername(),">",arguments),TD.util.insertLogDivider())},_connect:function(a){if(a===this._url){this.log("Connect",a,"Already connecting/connected. Do nothing");return}a?(this.log("Connect",a),this.disconnect(),this._url=a,this._startNewStream()):(this.log("Connect",a,"Nothing to stream. Disconnecting"),this.disconnect())},disconnect:function(){this.log("Disconnect completely"),this._setState(TD.services.StreamEngine.DISCONNECTED),this._disconnectStream(),this._url="",this._backoffLimit=0},isStreaming:function(){var a=this._state===TD.services.StreamEngine.STREAMING;return this.log("isStreaming",a),a},_setState:function(a){var b=this._state===TD.services.StreamEngine.STREAMING,c=a===TD.services.StreamEngine.STREAMING;this._state=a,b!==c&&$(document).trigger("dataUserStreamStatus",{accountKey:this._account.getKey(),streaming:c})},_startNewStream:function(){this._disconnectStream(),this.log("Start stream"),this._setState(TD.services.StreamEngine.CONNECTING),this._stream=this._createStreamRequest(),this._stream.goStreaming()},_disconnectStream:function(){this._stream&&(this.log("Disconnect stream"),this._stream.onStreaming.disconnect&&(this._stream.onStreaming.disconnect(this._handleData),this._stream.onFailure.disconnect(this._handleStreamInterruption)),this._stream.deleteLater(),this._stream=null),clearTimeout(this._backoffTimeout),clearTimeout(this._keepaliveTimeout),this._backoffTimeout=null,this._keepaliveTimeout=null},_handleData:function(a){var b=this;switch(this._state){case TD.services.StreamEngine.DISCONNECTED:return;case TD.services.StreamEngine.CONNECTING:this._setState(TD.services.StreamEngine.STREAMING),this._backoffLimit=0,this.log("Stream is functioning")}this._processDataString(a),clearTimeout(this._keepaliveTimeout),this._keepaliveTimeout=setTimeout(function(){b._handleStreamInterruption("Keepalive timeout",0)},TD.services.StreamEngine.KEEPALIVE_PERIOD),TD.util.isWrapperApp()||this._stream.receivedChars>TD.services.StreamEngine.XHR_BYTE_LIMIT&&(this.log("Reached XHR byte limit, reconnecting"),this._startNewStream())},_processDataString:function(a){var b,c,d=0;if(!a)return;b=a.split("\r");for(var e=0;e<b.length;e++)c=_.strip(b[e]),c.length&&(d++,this._callback(JSON.parse(c)));$(document).trigger("dataReceivedStreamData",{numStreamItems:d})},_handleStreamInterruption:function(a,b){this.log("Stream interrupted",a,b);switch(this._state){case TD.services.StreamEngine.DISCONNECTED:break;case TD.services.StreamEngine.CONNECTING:this._disconnectStream(),this._setBackoffTimeout(b);break;case TD.services.StreamEngine.STREAMING:this._startNewStream()}},_setBackoffTimeout:function(a){var b=this;this._backoffLimit=Math.max(this._backoffLimit,TD.services.StreamEngine.BACKOFF_PERIOD_MIN),this._backoffLimit*=2,String(a)==="420"?this._backoffLimit=Math.min(this._backoffLimit,TD.services.StreamEngine.BACKOFF_PERIOD_MAX_EXTENDED):this._backoffLimit=Math.min(this._backoffLimit,TD.services.StreamEngine.BACKOFF_PERIOD_MAX);var c=this._backoffLimit/2,d=c+Math.ceil(Math.random()*c);this.log("Set backoff timeout",(d/1e3).toString()+"s"),this._setState(TD.services.StreamEngine.CONNECTING),this._backoffTimeout=setTimeout(function(){b.log("Backoff complete, attempting reconnect"),b._startNewStream()},d)},_createStreamRequest:function(){var a;return TD.util.isWrapperApp()?a=deck.signedRequestFactory("GET",this._url,"","","",this._account.getOAuthToken(),this._account.getTokenSecret()):a=new TD.net.StreamRequest(this._url,this._account),a.onStreaming.connect(this._handleData),a.onFailure.connect(this._handleStreamInterruption),a}}),TD.services.TwitterAction=function(a){this.account=a},TD.services.TwitterAction.FAVORITE="favorite",TD.services.TwitterAction.RETWEET="retweet",TD.services.TwitterAction.MENTION="mention",TD.services.TwitterAction.REPLY="reply",TD.services.TwitterAction.FOLLOW="follow",TD.services.TwitterAction.LIST_MEMBER_ADDED="list_member_added",TD.services.TwitterAction.LIST_CREATED="list_created",TD.services.TwitterAction.UNFAVORITE="unfavorite",TD.services.TwitterAction.LIST_MEMBER_REMOVED="list_member_removed",TD.services.TwitterAction.LIST_DESTROYED="list_destroyed",TD.services.TwitterAction.UNFOLLOW="unfollow",TD.services.TwitterAction.processStreamAction=function(a,b){var c=TD.services.TwitterAction._getActionConstructor(a.event);return(new c(b)).fromJSONObject(a,null,!0)},TD.services.TwitterAction.processRESTAction=function(a,b){var c=TD.services.TwitterAction._getActionConstructor(a.action),d=a.sources,e=a.targets_size>0?a.targets:[undefined],f=a.target_objects_size>0?a.target_objects:[undefined],g=[];for(var h=0;h<d.length;h++){if(a.action===TD.services.TwitterAction.RETWEET){if(f[0].user.id!=b.getUserID())continue;g.push([a,d[h],e[h],f[0]]);continue}for(var i=0;i<e.length;i++)for(var j=0;j<f.length;j++){if(a.action===TD.services.TwitterAction.LIST_MEMBER_ADDED&&d[h].id!==f[j].user.id)continue;g.push([a,d[h],e[i],f[j]])}}var k=_.map(g,function(d){return(new c(b)).fromJSONObject(a,d,!1)});return k},TD.services.TwitterAction._getActionConstructor=function(a){switch(a){case TD.services.TwitterAction.MENTION:case TD.services.TwitterAction.REPLY:return TD.services.TwitterActionMention;case TD.services.TwitterAction.FAVORITE:case TD.services.TwitterAction.UNFAVORITE:return TD.services.TwitterActionFavorite;case TD.services.TwitterAction.RETWEET:return TD.services.TwitterActionRetweet;case TD.services.TwitterAction.FOLLOW:case TD.services.TwitterAction.UNFOLLOW:return TD.services.TwitterActionFollow;case TD.services.TwitterAction.LIST_MEMBER_ADDED:case TD.services.TwitterAction.LIST_MEMBER_REMOVED:return TD.services.TwitterActionListMemberAdded;case TD.services.TwitterAction.LIST_CREATED:case TD.services.TwitterAction.LIST_DESTROYED:return TD.services.TwitterActionListCreated;default:return TD.services.TwitterAction}},TD.services.TwitterAction.prototype=new TD.services.ChirpBase,TD.services.TwitterAction.prototype.getChirpType=function(){return this.action},TD.services.TwitterAction.prototype.action=null,TD.services.TwitterAction.prototype.maxPosition=null,TD.services.TwitterAction.prototype.minPosition=null,TD.services.TwitterAction.msFudge=0,TD.services.TwitterAction.prototype.fromJSONObject=function(a,b,c){return c?this.fromStreamData(a):this.fromRESTData.apply(this,b),this.created=TD.util.parseDateString(a.created_at),this.fudgeCreatedTime(this.created),this.maxPosition=a.max_position||this.created.getTime().toString(),this.minPosition=a.min_position||this.created.getTime().toString(),this.generateInternalID(),this.generateText(),this},TD.services.TwitterAction.prototype.fromRESTData=function(a,b,c,d){throw"TwitterAction.fromRESTData not implemented"},TD.services.TwitterAction.prototype.fromStreamData=function(a){throw"TwitterAction.fromStreamData not implemented"},TD.services.TwitterAction.prototype.generateInternalID=function(){throw"TwitterAction.generateInternalID not implemented"},TD.services.TwitterAction.prototype.generateText=function(){},TD.services.TwitterAction.prototype.render=function(){throw"TwitterAction.render not implemented"},TD.services.TwitterAction.prototype.renderNotification=function(){throw"TwitterAction.renderNotification not implemented"},TD.services.TwitterAction.prototype.isAboutYou=function(){throw"TwitterAction.isAboutYou not implemented"},TD.services.TwitterAction.prototype.isOwnChirp=function(){throw"TwitterAction.isOwnChirp not implemented"},TD.services.TwitterAction.prototype.getChirpURL=function(){return"http://twitter.com/activity"},TD.services.TwitterAction.prototype.getCreator=function(){throw"TwitterAction.getCreator not implemented"},TD.services.TwitterAction.prototype.getRelatedTweet=function(){return null},TD.services.TwitterAction.prototype.getSenders=function(){return[this.getCreator().screenName]},TD.services.TwitterAction.prototype.isFromVerifiedUser=function(){return this.getCreator().isVerified},TD.services.TwitterActionOnTweet=function(a){this.account=a},TD.services.TwitterActionOnTweet.prototype=new TD.services.TwitterAction,TD.services.TwitterActionOnTweet.prototype.sourceUser=null,TD.services.TwitterActionOnTweet.prototype.targetTweet=null,TD.services.TwitterActionOnTweet.prototype.generateInternalID=function(){this.id=[this.action,this.sourceUser.id,this.targetTweet.id].join("_")},TD.services.TwitterActionOnTweet.prototype.isAboutYou=function(){return this.targetTweet.user.id==this.account.getUserID()},TD.services.TwitterActionOnTweet.prototype.isOwnChirp=function(){return this.sourceUser.id==this.account.getUserID()},TD.services.TwitterActionOnTweet.prototype.getRelatedTweet=function(){return this.targetTweet},TD.services.TwitterActionOnTweet.prototype.getCreator=function(){return this.sourceUser},TD.services.TwitterActionOnTweet.prototype.render=function(a){a=a||{};var b=TD.settings.getDisplaySensitiveMedia();return TD.ui.template.render("status/tweet_activity_in_stream",{chirp:this,icon:this.iconClass,withTweetActions:!0,withFooter:!0,withAvatar:!0,withMediaPreview:a.mediaPreviewSize!==TD.vo.Column.MEDIA_PREVIEW_OFF,isMediaPreviewSmall:a.mediaPreviewSize===TD.vo.Column.MEDIA_PREVIEW_SIZE_SMALL,isMediaPreviewLarge:a.mediaPreviewSize===TD.vo.Column.MEDIA_PREVIEW_SIZE_LARGE,mediaPreviewSrc:function(){return this.getMediaSrcForPreviewSize(a.mediaPreviewSize)},thumbSizeClass:TD.services.TwitterMedia.thumbSizeClasses[a.mediaPreviewSize],isPossiblySensitive:this.possiblySensitive&&!b,withLinebreaks:!0})},TD.services.TwitterActionOnTweet.prototype.renderNotification=function(){return TD.ui.template.render("status/tweet_activity_in_box",{chirp:this,icon:this.iconClass,withAvatar:!0})},TD.services.TwitterActionOnTweet.prototype.getGrowlData=function(){return{title:this.text,img:this.targetTweet.user.profileImageURL,text:$("<div>"+this.targetTweet.htmlText+"</div>").text()}},TD.services.TwitterActionOnTweet.prototype.getMedia=function(){return this.getRelatedTweet().getMedia()},TD.services.TwitterActionRetweet=function(a){this.account=a},TD.services.TwitterActionRetweet.prototype=new TD.services.TwitterActionOnTweet,TD.services.TwitterActionRetweet.prototype.action=TD.services.TwitterAction.RETWEET,TD.services.TwitterActionRetweet.prototype.iconClass="icon-retweeted",TD.services.TwitterActionRetweet.prototype.retweet=null,TD.services.TwitterActionRetweet.prototype.fromRESTData=function(a,b,c,d){this.sourceUser=(new TD.services.TwitterUser(this.account)).fromJSONObject(b),this.retweet=(new TD.services.TwitterStatus(this.account)).fromJSONObject(c),this.targetTweet=(new TD.services.TwitterStatus(this.account)).fromJSONObject(d)},TD.services.TwitterActionRetweet.prototype.fromStreamData=function(a){this.sourceUser=(new TD.services.TwitterUser(this.account)).fromJSONObject(a.source),this.retweet=(new TD.services.TwitterStatus(this.account)).fromJSONObject(a.target),this.targetTweet=this.retweet.retweetedStatus},TD.services.TwitterActionRetweet.prototype.fromRetweet=function(a){return this.sourceUser=a.user,this.retweet=a,this.targetTweet=a.retweetedStatus,this.created=new Date(a.created),this.fudgeCreatedTime(this.created),this.generateInternalID(),this.generateText(),this.maxPosition=this.minPosition=this.created.getTime().toString(),this},TD.services.TwitterActionRetweet.prototype.generateText=function(){var a=TD.i("{{{user}}} retweeted",null,!0);this.text=TD.ui.template.toHtml(a,{user:this.sourceUser.name}),this.htmlText=TD.ui.template.toHtml(a,{user:TD.ui.template.render("text/user_link_fullname",this.sourceUser)})},TD.services.TwitterActionMention=function(a){this.account=a},TD.services.TwitterActionMention.prototype=new TD.services.TwitterActionOnTweet,TD.services.TwitterActionMention.prototype.action=TD.services.TwitterAction.MENTION,TD.services.TwitterActionMention.prototype.iconClass="icon-mentioned",TD.services.TwitterActionMention.prototype.fromRESTData=function(a,b,c,d){a.action==="reply"?this.targetTweet=(new TD.services.TwitterStatus(this.account)).fromJSONObject(c):this.targetTweet=(new TD.services.TwitterStatus(this.account)).fromJSONObject(d),this.sourceUser=(new TD.services.TwitterUser(this.account)).fromJSONObject(b)},TD.services.TwitterActionMention.prototype.fromStreamData=function(a){return this.sourceUser=a.user,this.targetTweet=a,this.created=new Date(a.created),this.fudgeCreatedTime(this.created),this.generateInternalID(),this.generateText(),this.maxPosition=this.minPosition=this.created.getTime().toString(),this},TD.services.TwitterActionMention.prototype.generateText=function(){var a=TD.i("{{{user}}} mentioned you",null,!0);this.text=TD.ui.template.toHtml(a,{user:this.sourceUser.name}),this.htmlText=TD.ui.template.toHtml(a,{user:TD.ui.template.render("text/user_link_fullname",this.sourceUser)})},TD.services.TwitterActionListCreated=function(a){this.account=a},TD.services.TwitterActionListCreated.prototype=new TD.services.TwitterAction,TD.services.TwitterActionListCreated.prototype.action=TD.services.TwitterAction.LIST_CREATED,TD.services.TwitterActionListCreated.prototype.owner=null,TD.services.TwitterActionListCreated.prototype.list=null,TD.services.TwitterActionListCreated.prototype.fromRESTData=function(a,b,c){this.owner=(new TD.services.TwitterUser(this.account)).fromJSONObject(b),this.list=(new TD.services.TwitterList(this.account)).fromJSONObject(c)},TD.services.TwitterActionListCreated.prototype.fromStreamData=function(a){this.owner=(new TD.services.TwitterUser(this.account)).fromJSONObject(a.source),this.list=(new TD.services.TwitterList(this.account)).fromJSONObject(a.target_object)},TD.services.TwitterActionListCreated.prototype.generateInternalID=function(){this.id=[this.action,this.owner.id,this.list.id].join("_")},TD.services.TwitterActionListCreated.prototype.generateText=function(){var a=TD.i("{{{owner}}} created the list {{{list}}}.",null,!0);this.text=TD.ui.template.toHtml(a,{owner:this.owner.name,list:this.list.fullName}),this.htmlText=TD.ui.template.toHtml(a,{owner:TD.ui.template.render("text/user_link_fullname",this.owner),list:TD.ui.template.render("text/list_link",this.list)})},TD.services.TwitterActionListCreated.prototype.isOwnChirp=function(){return this.owner.id==this.account.getUserID()},TD.services.TwitterActionListCreated.prototype.isAboutYou=function(){return!1},TD.services.TwitterActionListCreated.prototype.getCreator=function(){return this.owner},TD.services.TwitterActionListCreated.prototype.render=function(){var a={chirp:this};return TD.ui.template.render("status/list_activity",a)},TD.services.TwitterActionListCreated.prototype.renderNotification=function(){return this.render(null)},TD.services.TwitterActionListCreated.prototype.getGrowlData=function(){return{title:this.text,img:null,text:this.list.description}},TD.services.TwitterActionListMemberAdded=function(a){this.account=a},TD.services.TwitterActionListMemberAdded.prototype=new TD.services.TwitterAction,TD.services.TwitterActionListMemberAdded.prototype.action=TD.services.TwitterAction.LIST_MEMBER_ADDED,TD.services.TwitterActionListMemberAdded.prototype.owner=null,TD.services.TwitterActionListMemberAdded.prototype.added=null,TD.services.TwitterActionListMemberAdded.prototype.list=null,TD.services.TwitterActionListMemberAdded.prototype.fromRESTData=function(a,b,c,d){this.owner=(new TD.services.TwitterUser(this.account)).fromJSONObject(b),this.added=(new TD.services.TwitterUser(this.account)).fromJSONObject(c),this.list=(new TD.services.TwitterList(this.account)).fromJSONObject(d)},TD.services.TwitterActionListMemberAdded.prototype.fromStreamData=function(a){this.owner=(new TD.services.TwitterUser(this.account)).fromJSONObject(a.source),this.added=(new TD.services.TwitterUser(this.account)).fromJSONObject(a.target),this.list=(new TD.services.TwitterList(this.account)).fromJSONObject(a.target_object)},TD.services.TwitterActionListMemberAdded.prototype.generateInternalID=function(){this.id=[this.action,this.owner.id,this.added.id,this.list.id].join("_")},TD.services.TwitterActionListMemberAdded.prototype.generateText=function(){var a;this.isAboutYou()?a=TD.i("{{{owner}}} added you to the list {{{list}}}.",null,!0):a=TD.i("{{{owner}}} added {{{added}}} to the list {{{list}}}.",null,!0),this.text=TD.ui.template.toHtml(a,{owner:this.owner.name,added:this.added.name,list:this.list.fullName}),this.htmlText=TD.ui.template.toHtml(a,{owner:TD.ui.template.render("text/user_link_fullname",this.owner),added:TD.ui.template.render("text/user_link_fullname",this.added),list:TD.ui.template.render("text/list_link",this.list)})},TD.services.TwitterActionListMemberAdded.prototype.isOwnChirp=function(){return this.owner.id==this.account.getUserID()},TD.services.TwitterActionListMemberAdded.prototype.isAboutYou=function(){return this.added.id==this.account.getUserID()},TD.services.TwitterActionListMemberAdded.prototype.getCreator=function(){return this.owner},TD.services.TwitterActionListMemberAdded.prototype.render=function(){var a={chirp:this};return TD.ui.template.render("status/list_activity",a)},TD.services.TwitterActionListMemberAdded.prototype.renderNotification=function(){return this.render(null)},TD.services.TwitterActionListMemberAdded.prototype.getGrowlData=function(){return{title:this.text,img:null,text:this.list.description}},TD.services.TwitterActionMultiListMemberAdded=function(a){this.account=a},TD.services.TwitterActionMultiListMemberAdded.prototype=new TD.services.TwitterAction,TD.services.TwitterActionMultiListMemberAdded.prototype.action="multi_list_member_added",TD.services.TwitterActionMultiListMemberAdded.prototype.owner=null,TD.services.TwitterActionMultiListMemberAdded.prototype.added=null,TD.services.TwitterActionMultiListMemberAdded.prototype.lists=null,TD.services.TwitterActionMultiListMemberAdded.prototype.fromRESTData=function(a){this.owner=(new TD.services.TwitterUser(this.account)).fromJSONObject(a.sources[0]),this.added=_.map(a.targets,function(a){return(new TD.services.TwitterUser(this.account)).fromJSONObject(a)}),this.lists=_.map(a.target_objects,function(a){return(new TD.services.TwitterList(this.account)).fromJSONObject(a)})},TD.services.TwitterActionMultiListMemberAdded.prototype.generateInternalID=function(){var a=_.pluck(this.added,"id").sort().join("-"),b=_.pluck(this.lists,"id").sort().join("-");this.id=[this.action,this.owner.id,a,b].join("_")},TD.services.TwitterActionMultiListMemberAdded.prototype.generateText=function(){var a=TD.i("{{{owner}}} added {{{added}}} to the lists {{{lists}}}.",null,!0),b=[],c=[],d=[],e=[];_.each(this.added,function(a){b.push(a.name),c.push(TD.ui.template.render("text/user_link_fullname",a))}),_.each(this.lists,function(a){d.push(a.fullName),e.push(TD.ui.template.render("text/list_link",a))}),this.text=TD.ui.template.toHtml(a,{owner:this.owner.name,added:b.join(", "),lists:d.join(", ")}),this.htmlText=TD.ui.template.toHtml(a,{owner:TD.ui.template.render("text/user_link_fullname",this.owner),added:c.join(", "),lists:e.join(", ")})},TD.services.TwitterActionMultiListMemberAdded.prototype.isOwnChirp=function(){return!1},TD.services.TwitterActionMultiListMemberAdded.prototype.isAboutYou=function(){return!1},TD.services.TwitterActionMultiListMemberAdded.prototype.getCreator=function(){return this.owner},TD.services.TwitterActionMultiListMemberAdded.prototype.render=function(){var a={chirp:this};return TD.ui.template.render("status/action_list",a)},TD.services.TwitterActionMultiListMemberAdded.prototype.renderNotification=function(){return this.render(null)},TD.services.TwitterActionMultiListMemberAdded.prototype.getGrowlData=function(){return{title:null,img:null,text:this.text}},TD.services.TwitterActionFavorite=function(a){this.account=a},TD.services.TwitterActionFavorite.prototype=new TD.services.TwitterActionOnTweet,TD.services.TwitterActionFavorite.prototype.action=TD.services.TwitterAction.FAVORITE,TD.services.TwitterActionFavorite.prototype.iconClass="icon-favorited",TD.services.TwitterActionFavorite.prototype.fromRESTData=function(a,b,c,d){this.sourceUser=(new TD.services.TwitterUser(this.account)).fromJSONObject(b),this.targetTweet=(new TD.services.TwitterStatus(this.account)).fromJSONObject(c)},TD.services.TwitterActionFavorite.prototype.fromStreamData=function(a){this.sourceUser=(new TD.services.TwitterUser(this.account)).fromJSONObject(a.source),this.targetTweet=(new TD.services.TwitterStatus(this.account)).fromJSONObject(a.target_object)},TD.services.TwitterActionFavorite.prototype.generateText=function(){var a;this.isAboutYou()?a=TD.i("{{{user}}} favorited",null,!0):a=TD.i("{{{user}}} favorited",null,!0),this.text=TD.ui.template.toHtml(a,{user:this.sourceUser.name}),this.htmlText=TD.ui.template.toHtml(a,{user:TD.ui.template.render("text/user_link_fullname",this.sourceUser)})},TD.services.TwitterActionFollow=function(a){this.account=a},TD.services.TwitterActionFollow.prototype=new TD.services.TwitterAction,TD.services.TwitterActionFollow.prototype.action=TD.services.TwitterAction.FOLLOW,TD.services.TwitterActionFollow.prototype.following=null,TD.services.TwitterActionFollow.prototype.followed=null,TD.services.TwitterActionFollow.prototype.fromRESTData=function(a,b,c,d){this.following=(new TD.services.TwitterUser(this.account)).fromJSONObject(b),this.followed=(new TD.services.TwitterUser(this.account)).fromJSONObject(c)},TD.services.TwitterActionFollow.prototype.fromStreamData=function(a){this.following=(new TD.services.TwitterUser(this.account)).fromJSONObject(a.source),this.followed=(new TD.services.TwitterUser(this.account)).fromJSONObject(a.target)},TD.services.TwitterActionFollow.prototype.generateInternalID=function(){this.id=[this.action,this.following.id,this.followed.id].join("_")},TD.services.TwitterActionFollow.prototype.generateText=function(){var a;this.isAboutYou()?a=TD.i("{{{user}}} followed you",null,!0):a=TD.i("{{{user}}} followed",null,!0),this.text=TD.ui.template.toHtml(a,{user:this.following.name}),this.htmlText=TD.ui.template.toHtml(a,{user:TD.ui.template.render("text/user_link_fullname",this.following)})},TD.services.TwitterActionFollow.prototype.render=function(){return TD.ui.template.render("status/follow_activity_in_stream",{data:this,withUserMenu:!0,withUserBio:!0})},TD.services.TwitterActionFollow.prototype.renderNotification=function(){return TD.ui.template.render("status/follow_activity_in_box",{isAboutYou:this.isAboutYou(),data:this})},TD.services.TwitterActionFollow.prototype.isAboutYou=function(){return this.followed.id==this.account.getUserID()},TD.services.TwitterActionFollow.prototype.isOwnChirp=function(){return this.following.id==this.account.getUserID()},TD.services.TwitterActionFollow.prototype.getGrowlData=function(){var a=this.getRelatedUser();return{title:this.text,img:a.profileImageURL,text:"@"+a.screenName+"\n"+a.description}},TD.services.TwitterActionFollow.prototype.getRelatedUser=function(){return this.isAboutYou()?this.following:this.followed},TD.services.TwitterActionFollow.prototype.getCreator=function(){return this.following},TD.services.TwitterActionFollow.prototype.getFilterableText=function(){return this.followed.screenName},TD.services.TwitterList=function(a){this.account=a},TD.services.TwitterList.prototype.fromJSONObject=function(a){return this.id=a.id_str,this.name=a.name,this.description=a.description,this.slug=a.slug,this.fullName=a.full_name,this.memberCount=a.member_count,this.isPrivate=a.mode==="private",this.user=(new TD.services.TwitterUser(this.account)).fromJSONObject(a.user),this},TD.services.TwitterList.prototype.isOwnList=function(){var a=TD.storage.Account.generateKeyFor("twitter",this.user.id),b=TD.storage.accountController.get(a);return Boolean(b)},TD.services.TweetDeckClient=function(){var a={},b=TD.core.defer,c=TD.sync.tdapi;a.type="tweetdeck",a.statusMenuTemplate="",a.scheduledUpdates=[];var d,e=function(){var b=a.scheduledUpdates.length;for(var c=0;c<b;c++)TD.controller.feedManager.deleteChirp(a.scheduledUpdates[c].id);a.scheduledUpdates=[]},f=function(a){var b=new TD.services.ScheduledStatus;return b.fromJSONObject(a),b},g=function(a){var b,c,d,e,g={};for(b=0,e=a.length;b<e;b++){c=f(a[b]);if(!c.update)continue;g[c.token]||(g[c.token]=new TD.services.ScheduledGroup(c.token));try{g[c.token].addUpdate(c)}catch(h){console.log("Error processing scheduled update",c,h);continue}}return d=_.values(g),d=_.select(d,function(a){return a.pendingCount||a.retryingCount||a.failedCount}),d},h=function(){var a=TD.storage.columnController.getColumnsByType("scheduled"),b=a[0];if(b)TD.controller.feedScheduler.refreshColumn(b.getKey());else if(!TD.settings.getScheduledColAdded()){var c=TD.controller.columnManager.makeColumnFor("scheduled","tweetdeck");TD.controller.columnManager.addColumnToUI(c),TD.settings.setScheduledColAdded(!0)}},i=function(){return c.isLoggedIn()?c.drequest("/scheduled_update"):b.fail()};return a.removeScheduleGroup=function(a){return c.isLoggedIn()?c.drequest("/scheduled_update/"+a,c.getReq({method:"DELETE"})):b.fail()},a.scheduleGroup=function(d,e,f){if(!c.isLoggedIn())return b.fail();var g=TD.util.iso8601(e);for(var i=0;i<d.length;i++)d[i].timestamp=g;var j=c.requestWithBody("/scheduled_update","POST",d);return f&&j.addCallback(function(){return a.removeScheduleGroup(f)}),j.addCallback(h),j},a.refreshFeed=function(b,d,f,g){if(!c.isLoggedIn()){g&&g();return}if(d)return[];var h=a.getScheduledUpdates();return h.addCallback(function(b){return e(),a.scheduledUpdates=b,a.scheduledUpdates}),h.addCallback(f),g&&h.addErrback(g),h},a.getScheduledUpdates=function(){var a=i();return a.addCallback(function(a){if(a)return g(a)}),a},a.forgotPassword=function(a,b,d){var e={type:"DELETE",headers:{Authorization:"Basic "+TD.core.base64.encode(a+":junk")}};return c.drequest("/password",e)},a.feedIsStreaming=function(a){return!1},a},TD.services.ScheduledStatus=function(){},TD.services.ScheduledStatus.prototype.chirpType=TD.services.ChirpBase.SCHEDULED_STATUS,TD.services.ScheduledStatus.prototype.status=null,TD.services.ScheduledStatus.prototype.service="",TD.services.ScheduledStatus.prototype.token="",TD.services.ScheduledStatus.prototype.created="",TD.services.ScheduledStatus.prototype.timestamp="",TD.services.ScheduledStatus.prototype.uid="",TD.services.ScheduledStatus.prototype.update=null,TD.services.ScheduledStatus.prototype.meta=null,TD.services.ScheduledStatus.prototype.resultID=null,TD.services.ScheduledStatus.prototype.profileUrl="",TD.services.ScheduledStatus.prototype.isTwitter=!1,TD.services.ScheduledStatus.prototype.username="",TD.services.ScheduledStatus.prototype.avatar="",TD.services.ScheduledStatus.prototype.errorReason="",TD.services.ScheduledStatus.prototype.fromJSONObject=function(a){return this.status=a.status,this.service=a.service,this.token=a.token,this.created=a.created,this.timestamp=a.timestamp,this.uid=a.uid,this.update=a.update,this.meta=a.meta,this.resultID=a.result_id,this.username=a.meta.user.name,this.errorReason=a.reason,a.meta.user.avatar_url&&(this.avatar=TD.util.transformTwitterAvatar(a.meta.user.avatar_url,"mini")),a.service==="twitter"&&(this.isTwitter=!0),this._generateProfileUrl(),this},TD.services.ScheduledStatus.prototype._generateProfileUrl=function(){switch(this.service){case"twitter":this.meta&&this.meta.user&&(this.profileUrl="http://twitter.com/"+this.meta.user.name);break;case"facebook":this.profileUrl="http://facebook.com/profile.php?id="+this.uid;break;case"foursquare":case"foursquare2":this.profileUrl="http://foursquare.com/user/"+this.uid}},TD.services.ScheduledGroup=function(a){this.token=a,this.id=a,this.updates=[],this.errorReason="",this.reasonText=null},TD.services.ScheduledGroup.prototype=new TD.services.ChirpBase,TD.services.ScheduledGroup.prototype.chirpType=TD.services.ChirpBase.SCHEDULED_GROUP,TD.services.ScheduledGroup.prototype.token="",TD.services.ScheduledGroup.prototype.updates=null,TD.services.ScheduledGroup.prototype.time=null,TD.services.ScheduledGroup.prototype.pendingCount=0,TD.services.ScheduledGroup.prototype.failedCount=0,TD.services.ScheduledGroup.prototype.retryingCount=0,TD.services.ScheduledGroup.prototype.avatarURL=null,TD.services.ScheduledGroup.prototype.service=null,TD.services.ScheduledGroup.prototype.title="",TD.services.ScheduledGroup.prototype.location="",TD.services.ScheduledGroup.prototype.latitude=NaN,TD.services.ScheduledGroup.prototype.longitude=NaN,TD.services.ScheduledGroup.prototype.mapURL=null,TD.services.ScheduledGroup.prototype.htmlText="",TD.services.ScheduledGroup.prototype.twitterInReplyToStatusID=null,TD.services.ScheduledGroup.prototype.twitterDMTargetScreenName=null,TD.services.ScheduledGroup.prototype.twitterPlaceID=null,TD.services.ScheduledGroup.prototype.facebookWallPostTargetID=null,TD.services.ScheduledGroup.prototype.facebookPageID=null,TD.services.ScheduledGroup.prototype.foursquareVenueID=null,TD.services.ScheduledGroup.prototype.buzzRequest=null,TD.services.ScheduledGroup.prototype.addUpdate=function(a){if(!this.time){var b=a.timestamp;b.indexOf("+")===-1&&(b+="+00:00"),this.time=TD.util.parseISO8601(b),this.created=this.time}switch(a.service){case"twitter":this.twitterPlaceID=this.twitterPlaceID||a.update.place_id,this.twitterInReplyToStatusID=this.twitterInReplyToStatusID||a.update.in_reply_to_status_id,a.update.type==="direct_message"&&(this.twitterDMTargetScreenName=this.twitterDMTargetScreenName||a.update.screen_name);break;case"facebook":this.facebookWallPostTargetID=this.facebookWallPostTargetID||a.update.target_id;break;case"fbpage":this.facebookPageID=this.facebookPageID||a.update.uid;break;case"foursquare":this.foursquareVenueID=this.foursquareVenueID||a.update.vid,this.foursquareVenueID=this.foursquareVenueID||a.update.venueId}if(!this.text)if(a.service==="twitter"&&a.update.type==="direct_message")this.text=a.update.body,this.title=TD.i("Direct message to {{1}}",{1:a.update.screen_name});else if(a.service==="facebook"||a.service==="fbpage")this.text=a.update.message,a.update.type==="stream"&&a.update.target_id&&(a.meta&&a.meta.target&&a.meta.target.name?this.title=TD.i("Wall post to {{1}}",{1:a.meta.target.name}):this.title=TD.i("Wall post to {{1}}",{1:"#"+a.update.target_id}));else if(a.service==="foursquare")this.text=a.update.shout,a.meta&&a.meta.location?this.title=TD.i("Check-in to {{1}}",{1:a.meta.location}):this.foursquareVenueID&&(this.title=TD.i("Check-in to {{1}}",{1:"#"+this.foursquareVenueID}));else if(a.service==="buzz"){try{this.buzzRequest=JSON.parse(a.update.body)}catch(c){var d=$(a.update.body).find("content").text();this.buzzRequest={data:{object:{content:d}}}}this.text=this.buzzRequest.data.object.content}else this.text=a.update.body;this.text&&(this.htmlText=TD.util.transform(this.text)),!this.location&&a.meta&&(this.latitude=a.meta.geolat,this.longitude=a.meta.geolong,a.meta.location&&(this.location=a.meta.location,this.mapURL="http://maps.google.com/?q="+encodeURIComponent(this.location)),this.latitude&&this.longitude&&(this.location||(this.location=this.latitude.toPrecision(6)+","+this.longitude.toPrecision(6)),this.mapURL="http://maps.google.com/?q="+this.latitude+","+this.longitude)),a.meta&&a.meta.user&&(this.avatarURL=a.meta.user.avatar_url),this.service=a.service,a.status==="pending"?this.pendingCount++:a.status==="retrying"?this.retryingCount++:a.status==="failed"&&(this.errorReason=a.errorReason,this.failedCount++),this.updates.push(a)},TD.services.ScheduledGroup.prototype.render=function(){return this.errorReason&&(this.reasonText=this.getErrorMessageFromReason(this.errorReason)),TD.ui.template.render("status/tweet_scheduled",{items:[this]})},TD.services.ScheduledGroup.prototype.edit=function(){TD.ui.compose.editScheduledUpdate(this)},TD.services.ScheduledGroup.prototype.destroy=function(a){var b=this,c=_.uniqueId(),d={id:c,title:TD.i("Deleting scheduled update!"),message:TD.i("Are you sure you want to delete this scheduled update?"),okLabel:TD.i("Delete"),cancelLabel:TD.i("Cancel")},e=function(a,d){if(d.id!==c)return;$(document).off("uiConfirmationAction",e);if(d.result){TD.controller.feedManager.deleteChirp(b.id);var f=TD.controller.clients.getTDClient().removeScheduleGroup(b.token);f.addBoth(function(){var a=TD.storage.columnController.getColumnsByType("scheduled"),b=a[0];b&&TD.controller.feedScheduler.refreshColumn(b.getKey())})}};$(document).on("uiConfirmationAction",e).trigger("uiShowConfirmationDialog",d)},TD.services.ScheduledGroup.prototype.prettyTime=function(){return TD.util.prettyTimeString(this.time)},TD.services.ScheduledGroup.prototype.isOwnChirp=function(){return!0},TD.services.ScheduledGroup.prototype.getErrorMessageFromReason=function(a){var b=TD.i("Tweet not sent: ");switch(a){case"duplicate":b+=TD.i("You already tweeted that.");break;default:b+=TD.i("Unknown error.")}return b},TD.services.ScheduledGroup.prototype.getSenders=function(){return _.pluck(this.updates,"username")},TD.services.TwitterClient=function(a){var b=this;this.type="twitter",this.STREAMING_BASE_URL="https://userstream.twitter.com/1.1/user.json",this.streamEngine=new TD.services.StreamEngine(a,_.bind(this.processStreamData,this)),this.firstStreamConnect=!0,this.cachedStreamingQueries={},this.friends={},this.blocks={},this.retweetBlocks={},this.messageThreadCache={},this.publishQueue={},this.flushPending=!1,this.searches=[],this.FEED_TYPES={home:"home",mentions:"mentions",direct:"direct",favorites:"favorites",list:"list",search:"search",usertweets:"usertweets",usertimeline:"usertimeline",interactions:"interactions",networkactivity:"networkactivity",useractivity:"useractivity"},this.streamingFeeds={},this.STREAMING_FEED_TYPES={home:!0,mentions:!0,direct:!0,favorites:!0,search:!0,interactions:!0,networkactivity:!0},this.ACTIVITY_FEED_TYPES={interactions:!0,networkactivity:!0,useractivity:!0},this.ACTIVITY_EVENT_TYPES={favorite:!0,follow:!0,list_member_added:!0,list_created:!0,retweet:!0},this.DELETE_ACTIVITY_EVENT_TYPES={unfavorite:!0,unfollow:!0,list_member_removed:!0,list_destroyed:!0},this.STREAM_LIST_EVENTS={list_created:!0,list_updated:!0,list_destroyed:!0,list_member_added:!0,list_member_removed:!0,list_user_subscribed:!0,list_user_unsubscribed:!0},this.ERRORS={AUTHENTICATION_FAILED:{twitterErrorCode:32,message:TD.i("Could not authenticate you")},404:{twitterErrorCode:34,message:TD.i("We could not complete your request because the tweet may be protected or deleted")},SUSPENDED_USER:{twitterErrorCode:63,message:TD.i("This user has been suspended")},SUSPENDED_ACCOUNT:{twitterErrorCode:64,message:TD.i("Your account is suspended and is not permitted to access this feature")},RATE_LIMITED:{twitterErrorCode:88,message:TD.i("Sorry, you've made too many requests so Twitter has temporarily limited your access. Try again in a few minutes")},OVER_CAPACITY:{twitterErrorCode:130,message:TD.i("Twitter is temporarily over capacity. Please try again later")},INTERNAL_ERROR:{twitterErrorCode:131,message:TD.i("There's something wrong at Twitter. Please try again later")},USER_AUTHENTICATION_FAILED:{twitterErrorCode:135,message:TD.i("Could not authenticate you")},NOT_FOLLOWING:{twitterErrorCode:150,message:TD.i("You can't send a message to a user who is not following you")},DUPLICATE_MESSAGE:{twitterErrorCode:151,message:TD.i("Whoops! You already said that...")},DUPLICATE_TWEET:{twitterErrorCode:187,message:TD.i("You already tweeted that")},INVALID_SEARCH_QUERY:{twitterErrorCode:195,message:TD.i("Invalid search query")},PROTECTED_TWEET:{message:TD.i("Sorry, we could not perform your retweet because the tweet is protected")},DUPLICATE_RETWEET:{message:TD.i("Whoops! You've already retweeted that...")},USER_DOES_NOT_EXIST:{message:TD.i("That user does not exist")},UNKNOWN:{message:TD.i("An unknown error occurred. Please try again shortly.")}},this.streamWarningCodes={FOLLOWS_OVER_LIMIT:"FOLLOWS_OVER_LIMIT"},this.getError=function(a,b,c,d){var e;return a.code?a.code===34?d.status&&d.status.indexOf("DM")===0?e=this.ERRORS.USER_DOES_NOT_EXIST:c.indexOf("show.json")>-1?e=this.ERRORS.USER_DOES_NOT_EXIST:e=this.ERRORS[404]:a.code===89?$(document).trigger("dataTwitterAccountAccessDenied",{account:this.oauth.account}):a.code===64?($(document).trigger("dataTwitterAccountSuspended",{account:this.oauth.account}),e=this.ERRORS.SUSPENDED_ACCOUNT):e=_.find(this.ERRORS,function(b){return b.twitterErrorCode===a.code}):b.status===403&&(a.indexOf("retweet")>-1?e=this.ERRORS.DUPLICATE_RETWEET:a.indexOf("Share validations failed")>-1&&(e=this.ERRORS.PROTECTED_TWEET)),e||(e=this.ERRORS.UNKNOWN),TD.controller.stats.apiErrorResponse(b.status,a.code,c),e},this.oauth=TD.controller.auth.create("twitter",a),this.getLists(null,function(a){_.each(a,TD.cache.lists.add)}),this.getSavedSearches(function(a){b.searches=a}),this.populateBlockList(),this.populateRetweetBlockList(),this.refreshFeed=function(a,c,d,e,f,g){var h=1,i=null,j=a.feed,k=j.getMetadata(),l=this.streamEngine.isStreaming(),m=this.ACTIVITY_FEED_TYPES[j.getType()],n,o,p,q=function(a,b,c){return b>a.length-1?a:a.substr(0,b)+c+a.substr(b+1)};if(g)h=1;else if(a.chirpArray&&a.chirpArray.length)if(c){i=a.getOldestChirp().id;if(m)i=a.getOldestChirp().minPosition||a.getOldestChirp().created.getTime().toString(),i-=1;else if(typeof i=="string")for(var r=i.length-1;r>=0;r--){n=i.charAt(r);if(n==="0")i=q(i,r,9);else{n=String(Number(n)-1),i=q(i,r,n);break}}else i--}else m?h=a.chirpArray[0].maxPosition||a.chirpArray[0].created.getTime().toString():h=a.chirpArray[0].getSinceId();var s=b.STREAMING_FEED_TYPES[j.getType()];switch(j.getType()){case"favorites":s=!k.id||k.id===this.oauth.account.getUserID();break;case"search":s=TD.services.TwitterSearchParser.isStreamable(k.term)}var t=f||!l||h===1;if(s){this.streamingFeeds[j.getKey()]=j;if(!t)return e(),this}switch(j.getType()){case this.FEED_TYPES.home:b.getHomeTimeline(h,i,null,d,e);break;case this.FEED_TYPES.direct:b.getMessageTimelines(h,i,null,d,e);break;case this.FEED_TYPES.favorites:b.getFavoritesTimeline(h,k.id,i,null,d,e);break;case this.FEED_TYPES.list:b.getListTimeline(k.listId,k.screenName,k.slug,h,i,null,d,e);break;case this.FEED_TYPES.search:k.baseQuery&&k.searchFilterData?(o=new TD.vo.SearchFilter(k.searchFilterData),p=[k.baseQuery,o.getQueryString()].join(" ")):p=k.term,b.getSearchTimeline(p,h,i,null,d,e);break;case this.FEED_TYPES.usertweets:b.getProfileTimeline(k.id,null,h,i,d,e);break;case this.FEED_TYPES.usertimeline:b.getUserTimeline(k.id,h,i,null,d,e);break;case this.FEED_TYPES.mentions:b.getMentionsTimeline(h,i,null,d,e);break;case this.FEED_TYPES.interactions:b.getInteractionsTimeline(h,i,null,d,e);break;case this.FEED_TYPES.networkactivity:b.getNetworkActivityTimeline(h,i,null,d,e);break;case this.FEED_TYPES.useractivity:b.getUserActivityTimeline(k.screenName,h,i,null,d,e);break;default:e()}return this},this.feedIsStreaming=function(a){return this.streamingFeeds[a]&&this.streamEngine.isStreaming()},this.create=function(){return new TD.services.TwitterComposer(this)},this._checkUserStream=_.bind(this.checkUserStream,this),this.subscription=$.subscribe("/storage/client/settings/use_stream",this._checkUserStream)},TD.services.TwitterClient.prototype.API_BASE_URL=TD.config.TWITTER_API_ROOT||"https://api.twitter.com/1.1/",TD.services.TwitterClient.prototype.API_V1_BASE_URL=TD.config.TWITTER_API_V1_ROOT||"https://api.twitter.com/1/",TD.services.TwitterClient.prototype.makeTwitterCall=function(a,b,c,d,e,f,g){var h=this;b=b||{},b.include_entities=1,b.include_user_entities=1,b.include_cards=1,b.send_error_codes=1;var i=TD.net.ajax.request(a,{params:b,account:this.oauth.account,method:c});return i.addCallback(function(a){var b=a.data;if(d)try{b=d.call(h,b)}catch(c){console.log("Error processing Twitter data",b,c),f(c);return}e(b),this.processRateLimitData(g,a.xhr)}.bind(this)),i.addErrback(function(e){var i,j=[],k=e.req||{};k.responseText&&(i=JSON.parse(k.responseText),i&&i.errors&&(typeof i.errors=="string"?j.push(h.getError(i.errors,k,a,b)):_.each(i.errors,function(c){j.push(h.getError(c,k,a,b))}))),$(document).trigger("dataTwitterApiError",{request:{url:a,params:b,method:c,processor:d},response:{xhr:k,ts:"",error:e.msg},errors:j}),f&&(k.errors=j,f(k,"",e.msg,j)),this.processRateLimitData(g,k)}.bind(this)),i},TD.services.TwitterClient.prototype.processRateLimitData=function(a,b){if(!a)return;var c={rateLimitRemaining:parseInt(b.getResponseHeader("x-rate-limit-remaining"),10),rateLimitTotal:parseInt(b.getResponseHeader("x-rate-limit-limit"),10),rateLimitReset:parseInt(b.getResponseHeader("x-rate-limit-reset"),10)};c.rateLimitTotal&&c.rateLimitReset&&$(document).trigger("dataRateLimit",{feedType:a,accountKey:this.oauth.account.getKey(),rateLimitData:c})},TD.services.TwitterClient.prototype.processTweet=function(a){return(new TD.services.TwitterStatus(this.oauth.account)).fromJSONObject(a)},TD.services.TwitterClient.prototype.processDM=function(a){return(new TD.services.TwitterDirectMessage(this.oauth.account)).fromJSONObject(a)},TD.services.TwitterClient.prototype.processMessages=function(a,b){var c={},d=[],e=this;return _.each(a,function(a){var b=a.getCorrespondent(),d=e.messageThreadCache[b.id],f=c[b.id];d||(d=new TD.services.TwitterMessageThread(e.oauth.account,b),e.messageThreadCache[b.id]=d),f||(f=[],c[b.id]=f),f.push(a)}),_.each(c,function(a,b){var c=e.messageThreadCache[b],f=c.addMessages(a);f&&d.push(c)}),b&&this.publishChirpsInternal("publish","direct",d),d.sort(TD.util.chirpDescSort)},TD.services.TwitterClient.prototype.deleteMessage=function(a){var b=[],c=[],d=[],e=this;_.each(this.messageThreadCache,function(b,e){b.removeMessage(a)&&(b.messages.length===0?d.push(b):c.push(b))}),_.each(d,function(a){delete e.messageThreadCache[a.id],TD.controller.feedManager.deleteChirp(a.id)}),this.publishChirpsInternal("publish","direct",c)},TD.services.TwitterClient.prototype.processPlaces=function(a){return a.result.places},TD.services.TwitterClient.prototype.processTimeline=function(a){var b,c;if(!a.length)return[];for(b=a.length;b--;)c=a[b],c.sender?c=this.processDM(c):c=this.processTweet(c),a[b]=c;return a},TD.services.TwitterClient.prototype.processTrends=function(a){var b={locations:a[0].locations,trends:[]},c=a[0].trends,d;for(var e=0;e<c.length;e++)d=(new TD.services.TrendingTopic).fromJSONObject(c[e]),b.trends.push(d);return b},TD.services.TwitterClient.prototype.processTrendLocations=function(a){function e(a,b){var c=a.sortString,d=b.sortString;return c<d?-1:c>d?1:0}var b=[],c,d;for(d=0;d<a.length;d++)c=(new TD.services.TrendLocation).fromJSONObject(a[d]),b.push(c);return b.sort(e)},TD.services.TwitterClient.prototype.processList=function(a){return(new TD.services.TwitterList(this.oauth.account)).fromJSONObject(a)},TD.services.TwitterClient.prototype.processLists=function(a){return _.map(a,_.bind(this.processList,this))},TD.services.TwitterClient.prototype.processUser=function(a){return(new TD.services.TwitterUser(this.oauth.account)).fromJSONObject(a)},TD.services.TwitterClient.prototype.processUsers=function(a){var b=[];for(var c=0;c<a.length;c++)b.push(this.processUser(a[c]));return b},TD.services.TwitterClient.prototype.processActions=function(a){var b=[],c=this;for(var d=0;d<a.length;d++){var e=a[d];if(e.action==="list_member_added"&&e.targets_size>1&&e.target_objects_size>1){var f=new TD.services.TwitterActionMultiListMemberAdded(this.oauth.account);f.fromJSONObject(e,[e],!1),b.push(f)}else b=b.concat(TD.services.TwitterAction.processRESTAction(e,this.oauth.account))}return b},TD.services.TwitterClient.prototype.showUser=function(a,b,c,d){var e={};a?e.user_id=a:e.screen_name=b,this.makeTwitterCall(this.API_BASE_URL+"users/show.json",e,"GET",this.processUser,c,d)},TD.services.TwitterClient.prototype.getUsersByIds=function(a,b,c){var d={user_id:a.join(",")};this.makeTwitterCall(this.API_BASE_URL+"users/lookup.json",d,"POST",this.processUsers,b,c)},TD.services.TwitterClient.prototype.followUser=function(a,b,c){this.makeTwitterCall(this.API_BASE_URL+"friendships/create.json",{screen_name:a},"POST",this.processUser,b,c)},TD.services.TwitterClient.prototype.unfollowUser=function(a,b,c){this.makeTwitterCall(this.API_BASE_URL+"friendships/destroy.json",{screen_name:a},"POST",this.processUser,b,c)},TD.services.TwitterClient.prototype.typeaheadSearch=function(a,b,c){var d=function(c){b(c,a)};if(!a.query&&!a.prefetch)throw new Error("Typeahead API needs a query");this.makeTwitterCall(this.API_BASE_URL+"search/typeahead.json",{q:a.query,count:a.count||10,prefetch:a.prefetch?!0:!1},"GET",null,d,c)},TD.services.TwitterClient.prototype.userSearch=function(a,b,c){var d=this,e=function(b){var c,e=a.toLowerCase(),f;b=d.processUsers(b);for(c=0;c<b.length;c++){f=b[c];if(f.screenName.toLowerCase()==e&&c!==0){b.splice(c,1),b=[f].concat(b);break}}return b};this.makeTwitterCall(this.API_BASE_URL+"users/search.json",{q:a},"GET",e,b,c)},TD.services.TwitterClient.prototype.getRetweetedBy=function(a,b,c,d,e){var f={count:b||12,page:c||1};this.makeTwitterCall(this.API_BASE_URL+"statuses/"+a+"/retweeted_by.json",f,"GET",this.processUsers,d,e)},TD.services.TwitterClient.prototype.showFriendship=function(a,b,c,d,e){var f={source_id:a};b!==null?f.target_id=b:c!==null&&(f.target_screen_name=c),this.makeTwitterCall(this.API_BASE_URL+"friendships/show.json",f,"GET",null,d,e)},TD.services.TwitterClient.prototype.showFriendshipForScreenName=function(a,b,c,d){this.makeTwitterCall(this.API_BASE_URL+"friendships/show.json",{source_id:a,target_screen_name:b},"GET",null,c,d)},TD.services.TwitterClient.prototype.blockUser=function(a,b,c){this.makeTwitterCall(this.API_BASE_URL+"blocks/create.json",{screen_name:a},"POST",this.processUser,b,c)},TD.services.TwitterClient.prototype.unblockUser=function(a,b,c){var d=this;this.makeTwitterCall(this.API_BASE_URL+"blocks/destroy.json",{screen_name:a},"DELETE",this.processUser,b,c)},TD.services.TwitterClient.prototype.blockAndReportUser=function(a,b,c){this.makeTwitterCall(this.API_BASE_URL+"users/report_spam.json",{screen_name:a},"POST",this.processUser,b,c)},TD.services.TwitterClient.prototype.flagTweet=function(a,b,c){this.makeTwitterCall(this.API_BASE_URL+"statuses/flag_possibly_sensitive.json",{id:a},"POST",null,b,c)},TD.services.TwitterClient.prototype.getList=function(a,b,c,d,e){var f={};a?f.list_id=a:(f.slug=c,f.owner_screen_name=b),this.makeTwitterCall(this.API_BASE_URL+"lists/show.json",f,"GET",this.processList,d,e)},TD.services.TwitterClient.prototype.createList=function(a,b,c,d,e){var f=this,g={name:a,description:b||"",mode:c?"private":"public"},h=function(a){TD.cache.lists.add(a),d(a)};this.makeTwitterCall(this.API_BASE_URL+"lists/create.json",g,"POST",this.processList,h,e)},TD.services.TwitterClient.prototype.updateList=function(a,b,c,d,e,f){var g=this,h={list_id:a,name:b,description:c||"",mode:d?"private":"public"},i=function(a){TD.cache.lists.add(a),e(a)};this.makeTwitterCall(this.API_BASE_URL+"lists/update.json",h,"POST",this.processList,i,f)},TD.services.TwitterClient.prototype.destroyList=function(a,b,c){var d=this,e=function(a){TD.cache.lists.purge(a.id),b(a)};this.makeTwitterCall(this.API_BASE_URL+"lists/destroy.json",{list_id:a},"POST",this.processList,e,c)},TD.services.TwitterClient.prototype.getListMembers=function(a,b,c,d){var e=this,f=function(a){a.users=e.processUsers(a.users),c(a)};_.isUndefined(b)&&(b=-1),this.makeTwitterCall(this.API_BASE_URL+"lists/members.json",{list_id:a,skip_status:1,cursor:b},"GET",null,f,d)},TD.services.TwitterClient.prototype.subscribeToList=function(a,b,c){var d=function(a){TD.cache.lists.add(a),b(a)};this.makeTwitterCall(this.API_BASE_URL+"lists/subscribers/create.json",{list_id:a},"POST",!0,this.processList,d,c)},TD.services.TwitterClient.prototype.addUserToList=function(a,b,c,d){var e=function(a){TD.cache.lists.add(a),c(a)};this.makeTwitterCall(this.API_BASE_URL+"lists/members/create.json",{screen_name:b,list_id:a},"POST",this.processList,e,d)},TD.services.TwitterClient.prototype.addUsersToList=function(a,b,c,d){var e=function(a){TD.cache.lists.add(a),c(a)};this.makeTwitterCall(this.API_BASE_URL+"lists/members/create_all.json",{screen_name:b.join(","),list_id:a},"POST",this.processList,e,d)},TD.services.TwitterClient.prototype.removeUserFromList=function(a,b,c,d){var e=function(a){TD.cache.lists.add(a),c(a)};this.makeTwitterCall(this.API_BASE_URL+"lists/members/destroy.json",{screen_name:b,list_id:a},"POST",this.processList,e,d)},TD.services.TwitterClient.prototype.getBlockIDs=function(a,b){this.makeTwitterCall(this.API_BASE_URL+"blocks/ids.json",{stringify_ids:!0},"GET",null,a,b)},TD.services.TwitterClient.prototype.getNoRetweetIDs=function(a,b){this.makeTwitterCall(this.API_BASE_URL+"friendships/no_retweets/ids.json",null,"GET",null,a,b)},TD.services.TwitterClient.prototype.getTweetSummary=function(a,b,c){var d={};this.makeTwitterCall(this.API_BASE_URL+"statuses/"+a+"/activity/summary.json",d,"GET",null,b,c)},TD.services.TwitterClient.prototype.getEmbeddedTweet=function(a,b,c,d,e,f){var g;if(!a)throw new Error("getEmbeddedTweet: tweetID is a required parameter");g={id:a,partner:"tweetdeck"},b&&(g.hide_thread=b),c&&(g.hide_media=c),d&&(g.maxwidth=d),this.makeTwitterCall(this.API_BASE_URL+"statuses/oembed.json",g,"GET",null,e,f)},TD.services.TwitterClient.prototype.translateTweet=function(a,b,c,d){var e;if(!a)throw new Error("translateTweet: tweetID is a required parameter");if(!b)throw new Error("translateTweet: destLang is a required parameter");e={id:a,dest:b},this.makeTwitterCall(this.API_BASE_URL+"translations/show.json",e,"GET",null,c,d)},TD.services.TwitterClient.prototype.getFollowingFollowersOf=function(a,b,c){var d;if(!a)throw new Error("getFollowingFollowersOf: screenName is a required parameter");d={screen_name:a},this.makeTwitterCall("https://api.twitter.com/users/following_followers_of.json",d,"GET",null,b,c)},TD.services.TwitterClient.prototype.getHomeTimeline=function(a,b,c,d,e){this.getTimeline("statuses/home_timeline.json",a,b,c,d,e,{},this.FEED_TYPES.home)},TD.services.TwitterClient.prototype.getUserTimeline=function(a,b,c,d,e,f){var g={user_id:a};this.getTimeline(this.API_V1_BASE_URL+"statuses/following_timeline.json",b,c,d,e,f,g,this.FEED_TYPES.usertimeline)},TD.services.TwitterClient.prototype.getMentionsTimeline=function(a,b,c,d,e){this.getTimeline("statuses/mentions_timeline.json",a,b,c,d,e,{},this.FEED_TYPES.mentions)},TD.services.TwitterClient.prototype.getInteractionsTimeline=function(a,b,c,d,e){this.getActivityTimeline("activity/about_me.json",a,b,c,d,e,{},this.FEED_TYPES.interactions)},TD.services.TwitterClient.prototype.getNetworkActivityTimeline=function(a,b,c,d,e){this.getActivityTimeline("activity/by_friends.json",a,b,c,d,e,{},this.FEED_TYPES.networkactivity)},TD.services.TwitterClient.prototype.getUserActivityTimeline=function(a,b,c,d,e,f){var g={screen_name:a};this.getActivityTimeline(this.TWITTER_API_V1_ROOT+"activity/by_user.json",b,c,d,e,f,g,this.FEED_TYPES.useractivity)},TD.services.TwitterClient.prototype.getActivityTimeline=function(a,b,c,d,e,f,g){g=g||{},c&&(g.max_id=c),b&&(g.min_id=b),g.count=d||200,g.skip_aggregation=!0,this.makeTwitterCall(this.API_BASE_URL+a,g,"GET",this.processActions,e,f)},TD.services.TwitterClient.prototype.getMessageTimelines=function(a,b,c,d,e){function j(a){f++,g++,h=h.concat(a),f===2&&d(i.processMessages(h,!1))}function k(){f++,f===2&&(g>0?d(i.processMessages(h,!1)):e.apply(null,arguments))}var f=0,g=0,h=[],i=this;a==1&&(this.messageThreadCache={}),this.getDMTimeline(a,b,null,j,k),this.getSentDMTimeline(a,b,null,j,k)},TD.services.TwitterClient.prototype.getDMTimeline=function(a,b,c,d,e){this.getTimeline("direct_messages.json",a,b,c,d,e,{},this.FEED_TYPES.direct)},TD.services.TwitterClient.prototype.getSentDMTimeline=function(a,b,c,d,e){this.getTimeline("direct_messages/sent.json",a,b,c,d,e)},TD.services.TwitterClient.prototype.getFavoritesTimeline=function(a,b,c,d,e,f){var g={};b&&(g.user_id=b),this.getTimeline("favorites/list.json",a,c,d,e,f,g,this.FEED_TYPES.favorites)},TD.services.TwitterClient.prototype.getListTimeline=function(a,b,c,d,e,f,g,h){var i="lists/statuses.json",j={include_rts:1};a?j.list_id=a:(j.owner_screen_name=b,j.slug=c),this.getTimeline(i,d,e,f,g,h,j,this.FEED_TYPES.list)},TD.services.TwitterClient.prototype.getProfileTimeline=function(a,b,c,d,e,f){var g="statuses/user_timeline.json",h={include_rts:1};a&&a!==this.oauth.account.getUserID()&&(h.user_id=a),this.getTimeline(g,c,d,b,e,f,h,this.FEED_TYPES.usertweets)},TD.services.TwitterClient.prototype.getSearchTimeline=function(a,b,c,d,e,f){var g={count:d||200,q:a,result_type:"recent"},h=this,i;i=h.API_BASE_URL+"search/tweets.json";var j=function(a){return h.processTimeline(a.statuses)},k=function(a,b,c){a&&a.errors&&a.errors[0]===this.ERRORS.INVALID_SEARCH_QUERY?e([]):f.apply(null,arguments)}.bind(this);c&&(g.max_id=c),b&&b!=1&&(g.since_id=b),this.makeTwitterCall(i,g,"GET",j,e,k,this.FEED_TYPES.search)},TD.services.TwitterClient.prototype.getTimeline=function(a,b,c,d,e,f,g,h){var i={since_id:b||1,count:d||200,include_my_retweet:1},j="";_.startsWith(a,"https://")?j=a:j=this.API_BASE_URL+a,c&&(i.max_id=c),g&&_.extend(i,g),this.makeTwitterCall(j,i,"GET",this.processTimeline,e,f,h)},TD.services.TwitterClient.prototype.pendingConversation={},TD.services.TwitterClient.prototype.getConversation=function(a){var b=this;if(this.pendingConversation[a])return;var c=function(c){delete b.pendingConversation[a];var d={ancestors:[],descendants:[]},e=!1;c.forEach(function(b){e?d.descendants.push(b):b.id===a?e=!0:d.ancestors.push(b)}),$.publish("/tweets/conversation/"+a,[d])},d=function(){delete b.pendingConversation[a];var c={ancestors:[],descendants:[]};$.publish("/tweets/conversation/"+a,[c])};this.pendingConversation[a]=!0,this.makeTwitterCall(this.API_BASE_URL+"conversation/show.json",{id:a},"GET",this.processTimeline,c,d)},TD.services.TwitterClient.prototype.destroy=function(a,b,c){this.makeTwitterCall(this.API_BASE_URL+"statuses/destroy/:id.json".replace(":id",a),{},"POST",this.processTweet,b,c)},TD.services.TwitterClient.prototype.show=function(a,b,c){this.makeTwitterCall(this.API_BASE_URL+"statuses/show.json",{id:a},"GET",this.processTweet,b,c)},TD.services.TwitterClient.prototype.update=function(a,b,c,d,e,f,g){var h={status:a};h.in_reply_to_status_id=b,h.lat=c,h["long"]=d,h.place_id=e,this.makeTwitterCall(this.API_BASE_URL+"statuses/update.json",h,"POST",this.processTweet,f,g)},TD.services.TwitterClient.prototype.getLists=function(a,b,c){var d={};a&&(d.screen_name=a),this.makeTwitterCall(this.API_BASE_URL+"lists/list.json",d,"GET",this.processLists,b,c)},TD.services.TwitterClient.prototype.getListMemberships=function(a,b,c,d){var e={},f=this;a&&(e.screen_name=a),b&&(e.filter_to_owned_lists=1);var g=function(a){return f.processLists(a.lists)};this.makeTwitterCall(this.API_BASE_URL+"lists/memberships.json",e,"GET",g,c,d)},TD.services.TwitterClient.prototype.getSavedSearches=function(a,b){var c={};this.makeTwitterCall(this.API_BASE_URL+"saved_searches/list.json",c,"GET",null,a,b)},TD.services.TwitterClient.prototype.favorite=function(a,b,c){var d=this,e=function(a){d.updateFavoriteInternal(a,!0),b(a)};this.makeTwitterCall(this.API_BASE_URL+"favorites/create.json",{id:a},"POST",this.processTweet,e,c)},TD.services.TwitterClient.prototype.unfavorite=function(a,b,c){var d=this,e=function(a){d.updateFavoriteInternal(a,!1),b(a)};this.makeTwitterCall(this.API_BASE_URL+"favorites/destroy.json",{id:a},"POST",this.processTweet,e,c)},TD.services.TwitterClient.prototype.destroyDM=function(a,b,c){this.makeTwitterCall(this.API_BASE_URL+"direct_messages/destroy.json",{id:a},"POST",this.processDM,b,c)},TD.services.TwitterClient.prototype.markMessagesAsRead=function(a,b,c,d){var e={last_message_id:a};b&&(e.sender_id=b),this.makeTwitterCall(this.API_BASE_URL+"direct_messages/read.json",e,"POST",null,c,d)},TD.services.TwitterClient.prototype.geoSearch=function(a,b,c,d,e,f,g){var h={};b&&(h.lat=b),c&&(h["long"]=c),d&&(h.accuracy=d),a&&(h.query=a),h.granularity=e||"neighborhood",this.makeTwitterCall(this.API_BASE_URL+"geo/search.json",h,"GET",this.processPlaces,f,g)},TD.services.TwitterClient.prototype.getTrends=function(a,b,c){a=a||1,this.makeTwitterCall(this.API_BASE_URL+"trends/place.json",{id:a},"GET",this.processTrends,b,c)},TD.services.TwitterClient.prototype.getTrendLocations=function(a,b){this.makeTwitterCall(this.API_BASE_URL+"trends/available.json",null,"GET",this.processTrendLocations,a,b)},TD.services.TwitterClient.prototype.updateFavoriteInternal=function(a,b){a=a.retweetedStatus?a.retweetedStatus:a,a.setFavorite(b);var c=b?"publish":"remove";this.publishChirpsInternal(c,"favorites",[a])},TD.services.TwitterClient.prototype.removeAction=function(a){var b=TD.services.TwitterAction.processStreamAction(a,this.oauth.account);return b.isAboutYou()?this.publishChirpsInternal("remove","interactions",[b]):b.isOwnChirp()||this.publishChirpsInternal("remove","networkactivity",[b]),b},TD.services.TwitterClient.prototype.publishAction=function(a){var b=TD.services.TwitterAction.processStreamAction(a,this.oauth.account);b.isAboutYou()?this.publishChirpsInternal("publish","interactions",[b]):b.isOwnChirp()||this.publishChirpsInternal("publish","networkactivity",[b])},TD.services.TwitterClient.prototype.queueChirpsForDispatch=function(a,b){var c=this;this.publishQueue[a]=(this.publishQueue[a]||[]).concat(b),this.flushPending||(this.flushPending=!0,_.defer(function(){_.each(c.publishQueue,function(a,b){var c=TD.controller.feedManager.getPoller(b);c&&c.acceptChirps(a)}),c.publishQueue={},c.flushPending=!1}))},TD.services.TwitterClient.prototype.publishChirpsInternal=function(a,b,c,d){var e,f;e=TD.storage.Feed.generateKeyFor(this.oauth.account.getKey(),b,d),a=="publish"?this.queueChirpsForDispatch(e,c):a=="remove"&&(f=TD.controller.feedManager.getPoller(e),f&&_.each(c,function(a){f.removeChirp(a.id)}))},TD.services.TwitterClient.prototype.populateBlockList=function(){this.getBlockIDs(function(a){var b=a.ids,c;this.blocks={};for(c=0;c<b.length;c++)this.blocks[b[c]]=!0}.bind(this))},TD.services.TwitterClient.prototype.populateRetweetBlockList=function(){var a=this;this.getNoRetweetIDs(function(a){var b;this.retweetBlocks={};for(b=0;b<a.length;b++)this.retweetBlocks[a[b]]=!0}.bind(this))},TD.services.TwitterClient.prototype.constructStreamingUrl=function(){var a=this,b={},c=!1,d=!0;_.each(this.streamingFeeds,function(e,f){var g=e.getMetadata(),h=TD.controller.feedManager.getPoller(f);if(h){d=!1;if(e.managed&&e.getType()=="search"){var i=g.term,j=i.toLowerCase(),k=new TD.services.TwitterSearchParser(i);b[j]=k}else e.getType()=="home"&&(c=!0)}else delete a.streamingFeeds[f]});var e=[];for(var f in b)e.push(b[f].trackQuery);e=_.uniq(e.join(",").split(","));var g=e.join(","),h={};g&&(h.track=g),c||(h["with"]="user");var i=!1;return _.each(TD.storage.feedController.getAll(),function(b){b.getType()==="networkactivity"&&b.getService()==="twitter"&&a.oauth.account.getKey()===b.getAccountKey()&&(i=!0)}),i&&(h.include_followings_activity=!0),d?null:TD.net.util.addURLParameters(this.STREAMING_BASE_URL,h)},TD.services.TwitterClient.prototype.checkUserStream=function(){TD.util.shouldStream()?this.streamEngine.connect(this.constructStreamingUrl()):this.streamEngine.disconnect()},TD.services.TwitterClient.prototype.processDeleteChirpEvent=function(a){a["delete"].status?TD.controller.feedManager.deleteChirp(a["delete"].status.id_str):a["delete"].direct_message&&this.deleteMessage(a["delete"].direct_message.id_str)},TD.services.TwitterClient.prototype.processStreamData=function(a){var b=this;if(a.friends){for(var c=0;c<a.friends.length;c++)this.friends[a.friends[c]]=!0;try{this.firstStreamConnect||TD.controller.feedScheduler.refreshAccountFeeds(this.oauth.account.getKey(),!0)}finally{this.firstStreamConnect=!1}}else if(a.warning)switch(a.warning.code){case this.streamWarningCodes.FOLLOWS_OVER_LIMIT:}else if(a.event)this.processStreamEvent(a);else if(!a.limit)if(a["delete"])this.processDeleteChirpEvent(a);else if(a.direct_message){var d=this.processDM(a.direct_message);this.processMessages([d],!0)}else if(a.id_str&&a.text){var e=this.processTweet(a);this.processMiscTweet(e)}else TD.controller.stats.unknownStreamData(a)},TD.services.TwitterClient.prototype.processMiscTweet=function(a){var b=this,c=Boolean(this.friends[a.user.id]),d=a.user.id==this.oauth.account.getUserID(),e=a.isMention(),f=Boolean(a.retweetedStatus),g=f&&a.retweetedStatus.user.id==this.oauth.account.getUserID(),h=f&&(a.retweetedStatus.user.following||this.friends[a.retweetedStatus.user.id]),i,j,k,l,m;k=a.entities&&a.entities.user_mentions&&a.entities.user_mentions.some(function(a){if(a.indices&&a.indices[0]===0)return m=a.id,!0}),l=k&&Boolean(this.friends[m]);if(this.blocks[a.user.id]||f&&this.blocks[a.retweetedStatus.user.id])return;if(f&&this.retweetBlocks[a.user.id]&&!g)return;d&&f&&(a.setRetweeted(!0),a.retweetedStatus.setRetweeted(!0)),(d||c&&(!k||l||e))&&!g&&!h&&this.publishChirpsInternal("publish","home",[a]),g?(j=(new TD.services.TwitterActionRetweet(this.oauth.account)).fromRetweet(a),this.publishChirpsInternal("publish","interactions",[j])):e&&!f&&(this.publishChirpsInternal("publish","mentions",[a]),i=(new TD.services.TwitterActionMention(this.oauth.account)).fromStreamData(a),this.publishChirpsInternal("publish","interactions",[i])),_.each(this.streamingFeeds,function(c,d){var e=c.getMetadata();if(c.managed&&c.getType()=="search"){var f=e.term,g=b.cachedStreamingQueries[f];g||(g=b.cachedStreamingQueries[f]=new TD.services.TwitterSearchParser(f)),g.match(a.getFilterableText())&&b.queueChirpsForDispatch(d,[a])}}),this.publishChirpsInternal("publish","usertweets",[a],{id:parseInt(a.user.id,10)}),d&&this.publishChirpsInternal("publish","usertweets",[a],{})},TD.services.TwitterClient.prototype.processStreamEvent=function(a){var b,c,d=!1;this.STREAM_LIST_EVENTS[a.event]&&(b=(new TD.services.TwitterList(this.oauth.account)).fromJSONObject(a.target_object));if(a.source.id==this.oauth.account.getUserID())switch(a.event){case"favorite":d=a.source.id===a.target_object.user.id,c=this.processTweet(a.target_object),this.updateFavoriteInternal(c,!0);break;case"unfavorite":c=this.processTweet(a.target_object),this.updateFavoriteInternal(c,!1);break;case"follow":this.friends[a.target.id]=!0;break;case"unfollow":delete this.friends[a.target.id];break;case"block":this.blocks[a.target.id]=!0,delete this.friends[a.target.id];break;case"unblock":delete this.blocks[a.target.id];break;case"list_created":case"list_updated":case"list_member_added":case"list_member_removed":case"list_user_subscribed":TD.cache.lists.add(b);break;case"list_destroyed":TD.cache.lists.purge(b.id);break;case"list_user_unsubscribed":TD.cache.lists.unsubscribe(b)}else a.event==="favorite"&&(a.target_object.favorited=!1,a.target_object.retweeted=!1);this.ACTIVITY_EVENT_TYPES[a.event]&&!d?this.publishAction(a):this.DELETE_ACTIVITY_EVENT_TYPES[a.event]&&this.removeAction(a)},TD.services.TwitterClient.prototype.cleanUp=function(){$.unsubscribe(this.subscription),this.streamEngine.disconnect()},TD.ui.main=function(){var a={},b={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"};a.TRANSITION_END_EVENTS=b[Modernizr.prefixed("transition")];var c=function(a,b){$(".js-app-add-column").removeClass("is-hidden")},d=function(a,b){$(".js-app-add-column").addClass("is-hidden")};return a.init=function(){var b=$("body"),e=$(TD.ui.template.render("topbar/app_header",{searchInputClassName:"js-app-search-input app-search-input",searchInputPlaceholder:TD.i("Search")})),f=$(TD.ui.template.render("app_container"));$(".js-app").append(e),$(".js-app").append(f),$(".js-app-loading").hide(),TD.util.isWrapperApp()&&deck.closeLoadingScreen&&deck.closeLoadingScreen(),b.on("click","a",function(a){var b=TD.util.maybeOpenClickExternally(a)}),TD.ui.columns.init(),TD.ui.updates.init(),TD.ui.compose.init(),TD.ui.openColumn.init(),b.tooltip({selector:".js-show-tip",container:"body",delay:{show:500},suppressFadeOut:!0}),b.on("click","a",function(a){var b=$(a.currentTarget),c=b.attr("rel"),d=!1;switch(c){case"user":var e=b.data("user-name")||_.last(b.attr("href").split("/"));$(document).trigger("uiShowProfile",{id:e}),d=!0;break;case"hashtag":$(document).trigger("uiPerformSearch",{query:b.text()}),d=!0}d&&a.preventDefault(),a.isDefaultPrevented()===!1&&(TD.util.openURL(b.attr("href")),a.preventDefault())}),b.on("click","button",function(a){a.preventDefault()}),b.on("submit",function(a){a.preventDefault()}),$.subscribe("/storage/client/settings/column_width",a.updateColumnSize),a.updateColumnSize(),$.subscribe("/storage/client/settings/font_size",a.updateFontSize),a.updateFontSize();var g=_.debounce(function(a){$(document).trigger("uiMainWindowResized")},50);$(window).on("resize",g),$(document).on("uiColumnNavSizeOverflow",c.bind(this)),$(document).on("uiColumnNavSizeNormal",d.bind(this))},a.updateColumnSize=function(){var a=TD.settings.getColumnWidth(),b=$("html");b.removeClass("is-narrow-columns is-wide-columns");switch(a){case"narrow":b.addClass("is-narrow-columns");break;case"wide":b.addClass("is-wide-columns")}$(document).trigger("uiColumnWidthChange",{columnWidth:a})},a.updateFontSize=function(){var a=TD.settings.getFontSize(),b=$("html");b.removeClass("txt-base-smallest txt-base-small txt-base-large txt-base-largest");switch(a){case"smallest":b.addClass("txt-base-smallest");break;case"small":b.addClass("txt-base-small");break;case"large":b.addClass("txt-base-large");break;case"largest":b.addClass("txt-base-largest")}},a}(),TD.ui.compose=function(){function X(a){_.defer(bq)}function Y(a){!a.target.disabled&&a.which===13&&Z(a)}function Z(a){var b=$(a.target);b.attr("rel")||(b=$(a.target).parent());var c=b.attr("rel");a.target.id==="compose-modal"&&(c="dismiss");if(c)a.preventDefault();else return;if(b.prop("disabled")||b.hasClass("is-disabled"))return;if(o&&c!=="account"&&c!=="edit")return;switch(c){case"dismiss":bk();break;case"send":bh();break;case"message":E?be():bc();break;case"enterSchedule":bb();break;case"message":}}function bb(){var a=$("#compose-schedule"),b=function(a){var b,c;a===null?(w.$node.hide(),H.removeClass("set-content")):(b=TD.util.prettyTime(a),c=TD.ui.template.toHtml("{{hours12}}:{{minutes}} {{amPm}} {{date}} {{month}}",b),H.addClass("set-content"),$("b",H).text(c)),t=a},c=function(){P.removeClass("js-show-tip is-disabled").attr("title","")};P.addClass("js-show-tip is-disabled").attr("title",TD.i("Scheduled Tweets cannot contain images")),w?(w.$node.toggle(),t||w.setDate(new Date)):($.subscribe("/change/date",b),$.subscribe("/removed/date",c),w=new TD.components.ScheduledDatePicker(a))}function bf(a){bg(a)}function bg(a){var b=e.val();b.length&&(a=b+" "+a),e.val(a),V()}function bh(){br(),bt();var a=bl(),b=[],c=0,d=function(){if(b.length+c>=a.length){var d=e.val();_.each(b,function(a){d=d.replace(a.long_url,a.url)}),bi(d)}},f=function(a){a.data?b.push(a.data):c++,d()},g=function(){c++,d()};TD.settings.getLinkShortener()==="bitly"&&a.length>0?_.each(a,function(a){TD.services.bitly.shorten(a,f,g)}):bi(e.val())}function bi(b){function f(a){var g=a.account,h=TD.controller.clients.getClient(a.account),i=h.create(),j;E?i=i.DirectlyTo(G).WithMessage(b):(c!=""&&i.InReplyTo&&i.InReplyTo(c),i=i.WithMessage(b),R&&i.WithMedia(R),i.WithLocation&&r&&i.WithLocation(r,s)),i.WithLocation&&x&&x.twitterPlaceID&&i.WithLocation(x.twitterPlaceID,x.twitterPlaceName);if(t){j=TD.i("Scheduling update");if(!i.toSchedulableObject){TD.controller.progressIndicator.taskFailed(v,j);return}var k=i.toSchedulableObject();if(!k){TD.controller.progressIndicator.taskFailed(v,j);return}e.push(k);if(d.length>0)f(d.pop());else{TD.controller.progressIndicator.changeMessage(v,j);var l=u?u.token:null,m=TD.controller.clients.getTDClient().scheduleGroup(e,t,l);m.addCallback(function(){TD.controller.progressIndicator.taskComplete(v),u&&TD.controller.feedManager.deleteChirp(u.id),u=null,bk()}),m.addErrback(function(a){var b=j;a.req&&a.req.responseText&&(b+=": "+a.req.responseText),TD.controller.progressIndicator.taskFailed(v,b),bq(),bu()})}}else j=TD.i("Sending update to {{1}}",{1:_.capitalize(a.service)}),TD.controller.progressIndicator.changeMessage(v,j),i.post(function(){bx();if(d.length>0)f(d.pop());else{TD.controller.progressIndicator.taskComplete(v);if(u){var a=u.token,b=TD.controller.clients.getTDClient().removeScheduleGroup(a);b.addCallback(function(){TD.controller.feedManager.deleteChirp(a)})}u=null,bk()}},function(a,b,c){a.errors?a.errors.forEach(function(a){j+=" - "+a.message}):a&&a.errorMessage?j+=" - "+a.errorMessage+"":j+=" - "+TD.controller.clients.getPreferredClient("twitter").ERRORS.UNKNOWN.message,TD.controller.progressIndicator.taskFailed(v,j),bq(),bu()})}var c=p,d=l.getSelectedAccounts(),e=[];if(E&&G==""){TD.controller.progressIndicator.addMessage(TD.i("Message has no recipient!")),bu();return}if(a.getTextLength(b)===0){TD.controller.progressIndicator.addMessage(TD.i("Sorry, empty updates are not allowed")),bu();return}if(n.is(":visible")&&parseInt(n.val())<0){bu();return}v&&(TD.controller.progressIndicator.deleteTask(v),v=null),d.length>0?(v=TD.controller.progressIndicator.addTask("Sending update"),f(d.pop())):TD.controller.progressIndicator.addMessage(TD.i("Please select at least one account before sending"))}function bj(){e.val(""),K={},bq(),p=undefined,q=undefined,f&&(f.empty(),f=null),z.removeClass("s-inreply"),l.updateSelectedAccounts(),bu(),bx(),P.removeClass("js-show-tip is-disabled").attr("title",""),w&&w.setDate(null),E&&be(),u=null}function bk(){var c=function(){bj(),$(document).off("uiCloseModal",bk),b.find("input").blur(),b.hide(),b.trigger("uiFocusRelease",{id:a.focusId}),clearInterval(S)};if(u){var d=_.uniqueId(),f={id:d,title:TD.i("Stop editing?"),message:TD.i("If you close your edits now you will lose any changes made. Are you sure you want to stop editing?"),okLabel:TD.i("Yes"),cancelLabel:TD.i("No")},g=function(a,b){if(b.id!==d)return;$(document).off("uiConfirmationAction",g),b.result&&c()};$(document).on("uiConfirmationAction",g).trigger("uiShowConfirmationDialog",f)}else c();e.get(0).blur()}function bl(){return bm(twttr.txt.extractUrls(e.val()))}function bm(a){return _.filter(a,function(a){return!a.match(/^https?:\/\/t.co\/\w+$/)})}function bn(a){var b=TD.i("Links will be shortened by bit.ly"),c=TD.i("Link will be shortened by bit.ly");return a>1?b:c}function bo(){var a=TD.settings.getLinkShortener()==="bitly",b=bl().length;if(b===B)return;a&&b>0?(C.text(bn(b)).show(),z.addClass("s-link-added")):(C.hide(),z.removeClass("s-link-added")),B=b}function bp(){var a=e.val().toLowerCase();(a==="d "||a==="dm "||a==="m ")&&!E&&(e.val(""),bc())}function bq(){var b=140,c=e.val(),d=a.getTextLength(c),f="over-char-count";if(z.hasClass("s-sending"))return;bo();var g=Math.min(b-d,b);n.val(g),g<0?(n.addClass(f),br()):g===b?(br(),n.removeClass(f)):(n.removeClass(f),bs())}function br(){k.attr("disabled","disabled")}function bs(){k.removeAttr("disabled")}function bt(){z.addClass("s-sending"),e.attr("disabled","disabled"),br()}function bu(){z.removeClass("s-sending"),e.removeAttr("disabled"),bs()}function bv(){P.click(function(){P.hasClass("is-disabled")||$(document).trigger("uiCameraButtonClick")}),$("a",Q).live("click",function(a){a.stopPropagation(),bx()}),$("#compose-modal").on("uiComposeAddPhoto",bw)}function bw(a,b){var c;for(var d=0;d<b.files.length;d++)R=b.files[d],c=TD.ui.template.render("compose/media_bar"),Q.html(c).show(),z.addClass("s-photo-added"),H.addClass("js-show-tip is-disabled").attr("title",TD.i("Tweets with images cannot be scheduled"))}function bx(){R=null,$(document).trigger("uiResetImageUpload"),Q.empty().hide(),z.removeClass("s-photo-added"),H.removeClass("js-show-tip is-disabled").attr("title","")}function by(){return z.css("position")==="absolute"&&(parseInt(z.css("left"),10)+z.outerWidth()/2>$("body").outerWidth()||parseInt(z.css("top"),10)+z.outerHeight()/3>$("body").outerHeight())}function bz(){b.removeClass(N),z.attr("style","")}function bA(){z.css({position:"absolute",top:z.offset().top,left:z.offset().left}),b.addClass(N)}var a={},b,c,d,e,f,g,h,i,j,k,l,m,n,o=!1,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E=!1,F,G,H,I,J,K={},L,M,N="is-dragging",O=window.File&&window.FormData,P,Q,R,S,T=50,U=22;a.init=function(){};var V=function(){e.get(0).focus()},W=function(a){A.isCompletionsOpen?a.stopPropagation():e.get(0).blur()};a.setUp=function(){if(b){by()&&bz();return}b=$("#compose-modal"),b.html(TD.ui.template.render("compose/compose",{isMac:TD.util.getOSName()==="osx"})),z=$(".js-compose",b),c=$("#composeBox"),d=$("#autocomplete-container"),g=$("h3",b),y=$(".js-accounts-toggle",b),L=$("span",y),e=$(".js-compose-input",b),h=$("#hiddenDiv"),i=$('button[rel="addLocation"]',b),j=$(".removeLocationButton",b),I=$('button[rel="message"]',b),H=$('button[rel="enterSchedule"]'),k=$('button[rel="send"]',b),m=$("#overlay"),n=$("#character-count"),C=$(".js-links-added"),P=$('button[rel="addPhoto"]',b),Q=$(".js-media-added",b),D=$(".js-inreply",b),F=$(".js-dm-recipient").bind("blur",function(a){_.defer(function(){bd(F.val())})}),M=$(".js-drag-handle",z),e.bind("paste",X),z.draggable({boundary:b,handle:M}),z.on("start.draggable",bA),e.blur(function(){$(".cmp-input-container").removeClass("focus")}),e.focus(function(){$(".cmp-input-container").addClass("focus")}),b.focus(),b.on("click",Z),k.on("keydown",Y),A=new TD.components.Autocomplete(e),O?bv():P.remove(),TD.components.LocationPicker.canHazGeolocation()||i.hide();var f=new TD.components.ActionHeader;b.find(".mdl-header").prepend(f.$node),l=f.accountSelector,l.$node.bind(TD.components.AccountSelector.CHANGE,function(){V()}),ba(),l.selectDefaultAccount(),e.on("uiInputBlur",W),$(document).on("uiSendTweetAction",bh),a.hasFocus=!1,a.focusId=_.uniqueId("focus"),a._boundHandleFocus=a.handleFocus.bind(this),$(document).on("uiFocus",a._boundHandleFocus),$(document).on("uiComposeAddFile",a.addFile)},a.handleFocus=function(b,c){c.id===a.focusId?a.hasFocus=!0:a.hasFocus=!1},a.showComposeWindow=function(a,c,d,f){if(!b||b.is(":hidden")){var g,h;this.setUp(),b.show(),b.trigger("uiFocusRequest",{id:this.focusId}),S=setInterval(function(){bp(),bq()},T),a!==null&&a!==undefined&&(e.val(a),d=d===undefined?a.length:d,f=f===undefined?a.length:f,h=e[0],h.setSelectionRange?(V(),h.selectionStart=d,h.selectionEnd=f):h.createTextRange&&(g=h.createTextRange(),g.collapse(!0),g.moveStart("character",d),g.moveEnd("character",f),g.select())),c?l.selectAccounts(c):l.selectDefaultAccount(),bq(),V(),b.trigger("uiCloseModal"),$(document).on("uiCloseModal",bk)}else b&&V()},a.referenceTo=function(a,b){this.setUp(),this.showComposeWindow("RE "+a+" ",[b])},a.mention=function(a,b){this.setUp(),this.showComposeWindow("@"+a+" ",[b])},a.replyToTweet=function(a,b,c,d,e){var g,h,i,j=a;this.setUp(),!b&&a&&(g=TD.util.getReplyUsers(a),g.length&&(b=g.join(" ")+" ",h=g[0].length+1,i=b.length)),this.showComposeWindow(b,[c],h,i),p=e||a.id,q="@"+(d||a.user.screenName.toLowerCase()),j&&(j.withAvatar=!0,z.addClass("s-inreply"),D.html(TD.ui.template.render("status/tweet_single",a)).show(),f=$("#replyto"))},a.directMessage=function(a,b,c,d){var e=c?[c]:null;this.setUp(),d=d||"",this.showComposeWindow("",e),bf(d),E&&be(),bc(),a&&(bd(a,b),V())},a.editScheduledUpdate=function(b){var c,d,e,f=[],g=0,h,i,j,k,m=_.uniqueId("scheduledUpdateError"),n=function(){bj();if(b.twitterDMTargetScreenName)a.directMessage(b.twitterDMTargetScreenName,null,e,b.text);else if(b.twitterInReplyToStatusID){var c=twttr.txt.extractMentions(b.text)[0]||"";a.replyToTweet(null,b.text,null,c,b.twitterInReplyToStatusID)}else a.showComposeWindow(b.text);!b.twitterPlaceID,l.selectAccounts(f),bb(),w.setDate(b.created),u=b};a.setUp();for(c=0,d=b.updates.length;c<d;c++)h=!1,i=b.updates[c].service,e=TD.storage.Account.generateKeyFor(i,b.updates[c].uid),h=Boolean(TD.storage.accountController.get(e)),h?f.push(e):g++;if(g>0){j=TD.util.pluralise(TD.i("This scheduled update is associated with an account which has been removed from your TweetDeck. This account will therefore not be available during this edit unless you re-add it from the accounts panel."),TD.i("This scheduled update is associated with {{1}} accounts which have been removed from your TweetDeck. These accounts will therefore not be available during this edit unless you re-add them from the settings panel.",{1:g}),g),j+="\n\n",j+=TD.i("Are you sure you want to continue editing?"),k={id:m,title:TD.i("Warning!"),message:j,okLabel:TD.i("Continue"),cancelLabel:TD.i("Cancel")};var o=function(a,b){if(b.id!==m)return;$(document).off("uiConfirmationAction",o),b.result&&n()};$(document).on("uiConfirmationAction",o).trigger("uiShowConfirmationDialog",k)}else n()},a.selectAccounts=function(a){l.selectAccounts(a)},a.displayLength=function(a){if(typeof a!="string")throw new Error("displayLength() requires a single input of type string");var b=0,c=0,d=function(a,b){var c=a.charCodeAt(b),d="",e="";if(55296<=c&&c<=56319){if(a.length<=b+1)throw"High surrogate without following low surrogate";d=a.charCodeAt(b+1);if(56320>d||d>57343)throw"High surrogate without following low surrogate";return a.charAt(b)+a.charAt(b+1)}if(56320<=c&&c<=57343){if(b===0)throw"Low surrogate without preceding high surrogate";e=a.charCodeAt(b-1);if(55296>e||e>56319)throw"Low surrogate without preceding high surrogate";return!1}return a.charAt(b)};for(b=0,c=0;b<a.length;b++){if(d(a,b)===!1)continue;c++}return c},a.getTextLength=function(b){var c=a.displayLength(b),d=twttr.txt.extractUrls(b);for(var e=0;e<d.length;e++)c+=U-d[e].length,_.startsWith(d[e],"https://")&&c++;return R&&(c=c+1+U),c};var ba=function(){var a=!1;return function(){a?(L.text(TD.i("Change")),l.hide()):(L.text(TD.i("Hide")),l.show()),a=!a,V()}}(),bc=function(){E=!0,z.addClass("s-message-to"),k.text(TD.i("Send")),P.hide(),i.hide(),bx(),J=new TD.components.Autocomplete(F,{dmMode:!0}),J.$node.bind(TD.components.Autocomplete.SELECT,function(a,b,c){bd(b,c),V()}),F.focus()},bd=function(a,b){a&&(a=_.trim(a));if(a===G)return;G=a,F.val(a||""),b?b=TD.util.transformTwitterAvatar(b,"mini"):b="http://a1.twimg.com/sticky/default_profile_images/default_profile_6_mini.png",$(".js-msg-to-avatar").attr("src",b)},be=function(){E=!1,z.removeClass("s-message-to"),k.text(TD.i("Tweet")),J.destroy(),J=null,bd(null,null),O&&P.show(),V()};return a.resetAndCloseInput=bk,a}(),TD.ui.openColumn=function(){function c(a,c){var d=a.split("?"),e=d[0].split("/").slice(1),f=d[1]||"",g=TD.net.util.formDecode(f),h=e.shift();switch(h){case"add":if(e[0]!=="search"){var i=TD.components.OpenColumn.instance;i&&!i.canGo(h,e)&&(i.destroy(),i=null),i||(i=new TD.components.OpenColumn),i.go(h,e,g,c),b.append(i.$node).show()}else $(document).trigger("uiAppSearchFocus")}}var a={},b;return a.init=function(){b=$("#open-modal"),$.subscribe(TD.components.OpenColumn.GO_EVENT,function(a){c(a.data,a.history)})},a.showOpenColumn=function(){c("/add/home")},a.showTwitterProfile=function(a){c("/profile/twitter/"+a)},a.showLists=function(){c("/add/lists")},a.showList=function(a,b){c("/add/lists?screenName="+TD.util.deMentionify(a)+"&slug="+b)},a}(),TD.ui.template=function(){function h(a){var b;try{b=$.ajax(a,{async:!1,isLocal:TD.util.getAppEnv()!=="web"})}catch(c){return null}return b.status!==200?"":_.trim(b.responseText)}function i(f){f=f.replace(b,"/");var g=c[f];return g===undefined&&(g=a.getHogan(f),g=e.compile(g,d),c[f]=g),g}function j(a,b){var c=this.partials[a];return b=b||{},b[c.name]||(b[c.name]=i(c.name)),Hogan.Template.prototype.ep.call(this,a,b)}function k(a,b,c){var d=Hogan.parse.call(this,a,b,c),e="";for(var f=0;f<d.length;f++)if(d[f].tag==="_v"&&d[f].n.indexOf("%TRANSLATION-HINT")===0){var g=d.splice(f,1)[0];f--,e=g.n.substring(g.n.indexOf("mode=")+"mode=".length)}return l(d,e,b,c)}function l(a,b,c,d){var e=[];for(var f=0;f<a.length;f++)if(a[f].tag==="#"&&a[f].n==="_i"){var g=n(c.substring(a[f].i,a[f].end),b);g.tag==="raw"?e.push(g):Array.prototype.push.apply(e,Hogan.parse(Hogan.scan(g,d.delimiters),c,d))}else a[f].tag==="#"||a[f].tag==="^"||a[f].tag==="<"||a[f].tag==="$"?(a[f].nodes=l(a[f].nodes,b,c,d),e.push(a[f])):e.push(a[f]);return m(e)}function m(a){if(a.length===0)return a;var b=[a[0]];for(var c=1;c<a.length;c++)b[b.length-1].tag!=="_t"||a[c].tag!=="\n"&&a[c].tag!=="_t"?b.push(a[c]):b[b.length-1].text+=a[c].text||"\n";return b}function n(a,b){var c;return b!==""?c={text:a,mode:b}:c=a,TD.i(c,null,!0)}var a={},b=/\\/g,c={},d={sectionTags:[{o:"_i",c:"i"}]},e,f,g;return g=function(a,b,c,d){this.ep=j,Hogan.Template.call(this,a,b,c,d)},g.prototype=Hogan.Template.prototype,f=function(){},f.prototype=Hogan,e=new f,e.template=g,e.parse=k,a.getHogan=function(a){var b=TD.mustaches[a+".mustache"];return b===undefined&&(b=h("../mustaches/"+a+".mustache"),b===""&&(b=a),TD.mustaches[a+".mustache"]=b),b},a.render=function(a,b,c){var d=i(a),e=_.clone(TD.globalRenderOptions)||{};return _.extend(e,b),d.render(e,c)},a.toHtml=function(a,b,c){var f=e.compile(a,d);return f.render(b,c)},a}(),TD.ui.updates=function(){function e(b,c,d,e){var h=$(b.target),i,j,k=!1,l,m,n,o,p;if($(".js-stream-item",b.target).length>0)return;h.attr("rel")||(h=h.closest("a,button")),c||(i=a.findParentArticle(h),d||(d=TD.controller.columnManager.get(i.column)),d&&(e=d.findChirp(i.statusKey),c=d.findMostInterestingChirp(i.statusKey)));if(!c)return;j=h.attr("rel");switch(j){case"list":TD.ui.openColumn.showList(h.data("screen-name"),h.data("slug"));break;case"actionsMenu":case"userActionsMenu":l=h.data("user-id").toString(),m=TD.cache.twitterUsers.getById(l),n=j==="actionsMenu"?c:null,m.addCallback(function(a){var b=new TD.components.ProfileMenu(h,a,n,!0);return b.setPosition(TD.components.DropDown.POSITION_LEFT),b});break;case"mediaPreview":k=f(c,h.attr("href"),d);break;case"retweet":case"like":case"favorite":case"destroy":case"edit":case"reply":case"viewDetails":case"followStatus":case"dm":case"showSensitiveMedia":case"alwaysShowSensitiveMedia":g(j,c,e,d);break;case"globalSettings":var q=new TD.components.GlobalSettings;break;case"tweet":o=h.attr("data-tweet-id"),p=TD.controller.clients.getClient(c.account.getKey()),p.show(o,function(a){g("viewDetails",a,e,d)},function(){TD.util.openURL(h.attr("href"))});break;default:k=!0}return k||(b.preventDefault(),b.stopPropagation()),!1}function f(a,b,c){return c.temporary?(TD.util.openURL(b),!0):(new TD.components.MediaGallery(a,b,c),!1)}function g(b,c,d,e){var f;switch(b){case"retweet":case"like":case"favorite":case"destroy":case"edit":b in c&&c[b]();break;case"reply":c instanceof TD.services.TwitterMessageThread||c instanceof TD.services.TwitterDirectMessage?TD.ui.compose.mention(c.getMainUser().screenName,c.account.getKey()):TD.ui.compose.replyToTweet(c,"",c.account.getKey());break;case"viewDetails":a.showDetailView(e,c,d);break;case"followStatus":f=new TD.components.FollowDialog(c);break;case"dm":TD.ui.compose.directMessage(c.getMainUser().screenName,c.getMainUser().profileImageURL,c.getMainUser().account.getKey());case"showSensitiveMedia":a.showSensitiveMedia(c);break;case"alwaysShowSensitiveMedia":a.alwaysShowSensitiveMedia(c)}}function h(a){var b=".js-media";if(a){$(b).show();var c=TD.controller.columnManager.getAll();_.each(c,function(a,c){_.each(a.updateArray,function(c){c.hasMedia()&&c.getDOMChirps()&&c.getDOMChirps().each(function(){var d=$(this).find(b),e="";c.getMedia().forEach(function(b){e+=b.renderThumb(a.getMediaPreviewSize())}),d.children().length||d.html(e)})})})}else $(b).hide()}var a={currentlyDisplayedProfile:null},b=110,c="2s",d;return a.init=function(){$(".js-show-detail").live("click",function(b){var c,d,e,f=window.getSelection(),g=f.rangeCount===0?!1:f.getRangeAt(0),h;if(!g||g.endOffset===g.startOffset)c=a.findParentArticle($(this)),d=TD.controller.columnManager.get(c.column),d&&(e=d.findMostInterestingChirp(c.statusKey),h=d.findChirp(c.statusKey),a.showDetailView(d,e,h));return!1}),$("body").delegate(".js-stream-item a, .js-stream-item button","click",e),$(".form-comment").live("click",e),$.subscribe("chirp/click",function(a,b,c){e(a,b,c)}),$.subscribe("chirp/action",g),TD.controller.scheduler.schedulePeriodicTask(30,TD.ui.updates.refreshTimestamps)},a.statusAction=function(a,b){var c=TD.controller.columnManager.get(b.column),d;if(!c)return;d=c.findMostInterestingChirp(b.statusKey),d[a](b)},a.refreshTimestamps=function(){var a=TD.util.prettyDate;$(".js-timestamp").each(function(b,c){var d,e,f=$(this),g;d=f.attr("data-time"),g=new Date(Number(d)),e=a(g),$("a,span",f).text(e)})},a.findParentArticle=function(a){var b=a.closest(".js-stream-item");return{element:b,statusKey:b.attr("data-key"),column:b.closest(".js-chirp-container, .js-column").data("column")}},a.showDetailView=function(a,b,c){var d=a.model.getKey(),e=TD.ui.columns.getColumnElementByKey(d);TD.ui.columns.exitEditMode(d),a.detailViewComponent&&a.detailViewComponent.destroy(),b instanceof TD.services.TwitterStatus?a.detailViewComponent=new TD.components.TweetDetailView(a,e):b instanceof TD.services.TwitterMessageThread&&(a.detailViewComponent=new TD.components.MessageDetailView(a,e)),a.detailViewComponent.showChirp(b,c)},a.showSensitiveMedia=function(a){var b=a.getDOMChirps();b.find(".js-media-sensitive-overlay").remove(),b.find(".js-media-preview-container").removeClass("media-size-medium media-sensitive-detail"),b.find(".js-media-image-link").removeClass("is-invisible"),a.possiblySensitive=!1},a.alwaysShowSensitiveMedia=function(a){TD.settings.setDisplaySensitiveMedia(!0)},a}(),TD.ui.startflow=function(a,b,c,d){function A(a){a.preventDefault();var b=$(a.currentTarget),c=b.data("action");switch(c){case"url":var d=window.open(b.attr("href"));d.focus();break;case"signin":C();break;case"showRegister":L(i);break;case"login":L(h);break;case"forgotPassword":B();break;case"resetReload":TD.sync.controller.debugFlushAndReload();break;case"spoofData":TD.sync.controller.debugInstallOldChromeData()}}function B(){if(y)return;var a=$("#tdRegEmail",m).val();if(!a||!a.match(f)){J(TD.i("That doesn't seem to be a valid email address. Remember: TweetDeck accounts are different from Twitter accounts."),[p]);return}var b=new TD.services.TweetDeckClient;y=!0,J(TD.i("Sending password reset instructionsâ¦"),[p],!0);var c=b.forgotPassword(a);c.addCallback(function(){J(TD.i("We have sent an email to {{email}} with instructions to reset your password.",{email:a}),[],!0),y=!1}),c.addErrback(function(b){var c;b&&b.number===403?c=TD.i("We couldn't find a TweetDeck account associated with {{email}}.",{email:a}):c=TD.i("Sorry, something went wrong. It's not you, it's us. Please try again later."),J(c,[p]),y=!1})}function C(){var a=$("#tdRegEmail",m).val(),b=$("#tdRegPassword",m).val(),c=$("#tdRegRememberMe",m)[0].checked;D(a,b,c)}function D(a,b,d){if(a&&b!==""){L(j);var e=c.accountController.loginTweetdeck(a,b);e.addCallbacks(E,F,[d])}else L(h),J(TD.i("Please check your email & password."),[q,p])}function E(a,b){a.stay_signed_in=b,x.callback(a)}function F(a){L(h);var b,c=[],e,f;if(a.req.status===401)e=JSON.parse(a.req.responseText).error,e==TD.constants.TDApi.ERROR_ACCOUNT_DOESNT_EXIST?(f=$("#tdRegEmail",m).val(),b=TD.i("We couldn't find a TweetDeck account associated with: {{{email}}}",{email:f}),c=[p]):e==TD.constants.TDApi.ERROR_BAD_PASSWORD&&(b=TD.i("Please check your password. Remember: TweetDeck accounts are different from Twitter accounts."),c=[q]);else if(a.req.status===0)b=TD.i("Unable to connect. Please check your network.");else try{e=JSON.parse(a.req.responseText).error,b=TD.i("Unable to sign in: {{{1}}}",{1:e})}catch(g){b=TD.i("Sorry, something went wrong. It's not you, it's us. Please try again later."),console.log("An unknown error occurred at sign in"),console.log(a.req.responseText)}d.warn(a.message,a),J(b,c)}function G(){var a=$("#tdRegEmail",m).val(),b=$("#tdRegPassword",m).val(),c=$("#tdRegPasswordConfirm",m).val(),d=$("#tdRegRememberMe",m)[0].checked;if(!a||!a.match(f)){J(TD.i("That doesn't seem to be a valid email address. Remember: TweetDeck accounts are different from Twitter accounts."),[p]);return}if(b!==c){J(TD.i("Passwords must match!"),[q]);return}if(b.length<7){J(TD.i("Your password must be 7 characters or longer."),[q]);return}var e=H(a,b,d);e.addErrback(I),L(j)}function H(a,b,e){var f=c.accountController.loginTweetdeck(a,b);return f.addCallback(E,e),f.addErrback(function(){d.trace("register//login failed//going to try to create account");var f=c.accountController.createTweetdeckAccount(a,b);return f.addCallback(function(a){return a.created_account=!0,a}),f.addCallback(E,e),f}),f}function I(a){var b;L(i),a&&a.number&&a.number===401?b=TD.ui.template.render("text/already_registered"):b=TD.i("Registration unsuccessful. Please check your email & password"),a&&d.warn(a.message,a),J(b,[q,p])}function J(a,b,c){c?n.removeClass(v).addClass(w):n.removeClass(w).addClass(v),a&&(n.html(a),n.show()),b&&_.each(b,function(a){a.addClass("s-error")})}function K(){q.removeClass("s-error"),p.removeClass("s-error"),n.hide()}function L(a){k=a,K();switch(a){case h:t.fadeOut("fast"),$("#tdRegPasswordConfirm").attr("disabled",!0),r.attr("disabled",!1),m.addClass("s-login").removeClass("s-register is-loading");break;case i:t.fadeOut("fast"),$("#tdRegPasswordConfirm").attr("disabled",!1),s.attr("disabled",!1),m.addClass("s-register").removeClass("s-login is-loading");break;case j:t.fadeIn("fast"),r.attr("disabled",!0),s.attr("disabled",!0)}}var e={},f=/^[a-zA-Z0-9_\-\.+]+@[a-zA-Z0-9_\-\.]+\.[a-zA-Z]{2,4}$/,g=-1,h=0,i=1,j=2,k=g,l=null,m=null,n,o,p,q,r,s,t,u="form-error",v="srt-error-msg",w="srt-success-msg",x=null,y;e.doLogin=function(b,c,d){x=new a.Deferred;try{z(b,c),L(h),d&&J(d)}catch(e){var f="Unable to initialise login UI. Please contact your friendly dev team for assistance.";$("body").html(f),console.log("login UI init error:",[e]),TD.util.isChromeApp()&&console.log("stack trace:",[e.stack.split("\n")])}return x};var z=function(a,c){var d={email:a||"",spoofData:Boolean(TD.debug.spoof_data),debugMenu:Boolean(TD.config.debug_menu),version:TD.version,buildIDShort:TD.buildIDShort,appEnv:TD.util.getAppEnv()};TD.util.isWrapperApp()&&deck.getWrapperVersion&&(d.wrapperVersion=deck.getWrapperVersion());var e=b.render("startup/signin",d);$(".js-signin-ui").html(e),TD.util.isWrapperApp()&&deck.closeLoadingScreen&&deck.closeLoadingScreen(),m=$(".js-signin-form"),n=$(".js-start-message",m),p=$(".js-email"),q=$(".js-password"),r=$(".js-signin"),s=$(".js-register"),t=$(".js-loader"),$("#tdRegRememberMe",m)[0].checked=Boolean(c),$("#tdAccountForm").submit(function(a){return k===h?C():G(),a.preventDefault(),!1}),$("a",m).live("click",A),m.live("keypress",function(a){a.keyCode==13&&$("tdAccountForm").submit()})};return e}(TD.core.defer,TD.ui.template,TD.storage,TD.sync.util),TD.globalRenderOptions={styledScrollbar:TD.util.hasFixedScrollBars()};var TD,jQuery;TD.net.ajax=function(){var a={},b=function(a,b,c){var d=TD.config.api_root+"/oauth/"+b;return d+="/"+c.getType()+"/",d+=encodeURIComponent(a),d},c=function(a,b){a["x-td-oauth-key"]=b.getOAuthToken(),a["x-td-oauth-secret"]=b.getTokenSecret(),a["x-td-oauth-service"]=b.getType()},d=function(a,b,c,d,e){var f=new TD.core.defer.Deferred,g,h,i={url:b,global:!1,type:a,dataType:"text json"};return e&&_.extend(i,e),c&&(i.beforeSend=function(a){_.each(c,function(b,c){c.toLowerCase()!=="content-type"&&a.setRequestHeader(c,b)})}),d&&(i.data=d),h=c["Content-Type"]||c["content-type"],h&&(i.contentType=h),g=jQuery.ajax(i),g.done(function(a,b,c){f.callback({data:a,xhr:c})}),g.fail(function(a,b,c){f.errback(new TD.core.defer.XMLHttpRequestError(a,c))}),f};return a.jsonp=function(a,b){var c=d("GET",a,{},b,{dataType:"jsonp",timeout:1e4});return c},a.upload=function(a,b,e){var f={},g;return c(f,e),g=d("POST",a,f,b,{timeout:12e4,processData:!1,contentType:!1}),g},a.signRequest=function(a,e,f,g,h){var i,j,k,l;return h=h||{},c(h,a),f==="GET"?k="echo":k="sign",j=b(e,k,a),i=d(f,j,h,g),i},a.request=function(e,f){var f=f||{},g=f.headers||{},h=f.method||"GET",i=f.account,j=f.params||null,k,l;return(h==="GET"||!TD.util.isWrapperApp())&&f.params&&(e=TD.net.util.addURLParameters(e,j),j={}),TD.util.isChromeApp()?h==="GET"?(c(g,i),k=b(e,"sign",i),l=d(h,k,g)):(l=a.signRequest(i,e,h,j,g),l.addCallback(function(a){var b=a.data,c=b.headers||{};return g&&g["Content-Type"]&&(c["Content-Type"]=g["Content-Type"]),d(h,b.url,c,b.body)})):(c(g,i),k=b(e,"proxy",i),l=d(h,k,g,j)),l},a}(),function(a){function f(a,b){return 32-(new Date(a,b,32)).getDate()}function g(a,b){a=""+a,b=b||2;while(a.length<b)a="0"+a;return a}function j(a,b,c){var d=a.getDate(),f=a.getDay(),j=a.getMonth(),k=a.getFullYear(),l={d:d,dd:g(d),ddd:e[c].shortDays[f],dddd:e[c].days[f],m:j+1,mm:g(j+1),mmm:e[c].shortMonths[j],mmmm:e[c].months[j],yy:String(k).slice(2),yyyy:k},m=b.replace(h,function(a){return a in l?l[a]:a.slice(1,a.length-1)});return i.html(m).html()}function k(a){return parseInt(a,10)}function l(a,b){return a.getFullYear()===b.getFullYear()&&a.getMonth()==b.getMonth()&&a.getDate()==b.getDate()}function m(a){if(!a)return;if(a.constructor==Date)return a;if(typeof a=="string"){var b=a.split("-");if(b.length==3)return new Date(k(b[0]),k(b[1])-1,k(b[2]));if(!/^-?\d+$/.test(a))return;a=k(a)}var c=new Date;return c.setDate(c.getDate()+a),c}function n(c,g){function I(b,d,e){x=b,u=b.getFullYear(),v=b.getMonth(),w=b.getDate(),e=e||a.Event("api"),e.type="change",C.trigger(e,[b]);if(e.isDefaultPrevented())return;c.val(j(b,d.format,d.lang)),c.data("date",b),h.hide(e)}function J(a){a.type="onShow",C.trigger(a)}var h=this,i=new Date,n=g.css,o=e[g.lang],p=a("#"+n.root),q=p.find("#"+n.title),r,s,t,u,v,w,x=c.attr("data-value")||g.value||c.val(),y=c.attr("min")||g.min,z=c.attr("max")||g.max,A;y===0&&(y="0"),x=m(x)||i,y=m(y||g.yearRange[0]*365),z=m(z||g.yearRange[1]*365);if(!o)throw"Dateinput: invalid language: "+g.lang;if(c.attr("type")=="date"){var B=a("<input/>");a.each("class,disabled,id,maxlength,name,readonly,required,size,style,tabindex,title,value".split(","),function(a,b){B.attr(b,c.attr(b))}),c.replaceWith(B),c=B}c.addClass(n.input);var C=c.add(h);if(!p.length){p=a("<div><div><div/></div><div><div/><div/></div></div>").hide().css({position:"relative"}).attr("id",n.root),p.children().eq(0).attr("id",n.head).end().eq(1).attr("id",n.body).children().eq(0).attr("id",n.days).end().eq(1).attr("id",n.weeks).end().end().end(),q=p.find("#"+n.head).find("div").attr("id",n.title);if(g.selectors){var D=a("<select/>").attr("id",n.month),E=a("<select/>").attr("id",n.year);q.html(D.add(E))}var F=p.find("#"+n.days);for(var G=0;G<7;G++)F.append(a("<span/>").text(o.shortDays[(G+g.firstDay)%7]));a("#calendar").append(p)}var H=p.find("#"+n.weeks);E=p.find("#"+n.year),D=p.find("#"+n.month),a.extend(h,{show:function(d){if(c.attr("readonly")||c.attr("disabled")||A)return;d=d||a.Event(),d.type="onBeforeShow",C.trigger(d);if(d.isDefaultPrevented())return;a.each(b,function(){this.hide()}),A=!0,D.unbind("change").change(function(){h.setValue(E.val(),a(this).val())}),E.unbind("change").change(function(){h.setValue(a(this).val(),D.val())}),s=p.find("#"+n.prev).unbind("click").click(function(a){return s.hasClass(n.disabled)||h.addMonth(-1),!1}),t=p.find("#"+n.next).unbind("click").click(function(a){return t.hasClass(n.disabled)||h.addMonth(),!1}),h.setValue(x);var e=c.offset();return/iPad/i.test(navigator.userAgent)&&(e.top-=a(window).scrollTop()),g.speed?p.show(g.speed,function(){J(d)}):(p.show(),J(d)),h},setValue:function(b,c,d){var e=k(c)>=-1?new Date(k(b),k(c),k(d||1)):b||x;e<y?e=y:e>z&&(e=z),b=e.getFullYear(),c=e.getMonth(),d=e.getDate(),c==-1?(c=11,b--):c==12&&(c=0,b++);if(!A)return I(e,g),h;v=c,u=b,w=d;var j=new Date(b,c,1-g.firstDay),m=j.getDay(),p=f(b,c),r=f(b,c-1),B;if(g.selectors){D.empty(),a.each(o.months,function(c,d){y<new Date(b,c+1,-1)&&z>new Date(b,c,0)&&D.append(a("<option/>").html(d).attr("value",c))}),E.empty();var C=i.getFullYear();for(var F=C+g.yearRange[0];F<C+g.yearRange[1];F++)y<=new Date(F+1,-1,1)&&z>new Date(F,0,0)&&E.append(a("<option/>").text(F));D.val(c),E.val(b)}else q.html(o.months[c]+" "+b);H.empty(),s.add(t).removeClass(n.disabled);for(var G=m?0:-7,J,K;G<(m?42:35);G++)J=a("<a/>"),G%7===0&&(B=a("<div/>").addClass(n.week),H.append(B)),G<m?(J.addClass(n.off),K=r-m+G+1,e=new Date(b,c-1,K)):G>=m+p?(J.addClass(n.off),K=G-p-m+1,e=new Date(b,c+1,K)):(K=G-m+1,e=new Date(b,c,K),l(x,e)?J.attr("id",n.current).addClass(n.focus):l(i,e)&&J.attr("id",n.today)),y&&e<y&&J.add(s).addClass(n.disabled),z&&e>z&&J.add(t).addClass(n.disabled),J.attr("href","#"+K).text(K).data("date",e),B.append(J);return H.find("a").click(function(b){var c=a(this);return c.hasClass(n.disabled)||(a("#"+n.current).removeAttr("id"),c.attr("id",n.current),I(c.data("date"),g,b)),!1}),n.sunday&&H.find(n.week).each(function(){var b=g.firstDay?7-g.firstDay:0;a(this).children().slice(b,b+1).addClass(n.sunday)}),h},setMin:function(a,b){return y=m(a),b&&x<y&&h.setValue(y),h},setMax:function(a,b){return z=m(a),b&&x>z&&h.setValue(z),h},today:function(){return h.setValue(i)},addDay:function(a){return this.setValue(u,v,w+(a||1))},addMonth:function(a){return this.setValue(u,v+(a||1),w)},addYear:function(a){return this.setValue(u+(a||1),v,w)},hide:function(b){if(A){b=a.Event(),b.type="onHide",C.trigger(b),a(document).unbind("click.d").unbind("keydown.d");if(b.isDefaultPrevented())return;p.hide(),A=!1}return h},getConf:function(){return g},getInput:function(){return c},getCalendar:function(){return p},getValue:function(a){return a?j(x,a,g.lang):x},isOpen:function(){return A}}),a.each(["onBeforeShow","onShow","change","onHide"],function(b,c){a.isFunction(g[c])&&a(h).bind(c,g[c]),h[c]=function(b){return b&&a(h).bind(c,b),h}}),c.bind("focus click",h.show).keydown(function(b){var c=b.keyCode;return!A&&a(d).index(c)>=0?(h.show(b),b.preventDefault()):b.shiftKey||b.ctrlKey||b.altKey||c==9?!0:b.preventDefault()}),m(c.val())&&I(x,g)}a.tools=a.tools||{version:"1.2.5"};var b=[],c,d=[75,76,38,39,74,72,40,37],e={};c=a.tools.dateinput={conf:{format:"mm/dd/yy",selectors:!1,yearRange:[-5,5],lang:"en",offset:[0,0],speed:0,firstDay:0,min:undefined,max:undefined,trigger:!1,css:{prefix:"cal",input:"date",root:0,head:0,title:0,prev:0,next:0,month:0,year:0,days:0,body:0,weeks:0,today:0,current:0,week:0,off:0,sunday:0,focus:0,disabled:0,trigger:0}},localize:function(b,c){a.each(c,function(a,b){c[a]=b.split(",")}),e[b]=c}},c.localize("en",{months:"January,February,March,April,May,June,July,August,September,October,November,December",shortMonths:"Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Oct,Nov,Dec",days:"Sunday,Monday,Tuesday,Wednesday,Thursday,Friday,Saturday",shortDays:"S,M,T,W,T,F,S"});var h=/d{1,4}|m{1,4}|yy(?:yy)?|"[^"]*"|'[^']*'/g,i=a("<a/>");a.expr[":"].date=function(b){var c=b.getAttribute("type");return c&&c=="date"||!!a(b).data("dateinput")},a.fn.dateinput=function(d){if(this.data("dateinput"))return this;d=a.extend(!0,{},c.conf,d),a.each(d.css,function(a,b){!b&&a!="prefix"&&(d.css[a]=(d.css.prefix||"")+(b||a))});var e;return this.each(function(){var c=new n(a(this),d);b.push(c);var f=c.getInput().data("dateinput",c);e=e?e.add(f):f}),e?e:this}}(jQuery),function(a){a.createElement=function(b){return a(document.createElement(b))}}(jQuery),!function(a){"use strict",a(function(){a.support.transition=function(){var a=function(){var a=document.createElement("bootstrap"),b={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"},c;for(c in b)if(a.style[c]!==undefined)return b[c]}();return a&&{end:a}}()})}(window.jQuery),!function(a){"use strict";var b=function(a,b){this.init("tooltip",a,b)};b.prototype={constructor:b,init:function(b,c,d){var e,f,g,h,i;this.type=b,this.$element=a(c),this.options=this.getOptions(d),this.enabled=!0,g=this.options.trigger.split(" ");for(i=g.length;i--;)h=g[i],h=="click"?this.$element.on("click."+this.type,this.options.selector,a.proxy(this.toggle,this)):h!="manual"&&(e=h=="hover"?"mouseenter":"focus",f=h=="hover"?"mouseleave":"blur",this.$element.on(e+"."+this.type,this.options.selector,a.proxy(this.enter,this)),this.$element.on(f+"."+this.type,this.options.selector,a.proxy(this.leave,this)));this.options.selector?this._options=a.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},getOptions:function(b){return b=a.extend({},a.fn[this.type].defaults,b,this.$element.data()),b.delay&&typeof b.delay=="number"&&(b.delay={show:b.delay,hide:b.delay}),b},enter:function(b){var c=a(b.currentTarget)[this.type](this._options).data(this.type);if(!c.options.delay||!c.options.delay.show)return c.show();clearTimeout(this.timeout),c.hoverState="in",this.timeout=setTimeout(function(){c.hoverState=="in"&&c.show()},c.options.delay.show)},leave:function(b){var c=a(b.currentTarget)[this.type](this._options).data(this.type);this.timeout&&clearTimeout(this.timeout);if(!c.options.delay||!c.options.delay.hide)return c.hide();c.hoverState="out",this.timeout=setTimeout(function(){c.hoverState=="out"&&c.hide()},c.options.delay.hide)},show:function(){var b,c,d,e,f,g,h=a.Event("show");if(this.hasContent()&&this.enabled){this.$element.trigger(h);if(h.isDefaultPrevented())return;b=this.tip(),this.setContent(),this.options.animation&&b.addClass("fade"),f=typeof this.options.placement=="function"?this.options.placement.call(this,b[0],this.$element[0]):this.options.placement,b.detach().css({top:0,left:0,display:"block"}),this.options.container?b.appendTo(this.options.container):b.insertAfter(this.$element),c=this.getPosition(),d=b[0].offsetWidth,e=b[0].offsetHeight,this.interval=setInterval(function(){var a=this.$element.closest("body").length>0,b=this.elementOffset&&(this.elementOffset.top!=this.$element.offset().top||this.elementOffset.left!=this.$element.offset().left);(!a||b)&&this.hide(),this.elementOffset=this.$element.offset()}.bind(this),500);switch(f){case"bottom":g={top:c.top+c.height,left:c.left+c.width/2-d/2};break;case"top":g={top:c.top-e,left:c.left+c.width/2-d/2};break;case"left":g={top:c.top+c.height/2-e/2,left:c.left-d};break;case"right":g={top:c.top+c.height/2-e/2,left:c.left+c.width}}this.applyPlacement(g,f),this.$element.trigger("shown")}},applyPlacement:function(a,b){var c=this.tip(),d=c[0].offsetWidth,e=c[0].offsetHeight,f,g,h,i;c.offset(a).addClass(b).addClass("in"),f=c[0].offsetWidth,g=c[0].offsetHeight,b=="top"&&g!=e&&(a.top=a.top+e-g,i=!0),b=="bottom"||b=="top"?(h=0,a.left<0&&(h=a.left*-2,a.left=0,c.offset(a),f=c[0].offsetWidth,g=c[0].offsetHeight),this.replaceArrow(h-d+f,f,"left")):this.replaceArrow(g-e,g,"top"),i&&c.offset(a)},replaceArrow:function(a,b,c){this.arrow().css(c,a?50*(1-a/b)+"%":"")},setContent:function(){var a=this.tip(),b=this.getTitle();a.find(".tooltip-inner")[this.options.html?"html":"text"](b),a.removeClass("fade in top bottom left right")},hide:function(){function e(){var b=setTimeout(function(){c.off(a.support.transition.end).detach()},500);c.one(a.support.transition.end,function(){clearTimeout(b),c.detach()})}var b=this,c=this.tip(),d=a.Event("hide");this.$element.trigger(d);if(d.isDefaultPrevented())return;return c.removeClass("in"),!this.options.suppressFadeOut&&a.support.transition&&this.$tip.hasClass("fade")?e():c.detach(),clearInterval(this.interval),this.$element.trigger("hidden"),this},fixTitle:function(){var a=this.$element;(a.attr("title")||typeof a.attr("data-original-title")!="string")&&a.attr("data-original-title",a.attr("title")||"").attr("title","")},hasContent:function(){return this.getTitle()},getPosition:function(){var b=this.$element[0];return a.extend({},typeof b.getBoundingClientRect=="function"?b.getBoundingClientRect():{width:b.offsetWidth,height:b.offsetHeight},this.$element.offset())},getTitle:function(){var a,b=this.$element,c=this.options;return a=b.attr("data-original-title")||(typeof c.title=="function"?c.title.call(b[0]):c.title),a},tip:function(){return this.$tip=this.$tip||a(this.options.template)},arrow:function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},validate:function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},toggleEnabled:function(){this.enabled=!this.enabled},toggle:function(b){var c=b?a(b.currentTarget)[this.type](this._options).data(this.type):this;c.tip().hasClass("in")?c.hide():c.show()},destroy:function(){this.hide().$element.off("."+this.type).removeData(this.type)}};var c=a.fn.tooltip;a.fn.tooltip=function(c){return this.each(function(){var d=a(this),e=d.data("tooltip"),f=typeof c=="object"&&c;e||d.data("tooltip",e=new b(this,f)),typeof c=="string"&&e[c]()})},a.fn.tooltip.Constructor=b,a.fn.tooltip.defaults={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1},a.fn.tooltip.noConflict=function(){return a.fn.tooltip=c,this}}(window.jQuery),jQuery.easing.jswing=jQuery.easing.swing,jQuery.extend(jQuery.easing,{def:"easeOutQuad",swing:function(a,b,c,d,e){return jQuery.easing[jQuery.easing.def](a,b,c,d,e)},easeInQuad:function(a,b,c,d,e){return d*(b/=e)*b+c},easeOutQuad:function(a,b,c,d,e){return-d*(b/=e)*(b-2)+c},easeInOutQuad:function(a,b,c,d,e){return(b/=e/2)<1?d/2*b*b+c:-d/2*(--b*(b-2)-1)+c},easeInCubic:function(a,b,c,d,e){return d*(b/=e)*b*b+c},easeOutCubic:function(a,b,c,d,e){return d*((b=b/e-1)*b*b+1)+c},easeInOutCubic:function(a,b,c,d,e){return(b/=e/2)<1?d/2*b*b*b+c:d/2*((b-=2)*b*b+2)+c},easeInQuart:function(a,b,c,d,e){return d*(b/=e)*b*b*b+c},easeOutQuart:function(a,b,c,d,e){return-d*((b=b/e-1)*b*b*b-1)+c},easeInOutQuart:function(a,b,c,d,e){return(b/=e/2)<1?d/2*b*b*b*b+c:-d/2*((b-=2)*b*b*b-2)+c},easeInQuint:function(a,b,c,d,e){return d*(b/=e)*b*b*b*b+c},easeOutQuint:function(a,b,c,d,e){return d*((b=b/e-1)*b*b*b*b+1)+c},easeInOutQuint:function(a,b,c,d,e){return(b/=e/2)<1?d/2*b*b*b*b*b+c:d/2*((b-=2)*b*b*b*b+2)+c},easeInSine:function(a,b,c,d,e){return-d*Math.cos(b/e*(Math.PI/2))+d+c},easeOutSine:function(a,b,c,d,e){return d*Math.sin(b/e*(Math.PI/2))+c},easeInOutSine:function(a,b,c,d,e){return-d/2*(Math.cos(Math.PI*b/e)-1)+c},easeInExpo:function(a,b,c,d,e){return b==0?c:d*Math.pow(2,10*(b/e-1))+c},easeOutExpo:function(a,b,c,d,e){return b==e?c+d:d*(-Math.pow(2,-10*b/e)+1)+c},easeInOutExpo:function(a,b,c,d,e){return b==0?c:b==e?c+d:(b/=e/2)<1?d/2*Math.pow(2,10*(b-1))+c:d/2*(-Math.pow(2,-10*--b)+2)+c},easeInCirc:function(a,b,c,d,e){return-d*(Math.sqrt(1-(b/=e)*b)-1)+c},easeOutCirc:function(a,b,c,d,e){return d*Math.sqrt(1-(b=b/e-1)*b)+c},easeInOutCirc:function(a,b,c,d,e){return(b/=e/2)<1?-d/2*(Math.sqrt(1-b*b)-1)+c:d/2*(Math.sqrt(1-(b-=2)*b)+1)+c},easeInElastic:function(a,b,c,d,e){var f=1.70158,g=0,h=d;if(b==0)return c;if((b/=e)==1)return c+d;g||(g=e*.3);if(h<Math.abs(d)){h=d;var f=g/4}else var f=g/(2*Math.PI)*Math.asin(d/h);return-(h*Math.pow(2,10*(b-=1))*Math.sin((b*e-f)*2*Math.PI/g))+c},easeOutElastic:function(a,b,c,d,e){var f=1.70158,g=0,h=d;if(b==0)return c;if((b/=e)==1)return c+d;g||(g=e*.3);if(h<Math.abs(d)){h=d;var f=g/4}else var f=g/(2*Math.PI)*Math.asin(d/h);return h*Math.pow(2,-10*b)*Math.sin((b*e-f)*2*Math.PI/g)+d+c},easeInOutElastic:function(a,b,c,d,e){var f=1.70158,g=0,h=d;if(b==0)return c;if((b/=e/2)==2)return c+d;g||(g=e*.3*1.5);if(h<Math.abs(d)){h=d;var f=g/4}else var f=g/(2*Math.PI)*Math.asin(d/h);return b<1?-0.5*h*Math.pow(2,10*(b-=1))*Math.sin((b*e-f)*2*Math.PI/g)+c:h*Math.pow(2,-10*(b-=1))*Math.sin((b*e-f)*2*Math.PI/g)*.5+d+c},easeInBack:function(a,b,c,d,e,f){return f==undefined&&(f=1.70158),d*(b/=e)*b*((f+1)*b-f)+c},easeOutBack:function(a,b,c,d,e,f){return f==undefined&&(f=1.70158),d*((b=b/e-1)*b*((f+1)*b+f)+1)+c},easeInOutBack:function(a,b,c,d,e,f){return f==undefined&&(f=1.70158),(b/=e/2)<1?d/2*b*b*(((f*=1.525)+1)*b-f)+c:d/2*((b-=2)*b*(((f*=1.525)+1)*b+f)+2)+c},easeInBounce:function(a,b,c,d,e){return d-jQuery.easing.easeOutBounce(a,e-b,0,d,e)+c},easeOutBounce:function(a,b,c,d,e){return(b/=e)<1/2.75?d*7.5625*b*b+c:b<2/2.75?d*(7.5625*(b-=1.5/2.75)*b+.75)+c:b<2.5/2.75?d*(7.5625*(b-=2.25/2.75)*b+.9375)+c:d*(7.5625*(b-=2.625/2.75)*b+.984375)+c},easeInOutBounce:function(a,b,c,d,e){return b<e/2?jQuery.easing.easeInBounce(a,b*2,0,d,e)*.5+c:jQuery.easing.easeOutBounce(a,b*2-e,0,d,e)*.5+d*.5+c}}),function(a){a.fn.draggable=function(b){var c={translateY:!0,translateX:!0,boundary:"body"};a(this).each(function(){function l(){if(!f||f.length===0)typeof d.boundary=="function"?f=d.boundary():f=a(d.boundary)}function m(){return f[0].scrollHeight}function n(){return f[0].scrollWidth}function o(a,b,c){var d,g,h,i,j,k,l,o,p,q,r,s,t,u,v;c==="x"?(b=b.x,i=e.outerWidth(),d=e.offset().left,j=f.offset().left,k=f.outerWidth(),o=a.pageX<d,p=a.pageX>d+i,u="left",v=n()):(b=b.y,i=e.outerHeight(),d=e.offset().top,j=f.offset().top,k=f.outerHeight(),o=a.pageY<d,p=a.pageY>d+i,u="top",v=m()),s=b>0,t=b<0,g=parseInt(e.css(u),10),q=d<j,h=g+i,r=d+i>j+k,o&&s||p&&t||q&&t||r&&s||(t?g+b<0?l=0:l=g+b:h+b>v?l=v-i-1:l=g+b,e.css(u,l))}function p(a){var b={y:a.pageY-i,x:a.pageX-j},c=!1;i=a.pageY,j=a.pageX,a.preventDefault(),d.translateY&&(o(a,b,"y"),c=!0),d.translateX&&(o(a,b,"x"),c=!0),c&&e.trigger("drag.draggable",[b,{y:a.pageY,x:a.pageX}])}function q(){a(document).unbind("mousemove",r).unbind("mousemove",p).unbind("mouseup",q),k&&e.trigger("drop.draggable").removeClass("draggable-dragging"),k=!1}function r(b){k=!0,a(document).unbind("mousemove",r).bind("mousemove",p),i=b.pageY,j=b.pageX,l(),g=m(),h=n(),e.trigger("start.draggable",[b.offsetY,b.offsetX]).addClass("draggable-dragging")}function s(b){b.preventDefault(),a(document).bind("mousemove",r).bind("mouseup",q)}var d,e=a(this),f,g,h,i,j,k=!1;e.data("draggable")?d=a.extend({},e.data("draggable").settings,b):d=a.extend({},c,b),d.handle===undefined&&(d.handle=e),typeof d.handle=="string"?e.off("mousedown",d.handle,s).on("mousedown",d.handle,s):d.handle.unbind("mousedown",s).bind("mousedown",s),e.data("draggable",{settings:d})})}}(jQuery),function(a){var b=function(b){function o(){var b=a(this).position().top+f.scrollTop(),c=a(this).position().left+f.scrollLeft(),e=a(this).innerWidth();d.top.unshift(b),d.left.unshift(c),a(this).css({position:"absolute",top:b,left:c,width:e})}function p(e){d={top:[],left:[]},a.fn.reverse=[].reverse,h=function(){var c=0;return f.find(b.contentSelector).each(function(){c+=a(this).outerHeight()}),c}(),i=function(){var c=0;return f.find(b.contentSelector).each(function(){c+=a(this).outerWidth()}),c}(),a(this).append(a("<"+b.tagName+"/>",{"class":"placeholder",height:a(this).height(),width:a(this).width()})),f.css("z-index",2).find(b.selector).each(function(b){a(this).data("draggable-index",b)}).reverse().each(o),c=a(e.target),c.css({"z-index":10})}function q(a,e){var f=c.data("draggable-index"),g=a.data("draggable-index"),h=a.outerHeight()-c.outerHeight(),i=a.outerWidth()-c.outerWidth(),n=parseInt(c.css("margin-left"),10),o=parseInt(c.css("margin-top"),10),p=parseInt(a.css("margin-right"),10),q=parseInt(a.css("margin-bottom"),10),r,s;switch(e){case j:r=d.top[f]-h;break;case k:r=d.top[f],d.top[g]=r+a.outerHeight()+q+o;break;case l:s=d.left[f]-i;break;case m:s=d.left[f],d.left[g]=s+a.outerWidth()+p+n}b.orientation==="vertical"?a.stop().animate({top:r},"fast"):a.stop().animate({left:s},"fast"),c.data("draggable-index",g),a.data("draggable-index",f)}function r(a){var d,e=c.position().top,f=c.outerHeight(),g=c.position().left,h=c.outerWidth(),i,n,o,p;a===j||a===l?d=c.prev(b.selector):d=c.next(b.selector);if(d.length){i=d.position().top,n=d.outerHeight(),o=d.position().left,p=d.outerWidth();switch(a){case j:e<i+n/2&&(c.insertBefore(d),q(d,a));break;case k:e+f>i+n/2&&(c.insertAfter(d),q(d,a));break;case l:g<o+p/2&&(c.insertBefore(d),q(d,a));break;case m:g+h>o+p/2&&(c.insertAfter(d),q(d,a))}}}function s(a){var d=(new Date).getTime()-g,e=f.scrollTop(),j=parseInt(c.css("top"),10),l=j+c.outerHeight(),n=f.scrollLeft(),o=parseInt(c.css("left"),10),p=o+c.outerWidth(),q=1+d/1e3,s=Math.min(q*b.scroll_speed,b.scroll_speed*3);s=a===k||a===m?s:-s,b.orientation==="vertical"?e+s<0?u():e+s>h-f.innerHeight()?u():(f.scrollTop(f.scrollTop()+s),j+s>0&&l+s<h&&c.css({top:j+s}),r(a)):n+s<0?u():n+s>i-f.innerWidth()?u():(f.scrollLeft(f.scrollLeft()+s),o+s>0&&p+s<i&&c.css({left:o+s}),r(a))}function t(a){g=(new Date).getTime(),u(),e=setInterval(_.bind(s,this,a),n)}function u(){clearInterval(e),e=null}function v(a,d,g){if(c){var h,i=parseInt(c.css("top"),10),n=i+c.outerHeight(),o=parseInt(c.css("left"),10),p=o+c.outerWidth(),q=f.scrollTop()+f.innerHeight(),s=f.scrollLeft()+f.innerWidth(),v,w;if(d)if(b.orientation==="vertical"){h=d.y<0?j:k,v=d.y;while(v<0)r(h),v+=c.outerHeight();v=d.y;while(v>0)r(h),v-=c.outerHeight()}else{h=d.x<0?l:m,w=d.x;while(w<0)r(h),w+=c.outerWidth();w=d.x;while(w>0)r(h),w-=c.outerWidth()}g?(g.y>f.offset().top||g.y<f.offset().top+f.outerHeight())&&u():u(),e||(b.orientation==="vertical"?n>q?t(k):i<f.scrollTop()?t(j):u():p>s?t(m):o<f.scrollLeft()?t(l):u())}}function w(){a(this).find(".placeholder").remove(),f.css("height","").find(b.selector).attr("style",""),c.trigger("dropped.dragdroplist")}function x(){u(),b.orientation==="vertical"?c.animate({top:d.top[c.data("draggable-index")]},"fast",w.bind(this)):c.animate({left:d.left[c.data("draggable-index")]},"fast",w.bind(this)),c.trigger("drop.dragdroplist")}var c,d,e,f=b.$boundary,g,h,i,j="up",k="down",l="left",m="right",n=30;return{handleDragStart:p,handleDrop:x,handleDrag:v}};a.fn.dragdroplist=function(c){var d={orientation:"vertical",tagName:"li",selector:".draggable",contentSelector:"> *",scroll_speed:8};return a(this).each(function(){var e,f,g=function(a){a.draggable({translateX:f.orientation==="horizontal",translateY:f.orientation==="vertical",handle:f.handle?f.handle:f.tagName,boundary:f.$boundary})};a(this).data("dragdroplist")||(f=a.extend({},d,c),f.$boundary=f.$boundary||a(this),a(this).data("dragdroplist",{settings:f}),e=new b(f),a(this).find(f.tagName).each(function(){g(a(this))}),a(this).bind("start.draggable",e.handleDragStart).bind("drop.draggable",e.handleDrop).bind("drag.draggable",e.handleDrag)),a(this).on("itemadded.dragdroplist",function(b){g(a(b.target))})}),a(this)}}(jQuery),function(a){function b(b,c){this.el=a(b),this.options=c||{},this.x=!1!==this.options.x||this.options.forceHorizontal,this.y=!1!==this.options.y||this.options.forceVertical,this.autoHide=!1!==this.options.autoHide,this.padding=undefined==this.options.padding?2:this.options.padding,this.inner=this.el.find(".antiscroll-inner"),this.inner.css({right:this.y?-f():0,bottom:this.x?-f():0}),this.refresh()}function c(b){this.pane=b,this.pane.el.append(this.el),this.innerEl=this.pane.inner.get(0),this.dragging=!1,this.enter=!1,this.shown=!1,this.pane.el.mouseenter(a.proxy(this,"mouseenter")),this.pane.el.mouseleave(a.proxy(this,"mouseleave")),this.el.mousedown(a.proxy(this,"mousedown")),this.innerPaneScrollListener=a.proxy(this,"scroll"),this.pane.inner.scroll(this.innerPaneScrollListener),this.innerPaneMouseWheelListener=a.proxy(this,"mousewheel"),this.pane.inner.bind("mousewheel",this.innerPaneMouseWheelListener);var c=this.pane.options.initialDisplay;c!==!1&&(this.show(),this.pane.autoHide&&(this.hiding=setTimeout(a.proxy(this,"hide"),parseInt(c,10)||3e3)))}function d(a,b){function c(){}c.prototype=b.prototype,a.prototype=new c}function f(){if(e===undefined){var b=a('<div class="antiscroll-inner" style="width:50px;height:50px;overflow-y:scroll;position:absolute;top:-200px;left:-200px;"><div style="height:100px;width:100%"></div>');a("body").append(b);var c=a(b).innerWidth(),d=a("div",b).innerWidth();a(b).remove(),e=c-d}return e}a.fn.antiscroll=function(b){return this.each(function(){a(this).data("antiscroll")&&a(this).data("antiscroll").destroy(),a(this).data("antiscroll",new a.Antiscroll(this,b))})},a.Antiscroll=b,b.prototype.refresh=function(){var a=this.inner.get(0).scrollWidth>this.el.width()+(this.y?f():0),b=this.inner.get(0).scrollHeight>this.el.height()+(this.x?f():0);this.x&&(!this.horizontal&&a?this.horizontal=new c.Horizontal(this):this.horizontal&&!a?(this.horizontal.destroy(),this.horizontal=null):this.horizontal&&this.horizontal.update()),this.y&&(!this.vertical&&b?this.vertical=new c.Vertical(this):this.vertical&&!b?(this.vertical.destroy(),this.vertical=null):this.vertical&&this.vertical.update())},b.prototype.destroy=function(){return this.horizontal&&(this.horizontal.destroy(),this.horizontal=null),this.vertical&&(this.vertical.destroy(),this.vertical=null),this},b.prototype.rebuild=function(){return this.destroy(),this.inner.attr("style",""),b.call(this,this.el,this.options),this},c.prototype.destroy=function(){return this.el.remove(),this.pane.inner.unbind("scroll",this.innerPaneScrollListener),this.pane.inner.unbind("mousewheel",this.innerPaneMouseWheelListener),this},c.prototype.mouseenter=function(){this.enter=!0,this.show()},c.prototype.mouseleave=function(){this.enter=!1,this.dragging||this.pane.autoHide&&this.hide()},c.prototype.scroll=function(){this.shown||(this.show(),!this.dragging&&this.pane.autoHide&&(this.hiding=setTimeout(a.proxy(this,"hide"),1e3))),this.update()},c.prototype.mousedown=function(b){b.preventDefault(),this.dragging=!0,this.startPageY=b.pageY-parseInt(this.el.css("top"),10),this.startPageX=b.pageX-parseInt(this.el.css("left"),10),this.el[0].ownerDocument.onselectstart=function(){return!1};var c=this.pane,d=a.proxy(this,"mousemove"),e=this;a(this.el[0].ownerDocument).mousemove(d).mouseup(function(){e.dragging=!1,this.onselectstart=null,a(this).unbind("mousemove",d),e.enter||e.hide()})},c.prototype.show=function(a){this.hiding&&(clearTimeout(this.hiding),this.hiding=null),!this.shown&&this.update()&&(this.el.addClass("antiscroll-scrollbar-shown"),this.shown=!0)},c.prototype.hide=function(){this.pane.autoHide!==!1&&this.shown&&(this.el.removeClass("antiscroll-scrollbar-shown"),this.shown=!1)},c.Horizontal=function(b){this.el=a('<div class="antiscroll-scrollbar antiscroll-scrollbar-horizontal">',b.el),c.call(this,b)},d(c.Horizontal,c),c.Horizontal.prototype.update=function(){var a=this.pane.el.width(),b=a-this.pane.padding*2,c=this.pane.inner.get(0);return this.el.css("width",b*a/c.scrollWidth).css("left",b*c.scrollLeft/c.scrollWidth),a<c.scrollWidth},c.Horizontal.prototype.mousemove=function(a){var b=this.pane.el.width()-this.pane.padding*2,c=a.pageX-this.startPageX,d=this.el.width(),e=this.pane.inner.get(0),f=Math.min(Math.max(c,0),b-d);e.scrollLeft=(e.scrollWidth-this.pane.el.width())*f/(b-d)},c.Horizontal.prototype.mousewheel=function(a,b,c,d){if(c<0&&0==this.pane.inner.get(0).scrollLeft||c>0&&this.innerEl.scrollLeft+Math.ceil(this.pane.el.width())==this.innerEl.scrollWidth)return a.preventDefault(),!1},c.Vertical=function(b){this.el=a('<div class="antiscroll-scrollbar antiscroll-scrollbar-vertical">',b.el),c.call(this,b)},d(c.Vertical,c),c.Vertical.prototype.update=function(){var a=this.pane.el.height(),b=a-this.pane.padding*2,c=this.innerEl,d=b*a/c.scrollHeight;d=d<20?20:d;var e=b*c.scrollTop/c.scrollHeight;if(e+d>b){var f=e+d-b;e=e-f-3}return this.el.css("height",d).css("top",e),a<c.scrollHeight},c.Vertical.prototype.mousemove=function(a){var b=this.pane.el.height(),c=b-this.pane.padding*2,d=a.pageY-this.startPageY,e=this.el.height(),f=this.innerEl,g=Math.min(Math.max(d,0),c-e);f.scrollTop=(f.scrollHeight-b)*g/(c-e)},c.Vertical.prototype.mousewheel=function(a,b,c,d){if(d>0&&0==this.innerEl.scrollTop||d<0&&this.innerEl.scrollTop+Math.ceil(this.pane.el.height())==this.innerEl.scrollHeight)return a.preventDefault(),!1};var e}(jQuery),TD.debug=function(){var a={};return a.spoof_data=null,a}(),TD.minWrapperVersionMac="2.8.0",TD.minWrapperVersionWin="2.8.0";var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-4790629-1"]),_gaq.push(["_trackPageview"]),function(){var a=document.createElement("script");a.type="text/javascript",a.src="https://ssl.google-analytics.com/ga.js",a.setAttribute("async","true");var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)}();