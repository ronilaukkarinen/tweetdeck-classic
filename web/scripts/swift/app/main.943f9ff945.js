//implementation lifted from underscore.js (c) 2009-2012 Jeremy Ashkenas

/**
 * @license RequireJS domReady 2.0.1 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/domReady for details
 */

define("flight/utils",[],function(){function n(e,t,n){var r;return function(){var i=this,s=arguments,o=function(){r=null,e.apply(i,s)};r&&n&&clearTimeout(r);if(n||!r)r=setTimeout(o,t)}}var e=[],t=100,r={isDomObj:function(e){return!!e.nodeType||e===window},toArray:function(t,n){return e.slice.call(t,n)},merge:function(){var e=this.toArray(arguments);return e.unshift({}),e[e.length-1]===!0&&(e.pop(),e.unshift(!0)),$.extend.apply(undefined,e)},push:function(e,t,n){return e&&Object.keys(t||{}).forEach(function(r){if(e[r]&&n)throw Error("utils.push attempted to overwrite '"+r+"' while running in protected mode");typeof e[r]=="object"&&typeof t[r]=="object"?this.push(e[r],t[r]):e[r]=t[r]},this),e},isEnumerable:function(e,t){return Object.keys(e).indexOf(t)>-1},compose:function(){var e=arguments;return function(){var t=arguments;for(var n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},debounce:function(e,r){return typeof r!="number"&&(r=t),n(e,r,!0)},throttle:function(e,r){return typeof r!="number"&&(r=t),n(e,r,!1)},countThen:function(e,t){return function(){if(!--e)return t.apply(this,arguments)}},delegate:function(e){return function(t,n){var r=$(t.target),i;Object.keys(e).forEach(function(s){if((i=r.closest(s)).length)return n=n||{},n.el=i[0],e[s].apply(this,[t,n])},this)}}};return r}),define("flight/compose",[],function(){function t(t,n){if(!e)return;var r=Object.create(null);Object.keys(t).forEach(function(e){var i=Object.getOwnPropertyDescriptor(t,e);i.writable=n,r[e]=i}),Object.defineProperties(t,r)}function n(t,n,r){if(!e){r.call(t);return}var i=Object.getOwnPropertyDescriptor(t,n).writable;Object.defineProperty(t,n,{writable:!0}),r.call(t),Object.defineProperty(t,n,{writable:i})}function r(e,n){e.mixedIn=e.hasOwnProperty("mixedIn")?e.mixedIn:[],n.forEach(function(n){e.mixedIn.indexOf(n)==-1&&(t(e,!1),n.call(e),e.mixedIn.push(n))}),t(e,!0)}var e=!1;return{mixin:r,unlockProperty:n}}),define("flight/advice",["./utils","./compose"],function(e,t){var n={around:function(t,n){return function(){var r=e.toArray(arguments);return n.apply(this,[t.bind(this)].concat(r))}},before:function(t,n){return this.around(t,function(){var t=e.toArray(arguments),r=t.shift(),i;return i=typeof n=="function"?n:n.obj[n.fnName],i.apply(this,t),r.apply(this,t)})},after:function(t,n){return this.around(t,function(){var t=e.toArray(arguments),r=t.shift(),i,s=(r.unbound||r).apply(this,t);return i=typeof n=="function"?n:n.obj[n.fnName],i.apply(this,t),s})},withAdvice:function(){["before","after","around"].forEach(function(e){this[e]=function(r,i){t.unlockProperty(this,r,function(){return typeof this[r]=="function"?this[r]=n[e](this[r],i):this[r]=i})}},this)}};return n}),define("flight/registry",["./utils"],function(e){function t(t,n){var r,i,s;return n=e.toArray(n),typeof n[n.length-1]=="function"&&(s=n.pop()),typeof n[n.length-1]=="object"&&n.pop(),n.length==2?(r=n[0],i=n[1]):(r=t.node,i=n[0]),{element:r,type:i,callback:s}}function n(e,t){return e.element==t.element&&e.type==t.type&&(t.callback==null||e.callback==t.callback)}function r(){function i(e){this.component=e,this.instances=[],this.addInstance=function(e){this.throwIfInstanceExistsOnNode(e);var t=new s(e);return this.instances.push(t),t},this.throwIfInstanceExistsOnNode=function(e){this.instances.forEach(function(t){if(t.instance.$node[0]===e.$node[0])throw new Error("Instance of "+e.constructor+" already exists on node "+e.$node[0])})},this.removeInstance=function(e){var t=this.instances.filter(function(t){return t.instance==e})[0],n=this.instances.indexOf(t);n>-1&&this.instances.splice(n,1),this.instances.length||r.removeComponentInfo(this)}}function s(e){this.instance=e,this.events=[],this.addTrigger=function(){},this.addBind=function(e){this.events.push(e),r.events.push(e)},this.removeBind=function(e){for(var t=0,r;r=this.events[t];t++)n(r,e)&&this.events.splice(t,1)}}var r=this;(this.reset=function(){this.components=[],this.allInstances=[],this.events=[]}).call(this),this.addInstance=function(e){var t=this.findComponentInfo(e);t||(t=new i(e.constructor),this.components.push(t));var n=t.addInstance(e);return this.allInstances.push(n),t},this.removeInstance=function(e){var t,n=this.findInstanceInfo(e),r=this.findComponentInfo(e);r.removeInstance(e);var t=this.allInstances.indexOf(n);t>-1&&this.allInstances.splice(t,1)},this.removeComponentInfo=function(e){var t=this.components.indexOf(e);t>-1&&this.components.splice(t,1)},this.findComponentInfo=function(e){var t=e.attachTo?e:e.constructor;for(var n=0,r;r=this.components[n];n++)if(r.component===t)return r;return null},this.findInstanceInfo=function(e){var t;e.node?t=function(t){return t.instance===e}:t=function(t){return t.instance.node===e};var n=this.allInstances.filter(t);return n.length?e.node?n[0]:n:e.node?null:[]},this.trigger=function(){var e=t(this,arguments),n=r.findInstanceInfo(this);n&&n.addTrigger(e)},this.on=function(n){var i=e.toArray(arguments,1),s=r.findInstanceInfo(this),o;if(s){o=n.apply(null,i),o&&(i[i.length-1]=o);var u=t(this,i);s.addBind(u)}},this.off=function(e,n,i){var s=t(this,arguments),o=r.findInstanceInfo(this);o&&o.removeBind(s)},this.teardown=function(){r.removeInstance(this)},this.withRegistration=function(){this.before("initialize",function(){r.addInstance(this)}),this.after("trigger",r.trigger),this.around("on",r.on),this.after("off",r.off),this.after("teardown",{obj:r,fnName:"teardown"})}}return new r}),define("flight/component",["./advice","./utils","./compose","./registry"],function(e,t,n,r){function i(e){e.events.slice().forEach(function(e){var t=[e.type];e.element&&t.unshift(e.element),typeof e.callback=="function"&&t.push(e.callback),this.off.apply(this,t)},e.instance)}function s(){i(r.findInstanceInfo(this)),this.trigger("componentTornDown")}function o(){var e=r.findComponentInfo(this);e&&e.instances.slice().forEach(function(e){e.instance.teardown()})}function u(){this.trigger=function(){var e,n,r,i=t.toArray(arguments);typeof i[i.length-1]!="string"&&(r=i.pop()),e=i.length==2?$(i.shift()):this.$node,n=i[0];if(window.DEBUG&&window.postMessage)try{window.postMessage(r,"*")}catch(s){throw console.log("unserializable data for event",n,":",r),new Error(["The event",event.type,"on component",this.describe,"was triggered with non-serializable data"].join(" "))}return typeof this.attr.eventData=="object"&&(r=$.extend(!0,{},this.attr.eventData,r)),e.trigger(n,r)},this.on=function(){var e,n,r,i,s=t.toArray(arguments);typeof s[s.length-1]=="object"?i=t.delegate(this.resolveDelegateRules(s.pop())):i=s.pop(),r=i&&i.bind(this),r.target=i,e=s.length==2?$(s.shift()):this.$node,n=s[0];if(typeof r=="undefined")throw new Error("Unable to bind to '"+n+"' because the given callback is undefined");return e.on(n,r),r},this.off=function(){var e,n,r,i=t.toArray(arguments);return typeof i[i.length-1]=="function"&&(r=i.pop()),e=i.length==2?$(i.shift()):this.$node,n=i[0],e.off(n,r)},this.resolveDelegateRules=function(e){var t={};return Object.keys(e).forEach(function(n){if(!this.attr.hasOwnProperty(n))throw new Error('Component "'+this.describe+'" wants to listen on "'+n+'" but no such attribute was defined.');t[this.attr[n]]=e[n]},this),t},this.defaultAttrs=function(e){t.push(this.defaults,e,!0)||(this.defaults=e)},this.select=function(e){return this.$node.find(this.attr[e])},this.initialize=$.noop,this.teardown=s}function a(e,t){if(!e)throw new Error("Component needs to be attachTo'd a jQuery object, native node or selector string");$(e).each(function(e,n){new this(n,t)}.bind(this))}function f(){function s(e,n){var r={},i=0;if(!e)throw new Error("Component needs a node");e.jquery?(this.node=e[0],this.$node=e):(this.node=e,this.$node=$(e)),this.describe=this.constructor.describe,this.bind=function(e){var n;if(e.uuid&&(n=r[e.uuid]))return n;var s=t.toArray(arguments,1);return s.unshift(this),n=e.bind.apply(e,s),n.target=e,e.uuid=i++,r[e.uuid]=n,n},this.attr=t.merge(this.defaults,n),this.initialize.call(this,n||{}),this.trigger("componentInitialized")}var i=t.toArray(arguments);return s.toString=function(){var e=i.map(function(e){if($.browser.msie){var t=e.toString().match(/function (.*?)\s?\(/);return t&&t[1]?t[1]:""}return e.name}).join(", ").replace(/\s\,/g,"");return e},s.describe=s.toString(),s.attachTo=a,s.teardownAll=o,i.unshift(u,e.withAdvice,r.withRegistration),n.mixin(s.prototype,i),s}return f.teardownAll=function(){r.components.slice().forEach(function(e){e.component.teardownAll()})},f}),define("data/with_client",[],function(){function e(){this.getClientByAccount=function(e){return TD.controller.clients.getClient(e.getKey())},this.getPreferredClient=function(e){return TD.controller.clients.getPreferredClient(e)},this.getTwitterClient=function(){return TD.controller.clients.getPreferredClient("twitter")},this.getClientsByService=function(e){return TD.controller.clients.getClientsByService(e)}}return e}),define("data/accounts",["flight/component","data/with_client"],function(e,t){function n(){this.sendAccounts=function(e){this.trigger(document,"dataAccountsForService",{accounts:e||[]})},this.getAccountsForService=function(e,t){this.ready?(this.accounts[t.service]=TD.storage.accountController.getAccountsForService(t.service),this.sendAccounts(this.accounts[t.service])):this.on(document,"TD.ready",this.tdReady.bind(this,e,t))},this.tdReady=function(e,t){this.ready=!0,t&&this.getAccountsForService(e,t)},this.updateDefaultTwitterClient=function(){this.trigger("dataTwitterClientChanged",{client:this.getTwitterClient()})},this.after("initialize",function(){this.accounts={},this.on(document,"uiNeedsAccountsForService",this.getAccountsForService),this.on(document,"TD.ready",this.tdReady),this.defaultAccountSubscription=$.subscribe("/storage/client/default_account_changed",this.updateDefaultTwitterClient.bind(this))}),this.before("teardown",function(){$.unsubscribe(this.defaultAccountSubscription)})}return e(n,t)}),define("data/column_manager",["flight/component"],function(e){var t=function(){this.deleteColumn=function(e,t){var n=t.columnId;n&&TD.controller.columnManager.deleteColumn(n)},this.moveColumn=function(e,t){var n=t.columnId,r=t.action;n&&r&&TD.controller.columnManager.move(n,r)},this.handleUiNeedsColumnOrder=function(e,t){var n=TD.controller.columnManager.getAllOrdered();this.trigger("dataColumnOrder",{columns:n})},this.after("initialize",function(){this.on(document,"uiDeleteColumnAction",this.deleteColumn),this.on(document,"uiMoveColumnAction",this.moveColumn),this.on(document,"uiNeedsColumnOrder",this.handleUiNeedsColumnOrder)})};return e(t)}),define("data/embed_timeline",["flight/component","data/with_client"],function(e,t){function n(){this.checkListSubscription=function(e,t,n){var r=_.uniqueId(),i={id:r,title:TD.i("Subscribe to this list?"),message:TD.i("To share this list, we need to subscribe you to it. Subscribe and share?"),okLabel:TD.i("OK"),cancelLabel:TD.i("Cancel")},s=function(){TD.util.openURL(t,n)},o=function(t,n){var i;if(n.id!==r)return;this.off(document,"uiConfirmationAction",o),n.result&&(i=this.getTwitterClient(),i.subscribeToList(e,s))},u=this.getTwitterClient().oauth.account.getKey(),a=TD.cache.lists.find(e,null,null,!1,u);a?s():(this.on(document,"uiConfirmationAction",o.bind(this)),this.trigger("uiShowConfirmationDialog",i))},this.openEmbedTimeline=function(e,t){var n="https://twitter.com/settings/widgets/new/",r={},i,s,o;if(t&&t.column&&t.column.isEmbeddable()){i=t.column.getFeeds()[0],s=i.getMetadata();switch(t.column.getColumnType()){case TD.util.columnUtils.columnMetaTypes.USERTWEETS:n+="user",r.user_id=s.id;break;case TD.util.columnUtils.columnMetaTypes.FAVORITES:n+="favorites",s.id?r.user_id=s.id:r.user_id=i.getAccountKey();break;case TD.util.columnUtils.columnMetaTypes.LIST:n+="list",r.list_id=s.listId,this.checkListSubscription(s.listId,n,r);return;case TD.util.columnUtils.columnMetaTypes.SEARCH:n+="search",s.baseQuery&&s.searchFilterData?(o=new TD.vo.SearchFilter(s.searchFilterData),r.query=[s.baseQuery,o.getQueryString()].join(" ").trim()):r.query=s.term}TD.util.openURL(n,r)}},this.after("initialize",function(){this.on(document,"uiEmbedTimelineAction",this.openEmbedTimeline)})}return e(n,t)}),define("data/embed_tweet",["flight/component","data/with_client"],function(e,t){function n(){this.handleEmbeddedTweetFactory=function(e){return function(t){t.request=e,this.trigger(document,"dataEmbeddedTweet",t)}},this.handleErrorFactory=function(e){return function(){var t={request:e};this.trigger(document,"dataEmbeddedTweetError",t)}},this.getEmbeddedTweet=function(e,t){if(t&&t.tweetID){var n=this.getTwitterClient();n.getEmbeddedTweet(t.tweetID,t.hideThread,t.hideMedia,t.maxWidth,this.handleEmbeddedTweetFactory(t).bind(this),this.handleErrorFactory(t).bind(this))}},this.after("initialize",function(){this.on(document,"uiNeedsEmbeddedTweet",this.getEmbeddedTweet)})}return e(n,t)}),define("util/with_version_comparator",[],function(){var e=function(){this.appSatisfiesVersionRequirements=function(e){var t=TD.version,n=e.split(" ");return _.all(n,function(e){var n=e.match(/[<=>]*/)[0],r=e.substr(n.length),i=[],s;return _.contains(n,">")?i.push(1):_.contains(n,"<")&&i.push(-1),(_.contains(n,"=")||n.length===0)&&i.push(0),s=TD.util.versionComparator(t,r),_.contains(i,s)})}};return e}),define("data/message_banner",["flight/component","util/with_version_comparator"],function(e,t){var n=function(){this.dismissMessage=function(e,t){var n=TD.settings.getIdsForSeenMessages();n.push(t.id),TD.settings.setIdsForSeenMessages(n)},this.satisfiesPlatformRequirements=function(e){if(e.target&&e.target.platform){var t=TD.util.getAppEnv();return _.include(e.target.platform,t)}return!0},this.satisfiesVersionRequirements=function(e){return e.target&&e.target.version?this.appSatisfiesVersionRequirements(e.target.version):!0},this.hasNotBeenDismissed=function(e){if(e.message){var t=TD.settings.getIdsForSeenMessages(),n=t.every(function(t){return e.message.id!==t});return n}return!1},this.handleMessages=function(e,t){var n=t.messages;n&&(n=n.filter(this.satisfiesPlatformRequirements,this),n=n.filter(this.satisfiesVersionRequirements,this),n=n.filter(this.hasNotBeenDismissed,this),n.length&&this.trigger("dataMessage",n[0]))},this.after("initialize",function(){this.on(document,"uiHidingMessageBanner",this.dismissMessage),this.on(document,"dataMessages",this.handleMessages)})};return e(n,t)}),define("data/preferred_account",["flight/component"],function(e){function t(){this.send=function(e){this.trigger(document,"dataPreferredAccount",{account:e})},this.getPreferredTwitterAccount=function(){this.ready&&this.send(TD.storage.accountController.getPreferredAccount("twitter"))},this.tdReady=function(){this.ready=!0,this.getPreferredTwitterAccount(),this.off(document,"TD.ready",this.tdReady)},this.after("initialize",function(){this.on(document,"uiNeedsPreferredAccount",this.getPreferredTwitterAccount),this.on(document,"TD.ready",this.tdReady),$.subscribe("/storage/account/new",this.getPreferredTwitterAccount.bind(this)),$.subscribe("/storage/client/default_account_changed",this.getPreferredTwitterAccount.bind(this))})}return e(t)}),define("data/relationship",["flight/component","data/with_client"],function(e,t){function n(){this.handleRelationship=function(e){this.trigger(document,"dataRelationship",e)},this.handleError=function(e){return function(){this.trigger(document,"dataRelationshipError",e)}},this.getRelationship=function(e,t){if(t&&t.account&&t.screenName){var n=this.getClientByAccount(t.account);n.showFriendship(t.account.getUserID(),null,t.screenName,this.handleRelationship.bind(this),this.handleError(t).bind(this))}},this.after("initialize",function(){this.on(document,"uiNeedsRelationship",this.getRelationship)})}return e(n,t)}),define("data/twitter_user",["flight/component"],function(e){function t(){this.getTwitterUser=function(e,t){var n;t&&(t.id?n=TD.cache.twitterUsers.getById(t.id):n=TD.cache.twitterUsers.getByScreenName(t.screenName),n.addCallbacks(this.handleTwitterUser,this.errorHandlerFactory(t.screenName),null,null,this,this))},this.errorHandlerFactory=function(e){var t=function(t){var n=t.req.errors,r=TD.i("Sorry, we couldn't retrieve user @{{1}}",{1:e}),i=!1;n&&n.forEach(function(e){e.twitterErrorCode===63?i=!0:e.message&&(r+=" - "+e.message)}),i||TD.controller.progressIndicator.addMessage(r),this.trigger("dataTwitterUserError",{screenName:e})};return t.bind(this)},this.handleTwitterUser=function(e){e&&e.account&&this.trigger(document,"dataTwitterUser",e)},this.after("initialize",function(){this.on(document,"uiNeedsTwitterUser",this.getTwitterUser)})}return e(t)}),define("data/user_actions",["flight/component","data/with_client"],function(e,t){var n=function(){this.defaultAttrs({actions:{follow:{userAction:"follow",errorEvent:"dataFollowActionError"},unfollow:{userAction:"unfollow",errorEvent:"dataUnfollowActionError"},block:{userAction:"block",errorEvent:"dataBlockActionError"},unblock:{userAction:"unblock",errorEvent:"dataUnblockActionError"},report:{userAction:"report",errorEvent:"dataReportActionError"}}}),this.error=function(e,t){return function(n){var r;r={request:t,response:n},this.trigger(document,e.errorEvent,r)}},this.success=function(e,t){return function(n){this.trigger("dataFollowStateChange",{action:e,request:t,response:n})}},this.takeAction=function(e,t,n){var r=!1,i=this.success(e,n).bind(this),s=this.error(e,n).bind(this),o=e.userAction;try{switch(o){case"block":n.twitterUser.block(n.account,!1,i,s,r);break;case"report":n.twitterUser.block(n.account,!0,i,s,r);break;case"unblock":n.twitterUser.unblock(n.account,i,s);break;case"follow":n.twitterUser.follow(n.account,i,s,r);break;case"unfollow":n.twitterUser.unfollow(n.account,i,s,r)}}catch(t){this.error()}},this.bindAction=function(e){return this.takeAction.bind(this,e)},this.after("initialize",function(){this.on(document,"uiFollowAction",this.bindAction(this.attr.actions.follow)),this.on(document,"uiUnfollowAction",this.bindAction(this.attr.actions.unfollow)),this.on(document,"uiBlockAction",this.bindAction(this.attr.actions.block)),this.on(document,"uiUnblockAction",this.bindAction(this.attr.actions.unblock)),this.on(document,"uiReportAction",this.bindAction(this.attr.actions.report))})};return e(n,t)}),define("data/settings",["flight/component"],function(e){function t(){this.after("initialize",function(){this.on(document,"uiNeedsSettings",this.handleUiNeedsSettings),this.on(document,"uiThemeChangeAction",this.handleUiThemeChange),this.on(document,"uiNavbarWidthChangeAction",this.handleNavbarWidthChange)}),this.handleUiNeedsSettings=function(){this.settings={theme:TD.settings.getTheme(),navbarWidth:TD.settings.getNavbarWidth()},this.trigger(document,"dataSettings",this.settings)},this.handleUiThemeChange=function(){var e=this.settings.theme;e==="light"?e="dark":e="light",TD.settings.setTheme(e),this.settings.theme=e,this.trigger(document,"dataSettings",this.settings)},this.handleNavbarWidthChange=function(e,t){TD.settings.setNavbarWidth(t.navbarWidth),this.settings.navbarWidth=t.navbarWidth,this.trigger(document,"dataSettings",this.settings)}}return e(t)}),define("data/stream_counter",["flight/component"],function(e){var t=function(){this.defaultAttrs({updatePeriod:500,aggregationPeriod:1e4}),this.updateStreamCount=function(e,t){this.streamCounter.incrementCounter(t.numStreamItems)},this.after("initialize",function(){this.on(document,"dataReceivedStreamData",this.updateStreamCount),this.streamCounter=new TD.util.TpmCounter(this.attr.updatePeriod,this.attr.aggregationPeriod,"dataStreamRate")})};return e(t)}),define("data/search",["flight/component","data/with_client"],function(e,t){function n(){this.handleResponseFactory=function(e,t){return function(n){this.trigger(document,e,{query:t,result:n})}.bind(this)},this.doUserSearch=function(e,t){var n=this.getPreferredClient("twitter"),r=t.query;n?n.userSearch(r,this.handleResponseFactory("dataUserSearch",r),this.handleResponseFactory("dataUserSearchError",r)):this.handleResponseFactory("dataUserSearchError",r)()},this.after("initialize",function(){this.on(document,"uiNeedsUserSearch",this.doUserSearch)})}return e(n,t)}),define("data/storage",["flight/component"],function(e){var t=function(){this.get=function(e,t){t.names?t.names.forEach(function(e){this.trigger(document,"dataStorageItem",{name:e,value:TD.storage.store.get(e)})},this):t.name&&this.trigger(document,"dataStorageItem",{name:t.name,value:TD.storage.store.get(name)})},this.set=function(e,t){for(var n in t)if(t.hasOwnProperty(n))try{TD.storage.store.nonCriticalSet(n,t[n])}catch(r){r.code===DOMException.QUOTA_EXCEEDED_ERR?this.trigger(document,"dataStorageFull",{name:n,value:t[n]}):this.trigger(document,"dataStorageSetError",{name:n,value:t[n]})}},this.after("initialize",function(){this.on("dataStorageSet",this.set),this.on("dataStorageGet",this.get)})};return e(t)}),define("data/recent_searches",["flight/component"],function(e){var t=function(){this.saveRecentSearch=function(e,t){TD.storage.clientController.client.addRecentSearch(t.query)},this.getRecentSearches=function(e){var t={recentSearches:TD.storage.clientController.client.getRecentSearches()};this.trigger("dataRecentSearches",t)},this.clearRecentSearches=function(e){TD.storage.clientController.client.clearRecentSearches()},this.after("initialize",function(){this.on(document,"uiSearch",this.saveRecentSearch),this.on(document,"uiRecentSearchClearAction",this.clearRecentSearches),this.on(document,"uiNeedsRecentSearches",this.getRecentSearches)})};return e(t)}),define("data/typeahead/with_users_datasource",[],function(){function e(e){this.defaultAttrs({usersStorageLimit:2500,storageUserHash:"typeaheadUserHash",storageUserLastPrefetch:"typeaheadUserLastPrefetch"}),this.tokenize=function(e){return e.trim().toLowerCase().split(TD.constants.regexps.tokenSeparator)},this.overwriteUserdata=function(e){this.userHash={},this.userAdjacencyList={},this.processUserData(e)},this.processUserData=function(e){_.each(e,function(e){e.tokens=e.tokens.map(function(e){return e=typeof e=="string"?e:e.token,e.toLowerCase()}),delete e.location,delete e.connecting_user_ids,this.userHash[e.id]=e,e.tokens.forEach(function(t){var n=t.charAt(0);this.userAdjacencyList[n]===undefined&&(this.userAdjacencyList[n]=[]),this.userAdjacencyList[n].indexOf(e.id)===-1&&this.userAdjacencyList[n].push(e.id)},this)},this);var t={};t[this.attr.storageUserHash]=this.userHash,this.trigger("dataStorageSet",t)},this.processPrefetchUserData=function(e){this.processUserData(e.users);var t={};t[this.attr.storageUserLastPrefetch]=Date.now(),this.trigger("dataStorageSet",t)},this.prefetchUserSuggestions=function(){var e=this.getTwitterClient();e&&e.typeaheadSearch({prefetch:!0,count:this.attr.usersStorageLimit},this.processPrefetchUserData.bind(this),this.handleGetSuggestionsError.bind(this))},this.pruneUsers=function(){var e=_.values(this.userHash);e.sort(this.userSortComparator),e=e.slice(0,Math.floor(e.length/2)),this.overwriteUserdata(e)},this.getUserSuggestions=function(e){var t,n,r,i=[],s=e.datasources.some(function(e){return e==="users"});return e.datasources&&s&&(t=this.tokenize(e.query),n=this.getPotentiallyMatchingUserIds(t),r=this.getUsersFromIds(n),i=r.filter(this.matchUsers(t)),i.sort(this.userSortComparator),i=i.slice(0,this.attr.limit)),i},this.getPotentiallyMatchingUserIds=function(e){var t=[];return e.map(function(e){var n=this.userAdjacencyList[e.charAt(0)];n&&(t=t.concat(n))},this),t=_.uniq(t),t},this.getUsersFromIds=function(e){var t=[];return e.forEach(function(e){var n=this.userHash[e];n&&!this.isUserBlocked(e)&&t.push(n)},this),t},this.matchUsers=function(e){return function(t){var n=t.tokens,r=e.every(function(e){var t=n.filter(function(t){return t.indexOf(e)===0});return t.length});if(r)return t}},this.userSortComparator=function(e,t){var n=e.rounded_graph_weight!==0,r=t.rounded_graph_weight!==0;return n&&!r?-1:r&&!n?1:n&&r?t.rounded_graph_weight-e.rounded_graph_weight:t.rounded_score-e.rounded_score},this.isUserBlocked=function(e){return this.blockedUserIds[e]?!0:!1},this.processUserStorageItem=function(e,t){switch(t.name){case this.attr.storageUserHash:this.processUserData(t.value);break;case this.attr.storageUserLastPrefetch:(typeof t.value!="number"||Date.now()-t.value>TD.constants.DAY_IN_MS)&&this.prefetchUserSuggestions();break;default:}},this.loadUserData=function(){this.trigger("dataStorageGet",{names:[this.attr.storageUserHash,this.attr.storageUserLastPrefetch]});var e=this.getTwitterClient();e&&(this.blockedUserIds=e.blocks)},this.resetUserData=function(e,t){t.client&&(this.overwriteUserdata([]),this.blockedUserIds=t.client.blocks,this.prefetchUserSuggestions())},this.after("initialize",function(){this.userAdjacencyList={},this.userHash={},this.blockedUserIds={},this.datasources=this.datasources||{},this.datasources.users={processData:this.processUserData.bind(this),getSuggestions:this.getUserSuggestions.bind(this)},this.on(document,"dataStorageItem",this.processUserStorageItem),this.on(document,"TD.ready",this.loadUserData),this.on(document,"dataTwitterClientChanged",this.resetUserData),this.on(document,"dataStorageFull",this.pruneUsers)})}return e}),define("data/typeahead/with_topics_datasource",[],function(){var e=function(){this.defaultAttrs({storageTopicsHash:"typeaheadTopicsHash",storageTopicsLastPrefetch:"typeaheadTopicsLastPrefetch"}),this.topicSortComparator=function(e,t){return t.rounded_score-e.rounded_score},this.overwriteTopics=function(e){this.topicsHash={},this.topicsAdjacencyList={},this.processTopicData(e)},this.processTopicData=function(e){_.each(e,function(e){var t=e.topic;this.topicsHash[t]=e,e.tokens.forEach(function(e){var n=e.token.charAt(0).toLowerCase(),r=this.topicsAdjacencyList[n]||[];r.indexOf(t)===-1&&r.push(t),this.topicsAdjacencyList[n]=r},this)},this);var t={};t[this.attr.storageTopicsHash]=this.topicsHash,this.trigger("dataStorageSet",t)},this.processPrefetchTopicData=function(e){this.processTopicData(e.topics),this.topicsLastPrefetch=Date.now();var t={};t[this.attr.storageTopicsLastPrefetch]=this.topicsLastPrefetch,this.trigger("dataStorageSet",t)},this.pruneTopics=function(){var e=_.values(this.topicsHash);e.sort(this.topicSortComparator),e=e.slice(0,Math.floor(e.length/2)),this.overwriteTopics(e)},this.getTopicSuggestions=function(e){var t=e.query.toLowerCase(),n=this.topicsAdjacencyList[t.charAt(0)]||[],r=n.filter(function(e){return e.toLowerCase().indexOf(t)===0},this);return r=this.getTopicObjectsFromStrings(r),r.sort(this.topicSortComparator),r=r.slice(0,this.attr.limit),r},this.getTopicObjectsFromStrings=function(e){var t=[];return e.forEach(function(e){var n=this.topicsHash[e];n&&t.push(n)},this),t},this.prefetchTopicsSuggestions=function(){var e=this.getTwitterClient();e.typeaheadSearch({query:"",prefetch:!0,limit:200,datasources:["topics"]},this.processPrefetchTopicData.bind(this),this.handleGetSuggestionsError.bind(this))},this.processTopicStorageItem=function(e,t){switch(t.name){case this.attr.storageTopicsHash:this.processTopicData(t.value);break;case this.attr.storageTopicsLastPrefetch:this.topicsLastPrefetch=t.value,(!this.topicsLastPrefetch||Date.now()-this.topicsLastPrefetch>TD.constants.time.oneDay)&&this.prefetchTopicsSuggestions();break;default:}},this.loadTopicsData=function(){this.trigger("dataStorageGet",{names:[this.attr.storageTopicsHash,this.attr.storageTopicsLastPrefetch]})},this.resetTopicData=function(e,t){t.client&&(this.overwriteTopics([]),this.prefetchTopicsSuggestions())},this.after("initialize",function(){this.topicsHash={},this.topicsAdjacencyList={},this.datasources=this.datasources||{},this.datasources.topics={getSuggestions:this.getTopicSuggestions.bind(this),processData:this.processTopicData.bind(this)},this.on(document,"dataStorageItem",this.processTopicStorageItem),this.on(document,"TD.ready",this.loadTopicsData),this.on(document,"dataTwitterClientChanged",this.resetTopicData),this.on(document,"dataStorageFull",this.pruneTopics)})};return e}),define("data/typeahead/with_recent_searches_datasource",[],function(){var e=function(){this.tokenize=function(e){return e.trim().toLowerCase().split(TD.constants.regexps.tokenSeparator)},this.getRecentSearchSuggestions=function(e){var t=e.datasources&&e.datasources.some(function(e){return e==="recentSearches"}),n=t&&e.datasources.length===1,r;n?r=this.attr.recentSearchOnlyLimit:r=this.attr.limit;if(!t)return[];var i=[];this.trigger("uiNeedsRecentSearches");if(!this.recentSearches)return i;var s=this.recentSearches,o=this.tokenize(e.query);return s.some(function(e){var t=this.tokenize(e),n=this.recentSearchMatchesQuery(t,o);return n&&i.push(e),i.length===r},this),i},this.recentSearchMatchesQuery=function(e,t){var n=t.every(function(t){return e.some(function(e){return e.indexOf(t)===0})});return n},this.handleRecentSearches=function(e,t){t&&t.recentSearches&&(this.recentSearches=t.recentSearches)},this.processRecentSearchData=function(){},this.after("initialize",function(){this.datasources=this.datasources||{},this.datasources.recentSearches={getSuggestions:this.getRecentSearchSuggestions.bind(this),processData:this.processRecentSearchData.bind(this)},this.on(document,"dataRecentSearches",this.handleRecentSearches)})};return e}),define("data/typeahead/with_saved_searches_datasource",[],function(){var e=function(){this.tokenize=function(e){return e.trim().toLowerCase().split(TD.constants.regexps.tokenSeparator)},this.savedSearchesComparator=function(e,t){var n=e.query.toLowerCase(),r=t.query.toLowerCase();return(n>r)-(n<r)},this.updateSavedSearches=function(){var e=Date.now()-TD.constants.time.oneHour;if(!this.savedSearchesLastFetch||this.savedSearchesLastFetch<e){var t=this.getClientsByService("twitter");this.savedSearches=[],t.forEach(function(e){this.savedSearches=this.savedSearches.concat(e.searches)},this),this.savedSearchesLastFetch=Date.now()}},this.getSavedSearchSuggestions=function(e){if(e.query.trim()==="")return[];var t=e.datasources&&e.datasources.some(function(e){return e==="savedSearches"});if(!t)return[];var n=[],r=this.tokenize(e.query);return this.updateSavedSearches(),this.savedSearches.forEach(function(e){var t=this.tokenize(e.query),i=this.savedSearchMatchesQuery(t,r);i&&n.push(e)},this),n.sort(this.savedSearchesComparator),n.splice(this.attr.limit),n},this.savedSearchMatchesQuery=function(e,t){return t.every(function(t){return e.some(function(e){return e.indexOf(t)===0})})},this.processSavedSearchData=function(){},this.after("initialize",function(){this.savedSearches=[],this.savedSearchesLastFetch=!1,this.datasources=this.datasources||{},this.datasources.savedSearches={getSuggestions:this.getSavedSearchSuggestions.bind(this),processData:this.processSavedSearchData.bind(this)}})};return e}),define("data/typeahead/with_lists_datasource",[],function(){var e=function(){this.getListSuggestions=function(e){var t=[],n=e.query.trim().toLowerCase();return!e.datasources||e.datasources.indexOf("lists")===-1?t:(this.trigger("uiNeedsSubscribedLists"),this.lists?(this.lists.some(function(e){var r=e.toLowerCase().indexOf(n)!==-1;return r&&t.push(e),t.length===this.attr.limit},this),t):t)},this.handleSubscribedLists=function(e,t){t&&t.lists&&(this.lists=t.lists.map(function(e){return e.fullName}))},this.processListData=function(){},this.after("initialize",function(){this.datasources=this.datasources||{},this.datasources.lists={getSuggestions:this.getListSuggestions.bind(this),processData:this.processListData.bind(this)},this.on(document,"dataSubscribedLists",this.handleSubscribedLists)})};return e}),define("data/typeahead",["flight/component","data/with_client","data/typeahead/with_users_datasource","data/typeahead/with_topics_datasource","data/typeahead/with_recent_searches_datasource","data/typeahead/with_saved_searches_datasource","data/typeahead/with_lists_datasource"],function(e,t,n,r,i,s,o){var u=function(){this.defaultAttrs({limit:6,recentSearchOnlyLimit:10,queryCollationPeriod:150}),this.sendSuggestions=function(){this.trigger("dataTypeaheadSuggestions",{query:this.currentRequest.query,suggestions:this.dedupeSuggestions(this.suggestions),datasources:this.currentRequest.datasources,dropdownId:this.currentRequest.dropdownId})},this.dedupeSuggestions=function(e){var t={};return e=_.clone(e),e.recentSearches=this.dedupeArray(e.recentSearches,null,t),e.savedSearches=this.dedupeArray(e.savedSearches,"query",t),e.topics=this.dedupeArray(e.topics,"topic",t),e},this.dedupeArray=function(e,t,n){return!e||e.length===0?e:_.filter(e,function(e){var r=t?e[t]:e,i=r.toLowerCase(),s=!n[i];return n[i]=!0,s})},this.processTypeaheadData=function(e,t){t.query===this.currentRequest.query&&(t.datasources.forEach(function(t){this.datasources[t]&&e[t]&&(this.datasources[t].processData(e[t]),this.suggestions[t]=this.datasources[t].getSuggestions(this.currentRequest))},this),this.sendSuggestions())},this.handleGetSuggestionsError=function(){this.trigger("dataTypeaheadSuggestionsError")},this._getRemoteSuggestions=function(){var e=this.getTwitterClient();this.currentRequest.query&&this.currentRequest.query.trim()!==""&&e!==undefined&&e.typeaheadSearch(this.currentRequest,this.processTypeaheadData.bind(this),this.handleGetSuggestionsError.bind(this))},this.getSuggestions=function(e,t){t.query!==this.currentRequest.query&&(this.currentRequest={query:t.query,datasources:t.datasources,count:this.attr.limit,dropdownId:t.dropdownId},this.suggestions={},this.updateSuggestions(),t.onlyLocalData||this.getRemoteSuggestions())},this.updateSuggestions=function(){if(!this.currentRequest||!this.currentRequest.datasources)return;this.currentRequest.datasources.forEach(function(e){if(this.datasources[e]){var t=this.datasources[e].getSuggestions(this.currentRequest);t&&t.length>0&&(this.suggestions[e]=t)}},this),this.sendSuggestions()},this.queryReset=function(){this.currentRequest={}},this.after("initialize",function(){this.currentRequest={},this.datasources={},this.suggestions={},this.getRemoteSuggestions=_.debounce(this._getRemoteSuggestions.bind(this),this.attr.queryCollationPeriod),this.on("uiNeedsTypeaheadSuggestions",this.getSuggestions),this.on("uiRecentSearchClearAction",this.updateSuggestions),this.on("dataTypeaheadQueryReset",this.queryReset)})};return e(u,t,n,r,i,s,o)}),define("data/user_profile_social_proof",["flight/component","data/with_client"],function(e,t){function n(){this.handleUserProfileSocialProofFactory=function(e){return function(t){t.request=e,this.trigger(document,"dataUserProfileSocialProof",t)}},this.handleErrorFactory=function(e){return function(){var t={request:e};this.trigger(document,"dataUserProfileSocialProofError",t)}},this.getUserProfileSocialProofData=function(e,t){if(t&&t.screenName){var n=this.getTwitterClient();n.getFollowingFollowersOf(t.screenName,this.handleUserProfileSocialProofFactory(t).bind(this),this.handleErrorFactory(t).bind(this))}},this.after("initialize",function(){this.on(document,"uiNeedsUserProfileSocialProof",this.getUserProfileSocialProofData)})}return e(n,t)}),define("data/twitter_users",["flight/component","data/with_client"],function(e,t){var n=function(){this.handleTwitterUsersFactory=function(e){var t=function(t){this.trigger("dataTwitterUsers",{requestId:e,users:t})};return t.bind(this)},this.handleTwitterUsersErrorFactory=function(e){var t=function(){this.trigger("dataTwitterUsersError",{requestId:e})};return t.bind(this)},this.getTwitterUsers=function(e,t){this.twitterClient=this.twitterClient||this.getTwitterClient(),this.twitterClient.getUsersByIds(t.userIds,this.handleTwitterUsersFactory(t.requestId),this.handleTwitterUsersErrorFactory(t.requestId))},this.after("initialize",function(){this.on("uiNeedsTwitterUsers",this.getTwitterUsers)})};return e(n,t)}),define("data/lists",["flight/component"],function(e){var t=function(){this.getLists=function(e){var t=TD.cache.lists.getAll();this.trigger(document,"dataSubscribedLists",{lists:t})},this.after("initialize",function(){this.on(document,"uiNeedsSubscribedLists",this.getLists)})};return e(t)}),define("data/account",["flight/component"],function(e){var t=function(){this.handleReauthorizeTwitterAccount=function(e,t){TD.controller.clients.addClient("twitter",t.account,!0)},this.handleRemoveTwitterAccount=function(e,t){TD.controller.clients.removeClient(t.key)},this.after("initialize",function(){this.on(document,"uiRemoveTwitterAccount",this.handleRemoveTwitterAccount),this.on(document,"uiReauthorizeTwitterAccount",this.handleReauthorizeTwitterAccount)})};return e(t)}),define("ui/with_key_handler",[],function(){function e(){this.activeSequences={},this.sequenceStarters={},this.singleKeys={},this.combos={},this.defaultAttrs({charCodes:{esc:27,ret:13,del:46,left:37,up:38,right:39,down:40,bksp:8,pageup:33,pagedown:34,home:36,end:35},defaultKeyEvent:"keypress",keySequenceTimeoutDelay:1e3,modifiers:{ctrl:"ctrlKey",alt:"altKey",cmd:"metaKey",shift:"shiftKey"}}),this.getShortcutForEvent=function(e){var t=e.which,n;return this.eventHasModifier(e)&&(n=this.combos[t]),!n&&!this.eventHasFunctionModifier(e)&&(n=this.activeSequences[t]||this.singleKeys[t]||this.sequenceStarters[t]),n},this.clearActiveSequences=function(){this.activeSequences={}},this.eventHasModifier=function(e){return e.ctrlKey||e.altKey||e.metaKey||e.shiftKey},this.eventHasFunctionModifier=function(e){return e.ctrlKey||e.metaKey},this.eventHasTextModifier=function(e){return e.altKey||e.shiftKey},this.getModifiedKeyEvent=function(e,t){var n;return this.eventHasModifier(e)&&t.modifiers&&_.each(t.modifiers,function(t,r){e[r]&&(n=t)},this),n},this.handleKeyPress=function(e){var t,n=[],r=":not(input):not(textarea)";e.which>=65&&e.which<=90&&(e.which+=32),t=this.getShortcutForEvent(e),t?t.sequences?(_.each(t.sequences,function(e,t){this.addSequenceEnd(t,e)},this),setTimeout(function(){this.clearActiveSequences()}.bind(this),this.attr.keySequenceTimeoutDelay)):(n=t.shortcuts||[t],n=n.map(function(t){return t.modifiers&&(t=this.getModifiedKeyEvent(e,t)),t},this),n=n.filter(function(e){return e!==undefined}),n.forEach(function(t){var n=t.selector||r;$(e.target).is(n)&&t.callback(e,t.data)}),this.clearActiveSequences()):this.clearActiveSequences()},this.getCharCodeForKey=function(e){var t,n=!1,r=[[32,64],[91,126]];if(typeof e!="string")throw"Key must be a string";return e=e.toLowerCase(),e.length===1?(t=e.charCodeAt(0),r.forEach(function(e){if(t>=e[0]&&t<=e[1])return n=!0,!1}),n||(t=undefined)):t=this.attr.charCodes[e],t},this.addSingleKey=function(e,t,n,r){var i;if(typeof t!="function")throw"addSingleKey: no callback";i=this.getCharCodeForKey(e);if(i===undefined)throw"addSingleKey: invalid key string";if(this.singleKeys[i]){var s=this.singleKeys[i].shortcuts.every(function(e){return t!==e.callback||n!==e.selector},this);if(!s)throw"addSingleKey: attempted to add identical shortcut"}else this.singleKeys[i]={shortcuts:[]};this.singleKeys[i].shortcuts.push({shortcut:e,callback:t,selector:n,data:r})},this.addSequence=function(e,t,n,r){var i,s,o;if(typeof t!="function")throw"addSequence: no callback";if(typeof e!="string")throw"addSequence: sequence must be a string";i=e.split(" ");if(i.length!==2)throw'addSequence: sequence should be in format "g a"';s=this.getCharCodeForKey(i[0]);if(s===undefined)throw'addSequence: sequence should be in format "g a"';o=this.getCharCodeForKey(i[1]);if(o===undefined)throw'addSequence: sequence should be in format "g a"';this.sequenceStarters[s]||(this.sequenceStarters[s]={sequences:{}}),this.sequenceStarters[s].sequences[i[1]]={shortcut:e,callback:t,selector:n,data:r}},this.addSequenceEnd=function(e,t){var n;if(typeof t.callback!="function")throw"addSequenceEnd: no callback";if(typeof e!="string")throw"addSequenceEnd: invalid shortcut key";n=this.getCharCodeForKey(e);if(n===undefined)throw"addSequenceEnd: invalid shortcut key";this.activeSequences[n]={shortcut:t.shortcut,callback:t.callback,selector:t.selector,data:t.data}},this.addCombo=function(e,t,n,r){var i,s,o;if(typeof t!="function")throw"addCombo: no callback";if(typeof e!="string")throw"addCombo: invalid combo string";i=e.split("+");if(i.length!==2)throw"addCombo: invalid combo";s=this.attr.modifiers[i[0].toLowerCase()];if(s===undefined)throw"addCombo: invalid modifier";o=this.getCharCodeForKey(i[1]);if(o===undefined)throw"addCombo: invalid shortcut key";var u={modifiers:{}};u.modifiers[s]={shortcut:e,callback:t,selector:n,data:r},this.combos[o]||(this.combos[o]={shortcuts:[]}),this.combos[o].shortcuts.push(u)},this.isSequence=function(e){return typeof e=="string"&&e.indexOf(" ")>0},this.isCombo=function(e){return typeof e=="string"&&e.indexOf("+")>0},this.addShortcut=function(e,t,n,r){arguments.length===3&&typeof n!="string"&&(r=n,n=undefined),this.isCombo(e)?this.addCombo(e,t,n,r):this.isSequence(e)?this.addSequence(e,t,n,r):this.addSingleKey(e,t,n,r)},this.removeSingleKey=function(e){var t=this.getCharCodeForKey(e);this.singleKeys[t]&&delete this.singleKeys[t]},this.removeCombo=function(e){var t=this.getCharCodeForKey(e.split("+")[1]);this.combos[t]&&delete this.combos[t]},this.removeSequence=function(e){var t=this.getCharCodeForKey(e.split(" ")[0]);this.sequenceStarters[t]&&delete this.sequenceStarters[t]},this.removeShortcut=function(e){this.isCombo(e)?this.removeCombo(e):this.isSequence(e)?this.removeSequence(e):this.removeSingleKey(e)},this.handleKeyDown=function(e){var t=[this.attr.charCodes.del,this.attr.charCodes.bksp,this.attr.charCodes.esc,this.attr.charCodes.ret,this.attr.charCodes.left,this.attr.charCodes.right,this.attr.charCodes.up,this.attr.charCodes.down,this.attr.charCodes.pagedown,this.attr.charCodes.pageup,this.attr.charCodes.home,this.attr.charCodes.end],n=t.some(function(t){return t===e.which});n&&this.handleKeyPress(e)},this.after("initialize",function(){this.on(window,"keypress",this.handleKeyPress),this.on(window,"keydown",this.handleKeyDown)})}return e}),define("ui/keyboard_shortcuts",["flight/component","ui/with_key_handler"],function(e,t){var n=function(){this.defaultAttrs({shortcuts:{esc:[{event:"uiInputBlur",selector:"input, textarea"},{event:"uiCloseModal"},{event:"uiCloseDropdown"},{event:"uiTypeaheadFocusIfActive"},{event:"uiGridClearSelection"}],"CMD+ret":[{event:"uiSendRetweetAction"},{event:"uiSendTweetAction",selector:".js-compose-input"}],"CTRL+ret":[{event:"uiSendRetweetAction"},{event:"uiSendTweetAction",selector:".js-compose-input"}],del:[{event:"uiGridBack"}],bksp:[{event:"uiGridBack"}],ret:[{event:"uiGridShowDetail"}],n:[{event:"uiShowCompose"}],"/":[{event:"uiAppSearchFocus"}],s:[{event:"uiAppSearchFocus"}],a:[{event:"uiShowAddColumn"}],x:[{event:"uiToggleNavbarWidth"}],"?":[{event:"uiShowKeyboardShortcutList"}],left:[{event:"uiGridLeft",throttle:!0}],h:[{event:"uiGridLeft",throttle:!0}],right:[{event:"uiGridRight",throttle:!0}],l:[{event:"uiGridRight",throttle:!0}],up:[{event:"uiGridUp",throttle:!0}],k:[{event:"uiGridUp",throttle:!0}],down:[{event:"uiGridDown",throttle:!0}],j:[{event:"uiGridDown",throttle:!0}],r:[{event:"uiGridReply"}],f:[{event:"uiGridFavorite"}],t:[{event:"uiGridRetweet"}],d:[{event:"uiGridDirectMessage"}],m:[{event:"uiGridDirectMessage"}],p:[{event:"uiGridProfile"}]," ":[{event:"uiGridPageDown",throttle:!0}],"SHIFT+ ":[{event:"uiGridPageUp",throttle:!0}],pageup:[{event:"uiGridPageUp",throttle:!0}],pagedown:[{event:"uiGridPageDown",throttle:!0}],home:[{event:"uiGridHome",throttle:!0}],end:[{event:"uiGridEnd",throttle:!0}]}}),this.blurInput=function(e,t){$(e.target).blur()},this.shortcutEventHandlerFactory=function(e){var t,n,r=function(t){t.preventDefault(),t.stopPropagation(),this.trigger(t.target,e.event)}.bind(this);return e.throttle?(t=_.throttle(r,100),t):(n=_.debounce(r,200,!0),n)},this.columnFocusFactory=function(e){return function(t){t.preventDefault(),t.stopPropagation(),e===0?this.trigger("uiColumnFocus",{last:!0}):this.trigger("uiColumnFocus",{index:e-1})}.bind(this)},this.after("initialize",function(){this.on(document,"uiInputBlur",this.blurInput);for(var e=0;e<10;e++)this.addShortcut(e+"",this.columnFocusFactory(e));_.each(this.attr.shortcuts,function(e,t){e.forEach(function(e){var n=this.shortcutEventHandlerFactory(e);this.addShortcut(t,n,e.selector)},this)},this)})};return e(n,t)}),define("ui/with_template",[],function(){function e(){this.render=function(e,t){this.$node.html(this.toHtml(e,t))},this.renderTemplate=function(e,t){return $(TD.ui.template.render(e,t))},this.toHtml=function(e,t){return TD.ui.template.render(e,t)},this.toHtmlFromRaw=function(e,t){var n=Hogan.compile(e);return n.render(t)}}return e}),define("ui/message_banner",["flight/component","ui/with_template"],function(e,t){var n=function(){this.defaultAttrs({dismissButton:".js-dismiss",actions:{triggerEvent:"trigger-event",dismiss:"dismiss",openUrl:"url-ext"},buttonClasses:{"trigger-event":"btn-positive","url-ext":"btn-positive",dismiss:"btn-alt"}}),this.eventHandlerFactory=function(e){return function(){switch(e.action){case"trigger-event":this.trigger(e.event.type,e.event.data);break;case"url-ext":case"dismiss":}this.trigger("uiClickMessageButtonAction",{messageId:this.message.id,actionId:e.id}),this.hide()}.bind(this)},this.dismiss=function(){this.trigger("uiDismissMessageAction",this.message),this.hide()},this.hide=function(){window.clearInterval(this.resizeBannerCheckInterval),this.trigger("uiHidingMessageBanner",this.message),this.message=null},this.handleMessageData=function(e,t){if(this.message&&this.message.id==t.message.id)return;this.message=t.message,this.showMessage()},this.handleMessageContainerHidden=function(){this.$node.addClass("is-hidden")},this.showMessage=function(){this.trigger("uiShowMessageBanner",this.message);var e,t,n={text:this.message.text,actions:[]},r;for(t=0;this.message.actions&&t<this.message.actions.length;t++){e=this.message.actions[t],r=e.class;switch(e.action){case this.attr.actions.openUrl:n.actions.push({label:e.label,action:e.action,actionId:e.id,url:e.url,isExternalUrl:!0,boundEventHandler:this.eventHandlerFactory(e),buttonClass:r||this.attr.buttonClasses[e.action]});break;case this.attr.actions.triggerEvent:n.actions.push({label:e.label,action:e.action,actionId:e.id,boundEventHandler:this.eventHandlerFactory(e),buttonClass:r||this.attr.buttonClasses[e.action]});break;case this.attr.actions.dismiss:n.actions.push({label:e.label,action:e.action,actionId:e.id,boundEventHandler:this.eventHandlerFactory(e),buttonClass:r||this.attr.buttonClasses[e.action]});break;default:}}this.render("topbar/message_banner",n),this.message.colors&&this.$node.css({"background-color":this.message.colors.background,color:this.message.colors.foreground}),this.on(this.select("dismissButton"),"click",this.dismiss),n.actions.forEach(function(e){this.on('[data-action-id="'+e.actionId+'"]',"click",e.boundEventHandler)}.bind(this)),this.resizeBannerCheckInterval=window.setInterval(function(){this.currentBannerHeight&&this.currentBannerHeight!==this.$node.outerHeight()&&this.trigger("uiMessageBannerResized"),this.currentBannerHeight=this.$node.outerHeight()}.bind(this),200),this.$node.removeClass("is-hidden"),this.trigger("uiMessageBannerShown",this.message)},this.after("initialize",function(){this.on(document,"dataMessage",this.handleMessageData),this.on(document,"uiMessageBannerContainerHidden",this.handleMessageContainerHidden)})};return e(n,t)}),define("ui/search_input",["flight/component"],function(e){var t=function(){this.defaultAttrs({clearButtonSelector:".js-clear-search",textInputSelector:'input[type="text"]',hasValueClass:"has-value",isWaitingForResponseClass:"is-waiting-for-response"}),this.handleClearAction=function(){this.$textInput.val(""),this.$node.removeClass(this.attr.hasValueClass),this.$textInput.trigger("change")},this.handleAsyncFormReceivedResponse=function(){var e=this.$textInput.val();this.$node.removeClass(this.attr.isWaitingForResponseClass),e!==""?this.$node.addClass(this.attr.hasValueClass):this.$node.removeClass(this.attr.hasValueClass),this.value=e},this.handleAsyncFormWaitingForResponse=function(){var e=this.$textInput.val();this.value!==undefined&&this.value!==e&&this.$node.addClass(this.attr.isWaitingForResponseClass),this.value=e},this.after("initialize",function(){this.$textInput=this.select("textInputSelector"),this.value=this.$textInput.val().trim(),this.value!==""&&this.$node.addClass(this.attr.hasValueClass),this.on("click",{clearButtonSelector:this.handleClearAction}),this.on("uiAsyncFormWaitingForResponse",this.handleAsyncFormWaitingForResponse),this.on("uiAsyncFormReceivedResponse",this.handleAsyncFormReceivedResponse),this.on("uiSearchInputDestroy",this.teardown)})};return e(t)}),define("ui/asynchronous_form",["flight/component","ui/search_input"],function(e,t){var n=function(){this.defaultAttrs({searchControlSelector:".js-search-input-control"}),this.waitingForAsyncResponse=function(e,t){this.trigger(this.$searchControls,"uiAsyncFormWaitingForResponse")},this.receivedAsyncResponse=function(e,t){this.trigger(this.$searchControls,"uiAsyncFormReceivedResponse")},this.handleSearchInputCleared=function(){this.$node.closest("form").submit()},this.destroy=function(e,t){this.teardown()},this.before("teardown",function(){this.trigger(this.$searchControls,"uiSearchInputDestroy")}),this.after("initialize",function(e){this.on("uiReceivedAsyncResponse",this.receivedAsyncResponse),this.on("uiWaitingForAsyncResponse",this.waitingForAsyncResponse),this.on("uiDestroyAsynchronousForm",this.destroy),this.on("uiSearchInputCleared",this.handleSearchInputCleared),this.$searchControls=this.select("searchControlSelector"),t.attachTo(this.$searchControls)})};return e(n)}),define("ui/app_search",["flight/component","ui/asynchronous_form"],function(e,t){function n(){this.defaultAttrs({sourceId:"appSearch",appSearchInputSelector:".js-app-search-input",searchButtonSelector:".js-perform-search",clearButtonSelector:".js-clear-search",KEY_CODE_MAP:{13:{name:"ENTER",event:"uiSearchInputSubmit",on:"keypress",preventDefault:!0},27:{name:"ESC",event:"uiSearchInputEscaped",on:"keydown"},9:{name:"TAB",event:"uiSearchInputTab",on:"keydown",preventDefault:!0},37:{name:"LEFT",event:"uiSearchInputLeft",on:"keydown"},39:{name:"RIGHT",event:"uiSearchInputRight",on:"keydown"},38:{name:"UP",event:"uiSearchInputMoveUp",on:"keydown",preventDefault:!0},40:{name:"DOWN",event:"uiSearchInputMoveDown",on:"keydown",preventDefault:!0}}}),this.after("initialize",function(){t.attachTo(this.$node,{source:"appSearch"}),this.$input=this.select("appSearchInputSelector"),this.on(this.$input,"keyup keydown keypress paste",this.modifierKeyPressed),this.on(this.$input,"focus",this.handleFocus),this.on(this.$input,"uiInputBlur",function(e){this.$input.blur()}),this.on(this.$input,"click",function(e){e.stopPropagation()}),this.on(this.select("searchButtonSelector"),"click",function(e){this.trigger(this.$input,"uiSearchInputSubmit",{query:this.$input.val()})}),this.on(this.select("clearButtonSelector"),"click",this.handleClearSearchAction),this.on("uiAppSearchSetPreventDefault",this.setPreventKeyDefault),this.on("uiAppSearchItemComplete",this.completeInput),this.on("uiAppSearchSubmit",this.handleAppSearchSubmit),this.on(document,"uiNewSearchQuery uiSearchInputChanged",this.handleSearchInputChanged)}),this.handleSearchInputChanged=function(e,t){t.source!==this.attr.sourceId&&(this.$input.val(t.query),this.currentQuery=t.query)},this.handleAppSearchSubmit=function(e,t){this.completeInput(e,t),this.trigger(this.$input,"uiSearchInputSubmit",{query:this.$input.val()})},this.around("trigger",function(){var e=[].slice.call(arguments),t=e.shift(),n;typeof e[e.length-1]!="string"&&(n=e.pop()),n===undefined?n={source:this.attr.sourceId}:n.source=this.attr.sourceId,e.push(n),t.apply(this,e)}),this.setPreventKeyDefault=function(e,t){this.attr.KEY_CODE_MAP[t.key].preventDefault=t.preventDefault},this.handleFocus=function(e){_.defer(this.$input.select.bind(this.$input)),this.trigger(this.$input,"uiSearchInputFocus",{query:this.$input.val()})},this.modifierKeyPressed=function(e){var t=this.$input.val();t=t.trim()===""?"":t;var n=this.attr.KEY_CODE_MAP[e.which||e.keyCode];if(n){if(e.type!==n.on)return;n.preventDefault&&e.preventDefault(),this.trigger(this.$input,n.event,{query:t})}else this.setQueryAndTriggerUpdateEvent(t)},this.completeInput=function(e,t){t.searchType==="user"&&(t.query="@"+t.query),this.trigger("uiAppSearchSetQuery",{data:t.query}),this.$input.val(t.query),this.setQueryAndTriggerUpdateEvent(t.query),this.focusInput()},this.setQueryAndTriggerUpdateEvent=function(e){if(!this.currentQuery||this.currentQuery!==e)this.currentQuery=e,this.trigger(this.$input,"uiSearchInputChanged",{query:this.currentQuery})},this.focusInput=function(){this.$input.focus()},this.handleClearSearchAction=function(){this.focusInput()},this.before("teardown",function(){this.trigger("uiDestroyAsynchronousForm")})}return e(n)}),define("ui/with_column_selectors",[],function(){var e=function(){this.defaultAttrs({columnStateDetailViewClass:"js-column-state-detail-view",columnStateSocialProofClass:"js-column-state-social-proof",columnSelector:".js-app-columns .js-column",columnUpdateGlow:".js-column-update-glow",scrollContainerSelector:".js-column-scroller",columnDetailScrollerSelector:".js-detail-container",columnOptionsSelector:".js-column-options",columnHeaderSelector:".js-column-header"}),this.getColumnScrollContainerByKey=function(e){var t=this.getColumnElementByKey(e),n=t.find(this.attr.columnDetailScrollerSelector);return n.length>0?n:t.find(this.attr.scrollContainerSelector)},this.getColumnElementByKey=function(e){return this.select("columnSelector").filter('[data-column="'+e+'"]')},this.getKeyForColumnAtIndex=function(e){return this.select("columnSelector").eq(e).attr("data-column")},this.getKeyForLastColumn=function(){return this.select("columnSelector").last().attr("data-column")}};return e}),define("ui/with_transitions",[],function(){var e=function(){this.animateHeight=function(e,t,n,r){var i=e.height(),s,o,u=function(){e.trigger("uiTransitionExpandEnd"),typeof n=="function"&&n(),e.removeClass(t),r==="collapse"&&e.css("height","")};r==="expand"?(e.height(0),s=i):s=0,o=s===0?i*-1:s,e.addClass(t),_.defer(function(){e.height(s),e.trigger("uiTransitionExpandStart",{delta:o}),TD.ui.main.TRANSITION_END_EVENTS?e.one(TD.ui.main.TRANSITION_END_EVENTS,u):u()}.bind(this))},this.transitionExpand=function(e,t,n){this.animateHeight(e,t,n,"expand")},this.transitionCollapse=function(e,t,n){this.animateHeight(e,t,n,"collapse")},this.transitionTop=function(e,t,n,r){var i=function(){e.removeClass(t),typeof r=="function"&&r()};e.addClass(t),e.css("top",n),TD.ui.main.TRANSITION_END_EVENTS?e.one(TD.ui.main.TRANSITION_END_EVENTS,i):i()}};return e}),define("ui/with_text_utils",["flight/compose","ui/with_template"],function(e,t){function n(){e.mixin(this,[t]),this.highlightSubstring=function(e,t){var n=-1,r,i;return t&&(n=e.toLowerCase().indexOf(t.toLowerCase())),n!==-1?(i={before:e.substr(0,n),highlight:e.substr(n,t.length),after:e.substr(n+t.length)},r=this.toHtmlFromRaw("{{before}}<b>{{highlight}}</b>{{after}}",i)):r=this.toHtmlFromRaw("{{text}}",{text:e}),r},this.prettyNumber=function(e){return TD.util.prettyNumber(e)}}return n}),define("ui/with_user_menu",[],function(){var e=function(){this.defaultAttrs({userMenuButtonSelector:".js-profile-menu"}),this.showUserMenu=function(e,t,n){var r=!0;return this.userMenu&&(r=n.id!==this.userMenu.user.id,this.userMenu.destroy()),r&&(this.userMenu=new TD.components.ProfileMenu(t,n),this.userMenu.setPosition(TD.components.DropDown.POSITION_LEFT),e.stopPropagation()),r},this.handleUserMenuButtonClick=function(e){var t=$(e.target).closest(this.attr.userMenuButtonSelector),n=t.data("user-id").toString(),r;for(var i=0;i<this.users.length;i++)if(this.users[i].id===n){r=this.users[i];break}this.showUserMenu(e,t,r)},this.destroyMenuReference=function(e,t){t.target===this.userMenu&&(this.userMenu=null)},this.hideUserMenu=function(){this.userMenu&&this.userMeny.destroy()},this.before("teardown",function(){this.userMenu&&this.userMenu.destroy()}),this.after("initialize",function(){this.userMenu=null,this.on("td-dropdown-close",this.destroyMenuReference),this.on("click",{userMenuButtonSelector:this.handleUserMenuButtonClick})})};return e}),define("ui/social_proof_for_tweet",["flight/component","ui/with_template","ui/with_text_utils","ui/with_user_menu"],function(e,t,n,r){var i=function(){this.defaultAttrs({columnBackSelector:".js-tweet-social-proof-back",headerLinkClass:"js-tweet-social-proof-back",templateName:"status/social_proof_for_tweet"}),this.handleTwitterUsers=function(e,t){t.requestId===this.requestId&&(this.renderParams.users=t.users,this.users=t.users,this.render(this.attr.templateName,this.renderParams))},this.close=function(){this.trigger("uiSocialProofForTweetClosed"),this.teardown()},this.after("initialize",function(e){var t,n,r;this.on("uiSocialProofForTweetClose",this.close),this.on("click",{columnBackSelector:this.close}),this.on(document,"dataTwitterUsers",this.handleTwitterUsers),this.userIds=e.tweetSummary[e.type],this.attr.type==="retweeters"?(n="Retweeted",r=e.tweetSummary.retweeters_count):(n="Favorited",r=e.tweetSummary.favoriters_count),parseInt(r,10)>1?t=TD.i("{{action}} {{n}} times",{n:this.prettyNumber(r),action:n}):t=TD.i("{{action}} once",{action:n}),this.renderParams={title:t,columntitle:TD.i("Tweet"),headerLinkClass:this.attr.headerLinkClass,withUserMenu:!0},this.render(this.attr.templateName,this.renderParams),this.requestId=_.uniqueId("twitterUsers"),this.trigger("uiNeedsTwitterUsers",{requestId:this.requestId,userIds:this.userIds})})};return e(i,t,n,r)}),define("ui/column",["flight/component","ui/social_proof_for_tweet","ui/with_column_selectors","ui/with_template","ui/with_transitions","ui/asynchronous_form"],function(e,t,n,r,i,s){var o=function(){this.defaultAttrs({columnMessageSelector:".js-column-message",columnMessageTemplate:"column/column_message",filterErrorTemplate:"column/column_filter_error",filterErrorClass:"filter-error",hasFiltersClass:"has-filters",showDetailViewClass:"is-shifted-1",showSocialProofClass:"is-shifted-2",socialProofSelector:".js-column-social-proof",columnStateDefault:"default",columnStateDetailView:"detailView",columnStateSocialProof:"socialProof",columnScrollerIsAnimatingClass:"is-column-scroller-animating",isNewClass:"is-new",chirpSelector:".js-stream-item",animatingClass:"is-animating",focusId:null,tweetImpressionTrackingPeriod:100}),this.setColumnState=function(e){this.$node.removeClass([this.attr.showDetailViewClass,this.attr.columnStateDetailViewClass,this.attr.showSocialProofClass,this.attr.columnStateSocialProofClass].join(" "));switch(e){case this.attr.columnStateDetailView:this.$node.addClass(this.attr.showDetailViewClass),this.$node.addClass(this.attr.columnStateDetailViewClass);break;case this.attr.columnStateSocialProof:this.$node.addClass(this.attr.showSocialProofClass),this.$node.addClass(this.attr.columnStateSocialProofClass)}},this.handleDetailViewActive=function(){this.setColumnState(this.attr.columnStateDetailView)},this.handleDetailViewClosed=function(){this.setColumnState(this.attr.columnStateDefault),this.column.detailViewComponent=null},this.handleCloseDetailView=function(){this.column.detailViewComponent.destroy()},this.handleShowSocialProof=function(e,n){t.attachTo(this.$socialProofContainer,{type:n.type,tweetSummary:n.tweetSummary}),this.setColumnState(this.attr.columnStateSocialProof)},this.handleSocialProofClosed=function(){this.setColumnState(this.attr.columnStateDetailView)},this.handleCloseSocialProof=function(){this.trigger(this.$socialProofContainer,"uiSocialProofForTweetClose")},this.handleColumnOptionsShown=function(e,t){this.select("columnMessageSelector").html(""),s.attachTo(this.$columnOptions)},this.handleColumnOptionsHidden=function(e){this.column.hasActiveSearchFilters()&&this.$node.find(this.attr.columnMessageSelector).animate({opacity:1},150,"easeInOutQuad")},this.handleHidingColumnOptions=function(e){var t,n;this.trigger(this.$columnOptions,"uiDestroyAsynchronousForm"),this.column.hasActiveSearchFilters()?(n=this.select("columnMessageSelector"),this.column.hasFilterError()?(t=this.renderTemplate(this.attr.filterErrorTemplate),n.addClass(this.attr.filterErrorClass)):(t=this.renderTemplate(this.attr.columnMessageTemplate,{action:this.column.hasActiveActionFilters()&&!this.column.isSingleActionTypeColumn(),content:this.column.hasActiveContentFilters(),user:this.column.hasActiveUserFilters(),engagement:this.column.hasActiveEngagementFilters()}),n.removeClass(this.attr.filterErrorClass)),n.removeClass("is-hidden").css({opacity:0}).html(t),this.$node.addClass(this.attr.hasFiltersClass),this.handleColumnOptionsTransitionStart(null,{delta:n.outerHeight()})):this.$node.removeClass(this.attr.hasFiltersClass)},this.handleShowingColumnOptions=function(e,t){var n=this.$node,r=this.select("columnMessageSelector");n.hasClass(this.attr.hasFiltersClass)&&this.handleColumnOptionsTransitionStart(null,{delta:r.outerHeight()*-1,$column:n}),r.addClass("is-hidden")},this.handleColumnOptionsTransitionStart=function(e,t){var n=this.select("scrollContainerSelector"),r=this.select("columnUpdateGlow"),i=parseInt(n.css("top"),10),s=function(){n.data("isAnimating",!1)};n.data("isAnimating")===!0?this.targetTopPosition=this.targetTopPosition+t.delta:(n.data("isAnimating",!0),this.targetTopPosition=i+t.delta),this.transitionTop(n,this.attr.columnScrollerIsAnimatingClass,this.targetTopPosition,s),this.transitionTop(r,this.attr.columnScrollerIsAnimatingClass,this.targetTopPosition,s)},this.handleShowDetailView=function(e,t){var n,r;t.columnKey===this.columnKey&&t.chirpId&&(n=this.column.findChirp(t.chirpId),r=this.column.findMostInterestingChirp(t.chirpId),this.trigger("uiColumnFocus",{columnKey:t.columnKey}),r instanceof TD.services.TwitterAction||$.publish("chirp/action",["viewDetails",r,n,this.column]))},this.handleShowUserFilter=function(){this.trigger(this.$columnOptions,"uiShowUserFilter")},this.handleShowContentFilter=function(){this.trigger(this.$columnOptions,"uiShowContentFilter")},this.handleUpdateSearchFilter=function(e,t){this.column.updateSearchFilter(t)},this.handleUpdateMediaPreview=function(e,t){this.column.setMediaPreviewSize(t.value)},this.handleColumnUpdating=function(){this.trigger(this.$columnOptions,"uiWaitingForAsyncResponse")},this.handleColumnUpdated=function(){this.trigger(this.$columnOptions,"uiReceivedAsyncResponse")},this.handleMarkAllRead=function(){this.column.markAllMessagesAsRead()},this.handleReadStateChange=function(e,t){var n=this.select("columnHeaderSelector");t.columnKey=this.columnKey,this.column.isMessageColumn()?t.read=!this.column.hasUnreadMessages():this.$node.toggleClass(this.attr.isNewClass,!t.read),n.toggleClass(this.attr.isNewClass,!t.read)},this.handleColumnVisibilities=function(e,t){var n=this.column.visibility,r=t[this.columnKey],i,s;if(!r)return;this.column.visibility=r,i=n.visibleFraction===0,s=r.visibleFraction>0,(i&&s||n.visibleHeight!==r.visibleHeight)&&this.scribeTweetImpressions()},this.scribeTweetImpressions=function(){var e=this.column.temporary||this.hasFocus&&this.column.visibility.visibleFraction>0,t=this.$node.hasClass(this.attr.columnStateDetailViewClass)||this.$node.hasClass(this.attr.columnStateSocialProofClass);if(!e||t)return;var n=[],r=[],i=this.$scrollContainer.height(),s=this.attr.animatingClass;this.select("chirpSelector").each(function(e,t){var r=$(t),o=r.position().top,u=r.height(),a;if(!(o+u<0)){if(!(o<i))return!1;r.hasClass(s)||n.push(r.attr("data-key"))}}),n.forEach(function(e){var t,n;this.column.scribedImpressionIDs.get(e)||(t=this.column.findMostInterestingChirp(e),t instanceof TD.services.TwitterStatus&&r.push(t.getScribeItemData())),this.column.scribedImpressionIDs.enqueue(e,!0)}.bind(this)),TD.controller.stats.tweetStreamImpression(this.column.getColumnType(),r)},this.after("initialize",function(){this.columnKey=this.$node.data("column"),this.column=TD.controller.columnManager.get(this.columnKey),this.$socialProofContainer=this.select("socialProofSelector"),this.$columnOptions=this.select("columnOptionsSelector"),this.$scrollContainer=this.select("scrollContainerSelector"),this.attr.tweetImpressionTrackingPeriod>0&&(this.scribeTweetImpressions=_.throttle(this.scribeTweetImpressions.bind(this),this.attr.tweetImpressionTrackingPeriod)),this.on(document,"uiShowDetailView",this.handleShowDetailView),this.on("uiDetailViewActive",this.handleDetailViewActive),this.on("uiDetailViewClosed",this.handleDetailViewClosed),this.on("uiCloseDetailView",this.handleCloseDetailView),this.on("uiSocialProofForTweetClosed",this.handleSocialProofClosed),this.on("uiShowSocialProof",this.handleShowSocialProof),this.on("uiCloseSocialProof",this.handleCloseSocialProof),this.on("uiColumnOptionsShown",this.handleColumnOptionsShown),this.on("uiHidingColumnOptions",this.handleHidingColumnOptions),this.on("uiShowingColumnOptions",this.handleShowingColumnOptions),this.on("uiColumnOptionsHidden",this.handleColumnOptionsHidden),this.on("uiMarkAllMessagesRead",this.handleMarkAllRead),this.on("uiReadStateChange",this.handleReadStateChange),this.on("uiTransitionExpandStart",{columnOptionsSelector:this.handleColumnOptionsTransitionStart}),this.on("uiColumnUpdateSearchFilter",this.handleUpdateSearchFilter),this.on("uiColumnUpdateMediaPreview",this.handleUpdateMediaPreview),this.on("dataColumnUpdatingFilters dataColumnUpdatingFeed",this.handleColumnUpdating),this.on("dataColumnFiltersUpdated dataColumnFeedUpdated",this.handleColumnUpdated),this.on("uiRemoveColumn",this.teardown),this.on(document,"uiFocus",function(e,t){this.hasFocus=t.id===this.attr.focusId,this.hasFocus&&this.scribeTweetImpressions()}),this.on(this.$scrollContainer,"scroll",this.scribeTweetImpressions),this.on(document,"uiColumnVisibilities",this.handleColumnVisibilities),this.on(document,"uiColumnChirpsChanged",function(e,t){t.id===this.columnKey&&this.scribeTweetImpressions()}),this.on("uiDetailViewClosed",this.scribeTweetImpressions)})};return e(o,n,r,i)}),define("ui/alerts_form",["flight/component","ui/with_template"],function(e,t){var n=function(){this.defaultAttrs({template:"column/alerts_form",actionButton:"[data-action]",summarySelector:".js-alerts-summary",summaryClass:"js-alerts-summary"}),this.updateSummary=function(){var e=this.column.model,t=e.getHasNotification(),n=e.getHasSound(),r;t&&n?r=TD.i("sounds and popups"):t?r=TD.i("popups"):n?r=TD.i("sounds"):r=TD.i("none"),this.select("summarySelector").text(r)},this.toggleColumnSetting=function(e){var t=$(e.target).closest(this.attr.actionButton),n=t.data("action"),r=this.column.model,i;switch(n){case"popups":i=!r.getHasNotification(),r.setHasNotification(i);break;case"sound":i=!r.getHasSound(),r.setHasSound(i)}this.updateSummary()},this.after("initialize",function(e){var t={summaryText:"",iconClass:"icon-alerts",title:TD.i("Alerts"),jsClass:this.attr.summaryClass,options:[{action:"sound",option:TD.i("Sounds"),on:e.column.model.getHasSound()}]};this.column=e.column;if(e.column.getColumnType()===TD.util.columnUtils.columnMetaTypes.SCHEDULED){this.teardown();return}TD.controller.notifications.hasNotifications()&&t.options.push({action:"popups",option:TD.i("Popups"),on:e.column.model.getHasNotification()}),this.$alertsForm=this.renderTemplate(this.attr.template,t),this.$node.append(this.$alertsForm),this.updateSummary(),this.on(this.$alertsForm,"click",{actionButton:this.toggleColumnSetting})})};return e(n,t)}),define("ui/with_accordion",["flight/compose","ui/with_transitions"],function(e,t){var n=function(){e.mixin(this,[t]),this.defaultAttrs({accordionItemSelector:".js-accordion-item",accordionIsExpandedClass:"is-expanded",accordionIsActiveClass:"is-active",accordionToggleSelector:".js-accordion-toggle-view",accordionPanelSelector:".js-accordion-panel",isAccordionPanelAnimatingClass:"is-accordion-panel-animating"}),this.expandAccordionItem=function(e){var t=e.find(this.attr.accordionPanelSelector);e.addClass(this.attr.accordionIsExpandedClass),e.addClass(this.attr.accordionIsActiveClass),this.transitionExpand(t,this.attr.isAccordionPanelAnimatingClass),this.trigger(e,"uiAccordionExpandAction")},this.collapseAccordionItem=function(e){var t=e.find(this.attr.accordionPanelSelector);e.removeClass(this.attr.accordionIsActiveClass),this.transitionCollapse(t,this.attr.isAccordionPanelAnimatingClass,function(){e.removeClass(this.attr.accordionIsExpandedClass)}.bind(this)),this.trigger(e,"uiAccordionCollapseAction")},this.getOpenAccordionItem=function(){return this.select("accordionItemSelector").filter(function(e,t){return $(t).hasClass(this.attr.accordionIsExpandedClass)}.bind(this))},this.accordionToggle=function(e){var t=$(e.target).closest(this.attr.accordionItemSelector),n=this.getOpenAccordionItem();n.length>0&&this.collapseAccordionItem(n),t.is(n)||this.expandAccordionItem(t)},this.showAccordionPanel=function(e){var t=e.closest(this.attr.accordionItemSelector),n=this.getOpenAccordionItem();t.is(n)||(this.collapseAccordionItem(n),this.expandAccordionItem(t))},this.handleUpdatePanelHeights=function(){this.select("accordionPanelSelector").filter(":visible").each(function(e,t){var n=$(t);n.css("height",""),n.height(n.height()),this.trigger("uiAccordionTotalHeightChanged")}.bind(this))},this.after("initialize",function(){this.on("click",{accordionToggleSelector:_.throttle(this.accordionToggle,300).bind(this)}),this.on("uiAccordionUpdatePanelHeights",this.handleUpdatePanelHeights)})};return n}),define("data/with_languages",[],function(){function e(){this.before("initialize",function(){this.languages=TD.languages.getAllLanguages()})}return e}),define("ui/search/content_filter_form",["flight/component","ui/with_template","data/with_languages"],function(e,t,n){var r=function(){this.defaultAttrs({filterType:"content",template:"menus/search_content_form",matchingSelector:".js-matching",excludingSelector:".js-excluding",containingSelector:".js-containing",writtenInSelector:".js-written-in",retweetsSelector:".js-retweets",searchFilter:null,renderOptions:{withContentType:!0,withMatching:!0,withExcluding:!0,withLanguage:!0,withRetweetsToggle:!0}}),this.getContainingOptions=function(){return[{value:TD.vo.ContentFilter.TYPE_ANYTHING,title:TD.i("all Tweets")},{value:TD.vo.ContentFilter.TYPE_IMG,title:TD.i("Tweets with images")},{value:TD.vo.ContentFilter.TYPE_VID,title:TD.i("Tweets with videos")},{value:TD.vo.ContentFilter.TYPE_IMG_AND_VID,title:TD.i("Tweets with any media")},{value:TD.vo.ContentFilter.TYPE_LINKS,title:TD.i("Tweets with links")}]},this.getRetweetOptions=function(){return[{value:"included",title:TD.i("included"),isIncluded:!0},{value:"excluded",title:TD.i("excluded"),isIncluded:!1}]},this.handleChange=function(e){var t=this.$containing.val(),n=this.$matching.val(),r=this.$excluding.val(),i=this.$writtenIn.val(),s=this.$retweets.val(),o=this.retweetOptions.filter(function(e){return e.value===s})[0],u=new TD.vo.ContentFilter({type:t,matching:n,excluding:r,lang:i,includeRTs:o.isIncluded});this.trigger("uiSearchFilterUpdateAction",{type:"content",filter:u,filterName:$(e.target).data("title"),value:e.target.value})},this.after("initialize",function(){this.containingOptions=this.getContainingOptions(),this.retweetOptions=this.getRetweetOptions();var e={containingOptions:this.containingOptions,retweetOptions:this.retweetOptions},t=TD.languages.getSystemLanguageCode(!0),n=TD.languages.getLanguageFromISOCode(t);e.userLanguage=n,e.allLanguages=_.sortBy(this.languages,function(e){return e.localized_name}),$.extend(e,this.attr.renderOptions),this.render(this.attr.template,e),this.$matching=this.select("matchingSelector"),this.$excluding=this.select("excludingSelector"),this.$containing=this.select("containingSelector"),this.$writtenIn=this.select("writtenInSelector"),this.$retweets=this.select("retweetsSelector"),this.attr.searchFilter&&this.attr.searchFilter.content&&(this.$containing.val(this.attr.searchFilter.content.type),this.attr.searchFilter.content.includeRTs?this.$retweets.val("included"):this.$retweets.val("excluded"),this.$writtenIn.val(this.attr.searchFilter.content.lang)),this.on("change",this.handleChange),this.on("uiDestroyContentFilterForm",this.teardown)})};return e(r,t,n)}),define("ui/search/user_filter_form",["flight/component","ui/with_template","data/with_languages"],function(e,t,n){var r=function(){this.defaultAttrs({FROM_ME:"from_me",MENTIONING_USER:"mentioning_user",MENTIONING_ME:"mentioning_me",filterType:"user",template:"menus/search_user_form",tweetsFromSelector:".js-tweets-from",tweetsFromUserSelector:".js-tweets-from-user",tweetsFromUserClass:"js-tweets-from-user",tweetsFromUserInputSelector:'.js-tweets-from-user input[type="text"]',tweetsFromListSelector:".js-tweets-from-list",tweetsFromListClass:"js-tweets-from-list",tweetsFromListInputSelector:'.js-tweets-from-list input[type="text"]',tweetsFromMeSelector:".js-tweets-from-me",mentioningSelector:".js-mentioning",mentioningUserSelector:".js-mentioning-user",mentioningUserInputSelector:'.js-mentioning-user input[type="text"]',mentioningUserClass:"js-mentioning-user",mentioningMeSelector:".js-mentioning-me",isHiddenClass:"is-hidden",renderOptions:{withFromList:!1}}),this.getTweetsFromOptions=function(e){var t=[{value:TD.vo.UserFilter.FROM_ALL,title:TD.i("all users")},{value:TD.vo.UserFilter.FROM_USER,title:TD.i("specific user")},{value:this.attr.FROM_ME,title:TD.i("me")},{value:TD.vo.UserFilter.FROM_VERIFIED,title:TD.i("verified users")}];return e&&t.push({value:TD.vo.UserFilter.FROM_LIST,title:TD.i("members of list")}),t},this.getMentioningOptions=function(){return[{value:"",title:TD.i("-")},{value:this.attr.MENTIONING_USER,title:TD.i("specific user")},{value:this.attr.MENTIONING_ME,title:TD.i("me")}]},this.getMyAccounts=function(){var e=TD.storage.accountController.getPreferredAccount("twitter"),t=TD.storage.accountController.getAccountsForService("twitter");return t=t.map(function(t){return{value:t.getUsername().toLowerCase(),title:"@"+t.getUsername(),isDefault:t===e}}),t=t.sort(function(e,t){return e.value.toLowerCase().localeCompare(t.value.toLowerCase())}),t},this.updateFormState=function(e,t){switch(e){case TD.vo.UserFilter.FROM_USER:this.$tweetsFromUser.removeClass(this.attr.isHiddenClass),this.$tweetsFromList.addClass(this.attr.isHiddenClass),this.$tweetsFromMe.addClass(this.attr.isHiddenClass);break;case TD.vo.UserFilter.FROM_LIST:this.$tweetsFromList.removeClass(this.attr.isHiddenClass),this.$tweetsFromUser.addClass(this.attr.isHiddenClass),this.$tweetsFromMe.addClass(this.attr.isHiddenClass);break;case this.attr.FROM_ME:this.$tweetsFromMe.removeClass(this.attr.isHiddenClass),this.$tweetsFromUser.addClass(this.attr.isHiddenClass),this.$tweetsFromList.addClass(this.attr.isHiddenClass),this.$tweetsFromUserInput.val("");break;default:this.$tweetsFromMe.addClass(this.attr.isHiddenClass),this.$tweetsFromUser.addClass(this.attr.isHiddenClass),this.$tweetsFromList.addClass(this.attr.isHiddenClass),this.$tweetsFromUserInput.val("")}switch(t){case this.attr.MENTIONING_USER:this.$mentioningUser.removeClass(this.attr.isHiddenClass),this.$mentioningMe.addClass(this.attr.isHiddenClass);break;case this.attr.MENTIONING_ME:this.$mentioningMe.removeClass(this.attr.isHiddenClass),this.$mentioningUser.addClass(this.attr.isHiddenClass),this.$mentioningUserInput.val("");break;default:this.$mentioningMe.addClass(this.attr.isHiddenClass),this.$mentioningUser.addClass(this.attr.isHiddenClass),this.$mentioningUserInput.val("")}},this.handleChange=function(e){var t="",n="",r=this.$tweetsFrom.val(),i=this.$mentioning.val(),s=$(e.target).data("title");this.updateFormState(r,i);switch(r){case this.attr.FROM_ME:t=this.$tweetsFromMe.val(),r=TD.vo.UserFilter.FROM_USER;break;case TD.vo.UserFilter.FROM_USER:t=this.$tweetsFromUserInput.val();break;case TD.vo.UserFilter.FROM_LIST:t=this.$tweetsFromListInput.val()}n=i===this.attr.MENTIONING_ME?this.$mentioningMe.val():this.$mentioningUserInput.val(),!t&&(r===TD.vo.UserFilter.FROM_USER||r===TD.vo.UserFilter.FROM_LIST)&&(r=TD.vo.UserFilter.FROM_ALL);var o=new TD.vo.UserFilter({from_type:r,from_name:t,mention_name:n});this.trigger("uiSearchFilterUpdateAction",{type:"user",filter:o,filterName:s,value:e.target.value})},this.after("initialize",function(){var e,t,n;this.tweetsFromOptions=this.getTweetsFromOptions(this.attr.renderOptions.withFromList),this.mentioningOptions=this.getMentioningOptions(),this.myAccounts=this.getMyAccounts();var r=this.attr.searchFilter,i=r.user&&r.user.from_type!==null?r.user.from_name:"",s=r.user?r.user.mention_name:"";e={tweetsFromOptions:this.tweetsFromOptions,tweetsFromUser:{searchInputControlClass:this.attr.tweetsFromUserClass+" margin-txs",searchInputPlaceholder:TD.i("user name"),searchInputTitle:"from_user_or_list",searchInputValue:i},tweetsFromList:{searchInputControlClass:this.attr.tweetsFromListClass+" margin-txs",searchInputPlaceholder:TD.i("@username/list-name"),searchInputTitle:"from_user_or_list",searchInputValue:i},mentioningUser:{searchInputControlClass:this.attr.mentioningUserClass+" margin-txs",searchInputPlaceholder:TD.i("user name"),searchInputTitle:"mentioning_user",searchInputValue:s},mentioningOptions:this.mentioningOptions,myAccounts:this.myAccounts},this.render(this.attr.template,e),this.$tweetsFrom=this.select("tweetsFromSelector"),this.$tweetsFromUser=this.select("tweetsFromUserSelector"),this.$tweetsFromUserInput=this.select("tweetsFromUserInputSelector"),this.$tweetsFromList=this.select("tweetsFromListSelector"),this.$tweetsFromListInput=this.select("tweetsFromListInputSelector"),this.$tweetsFromMe=this.select("tweetsFromMeSelector"),this.$mentioning=this.select("mentioningSelector"),this.$mentioningUser=this.select("mentioningUserSelector"),this.$mentioningUserInput=this.select("mentioningUserInputSelector"),this.$mentioningMe=this.select("mentioningMeSelector");if(this.attr.searchFilter&&this.attr.searchFilter.user){t=this.attr.searchFilter.user.from_name&&TD.storage.accountController.getAccountFromUsername(this.attr.searchFilter.user.from_name).length>0,n=this.attr.searchFilter.user.mention_name&&TD.storage.accountController.getAccountFromUsername(this.attr.searchFilter.user.mention_name).length>0;if(t)this.$tweetsFrom.val(this.attr.FROM_ME),this.$tweetsFromMe.val(this.attr.searchFilter.user.from_name);else{this.$tweetsFrom.val(this.attr.searchFilter.user.from_type);switch(this.attr.searchFilter.user.from_type){case TD.vo.UserFilter.FROM_USER:this.$tweetsFromUserInput.val(this.attr.searchFilter.user.from_name);break;case TD.vo.UserFilter.FROM_LIST:this.$tweetsFromListInput.val(this.attr.searchFilter.user.from_name)}}n?(this.$mentioning.val(this.attr.MENTIONING_ME),this.$mentioningMe.val(this.attr.searchFilter.user.mention_name)):this.attr.searchFilter.user.mention_name&&(this.$mentioning.val(this.attr.MENTIONING_USER),this.$mentioningUserInput.val(this.attr.searchFilter.user.mention_name))}this.updateFormState(this.$tweetsFrom.val(),this.$mentioning.val()),this.on("change",this.handleChange),this.on("uiDestroyUserFilterForm",this.teardown)})};return e(r,t,n)}),define("ui/search/action_filter_form",["flight/component","ui/with_template"],function(e,t){function n(){this.defaultAttrs({filterType:"action",columnType:null,template:"menus/search_action_form",searchFilter:null,showFavoritesSelector:".js-show-favorites",showRetweetsSelector:".js-show-retweets",showListsSelector:".js-show-lists",showFollowersSelector:".js-show-followers",showMentionsSelector:".js-show-mentions",errorMessageSelector:".js-action-filter-error",isHiddenClass:"is-hidden"}),this.isInActivityColumn=function(){return this.attr.columnType===TD.util.columnUtils.columnMetaTypes.ACTIVITY},this.hasFilterError=function(e){var t=e.getFilters().length,n=!1;return this.isInActivityColumn()?t===TD.vo.ActionFilter.MAX_ACTIVITY_FILTERS&&(n=!0):t===TD.vo.ActionFilter.MAX_INTERACTION_FILTERS&&(n=!0),n},this.handleChange=function(e){var t,n={showFollowers:this.$showFollowers.attr("checked"),showLists:this.$showLists.attr("checked"),showMentions:this.$showMentions.attr("checked"),showRetweets:this.$showRetweets.attr("checked"),showFavorites:this.$showFavorites.attr("checked")};this.$showRetweets.length===0&&(n.showRetweets=!0),this.$showMentions.length===0&&(n.showMentions=!0),t=new TD.vo.ActionFilter(n),this.select("errorMessageSelector").toggleClass(this.attr.isHiddenClass,!this.hasFilterError(t)),this.trigger("uiAccordionUpdatePanelHeights"),this.trigger("uiSearchFilterUpdateAction",{type:this.attr.filterType,filter:t,filterName:$(e.target).data("title"),value:[e.target.value,e.target.checked?"show":"hide"].join(":")}),this.hasFilterError(t)&&this.trigger("uiActionFilterError")},this.after("initialize",function(){var e=this.attr.searchFilter.action.toJSONObject();e.showError=this.hasFilterError(this.attr.searchFilter.action),e.isInActivityColumn=this.isInActivityColumn(),this.render(this.attr.template,e),this.$showRetweets=this.select("showRetweetsSelector"),this.$showFavorites=this.select("showFavoritesSelector"),this.$showFollowers=this.select("showFollowersSelector"),this.$showLists=this.select("showListsSelector"),this.$showMentions=this.select("showMentionsSelector"),this.on("change",this.handleChange)})}return e(n,t)}),define("ui/search/engagement_filter_form",["flight/component","ui/with_template"],function(e,t){function n(){this.defaultAttrs({filterType:"engagement",template:"menus/search_engagement_form",searchFilter:null,minRetweetsSelector:".js-min-retweets",minRepliesSelector:".js-min-replies",minFavoritesSelector:".js-min-favorites",zeroClass:"txt-mute"}),this.after("initialize",function(){var e=this.attr.searchFilter.engagement;this.render(this.attr.template,e),this.$minFavorites=this.select("minFavoritesSelector"),this.$minRetweets=this.select("minRetweetsSelector"),this.$minReplies=this.select("minRepliesSelector"),this.on("change blur",this.handleChange),this.validateInput(this.attr.searchFilter.engagement)}),this.validateInput=function(){var e=parseInt(this.$minFavorites.val(),10),t=parseInt(this.$minRetweets.val(),10),n=parseInt(this.$minReplies.val(),10);e=isNaN(e)?0:e,t=isNaN(t)?0:t,n=isNaN(n)?0:n,this.$minFavorites.val(e).toggleClass(this.attr.zeroClass,e===0),this.$minRetweets.val(t).toggleClass(this.attr.zeroClass,t===0),this.$minReplies.val(n).toggleClass(this.attr.zeroClass,n===0)},this.handleChange=function(e){var t=$(e.target).data("title"),n=$(e.target).val(),r;this.validateInput(),r=new TD.vo.EngagementFilter({minFavorites:this.$minFavorites.val(),minRetweets:this.$minRetweets.val(),minReplies:this.$minReplies.val()}),this.trigger("uiSearchFilterUpdateAction",{type:this.attr.filterType,filter:r,filterName:t,value:n})}}return e(n,t)}),define("ui/with_search_filter",["flight/compose","ui/with_template","ui/search/content_filter_form","ui/search/user_filter_form","ui/search/action_filter_form","ui/search/engagement_filter_form"],function(e,t,n,r,i,s){var o=function(){e.mixin(this,[t]),this.defaultAttrs({searchAccordionTemplate:"menus/search_accordion",contentFilterSelector:".js-content-filter",userFilterSelector:".js-user-filter",actionFilterSelector:".js-action-filter",engagementFilterSelector:".js-engagement-filter",searchFilterSelector:".js-search-filter",contentSummaryClass:"js-content-filter-summary",userSummaryClass:"js-user-filter-summary",actionSummaryClass:"js-action-filter-summary",engagementSummaryClass:"js-engagement-filter-summary",contentSummarySelector:".js-content-filter-summary",userSummarySelector:".js-user-filter-summary",actionSummarySelector:".js-action-filter-summary",engagementSummarySelector:".js-engagement-filter-summary",excludingClass:"js-excluding",matchingClass:"js-matching",filterTypes:["content","user","action","engagement"]}),this.isValidFilterType=function(e){return this.attr.filterTypes.some(function(t){return e===t})},this.handleSearchFilterUpdate=function(e,t){if(!t.filter||!this.isValidFilterType(t.type))return;this.searchFilter[t.type]=t.filter;var n=t.filter.getSummaryText(this.attr.columnType),r=this.select(t.type+"SummarySelector");r.text(n),TD.controller.stats.advancedSearchSettings(this.attr.scribeSection,t.type,t.filterName,t.value),this.trigger(this.$accordion,"uiAccordionUpdatePanelHeights"),this.trigger("uiColumnUpdateSearchFilter",this.searchFilter)},this.renderSearchFilters=function(e,t){this.searchFilter=e,this.$accordion=this.select("accordionSelector");var o=this.renderTemplate(this.attr.searchAccordionTemplate,{content:{summaryText:this.searchFilter.content.getSummaryText(),iconClass:"icon-content",title:TD.i("Content"),jsClass:this.attr.contentSummaryClass,isExpanded:t.expandContentFilter},user:{summaryText:this.searchFilter.user.getSummaryText(),iconClass:"icon-user",title:TD.i("Users"),jsClass:this.attr.userSummaryClass,isExpanded:t.expandUserFilter},action:t.withActionFilter?{summaryText:this.searchFilter.action.getSummaryText(this.attr.columnType),iconClass:"icon-check",title:TD.i("Showing"),jsClass:this.attr.actionSummaryClass,isExpanded:t.expandActionFilter}:!1,engagement:t.withEngagementFilter?{summaryText:this.searchFilter.engagement.getSummaryText(),iconClass:"icon-retweet",title:TD.i("Engagement"),jsClass:this.attr.engagementSummaryClass,isExpanded:t.expandEngagementFilter}:!1});this.$accordion.append(o),this.trigger(this.select("contentFilterSelector"),"uiDestroyContentFilterForm"),this.trigger(this.select("userFilterSelector"),"uiDestroyUserFilterForm"),n.attachTo(this.select("contentFilterSelector"),{searchFilter:e,renderOptions:t}),r.attachTo(this.select("userFilterSelector"),{searchFilter:e,renderOptions:t}),t.withActionFilter&&i.attachTo(this.select("actionFilterSelector"),{searchFilter:e,renderOptions:t,columnType:this.attr.columnType}),t.withEngagementFilter&&s.attachTo(this.select("engagementFilterSelector"),{searchFilter:e,renderOptions:t})},this.after("initialize",function(){this.searchFilter=this.searchFilter||new TD.vo.SearchFilter,this.$searchFilter=this.select("searchFilterSelector"),this.on("uiSearchFilterUpdateAction",this.handleSearchFilterUpdate)})};return o}),define("ui/with_thumb_size_select",["flight/compose","ui/with_template"],function(e,t){function n(){e.mixin(this,[t]),this.defaultAttrs({thumbSizeSelectSelector:".js-thumb-size",thumbSizeSelectTemplate:"column/thumb_size_select",selectItemSelector:".js-toggle-item",selectedClass:"is-selected"}),this.after("initialize",function(){this.on(this.$node,"click",{selectItemSelector:this.handleThumbSizeSelectClick})}),this.renderThumbSizeSelector=function(){var e=this.toHtml(this.attr.thumbSizeSelectTemplate);this.$thumbSizeSelect=this.select("thumbSizeSelectSelector"),this.$thumbSizeSelect.html(e),this.$thumbSizeSelectOptions=this.select("selectItemSelector");var t=this.attr.column.getMediaPreviewSize(),n='[data-value="'+t+'"]';this.$thumbSizeSelectOptions.filter(n).addClass(this.attr.selectedClass)},this.handleThumbSizeSelectClick=function(e,t){var n=$(t.el),r=n.data("value");r&&(this.trigger("uiColumnUpdateMediaPreview",{value:r}),this.$thumbSizeSelectOptions.removeClass(this.attr.selectedClass),n.addClass(this.attr.selectedClass))}}return n}),define("ui/column_options",["flight/component","ui/alerts_form","ui/with_accordion","ui/with_template","ui/with_search_filter","ui/with_thumb_size_select","ui/with_transitions"],function(e,t,n,r,i,s,o){var u=function(){this.defaultAttrs({actionButton:"[data-action]",searchInputForm:".js-column-options-search-form",searchInput:".js-search-input",scribeSection:"column_options",isAnimatingClass:"is-column-options-animating",accordionSelector:".js-accordion",columnType:null}),this.updateHeight=function(){this.$node.css("height",""),this.$node.height(this.$node.height()),this.trigger("uiAccordionTotalHeightChanged")},this.handleChildTransitionExpandStart=function(e,t){this.$node.css("height","")},this.handleChildTransitionExpandEnd=function(){this.$node.height(this.$node.height())},this.handleUpdateSearchFilter=function(e,t){this.updateHeight(),this.column.updateSearchFilter(t)},this.handleShowUserFilter=function(e){e.stopPropagation(),this.showAccordionPanel(this.select("userFilterSelector"))},this.handleShowContentFilter=function(e){e.stopPropagation(),this.showAccordionPanel(this.select("contentFilterSelector"))},this.hide=function(){this.trigger("uiHidingColumnOptions",this.column),this.transitionCollapse(this.$node,this.attr.isAnimatingClass,this.afterHideTransition.bind(this)),this.teardown()},this.afterHideTransition=function(){this.$node.css("height",""),this.$node.empty(),this.trigger("uiColumnOptionsHidden",this.column)},this.showColumnOptions=function(){var e=this.$node.outerHeight(),t=function(){this.trigger("uiColumnOptionsShown",{column:this.column})}.bind(this);this.trigger("uiShowingColumnOptions",{columnOptionsHeight:e,column:this.column}),this.transitionExpand(this.$node,this.attr.isAnimatingClass,t.bind(this))},this.handleClickEvents=function(e){var t=$(e.target).closest(this.attr.actionButton),n=t.data("action"),r=this.column.model.getKey();switch(n){case"remove":this.trigger("uiDeleteColumnAction",{columnId:r});break;case"clear":this.column.clear(),this.trigger("uiClearColumnAction",{columnId:r});break;case"left":case"right":this.trigger("uiMoveColumnAction",{columnId:r,action:n});break;case"edit-list":new TD.components.ListMembers(this.column.isOwnList());break;case"embed":this.trigger("uiEmbedTimelineAction",{column:this.column})}},this.after("initialize",function(e){this.column=e.column;var n,r=this.column.getSearchFilter(),i=this.column.isSearchColumn(),s=TD.util.columnUtils.mediaPreviewableColumnTypes.indexOf(this.column.getColumnType())!==-1;this.on("uiShowUserFilter",this.handleShowUserFilter),this.on("uiShowContentFilter",this.handleShowContentFilter),this.on("uiColumnOptionsCloseAction",this.hide),this.on("uiColumnUpdateSearchFilter",this.handleUpdateSearchFilter),this.on("uiAccordionExpandAction",this.updateHeight),this.on("uiAccordionCollapseAction",this.updateHeight),this.on("uiTransitionExpandStart",{searchFilterSelector:this.handleChildTransitionExpandStart}),this.on("uiTransitionExpandEnd",{searchFilterSelector:this.handleChildTransitionExpandEnd}),this.on("click",{actionButton:this.handleClickEvents}),n={searchTerm:this.column.getBaseQuery(),isOwnList:Boolean(this.column.isOwnList()),isEmbeddable:this.column.isEmbeddable(),isClearable:this.column.isClearable()},this.render("column/column_options",n),this.column.isFilterable()&&this.renderSearchFilters(r,{withContentType:!0,withMatching:{isControl:!0,searchInputClassName:this.attr.matchingClass,searchInputPlaceholder:TD.i("Enter words to match"),searchInputTitle:"matching",searchInputValue:r.content?r.content.matching:""},withExcluding:{isControl:!0,searchInputClassName:this.attr.excludingClass,searchInputPlaceholder:TD.i("Enter words to exclude"),searchInputTitle:"excluding",searchInputValue:r.content?r.content.excluding:""},withLanguage:i,withRetweetsToggle:!0,withFromList:i,withActionFilter:this.column.isActionsColumn(),withEngagementFilter:this.column.isSearchColumn()&&TD.decider.get(TD.decider.ENGAGEMENT_FILTER),expandContentFilter:e.expandContentFilter,expandUserFilter:e.expandUserFilter,expandActionFilter:e.expandActionFilter,expandEngagementFilter:e.expandEngagementFilter}),t.attachTo(this.select("accordionSelector"),{column:this.column}),s&&this.renderThumbSizeSelector(),this.showColumnOptions()})};return e(u,n,r,i,s,o)}),define("td/UI/columns",["ui/column_options"],function(e){var t=window.TD||{};t.ui=t.ui||{},window.TD=t,t.ui.columns=function(){var n,r,i=10,s=40,o=20,u=350,a=500,f=200,l=20,c={},h={},p={},d={},v={},m=150,g=15,y="is-options-open",b="is-moving",w="is-focused",E=".is-focused",S="is-actionable",x="is-new",T="#container",N=".js-app-columns",C=".js-column-options",k=".js-column-scroller",L=".js-column-update-glow",A=".js-column",O=".js-column-header",M=".js-column-message",D=".js-detail-header",P=".js-chirp-container",H=".js-action-header-button",B=".is-minimalist",j=150,F=function(e){return K.getColumnElementByKey(e).find(O)},I=function(e){var t=$(e.target).closest("[data-action]"),n=t.data("action"),r=t.parents(A),i=r.attr("data-column");switch(n){case"options":e.preventDefault(),r.hasClass(y)?K.exitEditMode(i):K.enterEditMode(i),e.stopPropagation();break;case"mark-all-read":r.trigger("uiMarkAllMessagesRead",{columnKey:i});break;case"user-filter":case"content-filter":case"action-filter":case"engagement-filter":K.enterEditMode(i,n);break;case"edit-list":e.preventDefault(),e.stopPropagation()}},q=function(e){var n=$(e.currentTarget),r=n.data("action"),i=n.parents(A),s=i.data("column");t.ui.columns.setColumnToTop(s)},R=function(){var e=$(this);return e.offset().top+this.offsetHeight>0&&e.offset().top<n.innerHeight()},U=function(){var e=t.ui.updates.findParentArticle($(this)),n=t.controller.columnManager.get(e.column),r=n.updateIndex[e.statusKey];e.element.replaceWith(r.render({isTemporary:n.temporary}))},z=_.debounce(function(e){e.find(B).filter(R).each(U)},j),W=function(e,n){var r,i,s=0;return function(o){var u=o.timeStamp||(new Date).getTime(),a,f,l=n.scrollTop();d[e]=l,z(n),u-s>200&&(s=u,i=o.currentTarget.scrollHeight,r=n.height()),f=(r+l)/i,f>.999?(s=0,a=t.controller.columnManager.get(e),a.fetchUpdatesFromPoller()):l===0&&n.trigger("uiReadStateChange",{read:!0})}},X=function(e,t){var n=t.closest(".scroll-h");return function(i){var s,o,u,a=$(i.currentTarget);if(!i.originalEvent.wheelDeltaY&&!i.originalEvent.wheelDeltaX)return;i.preventDefault(),Math.abs(i.originalEvent.wheelDeltaY)>Math.abs(i.originalEvent.wheelDeltaX)?a.is(k)?(s=i.currentTarget.scrollHeight,o=t.height(),u=d[e],u=Math.max(0,u-i.originalEvent.wheelDeltaY),u=Math.min(u,s-o),t.scrollTop(u),d[e]=u):a.scrollTop(a.scrollTop()-i.originalEvent.wheelDeltaY):n.length&&n.scrollLeft(r.scrollLeft()-i.originalEvent.wheelDeltaX)}},V=function(e,r){var i,s=function(n){var r=n.model,s=n.isMessageColumn()&&(t.config.internal_build||t.decider.get(t.decider.DM_READ_STATE)),o=n.hasActiveSearchFilters(),u=null;o&&(u={content:n.hasActiveContentFilters(),user:n.hasActiveUserFilters(),action:n.hasActiveActionFilters()&&!n.isSingleActionTypeColumn(),engagement:n.hasActiveEngagementFilters(),filterError:n.hasFilterError()});var a={columnkey:r.getKey(),columntitle:e[i].getTitleHTML(),columnclass:e[i].getIconClass(),columnfilter:u,filterError:n.hasFilterError(),withMarkAllRead:s};return t.ui.template.render("column",a)};r=Boolean(r);if(r)for(i=e.length-1;i>=0;i--)n.prepend(s(e[i])),K.setupColumn(e[i]);else for(i=0;i<e.length;i++)n.append(s(e[i])),K.setupColumn(e[i])},J=function(){var e=$(this);K.setColumnScrollerPosition(e)},K={COLUMN_GLOW_DURATION:500,init:function(){n=$(N),r=$(T);var e=_.throttle(I,300);n.on("click",H+", "+M,e);var t=$(O);t.live("click",q),$(document).on("uiColumnWidthChange",this.handleColumnWidthChange.bind(this)),n.on("uiAccordionTotalHeightChanged",A,J)},setupColumn:function(e){var t=e.model.getKey(),n=$(P+'[data-column="'+t+'"]').closest(k),r=$(A+'[data-column="'+t+'"]'),i=n.scrollTop(),s=W(t,n),o=X(t,n);$(document).trigger("uiColumnRendered",{column:e,$column:r}),d[t]=i,h[t]=n,n.scroll(s),r.on("mousewheel onmousewheel",".scroll-v",o),r.on("mouseover",O,function(){var e=d[t];$(this).toggleClass(S,e>0)})},refreshTitle:function(e){var n,r=e.getIconClass(),i=e.model.getKey(),s=e.getTitleHTML(),o=K.getColumnElementByKey(i),u,a=e.isMessageColumn()&&(t.config.internal_build||t.decider.get(t.decider.DM_READ_STATE));e.temporary&&e.getColumnType()===t.util.columnUtils.columnMetaTypes.SEARCH?u=t.i("results"):u=e.getDetailTitleHTML(),n=t.ui.template.render("column/column_header",{columntitle:s,columnclass:r,isTemporary:e.temporary,withMarkAllRead:a}),F(e.model.getKey()).replaceWith(n),n=t.ui.template.render("column/column_header_detail",{headerClass:"js-detail-header",headerAction:"resetToTopColumn",headerLinkClass:"js-column-back",columntitle:u}),o.find(D).replaceWith(n),$(document).trigger("uiColumnTitleRefreshed",{title:s,columnKey:i})},setColumnToTop:function(e){var t=h[e],n=10,r,i=d[e],s=250,o=function(){var u=Math.max(i-s,0);i-=s,t.scrollTop(u),d[e]=u,u>0?setTimeout(o,n):(t.trigger("uiReadStateChange",{read:!0}),r=F(e),r.toggleClass(S,t.scrollTop>0))};i*n/s>u&&(s=i*n/u),o()},setColumnScrollerPosition:function(e,n){var r=$(C,e),i=e.attr("data-column"),s=t.controller.columnManager.get(i);if(!s)return;var u=n?0:r.height();s.hasActiveSearchFilters()&&n&&(u+=o),$(k,e).css("top",u),$(L,e).css("top",u)},handleColumnWidthChange:function(){var e=this.setColumnScrollerPosition;n.find("."+y).each(function(){e($(this),!1)})},enterEditMode:function(n,r){var i=t.controller.columnManager.get(n),s=K.getColumnElementByKey(n),o;s.length&&(s.addClass(y),o=$(C,s),e.attachTo(o,{column:i,expandContentFilter:r==="content-filter",expandUserFilter:r==="user-filter",expandActionFilter:r==="action-filter",expandEngagementFilter:r==="engagement-filter",columnType:i.getColumnType()}))},exitEditMode:function(e){var t=K.getColumnElementByKey(e),n=$(C,t);if(!t.hasClass(y))return;t.removeClass(y),n.trigger("uiColumnOptionsCloseAction")},isFrozen:function(e){var t=h[e];return t?d[e]!==0:!1},freezeScroll:function(e){var t=h[e];if(!t)return!1;var n=d[e];return v[e]||(c[e]=t[0].scrollHeight-n),n!==0},unfreezeScroll:function(e,t){var n=h[e],r=c[e],i=p[e],s=d[e],o;if(v[e])return;if(!n)return;r&&s>0?(o=n[0].scrollHeight-r,n.scrollTop(o),d[e]=o,t&&t()):z(n),i&&i.resizeScroller()},addColumnsToView:function(e){V(e),$(P).show()},removeColumn:function(e){var t=K.getColumnElementByKey(e);t.trigger("uiRemoveColumn"),t.remove(),delete d[e],delete h[e],delete p[e]},_moveColumnInstantly:function(e,t,r,i,s,o){r.length>0&&r.attr("data-column")!==s[i+1]&&(o[r.attr("data-column")]=r.detach()),e?t.insertAfter(e):t.prependTo(n)},_getOriginalWidth:function(e){return e.data("originalWidth")||parseInt(e.css("width"),10)},_storeOriginalWidth:function(e){var t=e.data("originalWidth");t===undefined&&(t=parseInt(e.css("width"),10)),e.data("originalWidth",t)},_isColumnOffScreen:function(e){return e.position().left+this._getOriginalWidth(e)<0||e.position().left+this._getOriginalWidth(e)>r.width()},_moveColumnToNewIndex:function(e,t,r,i,s){var o=t[e],u=r[o]||n.children('[data-column="'+o+'"]'),a=u.index(),f,l,c,h=function(){u.removeClass(b),i=u,delete r[o]};t.length>=e?(f=n.children(A).filter('[data-column="'+t[e+1]+'"]'),l=f.index()):(f=!1,l=-1),e<t.length&&a!==l&&(u.hasClass(b)?(this._storeOriginalWidth(u),this._moveColumnInstantly(i,u,f,e,t,r),this._isColumnOffScreen(u)?(c=this.scrollColumnToCenter(u.attr("data-column")),c.addCallback(function(){h(),K._moveColumnToNewIndex(e+1,t,r,i,s)})):(K.focusColumn(u.attr("data-column"),K.COLUMN_GLOW_DURATION),h(),K._moveColumnToNewIndex(e+1,t,r,i,s))):(i=u,this._moveColumnToNewIndex(e+1,t,r,i,s)))},reorderColumns:function(e){var t={},r=null,i=n.children("."+b);i.length>0?this._moveColumnToNewIndex(0,e,t,r,i):_.each(e,function(i,s){var o=t[i]||K.getColumnElementByKey(i),u=n.children(A).eq(s);u[0]!==o[0]&&(e.length>s+1&&u.length>0&&u.attr("data-column")!==e[s+1]&&(t[u.attr("data-column")]=u.detach()),s===0?o.prependTo(n):o.insertAfter(r),delete t[i]),r=o})},calculateScrollDuration:function(e,t,n){n=n||a,t=t||l;var r=f+e/100*t;return r=Math.min(r,n),r},scrollColumnToCenter:function(e){var s=K.getColumnElementByKey(e),o=r.innerWidth()/s.outerWidth(!0),u,c,h,p,d,v,m,g,y=r.scrollLeft(),b,w=!0;return o<=3.05?(b=parseInt(n.css("padding-left"),10),p=y+s.position().left-b):(d=s.outerWidth(),v=r.get(0).scrollWidth-i,m=n.width(),g=s.offset().left,p=y+g-(m-d)/2,p=Math.min(p,v-m),p=Math.max(p,0)),o<2&&(w=!1),p!==y?(r.stop(),u=Math.abs(p-y),c=f+u/100*l,c=Math.min(c,a),h=new t.core.defer.Deferred,r.animate({scrollLeft:p},c,"easeInOutQuad",function(){w&&t.ui.columns.focusColumn(e,K.COLUMN_GLOW_DURATION),h.callback()})):(w&&t.ui.columns.focusColumn(e,K.COLUMN_GLOW_DURATION),h=t.core.defer.succeed()),h},getLeftmostColumn:function(){var e=null;return n.children(A).each(function(){e||($(this).position().left<10&&$(this).position().left>=0?e=this:$(this).position().left>10&&(e=$(this).prev()))}),$(e)},scrollColumn:function(e){$.fn.reverse=[].reverse;var t,s,o=r[0].scrollWidth-r.outerWidth(),u=!1,a=!1,f,l=0;e==="right"?t=this.getLeftmostColumn().next():t=this.getLeftmostColumn().prev(),t.length?(s=r.scrollLeft()+t.position().left,s>o?(u=!0,f=r[0].scrollWidth-(r.scrollLeft()+r.outerWidth()),f>0&&r.stop().animate({scrollLeft:o},350)):r.stop().animate({scrollLeft:s-i},350)):a=!0,u&&f===0&&n.find(A).last().animate({marginRight:20},{duration:150,complete:function(){$(this).animate({marginRight:0},150),r.scrollLeft(r[0].scrollWidth)},step:function(e){r.not(":animated").scrollLeft(r.scrollLeft()+e-l),l=e}}),a&&this.bounceLeft()},bounceLeft:function(){n.animate({marginLeft:g},m,function(){n.animate({marginLeft:0},m)})},bounceRight:function(){var e=n.find(A).last(),t=parseInt(e.css("marginRight"),10);e.animate({marginRight:t+g},{duration:m,complete:function(){$(this).animate({marginRight:t},m)},step:function(e){r.scrollLeft(r[0].scrollWidth)}})},scrollPage:function(e){$.fn.reverse=[].reverse;var t=e==="left"?-1:1,s,o=r.innerWidth(),u=n.children(A).outerWidth()+i,a=Math.floor(o/u),f=r.scrollLeft()+a*u*t,l,c,h,p;if(e==="left"&&f>0){c=a*u*t;for(var d=0;d<n.children(A).length;d++){var v=n.children(A).eq(d),m=v.position().left;m<c&&(l=v.next())}l&&(f=r.scrollLeft()-l.position().left*-1)}f<0?f=0:f+o>r[0].scrollWidth&&(f=r[0].scrollWidth-o),f===r.scrollLeft()&&e==="left"?this.bounceLeft():f===r.scrollLeft()&&e==="right"?this.bounceRight():(p=Math.abs(f-r.scrollLeft()),s=this.calculateScrollDuration(p,50,1e3),s<700?r.is(":animated")?h="easeOutQuad":h="easeInOutQuad":r.is(":animated")?h="easeOutQuart":h="easeInOutQuart",r.stop().animate({scrollLeft:f},{duration:s,easing:h}))},focusColumn:function(e,r){$(E,n).removeClass(w),K.getColumnElementByKey(e).addClass(w),_.isNumber(r)&&_.delay(function(){t.ui.columns.unfocusColumn(e)},r)},unfocusColumn:function(e){K.getColumnElementByKey(e).removeClass(w)},setMovingColumn:function(e){K.getColumnElementByKey(e).addClass(b)},getColumnElementByKey:function(e){return $(A+'[data-column="'+e+'"]')}};return K}()}),define("ui/column_controller",["flight/component","ui/with_column_selectors","ui/with_template","ui/with_transitions","ui/column","td/UI/columns"],function(e,t,n,r,i,s){var o=function(){this.defaultAttrs({columnsContainerSelector:".js-app-columns",containerSelector:"#container",columnDragHandleSelector:".js-column-drag-handle",appContentSelector:".js-app-content",columnsLeftMargin:10,slideMinDuration:200,slideMaxDuration:500,extraSlideTimePer100Px:20,scrollChirpToTopDuration:750,scrollChirpToTopOffset:50,focusId:null}),this.handleColumnFocus=function(e,t){var n;t.index!==undefined?n=this.getKeyForColumnAtIndex(t.index):t.last?n=this.getKeyForLastColumn():t.columnKey&&(n=t.columnKey),n&&TD.ui.columns.scrollColumnToCenter(n)},this.handleScrollToColumn=function(e,t){var n=this.getColumnElementByKey(t.column.model.getKey()),r=this.select("containerSelector"),i=this.select("columnsContainerSelector"),s,o,u=n.outerWidth(),a=i.width(),f=r.scrollLeft(),l=n.position().left,c=l+u,h;if(l>=0&&c<=a)return;t.direction==="left"?h=f+l-t.offset:h=f+c+t.offset-a,h!==f&&(r.stop(),s=Math.abs(h-f),o=this.attr.slideMinDuration+s/100*this.attr.extraSlideTimePer100Px,o=Math.min(o,this.attr.slideMaxDuration),r.animate({scrollLeft:h},o,"easeInOutQuad"))},this.handleScrollToChirp=function(e,t){if(!t.$chirp||!t.columnKey||t.$chirp.length===0)return;var n=this.getColumnScrollContainerByKey(t.columnKey),r=n.scrollTop(),i=t.$chirp.position().top+r,s=n.innerHeight(),o,u;t.direction==="up"?(o=i-t.offset,o<r&&n.stop().animate({scrollTop:o},100)):(u=i+t.$chirp.outerHeight()+t.offset,u>r+s&&(o=u-s,n.stop().animate({scrollTop:o},100)))},this.handleColumnRendered=function(e,t){t.$column.trigger("itemadded.dragdroplist",{itemId:t.column}),i.attachTo(t.$column,{column:t.column,focusId:this.attr.focusId})},this.calculateColumnVisibilities=function(){var e=this.select("columnSelector"),t=this.$scrollContainer.width(),n={};e.each(function(e){var r=$(this),i=r.position(),s=r.width(),o;i.right=i.left+s,i.left=Math.max(0,i.left),i.right=Math.max(0,i.right),i.left=Math.min(t,i.left),i.right=Math.min(t,i.right),o={columnWidth:s,visibleWidth:i.right-i.left,visibleHeight:r.height()},o.visibleFraction=o.visibleWidth/o.columnWidth,n[r.data("column")]=o}),this.trigger("uiColumnVisibilities",n)},this.after("initialize",function(){this.$scrollContainer=this.select("containerSelector"),this.on(document,"uiColumnFocus",this.handleColumnFocus),this.on(document,"uiColumnsScrollToColumn",this.handleScrollToColumn),this.on(document,"uiColumnsScrollToChirp",this.handleScrollToChirp),this.on(document,"uiColumnRendered",this.handleColumnRendered),this.select("columnSelector").each(function(e,t){var n=$(t);i.attachTo(n,{focusId:this.attr.focusId})}.bind(this)),this.select("columnsContainerSelector").dragdroplist({selector:this.attr.columnSelector,contentSelector:this.attr.columnSelector,handle:this.attr.columnDragHandleSelector,$boundary:this.select("appContentSelector"),orientation:"horizontal",tagName:"section",scroll_speed:24}).on("dropped.dragdroplist",function(){var e=[];$(".js-column").each(function(){e.push($(this).attr("data-column"))}),TD.storage.clientController.client.setColumnOrder(e)}),this.on(document,"dataColumnOrder",this.calculateColumnVisibilities),this.on(this.$scrollContainer,"scroll",this.calculateColumnVisibilities),this.on(window,"resize",this.calculateColumnVisibilities)})};return e(o,t,n,r)}),define("ui/with_focus",[],function(){var e=function(){this.focusRequest=function(){this.trigger("uiFocusRequest",{id:this.focusId})},this.focusRelease=function(){this.trigger("uiFocusRelease",{id:this.focusId})},this.handleFocus=function(e,t){t.id===this.focusId?this.hasFocus=!0:this.hasFocus=!1},this.after("teardown",function(){this.trigger("uiFocusRelease",{id:this.focusId})}),this.after("initialize",function(){this.focusId=this.attr.focusId||_.uniqueId("focus"),this.hasFocus=!1,this.on(document,"uiFocus",this.handleFocus),this.attr.autoFocus===!0&&this.focusRequest()})};return e}),define("ui/grid",["flight/component","ui/with_focus","ui/with_column_selectors"],function(e,t,n){var r=function(){this.defaultAttrs({id:"grid",focusId:null,chirpScrollOffset:20,columnScrollOffset:20,isSelectedClass:"is-selected-tweet",chirpSelector:".js-stream-item",autoFocus:!0,pagingEasingFunction:"easeOutQuad"}),this.setSelectedColumn=function(e){var t=this.columns.length;e<0?e=0:e>=t&&(e=t-1),this.columns[e]!==this.selectedColumn&&(clearTimeout(this.chirpCenterTimeout),this.chirpCenter=this.calculateChirpCenterRelativeToColumn(this.selectedColumn,this.$selectedChirp),this.chirpCenterTimeout=setTimeout(function(){this.chirpCenter=null}.bind(this),1e3),this.selectedColumn=this.columns[e],this.columnIndex=e,this.chirpCenter===null?this.selectFirstChirpInSelectedColumn():this.selectClosestChirpToOffsetCenter(this.selectedColumn,this.chirpCenter,!0))},this.selectClosestChirpToOffsetCenter=function(e,t,n){var r=this.selectedColumn.model.getKey(),i=this.getColumnScrollContainerByKey(r),s=i.innerHeight(),o=i.find(this.attr.chirpSelector),u=$(),a=null,f=Number.MAX_VALUE;o.each(function(){var e=$(this),n=e.position().top,r=n+e.outerHeight();r>=0&&n<=s&&n<=t&&r>=t&&(u=$().add(e))}),u.length===0?a=o.last():u.length===1?a=u:u.each(function(n,r){var i=this.calculateChirpCenterRelativeToColumn(e,$(r)),s=Math.abs(t-i);f=Math.min(s,f),s===f&&(a=$(r))}.bind(this)),this.setSelectedChirp(a,n)},this.calculateChirpCenterRelativeToColumn=function(e,t){if(t.length===0||this.chirpCenter!==null)return this.chirpCenter;var n,r,i,s=e.model.getKey(),o=this.getColumnScrollContainerByKey(s).innerHeight();return n=t.position().top,r=t.outerHeight(),i=n+r/2,i>o?i=o:i<0&&(i=0),i},this.selectFirstChirpInSelectedColumn=function(){var e;if(this.isInDetailView())this.$selectedChirp=this.selectedColumn.detailViewComponent.getMostInteresting$Chirp();else if(!this.isInDetailViewLevel2()){e=this.selectedColumn.model.getKey();var t=this.getColumnElementByKey(e).find(this.attr.chirpSelector);this.$selectedChirp.removeClass(this.attr.isSelectedClass),this.$selectedChirp=$(),t.each(function(e,t){var n=$(t);if(n.position().top+n.outerHeight()/2>0)return this.$selectedChirp=n,!1}.bind(this)),this.$selectedChirp.length===0&&(this.$selectedChirp=t.first())}this.$selectedChirp.addClass(this.attr.isSelectedClass),this.scrollToChirp("up")},this.setSelectedChirp=function(e,t){this.$selectedChirp.length>0&&this.$selectedChirp.removeClass(this.attr.isSelectedClass),this.$selectedChirp=e,this.$selectedChirp.addClass(this.attr.isSelectedClass),t&&this.$selectedChirp.length>0&&this.scrollToChirp(this.scrollDirection)},this.selectPrevChirp=function(){var e,t,n;this.chirpCenter=null,this.isInDetailView()?(t=this.selectedColumn.detailViewComponent.$find(this.attr.chirpSelector),n=t.index(this.$selectedChirp),e=t.eq(Math.max(0,n-1))):e=this.$selectedChirp.prev(this.attr.chirpSelector),e.length===0?this.selectFirstChirpInSelectedColumn():this.setSelectedChirp(e,!0)},this.selectNextChirp=function(){var e,t,n;this.chirpCenter=null,this.isInDetailView()?(t=this.selectedColumn.detailViewComponent.$find(this.attr.chirpSelector),n=t.index(this.$selectedChirp),e=t.eq(Math.min(t.length-1,n+1))):this.$selectedChirp.next(this.attr.chirpSelector).length>0?e=this.$selectedChirp.next(this.attr.chirpSelector):e=this.$selectedChirp,e.length===0?this.selectFirstChirpInSelectedColumn():this.setSelectedChirp(e,!0)},this.moveSelection=function(e){var t=function(){var t;if(this.hasFocus)if(this.selectedColumn===null)this.setSelectedColumn(0);else{this.scrollDirection=e;switch(e){case"left":t=this.columnIndex===null?0:this.columnIndex-1,this.setSelectedColumn(t);break;case"right":t=this.columnIndex===null?0:this.columnIndex+1,this.setSelectedColumn(t);break;case"up":this.selectPrevChirp();break;case"down":this.selectNextChirp();break;default:}this.trigger("uiColumnsScrollToColumn",{column:this.selectedColumn,source:this.attr.id,offset:this.attr.columnScrollOffset,direction:this.scrollDirection})}},n=_.throttle(t.bind(this),100);return n},this.handleColumnOrderData=function(e,t){t.columns&&(this.columns=t.columns,this.columnIndex=null,this.selectedColumn&&this.columns.forEach(function(e,t){this.selectedColumn===e&&(this.columnIndex=t)}.bind(this)),this.columnIndex===null&&(this.selectedColumn=null,this.$selectedChirp=$(),this.offset=null))},this.selectColumnByKey=function(e){if(this.selectedColumn&&this.selectedColumn.model.getKey()===e)return!1;for(var t=0;t<this.columns.length;t++)if(this.columns[t].model.getKey()===e)return this.columnIndex=t,this.selectedColumn=this.columns[t],!0;return!1},this.selectColumnByIndex=function(e){return this.selectedColumn!==this.columns[e]?(this.columnIndex=e,this.selectedColumn=this.columns[e],!0):!1},this.selectLastColumn=function(){return this.selectColumnByIndex(this.columns.length-1)},this.handleColumnFocus=function(e,t){if(!this.hasFocus)return;var n=!1;this.$selectedChirp.removeClass(this.attr.isSelectedClass),t.columnKey!==undefined?n=this.selectColumnByKey(t.columnKey):t.index!==undefined?n=this.selectColumnByIndex(t.index):t.last===!0&&(n=this.selectLastColumn()),n?(this.$selectedChirp=$(),this.chirpIndex=null,this.offset=null):(this.$selectedChirp.addClass(this.attr.isSelectedClass),this.selectedColumn.visibility.visibleFraction===1&&this.trigger("uiGridHome"))},this.clearSelection=function(){this.$selectedChirp.removeClass(this.attr.isSelectedClass),this.$selectedChirp=$(),this.selectedColumn=null,this.chirpIndex=null,this.columnIndex=null,this.offset=null},this.scrollToChirp=function(e){this.trigger("uiColumnsScrollToChirp",{columnKey:this.selectedColumn.model.getKey(),$chirp:this.$selectedChirp,direction:e,offset:this.attr.chirpScrollOffset})},this.handleBack=function(){var e,t,n,r;this.hasFocus&&(r=this.getColumnElementByKey(this.selectedColumn.model.getKey()),this.isInDetailView()?(e=this.selectedColumn.detailViewComponent.parentChirp,n=this.selectedColumn.getChirpContainer(),t=n.find('[data-key="'+e.id+'"]'),r.trigger("uiCloseDetailView"),t.addClass(this.attr.isSelectedClass),this.$selectedChirp=t,this.scrollToChirp("down")):this.isInDetailViewLevel2()&&r.trigger("uiCloseSocialProof"))},this.handleClearSelection=function(){this.hasFocus&&this.clearSelection()},this.isInDetailView=function(){var e=this.getColumnElementByKey(this.selectedColumn.model.getKey());return e.hasClass(this.attr.columnStateDetailViewClass)},this.isInDetailViewLevel2=function(){var e=this.getColumnElementByKey(this.selectedColumn.model.getKey());return e.hasClass(this.attr.columnStateSocialProofClass)},this.tweetActionFactory=function(e){return function(){var t,n,r,i;if(this.hasFocus&&this.$selectedChirp.length>0&&!this.isInDetailViewLevel2()){n=this.$selectedChirp.attr("data-key"),t=this.selectedColumn.findMostInterestingChirp(n);if(!t)return;switch(e){case"profile":t.getMainUser?r=t.getMainUser():t.getRelatedUser&&(r=t.getRelatedUser()),r&&this.trigger("uiShowProfile",{id:r.screenName});break;case"viewDetails":if(t instanceof TD.services.TwitterDirectMessage)return;default:if(t instanceof TD.services.TwitterAction)return;e==="reply"&&(t instanceof TD.services.TwitterDirectMessage||t instanceof TD.services.TwitterMessageThread)?i="dm":i=e,this.parentChirp=this.selectedColumn.findChirp(n),$.publish("chirp/action",[i,t,this.parentChirp,this.selectedColumn])}}else switch(e){case"dm":this.trigger("uiShowMessageCompose")}}.bind(this)},this.handleDetailViewActive=function(e,t){var n=t.$chirp.closest(this.attr.columnSelector);this.selectColumnByKey(n.attr("data-column")),this.$selectedChirp.removeClass(this.attr.isSelectedClass),this.$selectedChirp=t.$chirp,this.parentChirp===t.parentChirp&&this.$selectedChirp.addClass(this.attr.isSelectedClass)},this.handleDetailClosed=function(e,t){var n;t&&t.column&&(n=t.column.model.getKey(),this.$selectedChirp.removeClass(this.attr.isSelectedClass),this.selectColumnByKey(n),this.$selectedChirp=$())},this.handlePagingFactory=function(e){var t=function(){if(this.hasFocus&&this.selectedColumn){var t,n=this.selectedColumn.model.getKey(),r=this.getColumnScrollContainerByKey(n),i=r.scrollTop(),s=r.innerHeight(),o,u,a,f,l,c;this.$selectedChirp.length===0&&this.selectFirstChirpInSelectedColumn(),this.chirpOffsetTop!==null?t=this.chirpOffsetTop:(t=this.$selectedChirp.position().top,this.targetChirpOffsetTop=null),this.chirpOffsetTop=t,this.$selectedChirp.removeClass(this.attr.isSelectedClass);if(e==="down"){this.targetChirpOffsetTop=this.targetChirpOffsetTop===null?t+s:this.targetChirpOffsetTop+s;do l=this.$selectedChirp.next(this.attr.chirpSelector),l.length>0&&(this.$selectedChirp=l);while(l.length>0&&l.position().top<this.targetChirpOffsetTop);o=i+(this.$selectedChirp.position().top-t),o+s+50>r.get(0).scrollHeight&&(o+=50),u=o-i}else{this.targetChirpOffsetTop=this.targetChirpOffsetTop===null?t-s:this.targetChirpOffsetTop-s;do f=this.$selectedChirp.prev(this.attr.chirpSelector),f.length>0&&(this.$selectedChirp=f);while(f.length>0&&f.position().top>this.targetChirpOffsetTop);o=i-(t+Math.abs(this.$selectedChirp.position().top)),u=i-o}this.$selectedChirp.addClass(this.attr.isSelectedClass),c=function(){this.chirpOffsetTop=null,this.targetChirpOffsetTop=null}.bind(this),a=TD.ui.columns.calculateScrollDuration(u,50,750),r.stop().animate({scrollTop:o},a,this.attr.pagingEasingFunction,c)}};return t.bind(this)},this.handleGridHome=function(){if(!this.hasFocus||!this.selectedColumn)return;this.chirpOffsetTop=null,this.targetChirpOffsetTop=null;var e=this.selectedColumn.model.getKey(),t=this.getColumnScrollContainerByKey(e),n=t.scrollTop(),r=TD.ui.columns.calculateScrollDuration(n,20,300);this.$selectedChirp.removeClass(this.attr.isSelectedClass),this.$selectedChirp=this.$selectedChirp.parent().find(".js-stream-item:first"),this.$selectedChirp.addClass(this.attr.isSelectedClass),t.stop().animate({scrollTop:0},r,this.attr.pagingEasingFunction)},this.handleGridEnd=function(){if(!this.hasFocus||!this.selectedColumn)return;this.chirpOffsetTop=null,this.targetChirpOffsetTop=null;var e=this.selectedColumn.model.getKey(),t=this.getColumnScrollContainerByKey(e),n=t.scrollTop(),r=t.get(0).scrollHeight-t.innerHeight()+50,i=r-n,s=TD.ui.columns.calculateScrollDuration(i,20,300);this.$selectedChirp.removeClass(this.attr.isSelectedClass),this.$selectedChirp=this.$selectedChirp.parent().find(".js-stream-item:last"),this.$selectedChirp.addClass(this.attr.isSelectedClass),t.stop().animate({scrollTop:r},s,this.attr.pagingEasingFunction)},this.after("initialize",function(){this.selectedColumn=null,this.$selectedChirp=$(),this.columnIndex=null,this.chirpCenter=null,this.scrollDirection=this.attr.down,this.chirpOffsetTop=null,this.on(document,"uiGridLeft",this.moveSelection("left")),this.on(document,"uiGridUp",this.moveSelection("up")),this.on(document,"uiGridRight",this.moveSelection("right")),this.on(document,"uiGridDown",this.moveSelection("down")),this.on(document,"uiGridBack",this.handleBack),this.on(document,"uiGridClearSelection",this.handleClearSelection),this.on(document,"uiColumnFocus",this.handleColumnFocus),this.on(document,"uiGridPageDown",this.handlePagingFactory("down")),this.on(document,"uiGridPageUp",this.handlePagingFactory("up")),this.on(document,"uiGridHome",this.handleGridHome),this.on(document,"uiGridEnd",this.handleGridEnd),this.on(document,"uiGridShowDetail",this.tweetActionFactory("viewDetails")),this.on(document,"uiGridReply",this.tweetActionFactory("reply")),this.on(document,"uiGridFavorite",this.tweetActionFactory("favorite")),this.on(document,"uiGridRetweet",this.tweetActionFactory("retweet")),this.on(document,"uiGridDirectMessage",this.tweetActionFactory("dm")),this.on(document,"uiGridProfile",this.tweetActionFactory("profile")),this.on(document,"uiDetailViewActive",this.handleDetailViewActive),this.on(document,"uiShowSocialProof",this.handleDetailViewActive),this.on(document,"uiDetailViewClosed",this.handleDetailClosed),this.on(document,"dataColumnOrder",this.handleColumnOrderData),this.trigger("uiNeedsColumnOrder",{source:this.attr.id})})};return e(r,t,n)}),define("ui/focus_controller",["flight/component"],function(e){var t=function(){this.handleFocusRequest=function(e,t){t&&t.id!==undefined&&this.focusHistory[this.focusHistory.length-1]!==t.id&&(this.focusHistory.push(t.id),this.trigger("uiFocus",{id:t.id}))},this.handleFocusRelease=function(e,t){t&&t.id!==undefined&&(this.focusHistory[this.focusHistory.length-1]===t.id?(this.focusHistory=this.focusHistory.filter(function(e){return e!==t.id}),this.focusHistory.length>0&&_.defer(function(){this.trigger("uiFocus",{id:this.focusHistory[this.focusHistory.length-1]})}.bind(this))):this.focusHistory=this.focusHistory.filter(function(e){return e!==t.id}))},this.after("initialize",function(){this.focusHistory=[],this.on(document,"uiFocusRequest",this.handleFocusRequest),this.on(document,"uiFocusRelease",this.handleFocusRelease)})};return e(t)}),define("ui/confirmation_dialog_controller",["flight/component"],function(e){var t=function(){this.showConfirmationDialog=function(e,t){this.trigger(document,"uiConfirmationAction",{id:t.id,result:confirm(t.message)?!0:!1})},this.after("initialize",function(e){this.on(document,"uiShowConfirmationDialog",this.showConfirmationDialog)})};return e(t)}),define("util/notifications",[],function(){var e={};return e.publishToQueue=function(e,t){TD.storage.notification.notify(e,t)},e.publish=function(e,t){$.publish(e,t)},e.subscribe=function(e,t){return $.subscribe(e,t)},e.unsubscribe=function(e){$.unsubscribe(e)},e}),define("ui/with_modal",["util/notifications","flight/compose","ui/with_focus"],function(e,t,n){function r(){t.mixin(this,[n]),this.defaultAttrs({dismissButton:".js-dismiss",modalPanel:".js-modal-panel",modalDragHandle:".mdl-drag-handle",isDraggingClass:"is-dragging",autoFocus:!0}),this.handleDragStart=function(){var e=this.select("modalPanel");e.css({position:"absolute",top:e.offset().top,left:e.offset().left}),this.$node.addClass(this.attr.isDraggingClass)},this.getDragDropBoundary=function(){return this.$node},this.before("initialize",function(){this.trigger("uiCloseModal")}),this.dismiss=function(){this.attr.closeEvent&&this.trigger(this.attr.closeEvent)},this.handleClickOnOverlay=function(e){e.target===this.$node.get(0)&&this.dismiss()},this.after("teardown",function(){this.$node.hide()}),this.after("initialize",function(){this.on(this.$node,"click",this.handleClickOnOverlay),this.on("click",{dismissButton:this.dismiss}),this.on(document,"uiCloseModal",this.dismiss)}),this.after("render",function(){this.select("modalPanel").draggable({boundary:this.getDragDropBoundary.bind(this),handle:this.select("modalDragHandle")}),this.on("start.draggable",this.handleDragStart),this.focusRequest()}),this.before("teardown",function(){this.$node.removeClass(this.attr.isDraggingClass)})}return r}),define("ui/embed_tweet",["flight/component","ui/with_template","ui/with_modal"],function(e,t,n){function r(){this.defaultAttrs({embedDataCache:{},includeParentTweet:!0,includeMedia:!0,closeEvent:"uiCloseEmbedTweet",dataEmbeddedTweetEvent:"dataEmbeddedTweet",dataEmbeddedTweetErrorEvent:"dataEmbeddedTweetError",embedTextArea:".js-embed-textarea",embedIncludeParentCheckBox:".js-embed-include-parent",embedIncludeMediaCheckBox:".js-embed-include-media",modalTitle:".js-header-title",embedIframe:".js-embed-iframe",embedIframeContainer:".js-embed-iframe-container",embedModalPanel:".js-modal-panel",embedModalHeader:".js-mdl-header",embedModalContent:".js-mdl-content",embedLoading:".js-embed-loading-container"}),this.handleEmbeddedTweet=function(e,t){var n,r,i,s,o,u,a,f;if(t&&t.html&&t.request&&t.request.tweetID===this.attr.tweet.id&&t.request.hideThread!==this.includeParentTweet&&t.request.hideMedia!==this.includeMedia){this.putEmbedDataInCache(t),f=function(e){var f;this.render("embed_tweet",{html:t.html,isReply:!!e.inReplyToID,includeParentTweet:this.includeParentTweet,hasMedia:!!e.cards,includeMedia:this.includeMedia}),this.select("modalTitle").text(TD.i("Embed this Tweet")),this.on(this.select("embedTextArea"),"focus",this.handleInputBoxFocus),r=this.select("embedIframe"),i=this.select("embedIframeContainer"),s=this.select("embedModalPanel"),o=this.select("embedModalHeader"),u=this.select("embedModalContent"),a=this.select("embedLoading"),f=function(){i.css("height","auto"),r.height(Math.max($("html",n).outerHeight(),$("body",n).outerHeight(),r.height())),s.height(u.height()+o.outerHeight()),$("a",n).attr("target","_blank")}.bind(this),r.load(function(){a.addClass("is-hidden"),f(),this.resizeIframeIntervalId=setInterval(f,500)}.bind(this)),r[0]&&(n=r[0].contentWindow.document,n.open(),n.write('<!DOCTYPE html><head><base href="https://api.tweetdeck.com"></head><body>'+t.html+"</body>"+"</html>"),n.close())};if(!this.attr.tweet.cards&&this.attr.tweet.hasLink()){var l=TD.controller.clients.getClient(this.attr.tweet.account.getKey());l.show(this.attr.tweet.id,f.bind(this),function(){this.trigger(document,this.attr.dataEmbeddedTweetErrorEvent,t)}.bind(this))}else f.call(this,this.attr.tweet)}},this.handleEmbeddedTweetError=function(e,t){t&&t.request&&t.request.tweetID===this.attr.tweet.id&&(this.teardown(e),TD.controller.progressIndicator.addMessage(TD.i("Sorry, couldn't retrieve embedded Tweet. Please try again later.")))},this.handleInputBoxFocus=function(e){var t=this.select("embedTextArea");_.defer(function(){t.select()})},this.handleEmbeddedTweetOptionsChange=function(e){var t;this.includeParentTweet=$(this.attr.embedIncludeParentCheckBox).prop("checked"),this.includeMedia=$(this.attr.embedIncludeMediaCheckBox).prop("checked"),this.render("embed_tweet",{loading:!0}),t=this.getEmbedDataFromCache(),t?this.trigger(document,"dataEmbeddedTweet",t):this.trigger(document,"uiNeedsEmbeddedTweet",{tweetID:this.attr.tweet.id,hideThread:!this.includeParentTweet,hideMedia:!this.includeMedia})},this.getEmbedDataFromCache=function(){var e=!!this.includeParentTweet,t=!!this.includeMedia,n=this.attr.embedDataCache[e+":"+t];if(n&&n.request.tweetID===this.attr.tweet.id)return n},this.putEmbedDataInCache=function(e){var t=!!this.includeParentTweet,n=!!this.includeMedia;this.attr.embedDataCache[t+":"+n]=e},this.after("teardown",function(){clearInterval(this.resizeIframeIntervalId),this.$node.html("")}),this.after("initialize",function(e){this.includeParentTweet=this.attr.includeParentTweet,this.includeMedia=this.attr.includeMedia,this.render("embed_tweet",{loading:!0}),this.trigger(document,"uiNeedsEmbeddedTweet",{tweetID:this.attr.tweet.id,hideThread:!this.includeParentTweet,hideMedia:!this.includeMedia}),this.on(this.attr.closeEvent,this.teardown),this.on("change",{embedIncludeParentCheckBox:this.handleEmbeddedTweetOptionsChange,embedIncludeMediaCheckBox:this.handleEmbeddedTweetOptionsChange}),this.on(document,this.attr.dataEmbeddedTweetEvent,this.handleEmbeddedTweet),this.on(document,this.attr.dataEmbeddedTweetErrorEvent,this.handleEmbeddedTweetError)})}return e(r,t,n)}),define("ui/keyboard_shortcut_list",["flight/component","ui/with_template","ui/with_modal"],function(e,t,n){function r(){this.defaultAttrs({closeEvent:"uiCloseKeyboardShortcutsList",modalTitle:".js-header-title"}),this.after("teardown",function(){this.$node.html("")}),this.after("initialize",function(e){this.render("keyboard_shortcut_list",{isMac:TD.util.getOSName()==="osx"}),this.select("modalTitle").text(TD.i("Keyboard shortcuts")),this.on(this.attr.closeEvent,this.teardown)})}return e(r,t,n)}),define("ui/with_column_config",[],function(){var e=function(){this.before("initialize",function(){this.columnConfig={DISPLAY_ORDER_PROFILE:TD.controller.columnManager.DISPLAY_ORDER_PROFILE,OPEN_COLUMN_URL_BASE:TD.components.OpenColumnHome.URL_BASE,GO_EVENT:TD.components.OpenColumn.GO_EVENT}})};return e}),define("ui/relationship",["flight/component"],function(e){var t=function(){this.defaultAttrs({states:{unknown:"unknown",following:"following",notFollowing:"notFollowing",blocking:"blocking",me:"me"},classNamesForStates:{unknown:"unknown",following:"s-following",notFollowing:"s-not-following",blocking:"s-blocking",me:"s-thats-you"},followButton:".js-follow-button",menuButton:".js-profile-menu"}),this.resetState=function(){this.$node.removeClass(this.attr.classNamesForStates[this.state])},this.setState=function(e,t){e.following?this.state=this.attr.states.following:this.state=this.attr.states.notFollowing,e.id===t.id&&(this.state=this.attr.states.me),e.blocking&&(this.state=this.attr.states.blocking)},this.handleMenuButtonClick=function(e){this.menu?this.menu.destroy():(this.menu=new TD.components.ProfileMenu(this.select("menuButton"),this.twitterUser),this.menu.setPosition(TD.components.DropDown.POSITION_LEFT),e.stopPropagation())},this.handleFollowButtonClick=function(e){var t={account:this.account,twitterUser:this.twitterUser};switch(this.state){case this.attr.states.following:this.trigger("uiUnfollowAction",t);break;case this.attr.states.notFollowing:this.trigger("uiFollowAction",t);break;case this.attr.states.blocking:this.trigger("uiUnblockAction",t);break;case this.attr.states.me:TD.util.openURL("https://twitter.com/settings/profile");break;case this.attr.states.unknown:break;default:}e.stopPropagation()},this.enableButton=function(){this.select("followButton").attr("disabled",!1)},this.setTargetElementState=function(){this.$node.addClass(this.attr.classNamesForStates[this.state])},this.isRelevantRelationship=function(e){return this.account.isSameUser(e.source.screen_name)&&this.twitterUser.isSameUser(e.target.screen_name)},this.handleRelationshipData=function(e,t){t&&t.relationship&&this.isRelevantRelationship(t.relationship)&&(this.resetState(),this.setState(t.relationship.source,t.relationship.target),this.state!==this.attr.states.unknown&&this.enableButton(),this.setTargetElementState())},this.isRelevantAction=function(e){return e&&e.twitterUser&&e.twitterUser.isSameUser(this.twitterUser)&&e.account===this.account},this.handleActionFactory=function(e){var t=function(t,n){this.isRelevantAction(n)&&(this.resetState(),this.state=this.attr.states[e],this.setTargetElementState())};return t.bind(this)},this.handlePubSubEvent=function(e){var t=function(t,n){n.getAccountKey()===this.account.getAccountKey()&&(this.resetState(),this.state=this.attr.states[e],this.setTargetElementState())};return t.bind(this)},this.destroy=function(e){e.stopPropagation(),this.teardown()},this.destroyMenuReference=function(){this.menu=null},this.after("initialize",function(e){this.account=e.account,this.twitterUser=e.twitterUser,this.state=this.attr.states.unknown,this.on(document,"dataRelationship",this.handleRelationshipData),this.on("click",{followButton:this.handleFollowButtonClick,menuButton:this.handleMenuButtonClick}),this.on("td-dropdown-close",this.destroyMenuReference),this.on(document,"uiFollowAction dataUnfollowActionError",this.handleActionFactory("following")),this.on(document,"uiUnfollowAction dataFollowActionError",this.handleActionFactory("notFollowing")),this.on(document,"uiBlockAction dataUnblockActionError",this.handleActionFactory("blocking")),this.on(document,"uiUnblockAction dataBlockActionError dataReportActionError",this.handleActionFactory("notFollowing")),this.on(document,"uiReportAction",this.handleActionFactory("blocking")),$.subscribe("/user/"+this.screenName+"/block",this.handlePubSubEvent("blocking")),$.subscribe("/user/"+this.screenName+"/unblock",this.handlePubSubEvent("notFollowing")),this.attr.closeEvent&&this.on(this.attr.closeEvent,this.destroy),this.trigger("uiNeedsRelationship",{account:this.account,screenName:this.twitterUser.screenName})})};return e(t)}),define("ui/follow_state",["flight/component"],function(e){var t=function(){this.defaultAttrs({follows:"s-follows"}),this.handleRelationshipData=function(e,t){t&&t.relationship&&this.account.isSameUser(t.relationship.source.screen_name)&&this.twitterUser.isSameUser(t.relationship.target.screen_name)&&this.$node.toggleClass(this.attr.follows,t.relationship.target.following)},this.destroy=function(e){e.stopPropagation(),this.teardown()},this.after("initialize",function(e){if(!(e.account instanceof TD.storage.Account))throw"source must be instance of TD.storage.Account";if(!(e.twitterUser instanceof TD.services.TwitterUser))throw"target must be instance of TD.services.TwitterUser";this.account=e.account,this.twitterUser=e.twitterUser,this.on(document,"dataRelationship",this.handleRelationshipData),this.attr.closeEvent&&this.on(this.attr.closeEvent,this.destroy),this.trigger("uiNeedsRelationship",{account:this.account,screenName:this.twitterUser.screenName})})};return e(t)}),define("ui/twitter_profile",["flight/component","ui/with_template","ui/with_modal","ui/with_column_config","ui/relationship","util/notifications","ui/follow_state","ui/with_transitions"],function(e,t,n,r,i,s,o,u){function a(){this.defaultAttrs({dataAction:"[data-action]",socialProofSelector:".js-social-proof",followFromSelector:".js-action-follow",followStateSelector:".prf-follow-status",closeEvent:"uiCloseTwitterProfile",numUsersInSocialProof:3,isSocialProofAnimatingClass:"social-proof-animating"}),this.handleTwitterAccount=function(e,t){if(t&&t.account&&t.screenName&&t.screenName.toLowerCase()===this.screenName.toLowerCase()){this.twitterUser=t,this.render("twitter_profile",{twitterProfile:{preferredAccount:this.account.getUsername(),profile:this.twitterUser,displayOrderProfile:this.columnConfig.DISPLAY_ORDER_PROFILE,account:this.account,showAccountMenu:!0,hideFromAccountName:!0,isSingleAccount:this.isSingleAccount}}),this.on(this.attr.dataAction,"click",this.handleActionClick),this.twitterUser.isMe()||this.trigger(document,"uiNeedsUserProfileSocialProof",{screenName:this.screenName});var n={account:this.account,twitterUser:this.twitterUser,closeEvent:this.attr.closeEvent};i.attachTo(this.select("followFromSelector"),n),o.attachTo(this.select("followStateSelector"),n)}},this.handleTwitterUserError=function(e,t){t.screenName.toLowerCase()===this.screenName.toLowerCase()&&this.teardown()},this.handleSocialProofData=function(e,t){var n=this.select("socialProofSelector"),r=this.select("modalPanel"),i=[],s=0,o=[],u,a,f,l;if(t.users&&t.users.length){if(t.users.length>this.attr.numUsersInSocialProof){s=t.users.length-this.attr.numUsersInSocialProof;while(i.length<this.attr.numUsersInSocialProof)l=Math.floor(Math.random()*t.users.length),i.push(t.users.splice(l,1)[0])}else i=t.users;i.forEach(function(e){o.push(TD.ui.template.render("text/social_proof_link",e))}),s>0&&o.push(TD.ui.template.render("text/followers_you_follow_link",{screenName:this.screenName})),o.length>1&&(a=o.splice(o.length-1,1)),u=o.join(", "),f=r.position(),r.css("position","absolute").css("left",f.left).css("top",f.top),n.removeClass("is-hidden"),n.html(TD.ui.template.render("twitter_profile_social_proof",{followedByString:u,others:a})),this.transitionExpand(n,this.attr.isSocialProofAnimatingClass)}},this.handleActionClick=function(e){var t=$(e.currentTarget),n=t.data("action"),r=t.data("type"),i=this.columnConfig.OPEN_COLUMN_URL_BASE+"/"+r,o=TD.util.maybeOpenClickExternally(e);o||(this.screenName&&(i+="?screenName="+this.screenName),s.publishToQueue(this.columnConfig.GO_EVENT,{data:i,history:{type:"uiShowProfile",target:document,data:{id:this.screenName}}}),e.preventDefault(),e.stopPropagation())},this.destroy=function(e){e.stopPropagation(),this.teardown()},this.before("teardown",function(){this.trigger(this.select("followStateSelector"),this.attr.closeEvent),this.trigger(this.select("followFromSelector"),this.attr.closeEvent)}),this.after("teardown",function(){this.$node.html("")}),this.handleAccountsForService=function(e,t){this.isSingleAccount=t.accounts.length===1},this.after("initialize",function(e){this.screenName=e.screenName,this.account=e.account,this.screenName.indexOf("@")===0&&(this.screenName=this.screenName.substring(1)),this.on(document,"dataAccountsForService",this.handleAccountsForService),this.trigger(document,"uiNeedsAccountsForService",{service:"twitter"}),this.on(document,"dataTwitterUser",this.handleTwitterAccount),this.on(document,"dataTwitterUserError",this.handleTwitterUserError),this.on(document,"dataUserProfileSocialProof",this.handleSocialProofData),this.render("twitter_profile",{loading:!0}),this.trigger(document,"uiNeedsTwitterUser",{screenName:this.screenName}),this.on(this.attr.closeEvent,this.destroy)})}return e(a,t,n,r,u)}),define("ui/with_dialog_manager",["ui/embed_tweet","ui/keyboard_shortcut_list","ui/twitter_profile"],function(e,t,n){var r=function(){this.showProfile=function(e,t){n.attachTo(this.select("modal"),{screenName:t.id,account:this.preferredAccount}),this.select("modal").show()},this.showCompose=function(e){TD.ui.compose.showComposeWindow()},this.showMessageCompose=function(e){TD.ui.compose.directMessage()},this.showAddColumn=function(e){TD.ui.openColumn.showOpenColumn()},this.showEmbedTweet=function(t,n){e.attachTo(this.select("modal"),{tweet:n.tweet}),this.select("modal").show()},this.showKeyboardShortcutList=function(e,n){t.attachTo(this.select("modal")),this.select("modal").show()},this.after("initialize",function(){this.on("uiShowProfile",this.showProfile),this.on("uiShowCompose",this.showCompose),this.on("uiShowMessageCompose",this.showMessageCompose),this.on("uiShowAddColumn",this.showAddColumn),this.on("uiShowEmbedTweet",this.showEmbedTweet),this.on("uiShowKeyboardShortcutList",this.showKeyboardShortcutList)})};return r}),define("ui/message_banner/with_access_denied_message_banner",[],function(e){var t=function(){this.getReauthorizeAccountMessageData=function(e){return{id:"expired-token-error",text:TD.i("TweetDeck no longer has permission to access account @{{1}}.",{1:e.account.getUsername()}),colors:{background:"#b2d5ed",foreground:"#555"},actions:[{id:"yes-button",action:"trigger-event",label:TD.i("Reauthorize account"),event:{type:"uiReauthorizeTwitterAccount",data:{account:e.account}}},{id:"no-button",action:"trigger-event",label:TD.i("It's fine "),"class":"btn-alt",event:{type:"uiRemoveTwitterAccount",data:{key:e.account.getKey()}}}]}}};return t}),define("ui/message_banner/with_account_suspended_message_banner",[],function(e){var t=function(){this.getAccountSuspendedMessageData=function(e){return{id:"expired-token-error",text:TD.i("Your account @{{1}} is currently suspended.",{1:e.account.getUsername()}),colors:{background:"#b2d5ed",foreground:"#555"},actions:[{id:"yes-button",action:"url-ext",label:TD.i("Visit Suspended Accounts Help page"),url:"https://twitter.com/account/suspended_help"}]}}};return t}),define("ui/message_banner/with_facebook_removed_message_banner",[],function(e){var t=function(){this.getFacebookRemovedMessageData=function(e){return{id:"facebook-account-removed2",text:TD.i("We've removed Facebook integration from TweetDeck"),colors:{background:"#b2d5ed",foreground:"#555"},actions:[{id:"read_more-button",action:"url-ext",label:TD.i("Read More"),url:"http://www.tweetdeck.com/an-update-on-tweetdeck"}]}}};return t}),define("ui/message_banner_container",["flight/component","ui/with_transitions","ui/message_banner/with_access_denied_message_banner","ui/message_banner/with_account_suspended_message_banner","ui/message_banner/with_facebook_removed_message_banner"],function(e,t,n,r,i){var s=function(){this.defaultAttrs({messageSelector:".js-message-banner",applicationSelector:".js-app",isAnimatingClass:"is-application-animating"}),this._onHidden=function(){this.trigger("uiMessageBannerContainerHidden")},this.showAccessDeniedMessage=function(e,t){var n=this.getReauthorizeAccountMessageData(t);$(document).trigger("dataMessage",{message:n})},this.showAccountSuspendedMessage=function(e,t){var n=this.getAccountSuspendedMessageData(t);$(document).trigger("dataMessage",{message:n})},this.showFacebookRemovedMessage=function(e,t){var n=this.getFacebookRemovedMessageData(t);$(document).trigger("dataMessage",{message:n})},this.handleMessageBannerResize=function(){this.transitionTop(this.$application,this.attr.isAnimatingClass,this.$message.outerHeight())},this.handleHideMessageBannerContainer=function(){this.transitionTop(this.$application,this.attr.isAnimatingClass,0,this._boundOnHiddenFn)},this.after("initialize",function(e){this.$application=this.select("applicationSelector"),this.$message=this.select("messageSelector"),this._boundOnHiddenFn=this._onHidden.bind(this),this.on(document,"uiHidingMessageBanner",this.handleHideMessageBannerContainer),this.on(document,"uiMessageBannerShown",this.handleMessageBannerResize),this.on(document,"uiMessageBannerResized",this.handleMessageBannerResize),this.on(document,"dataTwitterAccountAccessDenied",this.showAccessDeniedMessage),this.on(document,"dataTwitterAccountSuspended",this.showAccountSuspendedMessage),this.on(document,"dataFacebookAccountRemoved",this.showFacebookRemovedMessage)})};return e(s,t,n,r,i)}),define("ui/image_upload",["flight/component"],function(e){var t=function(){this.defaultAttrs({ALLOWED_IMAGE_TYPES:["jpg","jpeg","gif","png"],MAX_ALLOWED_FILES:1,MAX_ALLOWED_SIZE:3145728,errors:{TOO_MANY_FILES_ERROR:"tooManyFilesError",MAX_FILES_ALREADY_ADDED_ERROR:"alreadyAddedFileError",INCORRECT_FILETYPE_ERROR:"incorrectFileTypeError",INVALID_FILESIZE_ERROR:"invalidFileSizeError"},states:{WAITING:"waiting",DRAG_OK:"drag_ok",DRAG_ERROR:"drag_error"},uploadInputTemplate:'<input id="file-upload-input" type="file" class="cmp-file-upload" multiple />',uploadInputSelector:"#file-upload-input"}),this.validateFile=function(e){var t=e.type.split("/")[1],n=e.size,r={success:!0};return this.files.length>=this.attr.MAX_ALLOWED_FILES?r.error=this.attr.errors.MAX_FILES_ALREADY_ADDED_ERROR:_.include(this.attr.ALLOWED_IMAGE_TYPES,t)?n>this.attr.MAX_ALLOWED_SIZE&&(r.error=this.attr.errors.INVALID_FILESIZE_ERROR):r.error=this.attr.errors.INCORRECT_FILETYPE_ERROR,r.error&&(r.success=!1),r},this.validateFiles=function(e){var t=this.validateFileCount(e.length);if(!t.success)return t;for(var n=0;n<e.length;n++){validateResult=this.validateFile(e[n]);if(!validateResult.success)return validateResult}return validateResult},this.validateFileCount=function(e){var t={success:!0};return e>this.attr.MAX_ALLOWED_FILES?t.error=this.attr.errors.TOO_MANY_FILES_ERROR:this.files.length>0&&this.files.length+e>this.attr.MAX_ALLOWED_FILES&&(t.error=this.attr.errors.MAX_FILES_ALREADY_ADDED_ERROR),t.error&&(t.success=!1),t},this.handleResetImageUpload=function(e){this.files=[]},this.addFilesToUpload=function(e){var t;if(e){t=this.validateFiles(e);if(!t.success)switch(t.error){case this.attr.errors.TOO_MANY_FILES_ERROR:TD.controller.progressIndicator.addMessage(TD.i("Only one file can be attached to a tweet."));return;case this.attr.errors.MAX_FILES_ALREADY_ADDED_ERROR:TD.controller.progressIndicator.addMessage(TD.i("You have already attached an image."));return;case this.attr.errors.INCORRECT_FILETYPE_ERROR:TD.controller.progressIndicator.addMessage(TD.i("You did not select an image."));return;case this.attr.errors.INVALID_FILESIZE_ERROR:TD.controller.progressIndicator.addMessage(TD.i("The file you selected is greater than the 3MB limit."));return}this.trigger("uiShowCompose"),this.trigger("uiComposeAddPhoto",{files:e}),this.files=_.zip(this.files,e)}},this.handleDragEnterEvent=function(e){if(this.currentDragElement){this.currentDragElement=e.target;return}this.currentDragElement=e.target,this.state=this.attr.states.DRAG_OK;if(e.originalEvent.dataTransfer.items){e.preventDefault();var t=e.originalEvent.dataTransfer.items,n,r,i=this.validateFileCount(t.length);if(!i.success)this.state=this.attr.states.DRAG_ERROR,this.trigger("uiShowDropMessage",{errorCondition:i.error});else{for(var s=0;s<t.length;s++){n=t[s];if(n.kind==="file"){r=this.validateFile(n);if(!r.success){this.state=this.attr.states.DRAG_ERROR,this.trigger("uiShowDropMessage",{errorCondition:r.error});return}}}this.trigger("uiShowDropMessage")}}},this.handleDragLeaveEvent=function(e){this.currentDragElement===e.target&&(this.currentDragElement=null,this.state=this.attr.states.WAITING,this.trigger("uiHideDropMessage"))},this.handleDropEvent=function(e){e.preventDefault();if(this.state===this.attr.states.DRAG_OK){var t=e.originalEvent.dataTransfer.files;this.addFilesToUpload(t)}this.trigger("uiHideDropMessage"),this.state=this.attr.states.WAITING,this.currentDragElement=null},this.cancel=function(e){return e.preventDefault(),!1},this.handleCameraButtonClick=function(e,t){$(this.attr.uploadInputSelector).click()},this.handleFileUploadChange=function(e){this.addFilesToUpload(e.target.files),$(this.attr.uploadInputSelector).remove(),$("body").append(this.attr.uploadInputTemplate)},this.after("initialize",function(){this.files=[],$("body").append(this.attr.uploadInputTemplate),this.on(document,"uiResetImageUpload",this.handleResetImageUpload),this.on(document,"uiCameraButtonClick",this.handleCameraButtonClick),this.on(document,"dragenter",this.handleDragEnterEvent),this.on(document,"dragleave",this.handleDragLeaveEvent),this.on(document,"drop",this.handleDropEvent),this.on(document,"dragover",this.cancel),this.on(document,"change",{uploadInputSelector:this.handleFileUploadChange})})};return e(t)}),define("ui/with_nav_flyover",["flight/compose","ui/with_template"],function(e,t){function n(){e.mixin(this,[t]),this.renderFlyover=function(e,t){var n;t&&t.content?n=t.content:n=e.data("title"),n&&(this.$flyover=this.renderTemplate("column_nav_flyout",{content:n}),$("body").append(this.$flyover),this.repositionFlyover(e))},this.destroyFlyover=function(){this.$flyover&&(this.$flyover.remove(),this.$flyover=null)},this.repositionFlyover=function(e){var t;this.$flyover&&(t=e.offset().top-(this.$flyover.height()-e.height())/2,this.$flyover.css("top",t))}}return n}),define("ui/column_navigation",["flight/component","ui/with_template","ui/with_nav_flyover"],function(e,t,n){function r(){this.defaultAttrs({templateName:"menus/column_nav_menu",contentSelector:".js-column-nav-list",dragAndDropContainerSelector:".js-int-scroller",addColumnButtonSelector:".js-header-add-column",headerActionSelector:".js-header-action",listItemSelector:".js-column-nav-menu-item",dragHandleSelector:".js-drag-handle",listOrientation:"vertical",isNewClass:"is-new"}),this.after("initialize",function(){this.renderColumnNavigation(),this.on(document,"dataColumnsLoaded",this.handleDataColumnsLoaded),this.on(document,"uiMainWindowResized",this.handleUiMainWindowResized),$.subscribe("/storage/client/column_order_changed",this.handleColumnsChanged.bind(this)),$.subscribe("/storage/client/change",this.handleColumnsChanged.bind(this)),this.on(document,"uiReadStateChange",this.handleReadStateChange),this.on(document,"dataSettings",this.handleDataSettings),this.on(document,"uiColumnTitleRefreshed",this.handleColumnTitleRefreshed),this.trigger("uiNeedsSettings"),this.$columnNavScroller=$(".js-column-nav-scroller"),this.$columnNavScroller.antiscroll()}),this.handleDataColumnsLoaded=function(){this.renderColumnNavigation()},this.handleColumnsChanged=function(){this.$columnNavScroller.antiscroll()},this.renderColumnNavigation=function(){var e=TD.controller.columnManager.getAllOrdered(),t=[],n,r;this.select("listItemSelector").each(function(){t.push($(this).attr("data-column"))}),n=t.length!==e.length,r=_.map(e,function(e,r){var i=e.model.getKey(),s=TD.ui.columns.getColumnElementByKey(i);return t[r]!==i&&(n=!0),{key:i,title:e.getTitleHTML(),iconclass:e.getIconClass(),isNew:s.hasClass(this.attr.isNewClass)}}.bind(this)),n&&(this.render(this.attr.templateName,{columns:r}),this.$content=this.select("contentSelector"),this.$addColumnButton=this.select("addColumnButtonSelector"),this.on("click",{headerActionSelector:this.handleClick.bind(this)}),this.select("headerActionSelector").on("mouseover",this.handleListItemMouseover.bind(this)).on("mouseout",this.handleListItemMouseout.bind(this)),this.resizeColumnNavigation(),this.initialiseDragDrop());var i=$(".js-column-nav-list a").find(":hover");i.length||this.destroyFlyover()},this.resizeColumnNavigation=function(){var e=this.$node.height();this.$node&&e&&(this.$content.height()>e?($(document).trigger("uiColumnNavSizeOverflow"),this.$addColumnButton.hide()):($(document).trigger("uiColumnNavSizeNormal"),this.$addColumnButton.show()))},this.handleUiMainWindowResized=function(){this.resizeColumnNavigation(),this.$columnNavScroller.antiscroll()},this.handleClick=function(e){var t=$(e.target).closest("a[data-action]"),n=t.data("action"),r=t.data("column");switch(n){case"jumpto":TD.controller.columnManager.showColumn(r),TD.controller.stats.navbarJumpToColumn();break;case"add-column":TD.ui.openColumn.showOpenColumn(),TD.controller.stats.navbarAddColumnClick(),this.destroyFlyover()}this.trigger(TD.components.BaseModal.CLOSE_EVENT)},this.handleDrop=function(e){var t=[],n=$(e.target).attr("data-column");TD.ui.columns.setMovingColumn(n),this.select("listItemSelector").each(function(){t.push($(this).attr("data-column"))}),TD.storage.clientController.client.setColumnOrder(t),TD.controller.stats.navbarReorderColumns()},this.handleDrag=function(e,t){this.repositionFlyover($(e.target))},this.handleDropped=function(e,t){this.repositionFlyover($(e.target))},this.initialiseDragDrop=function(){this.select("dragAndDropContainerSelector").dragdroplist({handle:this.attr.dragHandleSelector,orientation:this.attr.listOrientation,selector:this.attr.listItemSelector,$boundary:this.$node}).on("drop.dragdroplist",this.handleDrop.bind(this)).on("drag.draggable",this.handleDrag.bind(this)).on("dropped.dragdroplist",this.handleDropped.bind(this))},this.handleReadStateChange=function(e,t){var n=this.$node.find(".js-column-nav-menu-item[data-column="+t.columnKey+"]");n.toggleClass(this.attr.isNewClass,!t.read)},this.handleListItemMouseover=function(e){if(this.isNavbarCollapsed){var t=$(e.currentTarget),n=t.data("column"),r,i,s;n&&(r=TD.controller.columnManager.get(n),s={content:r.getTitleHTML()}),this.isDragging()||this.renderFlyover(t,s)}},this.handleListItemMouseout=function(e){this.isDragging()||this.destroyFlyover()},this.isDragging=function(){return this.$node.find(".draggable-dragging").length>0},this.handleDataSettings=function(e,t){this.isNavbarCollapsed=Boolean(t.navbarWidth==="condensed"),this.destroyFlyover()},this.handleDataColumnStateUpdated=function(e,t){var n=this.$node.find(".js-column-nav-menu-item[data-column="+t.columnKey+"]");t.unread?n.addClass(this.attr.isNewClass):n.removeClass(this.attr.isNewClass)},this.handleColumnTitleRefreshed=function(e,t){var n=this.$node.find(".js-column-nav-menu-item[data-column="+t.columnKey+"] .js-column-title");n.html(t.title)}}return e(r,t,n)}),define("ui/with_popover",["flight/compose","ui/with_template"],function(e,t){function n(){e.mixin(this,[t]),this.defaultAttrs({popoverSelector:".js-popover",popoverContentSelector:".js-popover-content",isHiddenClass:"is-hidden",hasOverlayClass:"has-overlay",defaultHeight:2e3,defaultWidth:310,bottomPadding:30,withClickTrap:!0,withOverlay:!1,repositionPeriod:100,closeModals:!1,positionalClasses:{rt:"popover-position-rt"},popoverPosition:"rt"}),this.after("initialize",function(){this.trigger("uiPopoverCreated",{id:this.attr.id}),this.on(document,"uiCloseModal",this.handleCloseModal),this.boundClickTrap=this.popoverClickTrap.bind(this)}),this.handleCloseModal=function(e){e.target!==this.node&&this.hidePopover()},this.popoverClickTrap=function(e){if(e===this.lastSeenEvent)return;this.lastSeenEvent=e,this.$node&&this.$node.find(e.currentTarget).length===0&&this.hidePopover()},this.isPopoverVisible=function(){return!this.$popover.hasClass(this.attr.isHiddenClass)},this.showPopover=function(e){if(!this.$popover.hasClass(this.attr.isHiddenClass))return;this.$popover.removeClass(this.attr.isHiddenClass),this.withOverlay&&(this.$overlay.removeClass(this.attr.isHiddenClass),this.$overlayControlNode.addClass(this.attr.hasOverlayClass)),this.attr.closeModals&&this.trigger("uiCloseModal"),this.repositionPopover(),this.repositionInterval=this.repositionInterval||setInterval(this.repositionPopover.bind(this),this.attr.repositionPeriod),this.withClickTrap&&_.defer(function(){$("body").on("click","*",this.boundClickTrap)}.bind(this)),this.trigger("uiPopoverShown",{id:this.attr.id})},this.hidePopover=function(e){if(this.$popover.hasClass(this.attr.isHiddenClass))return;$("body").off("click","*",this.boundClickTrap),this.trigger("uiPopoverHiding",{id:this.attr.id}),this.$popover.addClass(this.attr.isHiddenClass),this.$overlay.addClass(this.attr.isHiddenClass),this.$overlayControlNode.removeClass(this.attr.hasOverlayClass),clearInterval(this.repositionInterval),this.repositionInterval=null,this.trigger("uiPopoverHidden",{id:this.attr.id})},this.showPopoverOverlay=function(){this.withOverlay=!0,this.$overlay.removeClass("is-hidden"),this.$overlayControlNode.addClass(this.attr.hasOverlayClass)},this.hidePopoverOverlay=function(){this.withOverlay=!1,this.$overlay.addClass("is-hidden"),this.$overlayControlNode.removeClass(this.attr.hasOverlayClass)},this.repositionPopover=function(){var e=this.$node.offset().top,t=$(window).height();this.maxHeight=t-e-this.attr.bottomPadding,this.$popover.css({height:this.maxHeight}),this.defaultHeight==="auto"&&(this.height=this.$popoverContent.outerHeight(),this.$popover.css({height:this.height}))},this.setPopoverSize=function(e){this.width=e.width,this.height=e.height,this.$popover.css({width:this.width,height:this.height})},this.getPopoverPositionClass=function(){return this.attr.positionalClasses[this.attr.popoverPosition]},this.renderInPopover=function(e,t,n){n&&(this.defaultHeight=n.defaultHeight||this.attr.defaultHeight,this.withOverlay=n.withOverlay||this.attr.withOverlay,this.withClickTrap=n.withClickTrap||this.attr.withClickTrap),this.$overlay=this.renderTemplate("overlay"),this.$overlayControlNode=this.$node.closest(".js-overlay"),this.$overlay.insertBefore(this.$overlayControlNode),this.render("popover"),this.$popover=this.select("popoverSelector"),this.$popover.addClass(this.getPopoverPositionClass()),this.setPopoverSize({width:this.attr.defaultWidth}),this.$popoverContent=this.select("popoverContentSelector");var r=this.renderTemplate(e,t);this.$popoverContent.append(r)}}return n}),define("ui/search/search_in_popover",["flight/component","ui/with_popover"],function(e,t){function n(){this.defaultAttrs({searchInputSelector:".js-app-search-input",searchInputClassName:"js-app-search-input",searchInPopoverTemplate:"search/search_in_popover",isHiddenClass:null,appSearchSourceId:null,searchPopoverSourceId:null,typeaheadContainer:".js-typeahead-dropdown",searchResultsContainer:".js-search-results-container",searchFormContainer:".js-search-form"}),this.after("initialize",function(){this.renderInPopover(this.attr.searchInPopoverTemplate,{searchInputClassName:this.attr.searchInputClassName,searchInputTitle:TD.i("Search"),searchInputPlaceholder:TD.i("Search")},{defaultHeight:"auto"}),this.$searchResultsContainer=this.select("searchResultsContainer"),this.$typeaheadContainer=this.select("typeaheadContainer"),this.searchData=null,this.on("uiTypeaheadItemSelected",this.handleTypeaheadItemSelect),this.on("uiTypeaheadNoItemSelected",this.handleTypeaheadNoItemSelected),this.on("uiTypeaheadSubmitQuery",this.handleTypeaheadSubmitQuery),this.on("uiTypeaheadItemComplete",this.handleTypeaheadItemComplete),this.on("uiTypeaheadSuggestions",this.handleTypeaheadSuggestions),this.on("uiTypeaheadNoSuggestions",this.handleTypeaheadNoSuggestions),this.on("uiTypeaheadRenderResults",this.handleTypeaheadRenderResults),this.on("uiSearchResultsColumnAdded",this.handleSearchResultsColumnAdded);var e=this.searchInputHandlerFactory.bind(this);this.on(document,"uiSearchInputSubmit",this.handleSearchInputSubmit),this.on(document,"uiSearchInputEscaped",this.handleSearchInputEscaped),this.on(document,"uiSearchInputFocus",this.handleSearchInputFocus),this.on(document,"uiSearchInputChanged",this.handleSearchInputChanged),this.on(document,"uiSearchInputTab",e("uiTypeaheadInputTab")),this.on(document,"uiSearchInputLeft",e("uiTypeaheadInputLeft")),this.on(document,"uiSearchInputRight",e("uiTypeaheadInputRight")),this.on(document,"uiSearchInputMoveUp",e("uiTypeaheadInputMoveUp")),this.on(document,"uiSearchInputMoveDown",e("uiTypeaheadInputMoveDown")),this.on("uiPopoverShown",this.handlePopoverShown),this.on("uiPopoverHiding",this.handlePopoverHiding),this.on("uiPopoverHidden",this.handlePopoverHidden),this.hasTypeaheadResults=!0,this.around("hidePopover",function(e,t){t!==!1&&this.$input&&this.$input.blur(),this.trigger("uiSearchResultsHidden"),e.apply(this)})}),this.handlePopoverShown=function(e,t){this.$input.addClass("is-focused")},this.handlePopoverHiding=function(e,t){this.defaultHeight="auto",this.$searchResultsContainer.addClass("is-hidden"),this.$typeaheadContainer.removeClass("is-hidden")},this.handlePopoverHidden=function(e,t){this.$input.removeClass("is-focused")},this.handleSearchResultsColumnAdded=function(){this.hidePopover()},this.handleSearchInputFocus=function(e,t){this.isCorrectSource(t.source)&&(this.$input=$(e.target),this.isPopoverVisible()||TD.controller.stats.searchboxFocus(),this.isPopoverEmpty()||this.showPopover(),this.trigger("uiFixedHeaderChangedPosition"),this.$typeaheadContainer.hasClass(this.attr.isHiddenClass)?this.showPopoverOverlay():(this.trigger("uiTypeaheadInputFocus",t),this.hidePopoverOverlay(),this.defaultHeight="auto"))},this.searchInputHandlerFactory=function(e){return function(t,n){this.isCorrectSource(n.source)&&!this.$typeaheadContainer.hasClass(this.attr.isHiddenClass)&&this.trigger(e,n)}.bind(this)},this.handleSearchInputChanged=function(e,t){this.isCorrectSource(t.source)&&(this.$input=$(e.target),this.isPopoverVisible()||this.showPopover(),this.hidePopoverOverlay(),this.defaultHeight="auto",this.$searchResultsContainer.addClass("is-hidden"),this.$typeaheadContainer.removeClass("is-hidden"),this.trigger("uiTypeaheadInputChanged",t))},this.isCorrectSource=function(e){return e===this.attr.appSearchSourceId||e===this.attr.searchPopoverSourceId},this.handleSearchInputEscaped=function(e,t){this.isCorrectSource(t.source)&&(this.trigger("uiTypeaheadInputBlur"),this.hidePopover())},this.handleSearchInputSubmit=function(e,t){var n;this.isCorrectSource(t.source)&&(this.searchData=t,twttr.txt.isValidList(t.query)?(n=t.query.split("/"),TD.ui.openColumn.showList(n[0].substr(1),n[1]),this.hidePopover()):(this.trigger("uiTypeaheadInputSubmit",t),TD.controller.stats.searchboxPerformSearch(t.query.length)))},this.handleTypeaheadNoItemSelected=function(){this.searchData&&this.performSearch(this.searchData)},this.handleTypeaheadSubmitQuery=function(e,t){var n;if(twttr.txt.isValidList(t.query)){n=t.query.split("/"),TD.ui.openColumn.showList(n[0].substr(1),n[1]),this.hidePopover();return}},this.performSearch=function(e){e.query&&(this.trigger("uiNewSearchQuery",{query:e.query}),this.defaultHeight="max",this.$typeaheadContainer.addClass("is-hidden"),this.$searchResultsContainer.removeClass("is-hidden"),this.trigger("uiSearch",e),this.showPopover(),this.showPopoverOverlay(),this.searchData=null)},this.handleTypeaheadItemSelect=function(e,t){var n;switch(t.searchType){case"user":this.hidePopover(),this.trigger("uiShowProfile",{id:t.query});break;case"topic":case"saved-search":case"recent-search":this.performSearch(t);break;case"recent-search-clear":this.trigger("uiRecentSearchClearAction");break;case"list":n=t.query.split("/"),TD.ui.openColumn.showList(n[0],n[1]);break;default:}this.searchData=null},this.handleTypeaheadItemComplete=function(e,t){this.$input.trigger("uiAppSearchItemComplete",t)},this.handleTypeaheadNoSuggestions=function(e,t){this.hasTypeaheadResults=!1,this.isPopoverEmpty()&&this.hidePopover(!1),this.trigger("uiAppSearchSetPreventDefault",{preventDefault:!1,key:9})},this.handleTypeaheadSuggestions=function(e,t){this.trigger("uiAppSearchSetPreventDefault",{preventDefault:!0,key:9})},this.handleTypeaheadRenderResults=function(){this.hasTypeaheadResults=!0,this.showPopover()},this.isPopoverEmpty=function(){return!this.hasTypeaheadResults&&!$.contains(this.$popover[0],this.$input[0])}}return e(n,t)}),define("ui/typeahead/with_users",[],function(){return function(){this.defaultAttrs({usersListSelector:".js-typeahead-user-list",usersItemSelector:".js-typeahead-user-item",usersTemplate:"typeahead/typeahead_users"}),this.renderUsers=function(e,t){this.$usersList.find(this.attr.usersItemSelector).remove();var n=t.suggestions.users||[];if(!n.length){this.clearUsers();return}var r=[],i;n.forEach(function(e){r.push({screen_name:e.screen_name,name:e.name,profile_image_url:this.getAvatar(e),verified:e.verified})},this),i=this.toHtml(this.attr.usersTemplate,{users:r}),this.$usersList.toggleClass("has-results",n.length>0).toggleClass("is-hidden",n.length===0).html(i)},this.getAvatar=function(e){return e.profile_image_url_https.replace(/_normal(\..*)?$/i,"_mini$1")},this.clearUsers=function(){this.$usersList.removeClass("has-results"),this.$usersList.addClass("is-hidden")},this.after("initialize",function(){this.$usersList=this.select("usersListSelector"),this.on("uiTypeaheadRenderResults",this.renderUsers)})}}),define("ui/typeahead/with_saved_searches",["flight/compose","ui/with_text_utils"],function(e,t){return function(){e.mixin(this,[t]),this.defaultAttrs({savedSearchesListSelector:".js-typeahead-saved-search-list",savedSearchesItemSelector:".js-typeahead-saved-search-item",savedSearchesTemplate:"typeahead/typeahead_saved_searches"}),this.renderSavedSearches=function(e,t){var n,r=[];this.$savedSearchesList.empty();if(!t.suggestions||!t.suggestions.savedSearches)return;t.suggestions.savedSearches.forEach(function(e){r.push({query:e.query,name:this.highlightSubstring(e.name,t.query)})},this),n=this.toHtml(this.attr.savedSearchesTemplate,{savedSearches:r}),this.$savedSearchesList.toggleClass("has-results",r.length>0).toggleClass("is-hidden",r.length===0).html(n)},this.after("initialize",function(){this.$savedSearchesList=this.select("savedSearchesListSelector"),this.on("uiTypeaheadRenderResults",this.renderSavedSearches)})}}),define("ui/typeahead/with_recent_searches",["flight/compose","ui/with_text_utils"],function(e,t){var n=function(){e.mixin(this,[t]),this.defaultAttrs({recentSearchesListSelector:".js-typeahead-recent-search-list",recentSearchesItemSelector:".js-typeahead-recent-search-item",recentSearchesClearSelector:".js-typeahead-recent-search-clear",recentSearchesTemplate:"typeahead/typeahead_recent_searches",recentSearchesPlaceholderTemplate:"typeahead/recent_searches_placeholder",recentSearchesFixedClass:"recent-searches-fixed-list"}),this.renderRecentSearches=function(e,t){this.currentData=t;var n=t.datasources&&t.datasources.some(function(e){return e==="recentSearches"});if(!n){this.$recentSearchesList.removeClass("has-results").addClass("is-hidden").empty(),this.$clearRecentSearches.addClass("is-hidden").removeClass("is-invisible");return}var r=n&&t.datasources.length===1,i=t.suggestions&&t.suggestions.recentSearches&&t.suggestions.recentSearches.length,s=r&&i,o,u=i||r,a=r&&!i;if(i){var f=[];t.suggestions.recentSearches.forEach(function(e){f.push({query:e,name:this.highlightSubstring(e,t.query)})},this),o=this.toHtml(this.attr.recentSearchesTemplate,{recentSearches:f})}else r?o=this.toHtml(this.attr.recentSearchesPlaceholderTemplate):o="";this.$recentSearchesList.toggleClass(this.attr.recentSearchesFixedClass,r),this.$recentSearchesList.toggleClass("has-results",i).toggleClass("is-hidden",!u).html(o),this.$clearRecentSearches.toggleClass("is-hidden",!r).toggleClass("is-invisible",a)},this.clearRecentSearches=function(e){delete this.currentData.suggestions.recentSearches,this.renderRecentSearches(null,this.currentData)},this.after("initialize",function(){this.$recentSearchesList=this.select("recentSearchesListSelector"),this.$clearRecentSearches=this.select("recentSearchesClearSelector"),this.on("uiRecentSearchClearAction",this.clearRecentSearches),this.on("uiTypeaheadRenderResults",this.renderRecentSearches)})};return n}),define("ui/typeahead/with_topics",["flight/compose","ui/with_text_utils"],function(e,t){return function(){e.mixin(this,[t]),this.defaultAttrs({topicsListSelector:".js-typeahead-topic-list",topicsItemSelector:".js-typeahead-topic-item",topicsTemplate:"typeahead/typeahead_topics"}),this.renderTopics=function(e,t){this.$topicsList.empty();var n=t.suggestions.topics||[];if(!n.length){this.clearTopics();return}var r=n.map(function(e){return{topic:e.topic,name:this.highlightSubstring(e.topic,t.query)}},this),i=this.toHtml(this.attr.topicsTemplate,{topics:r});this.$topicsList.toggleClass("has-results",n.length>0).toggleClass("is-hidden",n.length===0).html(i)},this.clearTopics=function(e){this.$topicsList.removeClass("has-results"),this.$topicsList.addClass("is-hidden")},this.resetTopics=function(){this.clearTopics(),this.$topicsList.find(this.attr.topicsItemSelector).remove()},this.after("initialize",function(){this.$topicsList=this.select("topicsListSelector"),this.on("uiTypeaheadRenderResults",this.renderTopics)})}}),define("ui/typeahead/with_lists",["flight/compose","ui/with_text_utils"],function(e,t){var n=function(){e.mixin(this,[t]),this.defaultAttrs({listsListSelector:".js-typeahead-lists-list",listItemSelector:".js-typeahead-list-item",listTemplate:"typeahead/typeahead_lists"}),this.renderLists=function(e,t){this.currentData=t;var n=t.datasources&&t.datasources.some(function(e){return e==="lists"});if(!n){this.$listsList.removeClass("has-results").addClass("is-hidden").empty();return}var r=t.suggestions&&t.suggestions.lists&&t.suggestions.lists.length,i;if(r){var s=[];t.suggestions.lists.forEach(function(e){s.push({query:e,name:this.highlightSubstring(e,t.query)})},this),i=this.toHtml(this.attr.listTemplate,{lists:s})}else i="";this.$listsList.toggleClass("has-results",r).toggleClass("is-hidden",!r).html(i)},this.after("initialize",function(){this.$listsList=this.select("listsListSelector"),this.on("uiTypeaheadRenderResults",this.renderLists)})};return n}),define("ui/typeahead/typeahead_dropdown",["flight/component","ui/typeahead/with_users","ui/typeahead/with_saved_searches","ui/typeahead/with_recent_searches","ui/typeahead/with_topics","ui/typeahead/with_lists","ui/with_template"],function(e,t,n,r,i,s,o){function u(){this.defaultAttrs({inputSelector:".js-app-search-input",dropdownSelector:".js-typeahead-dropdown",itemsSelector:".js-typeahead-item",itemSelectedClass:"is-selected",itemSelectedSelector:".is-selected",deciders:{showDebugInfo:!1},datasources:["topics","savedSearches","recentSearches","users"],datasourcesRecentOnly:["recentSearches"],queryTypes:["topic","saved-search","recent-search","user"],minHeight:300}),this.after("initialize",function(){this.query=null,this.on(document,"dataTypeaheadSuggestions",this.handleDataTypeaheadSuggestions),this.on("uiTypeaheadInputFocus",this.handleTypeaheadInputFocus),this.on("uiTypeaheadInputBlur",this.handleTypeaheadInputBlur),this.on("uiTypeaheadInputSubmit",this.handleTypeaheadInputSubmit),this.on("uiTypeaheadInputChanged",this.handleTypeaheadInputChanged),this.on("uiTypeaheadInputMoveUp",this.handleTypeaheadInputMoveUp),this.on("uiTypeaheadInputMoveDown",this.handleTypeaheadInputMoveDown),this.on("uiTypeaheadInputRight",this.handleTypeaheadInputMoveRight),this.on("uiTypeaheadInputTab uiTypeaheadInputLeft",this.completeSelection),this.on("mouseover",{itemsSelector:this.handleItemMouseover}),this.on("click",{itemsSelector:this.handleItemClick})}),this.handleTypeaheadInputFocus=function(e,t){this.hasFocus=!0,t.query!==this.query&&this.handleTypeaheadInputChanged(e,t)},this.handleTypeaheadInputBlur=function(){this.hasFocus=!1,this.trigger("dataTypeaheadQueryReset")},this.handleItemMouseover=function(e,t){this.select("itemsSelector").removeClass(this.attr.itemSelectedClass),$(t.el).addClass(this.attr.itemSelectedClass)},this.moveSelection=function(e){var t=this.select("itemsSelector").filter(":visible"),n=t.filter(this.attr.itemSelectedSelector),r;n.removeClass(this.attr.itemSelectedClass),n.length?r=t.index(n)+e:r=-1+e,r<0?r=t.length-1:r>=t.length&&(r=0),t.eq(r).addClass(this.attr.itemSelectedClass)},this.getSelectedItemIndex=function(){var e=this.select("itemsSelector").filter(":visible"),t=e.filter(this.attr.itemSelectedSelector);return e.index(t)},this.handleTypeaheadInputMoveUp=function(e){this.moveSelection(-1)},this.handleTypeaheadInputMoveDown=function(e){this.moveSelection(1)},this.handleTypeaheadInputMoveRight=function(e,t){this.getSelectedItemIndex()===-1?this.moveSelection(1):this.completeSelection(e,t)},this.handleTypeaheadInputChanged=function(e,t){var n=t.query,r=this.attr.datasources;n.trim().length===0&&(r=this.attr.datasourcesRecentOnly),this.query=n,this.select("itemsSelector").removeClass(this.attr.itemSelectedClass),this.trigger("uiNeedsTypeaheadSuggestions",{query:n,datasources:r,dropdownId:this.getDropdownId()})},this.getDropdownId=function(){return this.dropdownId||(this.dropdownId="swift_typeahead_dropdown_"+ +(new Date)),this.dropdownId},this.triggerSelectionEvent=function(e){var t=this.select("itemsSelector"),n=t.index(e),r=this.query,i=e.data("search-query");if(!r&&!i)return;this.trigger("uiTypeaheadItemSelected",{index:n,searchType:e.data("search-type"),query:i,input:r})},this.handleItemClick=function(e,t){var n=$(t.el);this.triggerSelectionEvent(n)},this.handleTypeaheadInputSubmit=function(e){var t=this.select("itemsSelector").filter(this.attr.itemSelectedSelector).filter(":visible").first();t.length?this.triggerSelectionEvent(t):this.trigger("uiTypeaheadNoItemSelected")},this.completeSelection=function(e,t){var n=t&&t.dir==="rtl"?"rtl":"ltr";if(n==="rtl"&&e.type==="uiTypeaheadInputRight")return;if(["ltr",undefined,""].indexOf(n)!==-1&&e.type==="uiTypeaheadInputLeft")return;var r=this.select("itemsSelector").filter(this.attr.itemSelectedSelector).first();if(!r.length){r=this.select("itemsSelector").first();var i=r.data("search-query")!==this.query;if(!i){e.type==="uiTypeaheadInputTab"&&(this.hasFocus=!1);return}}var s=r.data("search-type"),o=this.attr.queryTypes.some(function(e){return e===s});if(!o){e.type==="uiTypeaheadInputTab"&&(this.hasFocus=!1);return}var u=r.data("search-query"),a=this.select("itemsSelector"),f=a.index(r);this.trigger("uiTypeaheadItemComplete",{value:u,searchType:r.data("search-type"),index:f,query:u})},this.handleDataTypeaheadSuggestions=function(e,t){var n=this.select("itemsSelector").filter(this.attr.itemSelectedSelector);if(t.dropdownId!=this.getDropdownId()||t.query!==this.query||!this.hasFocus||n.length)return;this.trigger("uiTypeaheadRenderResults",t);var r=this.attr.datasources.some(function(e){return t.suggestions[e]&&t.suggestions[e].length});r=r||!t.query,r?(this.trigger("uiTypeaheadSuggestions"),this.select("itemsSelector").removeClass("list-item-first").removeClass("list-item-last").filter(":visible").first().addClass("list-item-first").end().last().addClass("list-item-last")):this.trigger("uiTypeaheadNoSuggestions")}}return e(u,o,n,t,i,s,r)}),define("ui/toggle_button",["flight/component","ui/with_template"],function(e,t){var n=function(){this.defaultAttrs({template:"menus/toggle_button",buttonSelector:".js-toggle-button"}),this.handleButtonClick=function(e){var t=$(e.currentTarget),n=t.data("clickevent");n&&(this.trigger(n),this.$buttons.removeClass("is-selected"),t.addClass("is-selected"))},this.handleSelectItem=function(e,t){this.$node.find("."+t.class).click()},this.after("initialize",function(e){var t=this;this.buttons=e.buttons;var n={buttons:[this.buttons.left,this.buttons.right]};this.render(this.attr.template,n),this.$buttons=this.select("buttonSelector"),this.on(this.$buttons,"click",this.handleButtonClick),this.on("uiToggleSelectItem",this.handleSelectItem),this.on("uiToggleButtonDestroy",this.teardown)})};return e(n,t)}),define("ui/user_search_results",["flight/component","ui/with_template","ui/with_user_menu"],function(e,t,n){var r=function(){this.query=null,this.handleSearch=function(e,t){this.query=t.query,this.hideUserMenu(),this.$node.empty(),this.trigger(document,"uiNeedsUserSearch",{query:this.query})},this.handleResults=function(e,t){if(t.query!==this.query)return;this.users=t.result,this.users.length===0?this.render("search_no_users_placeholder"):this.render("menus/user_results",{users:this.users,withUserMenu:!0})},this.after("initialize",function(){this.on(document,"uiSearch",this.handleSearch),this.on(document,"dataUserSearch",this.handleResults),this.on("uiUserResultsDestroy",this.teardown)})};return e(r,t,n)}),define("ui/with_fixed_header_and_footer",["flight/compose","ui/with_template"],function(e,t){var n=function(){e.mixin(this,[t]),this.defaultAttrs({headerSelector:".js-fhf-header",bodySelector:".js-fhf-body",footerSelector:".js-fhf-footer"}),this.after("initialize",function(){this.$headerContainer=this.select("headerSelector"),this.$bodyContainer=this.select("bodySelector"),this.$footerContainer=this.select("footerSelector"),this.on("uiFixedHeaderChangedPosition",this.resizeBody)}),this.resizeBody=function(){var e=0,t=0,n=0;this.$headerContainer.hasClass("is-hidden")?(this.$headerContainer.removeClass("is-hidden"),n=this.$headerContainer.position().top,this.$headerContainer.addClass("is-hidden")):(e=this.$headerContainer.outerHeight(),n=this.$headerContainer.position().top),this.$footerContainer.hasClass("is-hidden")||(t=this.$footerContainer.outerHeight()),this.$bodyContainer.css({top:e+n,bottom:t})},this.hideHeader=function(){this.$headerContainer.addClass("is-hidden")},this.showHeader=function(){this.$headerContainer.removeClass("is-hidden")},this.hideFooter=function(){this.$footerContainer.addClass("is-hidden")},this.showFooter=function(){this.$footerContainer.removeClass("is-hidden")}};return n}),define("ui/search/search_results",["flight/component","ui/toggle_button","ui/user_search_results","ui/with_accordion","ui/with_template","ui/with_search_filter","ui/with_focus","ui/asynchronous_form","ui/with_fixed_header_and_footer","ui/with_transitions"],function(e,t,n,r,i,s,o,u,a,f){function l(){this.defaultAttrs({scribeSection:"search_results",accordionSelector:".js-accordion",columnScrollerIsAnimatingClass:"is-column-scroller-animating",tweetResultsSelector:".js-tweet-results",userResultsSelector:".js-user-results",searchResultsHeaderSelector:".js-search-results-header",searchResultsFooterSelector:".js-search-results-footer",toggleSelector:".js-toggle",toggleTweetsClass:"js-toggle-tweets",columnType:"search"}),this.after("initialize",function(){this.on(document,"uiSearch",this.handleSearch),this.on("uiColumnUpdateSearchFilter",this.handleUpdateSearchFilter),this.$tweetResults=this.select("tweetResultsSelector"),this.$userResults=this.select("userResultsSelector"),this.$header=this.select("searchResultsHeaderSelector"),this.$footer=this.select("searchResultsFooterSelector"),this.$accordion=this.select("accordionSelector"),n.attachTo(this.$userResults),this.$toggle=this.select("toggleSelector"),t.attachTo(this.$toggle,{buttons:{left:{label:TD.i("Tweets"),"class":"js-toggle-tweets",clickEvent:"uiToggleTweetsClick",selected:!0},right:{label:TD.i("Users"),"class":"js-toggle-users",clickEvent:"uiToggleUsersClick"}}}),this.on(this.$header,"uiToggleTweetsClick",this.showTweets),this.on(this.$header,"uiToggleUsersClick",this.showUsers),this.on(this.$footer.find(".js-add-column"),"click",this.handleAddColumnClick),this.on("uiTransitionExpandStart",this.handleColumnOptionsTransitionStart),this.on("uiAccordionTotalHeightChanged",this.resizeBody),this.on("uiSearchResultsHidden",this.handleSearchResultsHidden)}),this.handleUpdateSearchFilter=function(e,t){if(!this.temporaryColumn)return;this.temporaryColumn.column.updateSearchFilter(t),this.temporaryColumn.populate()},this.handleSearchResultsHidden=function(){this.focusRelease(),this.temporaryColumn&&(this.temporaryColumn.destroy(),this.temporaryColumn=null)},this.handleSearch=function(e,t){var n=TD.storage.accountController.getPreferredAccount("twitter"),r=new TD.vo.SearchFilter;this.query=t.query,this.temporaryColumn&&(this.temporaryColumn.destroy(),this.temporaryColumn=null),this.temporaryColumn=new TD.components.TemporaryColumn,this.temporaryColumn.search(this.query,n.getKey()),this.$tweetResults.empty(),this.$tweetResults.append(this.temporaryColumn.$node),this.trigger(this.$toggle,"uiToggleSelectItem",{"class":this.attr.toggleTweetsClass}),this.trigger(this.$header,"uiDestroyAsynchronousForm"),this.select("accordionSelector").html(""),this.renderSearchFilters(r,{withContentType:!0,withMatching:!1,withExcluding:{isControl:!0,searchInputClassName:this.attr.excludingClass,searchInputPlaceholder:TD.i("Enter words to exclude"),searchInputTitle:"excluding"},withLanguage:!0,withRetweetsToggle:!0,withFromList:!0,withActionFilter:!1,withEngagementFilter:TD.decider.get(TD.decider.ENGAGEMENT_FILTER)}),u.attachTo(this.$header),this.resizeBody(),this.temporaryColumn.populate(),this.showTweets()},this.handleAddColumnClick=function(){this.temporaryColumn.makePermanent(),this.trigger("uiSearchResultsColumnAdded")},this.showTweets=function(){this.focusRequest(),this.$accordion.removeClass("is-hidden"),this.$tweetResults.removeClass("is-hidden"),this.$userResults.addClass("is-hidden"),this.showHeader(),this.showFooter(),this.resizeBody(),this.trigger("uiSearchResultsFocus")},this.showUsers=function(){this.focusRequest(),this.showHeader(),this.$accordion.addClass("is-hidden"),this.$tweetResults.addClass("is-hidden"),this.$userResults.removeClass("is-hidden"),this.hideFooter(),this.resizeBody()},this.handleUpdatingColumn=function(){this.trigger(this.$header,"uiWaitingForAsyncResponse")},this.handleColumnUpdated=function(){this.trigger(this.$header,"uiReceivedAsyncResponse")},this.handleColumnOptionsTransitionStart=function(e,t){var n=this.$bodyContainer,r=parseInt(n.css("top"),10),i=function(){n.data("isAnimating",!1)};n.data("isAnimating")===!0?this.columnScrollerTargetTop=this.columnScrollerTargetTop+t.delta:(n.data("isAnimating",!0),this.columnScrollerTargetTop=r+t.delta),this.transitionTop(n,this.attr.columnScrollerIsAnimatingClass,this.columnScrollerTargetTop,i)},this.before("teardown",function(){this.trigger(this.$searchFilter,"uiDestroyAsynchronousForm"),this.trigger(this.$userResults,"uiUserResultsDestroy"),this.trigger(this.$header,"uiToggleButtonDestroy")})}return e(l,r,i,o,s,a,f)}),define("ui/search/search_router",["flight/component"],function(e){var t=function(){this.defaultAttrs({appSearchInputSelector:".js-search-form .js-app-search-input",searchPopoverInputSelector:".js-search-in-popover .js-app-search-input"}),this.after("initialize",function(){this.on(document,"uiPerformSearch",this.handlePerformSearch),this.on(document,"uiAppSearchFocus",this.handleAppSearchFocus),this.on(document,"uiShowSearchButtonClick",this.handleShowSearchButtonClick),this.on(document,"dataSettings",this.handleDataSettings),this.trigger("uiNeedsSettings")}),this.handleDataSettings=function(e,t){t.navbarWidth==="condensed"?this.$input=this.select("searchPopoverInputSelector"):this.$input=this.select("appSearchInputSelector")},this.handleAppSearchFocus=function(){this.$input.focus()},this.handlePerformSearch=function(e,t){e.target===document&&_.defer(function(){this.trigger(this.$input,"uiAppSearchSubmit",t)}.bind(this))},this.handleShowSearchButtonClick=function(){this.$input.focus()}};return e(t)}),define("ui/app_header",["flight/component","ui/with_nav_flyover"],function(e,t){function n(){this.defaultAttrs({headerActionSelector:".js-header-action"}),this.after("initialize",function(){this.on("click",this.handleClick),$(document).on("uiToggleNavbarWidth",this.toggleNavbarWidth.bind(this)),$(document).on("dataSettings",this.handleDataSettings.bind(this)),this.select("headerActionSelector").on("mouseover",this.handleListItemMouseover.bind(this)).on("mouseout",this.handleListItemMouseout.bind(this)),this.trigger("uiNeedsSettings")}),this.handleClick=function(e,t){var n=$(e.target).closest(".js-header-action"),r;n.data("action")&&e.preventDefault();switch(n.data("action")){case"show-compose":TD.ui.compose.showComposeWindow(),TD.controller.stats.navbarComposeClick();break;case"add-column":TD.ui.openColumn.showOpenColumn(),TD.controller.stats.navbarAddColumnClick();break;case"settings-menu":e.stopPropagation(),new TD.components.TopbarMenu(n),TD.controller.stats.navbarSettingsClick();break;case"show-lists":TD.ui.openColumn.showLists(),TD.controller.stats.navbarListsClick();break;case"change-sidebar-width":this.toggleNavbarWidth();break;case"show-search":this.trigger("uiShowSearchButtonClick")}this.destroyFlyover()},this.toggleNavbarWidth=function(){var e;this.isCollapsed?e="full-size":e="condensed",this.trigger("uiNavbarWidthChangeAction",{navbarWidth:e})},this.handleDataSettings=function(e,t){this.isCollapsed=Boolean(t.navbarWidth==="condensed")},this.handleListItemMouseover=function(e){if(this.isCollapsed){var t=$(e.currentTarget);this.renderFlyover(t)}},this.handleListItemMouseout=function(e){this.destroyFlyover()}}return e(n,t)}),define("ui/default_page_layout",["flight/component"],function(e){function t(){this.defaultAttrs({jsAppSelector:".js-app",jsAppHeaderSelector:".js-app-header",jsAppHeaderInnerSelector:".js-app-header-inner",jsSearchSelector:".js-search",jsAppContentSelector:".js-app-content",isCondensingClass:"is-condensing",isCondensedClass:"is-condensed",scrollNoneClass:"scroll-none",navbarWidthChangeDuration:250,maxColumnsForAnimation:5}),this.setTheme=function(e){var t=$("link");_.each(t,function(t){var n=_.contains(t.getAttribute("rel"),"stylesheet"),r=t.getAttribute("title");n&&r&&(t.disabled=!0,r===e&&(t.disabled=!1))}),$("meta[http-equiv=Default-Style]")[0].content=e},this.setNavbarWidth=function(e){var t=this.select("jsAppHeaderInnerSelector"),n=this.select("jsAppHeaderSelector"),r=this.select("jsAppContentSelector"),i=this.select("jsAppSelector"),s=e==="condensed",o,u=TD.storage.clientController.client.getColumnOrder().length,a=function(){s&&n.removeClass(this.attr.isCondensingClass),i.toggleClass(this.attr.isCondensedClass,s),n.toggleClass(this.attr.isCondensedClass,s)}.bind(this);if(!this.isNavbarWidthSet||u>this.attr.maxColumnsForAnimation)a(),this.isNavbarWidthSet=!0;else{if(!s&&!i.hasClass(this.attr.isCondensedClass)||s&&i.hasClass(this.attr.isCondensedClass))return;s?(o=parseInt(t.css("min-width"),10),n.addClass(this.attr.isCondensingClass)):(n.removeClass(this.attr.isCondensedClass),o=t.outerWidth()),n.addClass(this.attr.scrollNoneClass),n.animate({width:o},{duration:this.attr.navbarWidthChangeDuration,complete:function(){a(),n.removeClass(this.attr.scrollNoneClass)}.bind(this),step:function(e){r.css("left",e)},easing:"easeOutQuad"})}},this.handleDataSettings=function(e,t){this.setTheme(t.theme),this.setNavbarWidth(t.navbarWidth)},this.after("initialize",function(){this.isNavbarWidthSet=!1,this.on(document,"dataSettings",this.handleDataSettings)})}return e(t)}),define("tracking/column_options_scribe",["flight/component"],function(e){var t=function(){this.trackClear=function(){TD.controller.stats.columnActionClick("clear")},this.trackMoveColumn=function(e,t){TD.controller.stats.columnActionClick(t.action)},this.trackEmbedTimeline=function(e,t){TD.controller.stats.columnActionClick("embed",{type:t.column.getColumnType()})},this.trackActionFilterError=function(e,t){TD.controller.stats.actionFilterError()},this.after("initialize",function(){this.on(document,"uiClearColumnAction",this.trackClear),this.on(document,"uiMoveColumnAction",this.trackMoveColumn),this.on(document,"uiEmbedTimelineAction",this.trackEmbedTimeline),this.on(document,"uiActionFilterError",this.trackActionFilterError)})};return e(t)}),define("tracking/message_banner_scribe",["flight/component"],function(e){var t=function(){this.trackImpression=function(e,t){TD.controller.stats.messageBannerImpression(t.id)},this.trackDismiss=function(e,t){TD.controller.stats.messageBannerDismiss(t.id)},this.trackAction=function(e,t){TD.controller.stats.messageBannerClick(t.messageId,t.actionId)},this.after("initialize",function(){this.on(document,"uiShowMessageBanner",this.trackImpression),this.on(document,"uiDismissMessageAction",this.trackDismiss),this.on(document,"uiClickMessageButtonAction",this.trackAction)})};return e(t)}),define("tracking/embed_tweet_dialog_scribe",["flight/component"],function(e){var t=function(){this.trackOpen=function(e,t){TD.controller.stats.embedTweetDialogOpen(t.tweet.id)},this.after("initialize",function(){this.on(document,"uiShowEmbedTweet",this.trackOpen)})};return e(t)}),define("tracking/typeahead_scribe",["flight/component"],function(e){var t=function(){this.trackInvocation=function(){TD.controller.stats.typeaheadInvoked()},this.trackSelection=function(e,t){var n=t.input.length;t.searchType==="recent-search"?TD.controller.stats.typeaheadRecentItemSelected(n,t.searchType,t.index):TD.controller.stats.typeaheadItemSelected(n,t.searchType,t.index)},this.after("initialize",function(){this.on(document,"uiTypeaheadDropdownInvoked",this.trackInvocation),this.on(document,"uiTypeaheadItemSelected",this.trackSelection)})};return e(t)}),define("tracking/social_proof_for_tweet_scribe",["flight/component"],function(e){var t=function(){this.trackViews=function(e,t){TD.controller.stats.viewedTweetSocialProof(t.type)},this.after("initialize",function(){this.on(document,"uiShowSocialProof",this.trackViews)})};return e(t)}),define("page/default",["flight/component","data/accounts","data/column_manager","data/embed_timeline","data/embed_tweet","data/message_banner","data/preferred_account","data/relationship","data/twitter_user","data/user_actions","data/settings","data/stream_counter","data/search","data/storage","data/recent_searches","data/typeahead","data/user_profile_social_proof","data/twitter_users","data/lists","data/account","ui/keyboard_shortcuts","ui/message_banner","ui/app_search","ui/search_input","ui/column_controller","ui/grid","ui/focus_controller","ui/confirmation_dialog_controller","ui/with_dialog_manager","ui/message_banner_container","ui/image_upload","ui/column_navigation","ui/search/search_in_popover","ui/typeahead/typeahead_dropdown","ui/search/search_results","ui/search/search_router","ui/app_header","ui/default_page_layout","tracking/column_options_scribe","tracking/message_banner_scribe","tracking/embed_tweet_dialog_scribe","tracking/typeahead_scribe","tracking/social_proof_for_tweet_scribe"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U){function z(){this.defaultAttrs({modal:"#open-modal",appHeader:".js-app-header",searchResults:".js-search-form",message:".js-message-banner",appSearchSourceId:"appSearch",searchPopoverSourceId:"searchPopover",isHiddenClass:"is-hidden",gridFocusId:"grid_focus"}),this.handlePreferredAccount=function(e,t){t&&t.account&&(this.preferredAccount=t.account)},this.initSearchInPopover=function(){_.attachTo(".js-search-in-popover",{popoverPosition:"rt",closeModals:!0,appSearchSourceId:this.attr.appSearchSourceId,searchPopoverSourceId:this.attr.searchPopoverSourceId,isHiddenClass:this.attr.isHiddenClass}),S.attachTo(".js-search-in-popover",{sourceId:this.attr.searchPopoverSourceId}),D.attachTo(".js-search-in-popover"),P.attachTo(".js-search-in-popover")},this.initUI=function(){j.attachTo(this.$node),C.attachTo(this.$node),E.attachTo(this.select("message")),T.attachTo(this.$node,{focusId:this.attr.gridFocusId}),N.attachTo(this.$node,{focusId:this.attr.gridFocusId}),O.attachTo("#compose-modal"),B.attachTo(".js-app-header"),M.attachTo("#column-navigator"),S.attachTo(".js-search-form",{sourceId:this.attr.appSearchSourceId}),this.initSearchInPopover(),H.attachTo(this.$node),w.attachTo(this.$node)},this.after("initialize",function(){p.attachTo(this.$node),d.attachTo(this.$node),l.attachTo(this.$node),t.attachTo(this.$node),n.attachTo(this.$node),s.attachTo(this.$node),o.attachTo(this.$node),u.attachTo(this.$node),a.attachTo(this.$node),f.attachTo(this.$node),c.attachTo(this.$node),i.attachTo(this.$node),r.attachTo(this.$node),h.attachTo(this.$node),v.attachTo(this.$node),m.attachTo(this.$node),g.attachTo(this.$node),k.attachTo(this.$node),y.attachTo(this.$node),A.attachTo(this.$node),b.attachTo(this.$node),F.attachTo(this.$node),I.attachTo(this.$node),q.attachTo(this.$node),R.attachTo(this.$node),U.attachTo(this.$node),this.on(document,"TD.ready",this.initUI),this.trigger(document,"uiNeedsPreferredAccount"),this.on(document,"dataPreferredAccount",this.handlePreferredAccount)})}return e(z,L)}),define("td/lib/require-domready",[],function(){function u(e){var t;for(t=0;t<e.length;t+=1)e[t](s)}function a(){var e=o;i&&e.length&&(o=[],u(e))}function f(){i||(i=!0,n&&clearInterval(n),a())}function c(e){return i?e(s):o.push(e),c}var e,t,n,r=typeof window!="undefined"&&window.document,i=!r,s=r?document:null,o=[];if(r){if(document.addEventListener)document.addEventListener("DOMContentLoaded",f,!1),window.addEventListener("load",f,!1);else if(window.attachEvent){window.attachEvent("onload",f),t=document.createElement("div");try{e=window.frameElement===null}catch(l){}t.doScroll&&e&&window.external&&(n=setInterval(function(){try{t.doScroll(),f()}catch(e){}},30))}document.readyState==="complete"&&f()}return c.version="2.0.1",c.load=function(e,t,n,r){r.isBuild?n(null):c(n)},c}),requirejs.config({baseUrl:"/web/scripts/swift",paths:{flight:"lib/flight/lib",data:"app/data",ui:"app/ui",page:"app/page",util:"app/util",tracking:"app/tracking",td:"../"}}),require(["page/default","td/lib/require-domready!"],function(e,t){e.attachTo(t),TD.controller.init.start()}),define("app/main",function(){})