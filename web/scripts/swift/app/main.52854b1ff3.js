//implementation lifted from underscore.js (c) 2009-2012 Jeremy Ashkenas

define("flight/utils",[],function(){function n(e,t,n){var r;return function(){var i=this,s=arguments,o=function(){r=null,e.apply(i,s)};r&&n&&clearTimeout(r);if(n||!r)r=setTimeout(o,t)}}var e=[],t=100,r={isDomObj:function(e){return!!e.nodeType||e===window},toArray:function(t,n){return e.slice.call(t,n)},merge:function(){var e=this.toArray(arguments);return e.unshift({}),e[e.length-1]===!0&&(e.pop(),e.unshift(!0)),$.extend.apply(undefined,e)},push:function(e,t,n){return e&&Object.keys(t||{}).forEach(function(r){if(e[r]&&n)throw Error("utils.push attempted to overwrite '"+r+"' while running in protected mode");typeof e[r]=="object"&&typeof t[r]=="object"?this.push(e[r],t[r]):e[r]=t[r]},this),e},isEnumerable:function(e,t){return Object.keys(e).indexOf(t)>-1},compose:function(){var e=arguments;return function(){var t=arguments;for(var n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},debounce:function(e,r){return typeof r!="number"&&(r=t),n(e,r,!0)},throttle:function(e,r){return typeof r!="number"&&(r=t),n(e,r,!1)},countThen:function(e,t){return function(){if(!--e)return t.apply(this,arguments)}},delegate:function(e){return function(t,n){var r=$(t.target),i;Object.keys(e).forEach(function(s){if((i=r.closest(s)).length)return n=n||{},n.el=i[0],e[s].apply(this,[t,n])},this)}}};return r}),define("flight/compose",[],function(){function t(t,n){if(!e)return;var r=Object.create(null);Object.keys(t).forEach(function(e){var i=Object.getOwnPropertyDescriptor(t,e);i.writable=n,r[e]=i}),Object.defineProperties(t,r)}function n(t,n,r){if(!e){r.call(t);return}var i=Object.getOwnPropertyDescriptor(t,n).writable;Object.defineProperty(t,n,{writable:!0}),r.call(t),Object.defineProperty(t,n,{writable:i})}function r(e,n){e.mixedIn=e.hasOwnProperty("mixedIn")?e.mixedIn:[],n.forEach(function(n){e.mixedIn.indexOf(n)==-1&&(t(e,!1),n.call(e),e.mixedIn.push(n))}),t(e,!0)}var e=!1;return{mixin:r,unlockProperty:n}}),define("flight/advice",["./utils","./compose"],function(e,t){var n={around:function(t,n){return function(){var r=e.toArray(arguments);return n.apply(this,[t.bind(this)].concat(r))}},before:function(t,n){return this.around(t,function(){var t=e.toArray(arguments),r=t.shift(),i;return i=typeof n=="function"?n:n.obj[n.fnName],i.apply(this,t),r.apply(this,t)})},after:function(t,n){return this.around(t,function(){var t=e.toArray(arguments),r=t.shift(),i,s=(r.unbound||r).apply(this,t);return i=typeof n=="function"?n:n.obj[n.fnName],i.apply(this,t),s})},withAdvice:function(){["before","after","around"].forEach(function(e){this[e]=function(r,i){t.unlockProperty(this,r,function(){return typeof this[r]=="function"?this[r]=n[e](this[r],i):this[r]=i})}},this)}};return n}),define("flight/registry",["./utils"],function(e){function t(t,n){var r,i,s;return n=e.toArray(n),typeof n[n.length-1]=="function"&&(s=n.pop()),typeof n[n.length-1]=="object"&&n.pop(),n.length==2?(r=n[0],i=n[1]):(r=t.node,i=n[0]),{element:r,type:i,callback:s}}function n(e,t){return e.element==t.element&&e.type==t.type&&(t.callback==null||e.callback==t.callback)}function r(){function i(e){this.component=e,this.instances=[],this.addInstance=function(e){this.throwIfInstanceExistsOnNode(e);var t=new s(e);return this.instances.push(t),t},this.throwIfInstanceExistsOnNode=function(e){this.instances.forEach(function(t){if(t.instance.$node[0]===e.$node[0])throw new Error("Instance of "+e.constructor+" already exists on node "+e.$node[0])})},this.removeInstance=function(e){var t=this.instances.filter(function(t){return t.instance==e})[0],n=this.instances.indexOf(t);n>-1&&this.instances.splice(n,1),this.instances.length||r.removeComponentInfo(this)}}function s(e){this.instance=e,this.events=[],this.addTrigger=function(){},this.addBind=function(e){this.events.push(e),r.events.push(e)},this.removeBind=function(e){for(var t=0,r;r=this.events[t];t++)n(r,e)&&this.events.splice(t,1)}}var r=this;(this.reset=function(){this.components=[],this.allInstances=[],this.events=[]}).call(this),this.addInstance=function(e){var t=this.findComponentInfo(e);t||(t=new i(e.constructor),this.components.push(t));var n=t.addInstance(e);return this.allInstances.push(n),t},this.removeInstance=function(e){var t,n=this.findInstanceInfo(e),r=this.findComponentInfo(e);r.removeInstance(e);var t=this.allInstances.indexOf(n);t>-1&&this.allInstances.splice(t,1)},this.removeComponentInfo=function(e){var t=this.components.indexOf(e);t>-1&&this.components.splice(t,1)},this.findComponentInfo=function(e){var t=e.attachTo?e:e.constructor;for(var n=0,r;r=this.components[n];n++)if(r.component===t)return r;return null},this.findInstanceInfo=function(e){var t;e.node?t=function(t){return t.instance===e}:t=function(t){return t.instance.node===e};var n=this.allInstances.filter(t);return n.length?e.node?n[0]:n:e.node?null:[]},this.trigger=function(){var e=t(this,arguments),n=r.findInstanceInfo(this);n&&n.addTrigger(e)},this.on=function(n){var i=e.toArray(arguments,1),s=r.findInstanceInfo(this),o;if(s){o=n.apply(null,i),o&&(i[i.length-1]=o);var u=t(this,i);s.addBind(u)}},this.off=function(e,n,i){var s=t(this,arguments),o=r.findInstanceInfo(this);o&&o.removeBind(s)},this.teardown=function(){r.removeInstance(this)},this.withRegistration=function(){this.before("initialize",function(){r.addInstance(this)}),this.after("trigger",r.trigger),this.around("on",r.on),this.after("off",r.off),this.after("teardown",{obj:r,fnName:"teardown"})}}return new r}),define("flight/component",["./advice","./utils","./compose","./registry"],function(e,t,n,r){function i(e){e.events.slice().forEach(function(e){var t=[e.type];e.element&&t.unshift(e.element),typeof e.callback=="function"&&t.push(e.callback),this.off.apply(this,t)},e.instance)}function s(){i(r.findInstanceInfo(this)),this.trigger("componentTornDown")}function o(){var e=r.findComponentInfo(this);e&&e.instances.slice().forEach(function(e){e.instance.teardown()})}function u(){this.trigger=function(){var e,n,r,i=t.toArray(arguments);typeof i[i.length-1]!="string"&&(r=i.pop()),e=i.length==2?$(i.shift()):this.$node,n=i[0];if(window.DEBUG&&window.postMessage)try{window.postMessage(r,"*")}catch(s){throw console.log("unserializable data for event",n,":",r),new Error(["The event",event.type,"on component",this.describe,"was triggered with non-serializable data"].join(" "))}return typeof this.attr.eventData=="object"&&(r=$.extend(!0,{},this.attr.eventData,r)),e.trigger(n,r)},this.on=function(){var e,n,r,i,s=t.toArray(arguments);typeof s[s.length-1]=="object"?i=t.delegate(this.resolveDelegateRules(s.pop())):i=s.pop(),r=i&&i.bind(this),r.target=i,e=s.length==2?$(s.shift()):this.$node,n=s[0];if(typeof r=="undefined")throw new Error("Unable to bind to '"+n+"' because the given callback is undefined");return e.on(n,r),r},this.off=function(){var e,n,r,i=t.toArray(arguments);return typeof i[i.length-1]=="function"&&(r=i.pop()),e=i.length==2?$(i.shift()):this.$node,n=i[0],e.off(n,r)},this.resolveDelegateRules=function(e){var t={};return Object.keys(e).forEach(function(n){if(!this.attr.hasOwnProperty(n))throw new Error('Component "'+this.describe+'" wants to listen on "'+n+'" but no such attribute was defined.');t[this.attr[n]]=e[n]},this),t},this.defaultAttrs=function(e){t.push(this.defaults,e,!0)||(this.defaults=e)},this.select=function(e){return this.$node.find(this.attr[e])},this.initialize=$.noop,this.teardown=s}function a(e,t){if(!e)throw new Error("Component needs to be attachTo'd a jQuery object, native node or selector string");$(e).each(function(e,n){new this(n,t)}.bind(this))}function f(){function s(e,n){var r={},i=0;if(!e)throw new Error("Component needs a node");e.jquery?(this.node=e[0],this.$node=e):(this.node=e,this.$node=$(e)),this.describe=this.constructor.describe,this.bind=function(e){var n;if(e.uuid&&(n=r[e.uuid]))return n;var s=t.toArray(arguments,1);return s.unshift(this),n=e.bind.apply(e,s),n.target=e,e.uuid=i++,r[e.uuid]=n,n},this.attr=t.merge(this.defaults,n),this.initialize.call(this,n||{}),this.trigger("componentInitialized")}var i=t.toArray(arguments);return s.toString=function(){var e=i.map(function(e){if($.browser.msie){var t=e.toString().match(/function (.*?)\s?\(/);return t&&t[1]?t[1]:""}return e.name}).join(", ").replace(/\s\,/g,"");return e},s.describe=s.toString(),s.attachTo=a,s.teardownAll=o,i.unshift(u,e.withAdvice,r.withRegistration),n.mixin(s.prototype,i),s}return f.teardownAll=function(){r.components.slice().forEach(function(e){e.component.teardownAll()})},f}),define("data/with_client",[],function(){function e(){this.getClientByAccount=function(e){return TD.controller.clients.getClient(e.getKey())},this.getPreferredClient=function(e){return TD.controller.clients.getPreferredClient(e)},this.getTwitterClient=function(){return TD.controller.clients.getPreferredClient("twitter")},this.getClientsByService=function(e){return TD.controller.clients.getClientsByService(e)}}return e}),define("data/accounts",["flight/component","data/with_client"],function(e,t){function n(){this.sendAccounts=function(e){this.trigger(document,"dataAccountsForService",{accounts:e||[]})},this.getAccountsForService=function(e,t){this.ready?(this.accounts[t.service]=TD.storage.accountController.getAccountsForService(t.service),this.sendAccounts(this.accounts[t.service])):this.on(document,"TD.ready",this.tdReady.bind(this,e,t))},this.tdReady=function(e,t){this.ready=!0,t&&this.getAccountsForService(e,t)},this.updateDefaultTwitterClient=function(){this.trigger("dataTwitterClientChanged",{client:this.getTwitterClient()})},this.after("initialize",function(){this.accounts={},this.on(document,"uiNeedsAccountsForService",this.getAccountsForService),this.on(document,"TD.ready",this.tdReady),this.defaultAccountSubscription=$.subscribe("/storage/client/default_account_changed",this.updateDefaultTwitterClient.bind(this))}),this.before("teardown",function(){$.unsubscribe(this.defaultAccountSubscription)})}return e(n,t)}),define("data/column_manager",["flight/component"],function(e){var t=function(){this.deleteColumn=function(e,t){var n=t.columnId;n&&TD.controller.columnManager.deleteColumn(n)},this.moveColumn=function(e,t){var n=t.columnId,r=t.action;n&&r&&TD.controller.columnManager.move(n,r)},this.handleUiNeedsColumnOrder=function(e,t){var n=TD.controller.columnManager.getAllOrdered();this.trigger("dataColumnOrder",{columns:n})},this.after("initialize",function(){this.on(document,"uiDeleteColumnAction",this.deleteColumn),this.on(document,"uiMoveColumnAction",this.moveColumn),this.on(document,"uiNeedsColumnOrder",this.handleUiNeedsColumnOrder)})};return e(t)}),define("data/embed_timeline",["flight/component","data/with_client"],function(e,t){function n(){this.checkListSubscription=function(e,t,n){var r=_.uniqueId(),i={id:r,title:TD.i("Subscribe to this list?"),message:TD.i("To share this list, we need to subscribe you to it. Subscribe and share?"),okLabel:TD.i("OK"),cancelLabel:TD.i("Cancel")},s=function(){TD.util.openURL(t,n)},o=function(t,n){var i;if(n.id!==r)return;this.off(document,"uiConfirmationAction",o),n.result&&(i=this.getTwitterClient(),i.subscribeToList(e,s))},u=this.getTwitterClient().oauth.account.getKey(),a=TD.cache.lists.find(e,null,null,!1,u);a?s():(this.on(document,"uiConfirmationAction",o.bind(this)),this.trigger("uiShowConfirmationDialog",i))},this.openEmbedTimeline=function(e,t){var n="https://twitter.com/settings/widgets/new/",r={},i,s,o;if(t&&t.column&&t.column.isEmbeddable()){i=t.column.getFeeds()[0],s=i.getMetadata();switch(t.column.getColumnType()){case TD.util.columnUtils.columnMetaTypes.USERTWEETS:n+="user",r.user_id=s.id;break;case TD.util.columnUtils.columnMetaTypes.FAVORITES:n+="favorites",s.id?r.user_id=s.id:r.user_id=i.getAccountKey();break;case TD.util.columnUtils.columnMetaTypes.LIST:n+="list",r.list_id=s.listId,this.checkListSubscription(s.listId,n,r);return;case TD.util.columnUtils.columnMetaTypes.SEARCH:n+="search",s.baseQuery&&s.searchFilterData?(o=new TD.vo.SearchFilter(s.searchFilterData),r.query=[s.baseQuery,o.getQueryString()].join(" ").trim()):r.query=s.term}TD.util.openURL(n,r)}},this.after("initialize",function(){this.on(document,"uiEmbedTimelineAction",this.openEmbedTimeline)})}return e(n,t)}),define("data/embed_tweet",["flight/component","data/with_client"],function(e,t){function n(){this.handleEmbeddedTweetFactory=function(e){return function(t){t.request=e,this.trigger(document,"dataEmbeddedTweet",t)}},this.handleErrorFactory=function(e){return function(){var t={request:e};this.trigger(document,"dataEmbeddedTweetError",t)}},this.getEmbeddedTweet=function(e,t){if(t&&t.tweetID){var n=this.getTwitterClient();n.getEmbeddedTweet(t.tweetID,t.hideThread,t.hideMedia,t.maxWidth,this.handleEmbeddedTweetFactory(t).bind(this),this.handleErrorFactory(t).bind(this))}},this.after("initialize",function(){this.on(document,"uiNeedsEmbeddedTweet",this.getEmbeddedTweet)})}return e(n,t)}),define("util/with_version_comparator",[],function(){var e=function(){this.appSatisfiesVersionRequirements=function(e){var t=TD.version,n=e.split(" ");return _.all(n,function(e){var n=e.match(/[<=>]*/)[0],r=e.substr(n.length),i=[],s;return _.contains(n,">")?i.push(1):_.contains(n,"<")&&i.push(-1),(_.contains(n,"=")||n.length===0)&&i.push(0),s=TD.util.versionComparator(t,r),_.contains(i,s)})}};return e}),define("data/message_banner",["flight/component","util/with_version_comparator"],function(e,t){var n=function(){this.dismissMessage=function(e,t){var n=TD.settings.getIdsForSeenMessages();n.push(t.id),TD.settings.setIdsForSeenMessages(n)},this.satisfiesPlatformRequirements=function(e){if(e.target&&e.target.platform){var t=TD.util.getAppEnv();return _.include(e.target.platform,t)}return!0},this.satisfiesVersionRequirements=function(e){return e.target&&e.target.version?this.appSatisfiesVersionRequirements(e.target.version):!0},this.hasNotBeenDismissed=function(e){if(e.message){var t=TD.settings.getIdsForSeenMessages(),n=t.every(function(t){return e.message.id!==t});return n}return!1},this.handleMessages=function(e,t){var n=t.messages;n&&(n=n.filter(this.satisfiesPlatformRequirements,this),n=n.filter(this.satisfiesVersionRequirements,this),n=n.filter(this.hasNotBeenDismissed,this),n.length&&this.trigger("dataMessage",n[0]))},this.after("initialize",function(){this.on(document,"uiHidingMessageBanner",this.dismissMessage),this.on(document,"dataMessages",this.handleMessages)})};return e(n,t)}),define("data/preferred_account",["flight/component"],function(e){function t(){this.send=function(e){this.trigger(document,"dataPreferredAccount",{account:e})},this.getPreferredTwitterAccount=function(){this.ready&&this.send(TD.storage.accountController.getPreferredAccount("twitter"))},this.tdReady=function(){this.ready=!0,this.getPreferredTwitterAccount(),this.off(document,"TD.ready",this.tdReady)},this.after("initialize",function(){this.on(document,"uiNeedsPreferredAccount",this.getPreferredTwitterAccount),this.on(document,"TD.ready",this.tdReady),$.subscribe("/storage/account/new",this.getPreferredTwitterAccount.bind(this)),$.subscribe("/storage/client/default_account_changed",this.getPreferredTwitterAccount.bind(this))})}return e(t)}),define("data/relationship",["flight/component","data/with_client"],function(e,t){function n(){this.handleRelationship=function(e){this.trigger(document,"dataRelationship",e)},this.handleError=function(e){return function(){this.trigger(document,"dataRelationshipError",e)}},this.getRelationship=function(e,t){if(t&&t.account&&t.screenName){var n=this.getClientByAccount(t.account);n.showFriendship(t.account.getUserID(),null,t.screenName,this.handleRelationship.bind(this),this.handleError(t).bind(this))}},this.after("initialize",function(){this.on(document,"uiNeedsRelationship",this.getRelationship)})}return e(n,t)}),define("data/twitter_user",["flight/component"],function(e){function t(){this.getTwitterUser=function(e,t){var n;t&&(t.id?n=TD.cache.twitterUsers.getById(t.id):n=TD.cache.twitterUsers.getByScreenName(t.screenName),n.addCallbacks(this.handleTwitterUser,this.errorHandlerFactory(t.screenName),null,null,this,this))},this.errorHandlerFactory=function(e){var t=function(t){var n=t.req.errors,r=TD.i("Sorry, we couldn't retrieve user @{{1}}",{1:e}),i=!1;n&&n.forEach(function(e){e.twitterErrorCode===63?i=!0:e.message&&(r+=" - "+e.message)}),i||TD.controller.progressIndicator.addMessage(r),this.trigger("dataTwitterUserError",{screenName:e})};return t.bind(this)},this.handleTwitterUser=function(e){e&&e.account&&this.trigger(document,"dataTwitterUser",e)},this.after("initialize",function(){this.on(document,"uiNeedsTwitterUser",this.getTwitterUser)})}return e(t)}),define("data/user_actions",["flight/component","data/with_client"],function(e,t){var n=function(){this.defaultAttrs({actions:{follow:{userAction:"follow",errorEvent:"dataFollowActionError"},unfollow:{userAction:"unfollow",errorEvent:"dataUnfollowActionError"},block:{userAction:"block",errorEvent:"dataBlockActionError"},unblock:{userAction:"unblock",errorEvent:"dataUnblockActionError"},report:{userAction:"report",errorEvent:"dataReportActionError"}}}),this.error=function(e,t){return function(n){var r;r={request:t,response:n},this.trigger(document,e.errorEvent,r)}},this.success=function(e,t){return function(n){this.trigger("dataFollowStateChange",{action:e,request:t,response:n})}},this.takeAction=function(e,t,n){var r=!1,i=this.success(e,n).bind(this),s=this.error(e,n).bind(this),o=e.userAction;try{switch(o){case"block":n.twitterUser.block(n.account,!1,i,s,r);break;case"report":n.twitterUser.block(n.account,!0,i,s,r);break;case"unblock":n.twitterUser.unblock(n.account,i,s);break;case"follow":n.twitterUser.follow(n.account,i,s,r);break;case"unfollow":n.twitterUser.unfollow(n.account,i,s,r)}}catch(t){this.error()}},this.bindAction=function(e){return this.takeAction.bind(this,e)},this.after("initialize",function(){this.on(document,"uiFollowAction",this.bindAction(this.attr.actions.follow)),this.on(document,"uiUnfollowAction",this.bindAction(this.attr.actions.unfollow)),this.on(document,"uiBlockAction",this.bindAction(this.attr.actions.block)),this.on(document,"uiUnblockAction",this.bindAction(this.attr.actions.unblock)),this.on(document,"uiReportAction",this.bindAction(this.attr.actions.report))})};return e(n,t)}),define("data/theme_switch",["flight/component"],function(e){var t=function(){this.triggerDataThemeEvent=function(){this.trigger(document,"dataTheme",{theme:this.theme})},this.getTheme=function(){this.theme===undefined&&(this.theme=TD.settings.getTheme()),this.triggerDataThemeEvent()},this.switchTheme=function(){this.theme==="light"?this.theme="dark":this.theme="light",TD.settings.setTheme(this.theme),this.triggerDataThemeEvent()},this.after("initialize",function(){this.on(document,"uiNeedsTheme",this.getTheme),this.on(document,"uiThemeChangeAction",this.switchTheme)})};return e(t)}),define("data/stream_counter",["flight/component"],function(e){var t=function(){this.defaultAttrs({updatePeriod:500,aggregationPeriod:1e4}),this.updateStreamCount=function(e,t){this.streamCounter.incrementCounter(t.numStreamItems)},this.after("initialize",function(){this.on(document,"dataReceivedStreamData",this.updateStreamCount),this.streamCounter=new TD.util.TpmCounter(this.attr.updatePeriod,this.attr.aggregationPeriod,"dataStreamRate")})};return e(t)}),define("data/search",["flight/component","data/with_client"],function(e,t){function n(){this.handleResponseFactory=function(e,t){return function(n){this.trigger(document,e,{query:t,result:n})}.bind(this)},this.doUserSearch=function(e,t){var n=this.getPreferredClient("twitter"),r=t.query;n?n.userSearch(r,this.handleResponseFactory("dataUserSearch",r),this.handleResponseFactory("dataUserSearchError",r)):this.handleResponseFactory("dataUserSearchError",r)()},this.after("initialize",function(){this.on(document,"uiNeedsUserSearch",this.doUserSearch)})}return e(n,t)}),define("data/storage",["flight/component"],function(e){var t=function(){this.get=function(e,t){t.names?t.names.forEach(function(e){this.trigger(document,"dataStorageItem",{name:e,value:TD.storage.store.get(e)})},this):t.name&&this.trigger(document,"dataStorageItem",{name:t.name,value:TD.storage.store.get(name)})},this.set=function(e,t){for(var n in t)if(t.hasOwnProperty(n))try{TD.storage.store.nonCriticalSet(n,t[n])}catch(r){r.code===DOMException.QUOTA_EXCEEDED_ERR?this.trigger(document,"dataStorageFull",{name:n,value:t[n]}):this.trigger(document,"dataStorageSetError",{name:n,value:t[n]})}},this.after("initialize",function(){this.on("dataStorageSet",this.set),this.on("dataStorageGet",this.get)})};return e(t)}),define("data/recent_searches",["flight/component"],function(e){var t=function(){this.saveRecentSearch=function(e,t){TD.storage.clientController.client.addRecentSearch(t.query)},this.getRecentSearches=function(e){var t={recentSearches:TD.storage.clientController.client.getRecentSearches()};this.trigger("dataRecentSearches",t)},this.clearRecentSearches=function(e){TD.storage.clientController.client.clearRecentSearches()},this.after("initialize",function(){this.on(document,"uiSearchResultsSearch",this.saveRecentSearch),this.on(document,"uiRecentSearchClearAction",this.clearRecentSearches),this.on(document,"uiNeedsRecentSearches",this.getRecentSearches)})};return e(t)}),define("data/typeahead/with_users_datasource",[],function(){function e(e){this.defaultAttrs({usersStorageLimit:2500,storageUserHash:"typeaheadUserHash",storageUserLastPrefetch:"typeaheadUserLastPrefetch"}),this.tokenize=function(e){return e.trim().toLowerCase().split(TD.constants.regexps.tokenSeparator)},this.overwriteUserdata=function(e){this.userHash={},this.userAdjacencyList={},this.processUserData(e)},this.processUserData=function(e){_.each(e,function(e){e.tokens=e.tokens.map(function(e){return e=typeof e=="string"?e:e.token,e.toLowerCase()}),delete e.location,delete e.connecting_user_ids,this.userHash[e.id]=e,e.tokens.forEach(function(t){var n=t.charAt(0);this.userAdjacencyList[n]===undefined&&(this.userAdjacencyList[n]=[]),this.userAdjacencyList[n].indexOf(e.id)===-1&&this.userAdjacencyList[n].push(e.id)},this)},this);var t={};t[this.attr.storageUserHash]=this.userHash,this.trigger("dataStorageSet",t)},this.processPrefetchUserData=function(e){this.processUserData(e.users);var t={};t[this.attr.storageUserLastPrefetch]=Date.now(),this.trigger("dataStorageSet",t)},this.prefetchUserSuggestions=function(){var e=this.getTwitterClient();e&&e.typeaheadSearch({prefetch:!0,count:this.attr.usersStorageLimit},this.processPrefetchUserData.bind(this),this.handleGetSuggestionsError.bind(this))},this.pruneUsers=function(){var e=_.values(this.userHash);e.sort(this.userSortComparator),e=e.slice(0,Math.floor(e.length/2)),this.overwriteUserdata(e)},this.getUserSuggestions=function(e){var t,n,r,i=[],s=e.datasources.some(function(e){return e==="users"});return e.datasources&&s&&(t=this.tokenize(e.query),n=this.getPotentiallyMatchingUserIds(t),r=this.getUsersFromIds(n),i=r.filter(this.matchUsers(t)),i.sort(this.userSortComparator),i=i.slice(0,this.attr.limit)),i},this.getPotentiallyMatchingUserIds=function(e){var t=[];return e.map(function(e){var n=this.userAdjacencyList[e.charAt(0)];n&&(t=t.concat(n))},this),t=_.uniq(t),t},this.getUsersFromIds=function(e){var t=[];return e.forEach(function(e){var n=this.userHash[e];n&&!this.isUserBlocked(e)&&t.push(n)},this),t},this.matchUsers=function(e){return function(t){var n=t.tokens,r=e.every(function(e){var t=n.filter(function(t){return t.indexOf(e)===0});return t.length});if(r)return t}},this.userSortComparator=function(e,t){var n=e.rounded_graph_weight!==0,r=t.rounded_graph_weight!==0;return n&&!r?-1:r&&!n?1:n&&r?t.rounded_graph_weight-e.rounded_graph_weight:t.rounded_score-e.rounded_score},this.isUserBlocked=function(e){return this.blockedUserIds[e]?!0:!1},this.processUserStorageItem=function(e,t){switch(t.name){case this.attr.storageUserHash:this.processUserData(t.value);break;case this.attr.storageUserLastPrefetch:(typeof t.value!="number"||Date.now()-t.value>TD.constants.DAY_IN_MS)&&this.prefetchUserSuggestions();break;default:}},this.loadUserData=function(){this.trigger("dataStorageGet",{names:[this.attr.storageUserHash,this.attr.storageUserLastPrefetch]});var e=this.getTwitterClient();e&&(this.blockedUserIds=e.blocks)},this.resetUserData=function(e,t){t.client&&(this.overwriteUserdata([]),this.blockedUserIds=t.client.blocks,this.prefetchUserSuggestions())},this.after("initialize",function(){this.userAdjacencyList={},this.userHash={},this.blockedUserIds={},this.datasources=this.datasources||{},this.datasources.users={processData:this.processUserData.bind(this),getSuggestions:this.getUserSuggestions.bind(this)},this.on(document,"dataStorageItem",this.processUserStorageItem),this.on(document,"TD.ready",this.loadUserData),this.on(document,"dataTwitterClientChanged",this.resetUserData),this.on(document,"dataStorageFull",this.pruneUsers)})}return e}),define("data/typeahead/with_topics_datasource",[],function(){var e=function(){this.defaultAttrs({storageTopicsHash:"typeaheadTopicsHash",storageTopicsLastPrefetch:"typeaheadTopicsLastPrefetch"}),this.topicSortComparator=function(e,t){return t.rounded_score-e.rounded_score},this.overwriteTopics=function(e){this.topicsHash={},this.topicsAdjacencyList={},this.processTopicData(e)},this.processTopicData=function(e){_.each(e,function(e){var t=e.topic;this.topicsHash[t]=e,e.tokens.forEach(function(e){var n=e.token.charAt(0).toLowerCase(),r=this.topicsAdjacencyList[n]||[];r.indexOf(t)===-1&&r.push(t),this.topicsAdjacencyList[n]=r},this)},this);var t={};t[this.attr.storageTopicsHash]=this.topicsHash,this.trigger("dataStorageSet",t)},this.processPrefetchTopicData=function(e){this.processTopicData(e.topics),this.topicsLastPrefetch=Date.now();var t={};t[this.attr.storageTopicsLastPrefetch]=this.topicsLastPrefetch,this.trigger("dataStorageSet",t)},this.pruneTopics=function(){var e=_.values(this.topicsHash);e.sort(this.topicSortComparator),e=e.slice(0,Math.floor(e.length/2)),this.overwriteTopics(e)},this.getTopicSuggestions=function(e){var t=e.query.toLowerCase(),n=this.topicsAdjacencyList[t.charAt(0)]||[],r=n.filter(function(e){return e.toLowerCase().indexOf(t)===0},this);return r=this.getTopicObjectsFromStrings(r),r.sort(this.topicSortComparator),r=r.slice(0,this.attr.limit),r},this.getTopicObjectsFromStrings=function(e){var t=[];return e.forEach(function(e){var n=this.topicsHash[e];n&&t.push(n)},this),t},this.prefetchTopicsSuggestions=function(){var e=this.getTwitterClient();e.typeaheadSearch({query:"",prefetch:!0,limit:200,datasources:["topics"]},this.processPrefetchTopicData.bind(this),this.handleGetSuggestionsError.bind(this))},this.processTopicStorageItem=function(e,t){switch(t.name){case this.attr.storageTopicsHash:this.processTopicData(t.value);break;case this.attr.storageTopicsLastPrefetch:this.topicsLastPrefetch=t.value,(!this.topicsLastPrefetch||Date.now()-this.topicsLastPrefetch>TD.constants.time.oneDay)&&this.prefetchTopicsSuggestions();break;default:}},this.loadTopicsData=function(){this.trigger("dataStorageGet",{names:[this.attr.storageTopicsHash,this.attr.storageTopicsLastPrefetch]})},this.resetTopicData=function(e,t){t.client&&(this.overwriteTopics([]),this.prefetchTopicsSuggestions())},this.after("initialize",function(){this.topicsHash={},this.topicsAdjacencyList={},this.datasources=this.datasources||{},this.datasources.topics={getSuggestions:this.getTopicSuggestions.bind(this),processData:this.processTopicData.bind(this)},this.on(document,"dataStorageItem",this.processTopicStorageItem),this.on(document,"TD.ready",this.loadTopicsData),this.on(document,"dataTwitterClientChanged",this.resetTopicData),this.on(document,"dataStorageFull",this.pruneTopics)})};return e}),define("data/typeahead/with_recent_searches_datasource",[],function(){var e=function(){this.tokenize=function(e){return e.trim().toLowerCase().split(TD.constants.regexps.tokenSeparator)},this.getRecentSearchSuggestions=function(e){var t=e.datasources&&e.datasources.some(function(e){return e==="recentSearches"}),n=t&&e.datasources.length===1,r;n?r=this.attr.recentSearchOnlyLimit:r=this.attr.limit;if(!t)return[];var i=[];this.trigger("uiNeedsRecentSearches");if(!this.recentSearches)return i;var s=this.recentSearches,o=this.tokenize(e.query);return s.some(function(e){var t=this.tokenize(e),n=this.recentSearchMatchesQuery(t,o);return n&&i.push(e),i.length===r},this),i},this.recentSearchMatchesQuery=function(e,t){var n=t.every(function(t){return e.some(function(e){return e.indexOf(t)===0})});return n},this.handleRecentSearches=function(e,t){t&&t.recentSearches&&(this.recentSearches=t.recentSearches)},this.processRecentSearchData=function(){},this.after("initialize",function(){this.datasources=this.datasources||{},this.datasources.recentSearches={getSuggestions:this.getRecentSearchSuggestions.bind(this),processData:this.processRecentSearchData.bind(this)},this.on(document,"dataRecentSearches",this.handleRecentSearches)})};return e}),define("data/typeahead/with_saved_searches_datasource",[],function(){var e=function(){this.tokenize=function(e){return e.trim().toLowerCase().split(TD.constants.regexps.tokenSeparator)},this.savedSearchesComparator=function(e,t){var n=e.query.toLowerCase(),r=t.query.toLowerCase();return(n>r)-(n<r)},this.updateSavedSearches=function(){var e=Date.now()-TD.constants.time.oneHour;if(!this.savedSearchesLastFetch||this.savedSearchesLastFetch<e){var t=this.getClientsByService("twitter");this.savedSearches=[],t.forEach(function(e){this.savedSearches=this.savedSearches.concat(e.searches)},this),this.savedSearchesLastFetch=Date.now()}},this.getSavedSearchSuggestions=function(e){if(e.query.trim()==="")return[];var t=e.datasources&&e.datasources.some(function(e){return e==="savedSearches"});if(!t)return[];var n=[],r=this.tokenize(e.query);return this.updateSavedSearches(),this.savedSearches.forEach(function(e){var t=this.tokenize(e.query),i=this.savedSearchMatchesQuery(t,r);i&&n.push(e)},this),n.sort(this.savedSearchesComparator),n.splice(this.attr.limit),n},this.savedSearchMatchesQuery=function(e,t){return t.every(function(t){return e.some(function(e){return e.indexOf(t)===0})})},this.processSavedSearchData=function(){},this.after("initialize",function(){this.savedSearches=[],this.savedSearchesLastFetch=!1,this.datasources=this.datasources||{},this.datasources.savedSearches={getSuggestions:this.getSavedSearchSuggestions.bind(this),processData:this.processSavedSearchData.bind(this)}})};return e}),define("data/typeahead",["flight/component","data/with_client","data/typeahead/with_users_datasource","data/typeahead/with_topics_datasource","data/typeahead/with_recent_searches_datasource","data/typeahead/with_saved_searches_datasource"],function(e,t,n,r,i,s){var o=function(){this.defaultAttrs({limit:6,recentSearchOnlyLimit:10,queryCollationPeriod:150}),this.sendSuggestions=function(){this.trigger("dataTypeaheadSuggestions",{query:this.currentRequest.query,suggestions:this.dedupeSuggestions(this.suggestions),datasources:this.currentRequest.datasources,dropdownId:this.currentRequest.dropdownId})},this.dedupeSuggestions=function(e){var t={};return e=_.clone(e),e.recentSearches=this.dedupeArray(e.recentSearches,null,t),e.savedSearches=this.dedupeArray(e.savedSearches,"query",t),e.topics=this.dedupeArray(e.topics,"topic",t),e},this.dedupeArray=function(e,t,n){return!e||e.length===0?e:_.filter(e,function(e){var r=t?e[t]:e,i=r.toLowerCase(),s=!n[i];return n[i]=!0,s})},this.processTypeaheadData=function(e,t){t.query===this.currentRequest.query&&(t.datasources.forEach(function(t){this.datasources[t]&&e[t]&&(this.datasources[t].processData(e[t]),this.suggestions[t]=this.datasources[t].getSuggestions(this.currentRequest))},this),this.sendSuggestions())},this.handleGetSuggestionsError=function(){this.trigger("dataTypeaheadSuggestionsError")},this._getRemoteSuggestions=function(){var e=this.getTwitterClient();this.currentRequest.query&&this.currentRequest.query.trim()!==""&&e!==undefined&&e.typeaheadSearch(this.currentRequest,this.processTypeaheadData.bind(this),this.handleGetSuggestionsError.bind(this))},this.getSuggestions=function(e,t){t.query!==this.currentRequest.query&&(this.currentRequest={query:t.query,datasources:t.datasources,count:this.attr.limit,dropdownId:t.dropdownId},this.suggestions={},this.updateSuggestions(),t.onlyLocalData||this.getRemoteSuggestions())},this.updateSuggestions=function(){if(!this.currentRequest||!this.currentRequest.datasources)return;this.currentRequest.datasources.forEach(function(e){if(this.datasources[e]){var t=this.datasources[e].getSuggestions(this.currentRequest);t&&t.length>0&&(this.suggestions[e]=t)}},this),this.sendSuggestions()},this.queryReset=function(){this.currentRequest={}},this.after("initialize",function(){this.currentRequest={},this.datasources={},this.suggestions={},this.getRemoteSuggestions=_.debounce(this._getRemoteSuggestions.bind(this),this.attr.queryCollationPeriod),this.on("uiNeedsTypeaheadSuggestions",this.getSuggestions),this.on("uiRecentSearchClearAction",this.updateSuggestions),this.on("dataTypeaheadQueryReset",this.queryReset)})};return e(o,t,n,r,i,s)}),define("data/user_profile_social_proof",["flight/component","data/with_client"],function(e,t){function n(){this.handleUserProfileSocialProofFactory=function(e){return function(t){t.request=e,this.trigger(document,"dataUserProfileSocialProof",t)}},this.handleErrorFactory=function(e){return function(){var t={request:e};this.trigger(document,"dataUserProfileSocialProofError",t)}},this.getUserProfileSocialProofData=function(e,t){if(t&&t.screenName){var n=this.getTwitterClient();n.getFollowingFollowersOf(t.screenName,this.handleUserProfileSocialProofFactory(t).bind(this),this.handleErrorFactory(t).bind(this))}},this.after("initialize",function(){this.on(document,"uiNeedsUserProfileSocialProof",this.getUserProfileSocialProofData)})}return e(n,t)}),define("data/twitter_users",["flight/component","data/with_client"],function(e,t){var n=function(){this.handleTwitterUsersFactory=function(e){var t=function(t){this.trigger("dataTwitterUsers",{requestId:e,users:t})};return t.bind(this)},this.handleTwitterUsersErrorFactory=function(e){var t=function(){this.trigger("dataTwitterUsersError",{requestId:e})};return t.bind(this)},this.getTwitterUsers=function(e,t){this.twitterClient=this.twitterClient||this.getTwitterClient(),this.twitterClient.getUsersByIds(t.userIds,this.handleTwitterUsersFactory(t.requestId),this.handleTwitterUsersErrorFactory(t.requestId))},this.after("initialize",function(){this.on("uiNeedsTwitterUsers",this.getTwitterUsers)})};return e(n,t)}),define("ui/with_key_handler",[],function(){function e(){this.activeSequences={},this.sequenceStarters={},this.singleKeys={},this.combos={},this.defaultAttrs({charCodes:{esc:27,ret:13,del:46,left:37,up:38,right:39,down:40,bksp:8,pageup:33,pagedown:34,home:36,end:35},defaultKeyEvent:"keypress",keySequenceTimeoutDelay:1e3,modifiers:{ctrl:"ctrlKey",alt:"altKey",cmd:"metaKey",shift:"shiftKey"}}),this.getShortcutForEvent=function(e){var t=e.which,n;return this.eventHasModifier(e)&&(n=this.combos[t]),!n&&!this.eventHasFunctionModifier(e)&&(n=this.activeSequences[t]||this.singleKeys[t]||this.sequenceStarters[t]),n},this.clearActiveSequences=function(){this.activeSequences={}},this.eventHasModifier=function(e){return e.ctrlKey||e.altKey||e.metaKey||e.shiftKey},this.eventHasFunctionModifier=function(e){return e.ctrlKey||e.metaKey},this.eventHasTextModifier=function(e){return e.altKey||e.shiftKey},this.getModifiedKeyEvent=function(e,t){var n;return this.eventHasModifier(e)&&t.modifiers&&_.each(t.modifiers,function(t,r){e[r]&&(n=t)},this),n},this.handleKeyPress=function(e){var t,n=[],r=":not(input):not(textarea)";e.which>=65&&e.which<=90&&(e.which+=32),t=this.getShortcutForEvent(e),t?t.sequences?(_.each(t.sequences,function(e,t){this.addSequenceEnd(t,e)},this),setTimeout(function(){this.clearActiveSequences()}.bind(this),this.attr.keySequenceTimeoutDelay)):(n=t.shortcuts||[t],n=n.map(function(t){return t.modifiers&&(t=this.getModifiedKeyEvent(e,t)),t},this),n=n.filter(function(e){return e!==undefined}),n.forEach(function(t){var n=t.selector||r;$(e.target).is(n)&&t.callback(e,t.data)}),this.clearActiveSequences()):this.clearActiveSequences()},this.getCharCodeForKey=function(e){var t,n=!1,r=[[32,64],[91,126]];if(typeof e!="string")throw"Key must be a string";return e=e.toLowerCase(),e.length===1?(t=e.charCodeAt(0),r.forEach(function(e){if(t>=e[0]&&t<=e[1])return n=!0,!1}),n||(t=undefined)):t=this.attr.charCodes[e],t},this.addSingleKey=function(e,t,n,r){var i;if(typeof t!="function")throw"addSingleKey: no callback";i=this.getCharCodeForKey(e);if(i===undefined)throw"addSingleKey: invalid key string";if(this.singleKeys[i]){var s=this.singleKeys[i].shortcuts.every(function(e){return t!==e.callback||n!==e.selector},this);if(!s)throw"addSingleKey: attempted to add identical shortcut"}else this.singleKeys[i]={shortcuts:[]};this.singleKeys[i].shortcuts.push({shortcut:e,callback:t,selector:n,data:r})},this.addSequence=function(e,t,n,r){var i,s,o;if(typeof t!="function")throw"addSequence: no callback";if(typeof e!="string")throw"addSequence: sequence must be a string";i=e.split(" ");if(i.length!==2)throw'addSequence: sequence should be in format "g a"';s=this.getCharCodeForKey(i[0]);if(s===undefined)throw'addSequence: sequence should be in format "g a"';o=this.getCharCodeForKey(i[1]);if(o===undefined)throw'addSequence: sequence should be in format "g a"';this.sequenceStarters[s]||(this.sequenceStarters[s]={sequences:{}}),this.sequenceStarters[s].sequences[i[1]]={shortcut:e,callback:t,selector:n,data:r}},this.addSequenceEnd=function(e,t){var n;if(typeof t.callback!="function")throw"addSequenceEnd: no callback";if(typeof e!="string")throw"addSequenceEnd: invalid shortcut key";n=this.getCharCodeForKey(e);if(n===undefined)throw"addSequenceEnd: invalid shortcut key";this.activeSequences[n]={shortcut:t.shortcut,callback:t.callback,selector:t.selector,data:t.data}},this.addCombo=function(e,t,n,r){var i,s,o;if(typeof t!="function")throw"addCombo: no callback";if(typeof e!="string")throw"addCombo: invalid combo string";i=e.split("+");if(i.length!==2)throw"addCombo: invalid combo";s=this.attr.modifiers[i[0].toLowerCase()];if(s===undefined)throw"addCombo: invalid modifier";o=this.getCharCodeForKey(i[1]);if(o===undefined)throw"addCombo: invalid shortcut key";var u={modifiers:{}};u.modifiers[s]={shortcut:e,callback:t,selector:n,data:r},this.combos[o]||(this.combos[o]={shortcuts:[]}),this.combos[o].shortcuts.push(u)},this.isSequence=function(e){return typeof e=="string"&&e.indexOf(" ")>0},this.isCombo=function(e){return typeof e=="string"&&e.indexOf("+")>0},this.addShortcut=function(e,t,n,r){arguments.length===3&&typeof n!="string"&&(r=n,n=undefined),this.isCombo(e)?this.addCombo(e,t,n,r):this.isSequence(e)?this.addSequence(e,t,n,r):this.addSingleKey(e,t,n,r)},this.removeSingleKey=function(e){var t=this.getCharCodeForKey(e);this.singleKeys[t]&&delete this.singleKeys[t]},this.removeCombo=function(e){var t=this.getCharCodeForKey(e.split("+")[1]);this.combos[t]&&delete this.combos[t]},this.removeSequence=function(e){var t=this.getCharCodeForKey(e.split(" ")[0]);this.sequenceStarters[t]&&delete this.sequenceStarters[t]},this.removeShortcut=function(e){this.isCombo(e)?this.removeCombo(e):this.isSequence(e)?this.removeSequence(e):this.removeSingleKey(e)},this.handleKeyDown=function(e){var t=[this.attr.charCodes.bksp,this.attr.charCodes.esc,this.attr.charCodes.ret,this.attr.charCodes.left,this.attr.charCodes.right,this.attr.charCodes.up,this.attr.charCodes.down,this.attr.charCodes.pagedown,this.attr.charCodes.pageup,this.attr.charCodes.home,this.attr.charCodes.end],n=t.some(function(t){return t===e.which});n&&this.handleKeyPress(e)},this.after("initialize",function(){this.on(window,"keypress",this.handleKeyPress),this.on(window,"keydown",this.handleKeyDown)})}return e}),define("ui/keyboard_shortcuts",["flight/component","ui/with_key_handler"],function(e,t){var n=function(){this.defaultAttrs({shortcuts:{esc:[{event:"uiInputBlur",selector:"input, textarea"},{event:"uiCloseModal"},{event:"uiCloseDropdown"},{event:"uiTypeaheadFocusIfActive"},{event:"uiGridClearSelection"}],"CMD+ret":[{event:"uiSendRetweetAction"},{event:"uiSendTweetAction",selector:".js-compose-input"}],"CTRL+ret":[{event:"uiSendRetweetAction"},{event:"uiSendTweetAction",selector:".js-compose-input"}],del:[{event:"uiGridBack"}],bksp:[{event:"uiGridBack"}],ret:[{event:"uiGridShowDetail"}],n:[{event:"uiShowCompose"}],"/":[{event:"uiSearchInputFocus"}],s:[{event:"uiSearchInputFocus"}],a:[{event:"uiShowAddColumn"}],"?":[{event:"uiShowKeyboardShortcutList"}],left:[{event:"uiGridLeft",throttle:!0}],h:[{event:"uiGridLeft",throttle:!0}],right:[{event:"uiGridRight",throttle:!0}],l:[{event:"uiGridRight",throttle:!0}],up:[{event:"uiGridUp",throttle:!0}],k:[{event:"uiGridUp",throttle:!0}],down:[{event:"uiGridDown",throttle:!0}],j:[{event:"uiGridDown",throttle:!0}],r:[{event:"uiGridReply"}],f:[{event:"uiGridFavorite"}],t:[{event:"uiGridRetweet"}],d:[{event:"uiGridDirectMessage"}],m:[{event:"uiGridDirectMessage"}],p:[{event:"uiGridProfile"}]," ":[{event:"uiGridPageDown",throttle:!0}],"SHIFT+ ":[{event:"uiGridPageUp",throttle:!0}],pageup:[{event:"uiGridPageUp",throttle:!0}],pagedown:[{event:"uiGridPageDown",throttle:!0}],home:[{event:"uiGridHome",throttle:!0}],end:[{event:"uiGridEnd",throttle:!0}]}}),this.blurInput=function(e,t){$(e.target).blur()},this.shortcutEventHandlerFactory=function(e){var t,n,r=function(t){t.preventDefault(),t.stopPropagation(),this.trigger(t.target,e.event)}.bind(this);return e.throttle?(t=_.throttle(r,100),t):(n=_.debounce(r,200,!0),n)},this.columnFocusFactory=function(e){return function(t){t.preventDefault(),t.stopPropagation(),e===0?this.trigger("uiColumnFocus",{last:!0}):this.trigger("uiColumnFocus",{index:e-1})}.bind(this)},this.after("initialize",function(){this.on(document,"uiInputBlur",this.blurInput);for(var e=0;e<10;e++)this.addShortcut(e+"",this.columnFocusFactory(e));_.each(this.attr.shortcuts,function(e,t){e.forEach(function(e){var n=this.shortcutEventHandlerFactory(e);this.addShortcut(t,n,e.selector)},this)},this)})};return e(n,t)}),define("ui/with_template",[],function(){function e(){this.render=function(e,t){this.$node.html(this.toHtml(e,t))},this.renderTemplate=function(e,t){return $(TD.ui.template.render(e,t))},this.toHtml=function(e,t){return TD.ui.template.render(e,t)},this.toHtmlFromRaw=function(e,t){var n=Hogan.compile(e);return n.render(t)}}return e}),define("ui/message_banner",["flight/component","ui/with_template"],function(e,t){var n=function(){this.defaultAttrs({dismissButton:".js-dismiss",actions:{triggerEvent:"trigger-event",dismiss:"dismiss",openUrl:"url-ext"},buttonClasses:{"trigger-event":"btn-primary","url-ext":"btn-primary",dismiss:"btn-alt"}}),this.eventHandlerFactory=function(e){return function(){switch(e.action){case"trigger-event":this.trigger(e.event.type,e.event.data);break;case"url-ext":case"dismiss":}this.trigger("uiClickMessageButtonAction",{messageId:this.message.id,actionId:e.id}),this.hide()}.bind(this)},this.dismiss=function(){this.trigger("uiDismissMessageAction",this.message),this.hide()},this.hide=function(){this.trigger("uiHidingMessageBanner",this.message),this.$node.slideUp(),this.message=null},this.handleMessageData=function(e,t){if(this.message){if(this.message.id===t.message.id)return;this.animate=!1}else this.animate=!0;this.message=t.message,this.showMessage()},this.showMessage=function(){this.trigger("uiShowMessageBanner",this.message);var e,t,n={text:this.message.text,actions:[]};for(t=0;this.message.actions&&t<this.message.actions.length;t++){e=this.message.actions[t];switch(e.action){case this.attr.actions.openUrl:n.actions.push({label:e.label,action:e.action,actionId:e.id,url:e.url,isExternalUrl:!0,boundEventHandler:this.eventHandlerFactory(e),buttonClass:this.attr.buttonClasses[e.action]});break;case this.attr.actions.triggerEvent:n.actions.push({label:e.label,action:e.action,actionId:e.id,boundEventHandler:this.eventHandlerFactory(e),buttonClass:this.attr.buttonClasses[e.action]});break;case this.attr.actions.dismiss:n.actions.push({label:e.label,action:e.action,actionId:e.id,boundEventHandler:this.eventHandlerFactory(e),buttonClass:this.attr.buttonClasses[e.action]});break;default:}}this.render("topbar/message_banner",n),this.message.colors&&this.$node.css({"background-color":this.message.colors.background,color:this.message.colors.foreground}),this.on(this.select("dismissButton"),"click",this.dismiss),n.actions.forEach(function(e){this.on('[data-action-id="'+e.actionId+'"]',"click",e.boundEventHandler)}.bind(this)),this.animate&&(this.trigger("uiShowingMessageBanner",this.message),this.$node.slideDown())},this.after("initialize",function(){this.on(document,"dataMessage",this.handleMessageData)})};return e(n,t)}),define("ui/typeahead/with_users",[],function(){return function(){this.defaultAttrs({usersListSelector:".js-typeahead-user-list",usersItemSelector:".js-typeahead-user-item",usersTemplate:"typeahead/typeahead_users"}),this.renderUsers=function(e,t){this.$usersList.find(this.attr.usersItemSelector).remove();var n=t.suggestions.users||[];if(!n.length){this.clearUsers();return}var r=[],i;n.forEach(function(e){r.push({screen_name:e.screen_name,name:e.name,profile_image_url:this.getAvatar(e),verified:e.verified})},this),i=this.toHtml(this.attr.usersTemplate,{users:r}),this.$usersList.toggleClass("has-results",n.length>0).toggleClass("is-hidden",n.length===0).html(i)},this.getAvatar=function(e){return e.profile_image_url_https.replace(/_normal(\..*)?$/i,"_mini$1")},this.clearUsers=function(){this.$usersList.removeClass("has-results"),this.$usersList.addClass("is-hidden")},this.after("handlePopoverCreated",function(){this.$usersList=this.select("usersListSelector")}),this.after("initialize",function(){this.on("uiTypeaheadRenderResults",this.renderUsers)})}}),define("ui/with_text_utils",["flight/compose","ui/with_template"],function(e,t){function n(){e.mixin(this,[t]),this.highlightSubstring=function(e,t){var n=-1,r,i;return t&&(n=e.toLowerCase().indexOf(t.toLowerCase())),n!==-1?(i={before:e.substr(0,n),highlight:e.substr(n,t.length),after:e.substr(n+t.length)},r=this.toHtmlFromRaw("{{before}}<b>{{highlight}}</b>{{after}}",i)):r=this.toHtmlFromRaw("{{text}}",{text:e}),r},this.prettyNumber=function(e){return TD.util.prettyNumber(e)}}return n}),define("ui/typeahead/with_saved_searches",["flight/compose","ui/with_text_utils"],function(e,t){return function(){e.mixin(this,[t]),this.defaultAttrs({savedSearchesListSelector:".js-typeahead-saved-search-list",savedSearchesItemSelector:".js-typeahead-saved-search-item",savedSearchesTemplate:"typeahead/typeahead_saved_searches"}),this.renderSavedSearches=function(e,t){var n,r=[];this.$savedSearchesList.empty();if(!t.suggestions||!t.suggestions.savedSearches)return;t.suggestions.savedSearches.forEach(function(e){r.push({query:e.query,name:this.highlightSubstring(e.name,t.query)})},this),n=this.toHtml(this.attr.savedSearchesTemplate,{savedSearches:r}),this.$savedSearchesList.toggleClass("has-results",r.length>0).toggleClass("is-hidden",r.length===0).html(n)},this.after("handlePopoverCreated",function(){this.$savedSearchesList=this.select("savedSearchesListSelector")}),this.after("initialize",function(){this.on("uiTypeaheadRenderResults",this.renderSavedSearches)})}}),define("ui/typeahead/with_recent_searches",["flight/compose","ui/with_text_utils"],function(e,t){var n=function(){e.mixin(this,[t]),this.defaultAttrs({recentSearchesListSelector:".js-typeahead-recent-search-list",recentSearchesItemSelector:".js-typeahead-recent-search-item",recentSearchesClearSelector:".js-typeahead-recent-search-clear",recentSearchesTemplate:"typeahead/typeahead_recent_searches",recentSearchesPlaceholderTemplate:"typeahead/recent_searches_placeholder",recentSearchesFixedClass:"recent-searches-fixed-list"}),this.renderRecentSearches=function(e,t){this.currentData=t;var n=t.datasources&&t.datasources.some(function(e){return e==="recentSearches"});if(!n){this.$recentSearchesList.removeClass("has-results").addClass("is-hidden").empty(),this.$clearRecentSearches.addClass("is-hidden").removeClass("is-invisible");return}var r=n&&t.datasources.length===1,i=t.suggestions&&t.suggestions.recentSearches&&t.suggestions.recentSearches.length,s=r&&i,o,u=i||r,a=r&&!i;if(i){var f=[];t.suggestions.recentSearches.forEach(function(e){f.push({query:e,name:this.highlightSubstring(e,t.query)})},this),o=this.toHtml(this.attr.recentSearchesTemplate,{recentSearches:f})}else r?o=this.toHtml(this.attr.recentSearchesPlaceholderTemplate):o="";this.$recentSearchesList.toggleClass(this.attr.recentSearchesFixedClass,r),this.$recentSearchesList.toggleClass("has-results",i).toggleClass("is-hidden",!u).html(o),this.$clearRecentSearches.toggleClass("is-hidden",!r).toggleClass("is-invisible",a)},this.clearRecentSearches=function(e){delete this.currentData.suggestions.recentSearches,this.renderRecentSearches(null,this.currentData)},this.after("handlePopoverCreated",function(){this.$recentSearchesList=this.select("recentSearchesListSelector")}),this.after("initialize",function(){this.$clearRecentSearches=this.select("recentSearchesClearSelector"),this.on("uiRecentSearchClearAction",this.clearRecentSearches),this.on("uiTypeaheadRenderResults",this.renderRecentSearches)})};return n}),define("ui/typeahead/with_topics",["flight/compose","ui/with_text_utils"],function(e,t){return function(){e.mixin(this,[t]),this.defaultAttrs({topicsListSelector:".js-typeahead-topic-list",topicsItemSelector:".js-typeahead-topic-item",topicsTemplate:"typeahead/typeahead_topics"}),this.renderTopics=function(e,t){this.$topicsList.empty();var n=t.suggestions.topics||[];if(!n.length){this.clearTopics();return}var r=n.map(function(e){return{topic:e.topic,name:this.highlightSubstring(e.topic,t.query)}},this),i=this.toHtml(this.attr.topicsTemplate,{topics:r});this.$topicsList.toggleClass("has-results",n.length>0).toggleClass("is-hidden",n.length===0).html(i)},this.clearTopics=function(e){this.$topicsList.removeClass("has-results"),this.$topicsList.addClass("is-hidden")},this.resetTopics=function(){this.clearTopics(),this.$topicsList.find(this.attr.topicsItemSelector).remove()},this.after("handlePopoverCreated",function(){this.$topicsList=this.select("topicsListSelector")}),this.after("initialize",function(){this.on("uiTypeaheadRenderResults",this.renderTopics)})}}),define("util/notifications",[],function(){var e={};return e.publishToQueue=function(e,t){TD.storage.notification.notify(e,t)},e.publish=function(e,t){$.publish(e,t)},e.subscribe=function(e,t){return $.subscribe(e,t)},e.unsubscribe=function(e){$.unsubscribe(e)},e}),define("ui/with_transitions",[],function(){var e=function(){this.animateHeight=function(e,t,n,r){var i=e.height(),s,o,u=function(){e.trigger("uiTransitionExpandEnd"),typeof n=="function"&&n(),e.removeClass(t),r==="collapse"&&e.css("height","")};r==="expand"?(e.height(0),s=i):s=0,o=s===0?i*-1:s,e.addClass(t),_.defer(function(){e.height(s),e.trigger("uiTransitionExpandStart",{delta:o}),TD.ui.main.TRANSITION_END_EVENTS?e.one(TD.ui.main.TRANSITION_END_EVENTS,u):u()}.bind(this))},this.transitionExpand=function(e,t,n){this.animateHeight(e,t,n,"expand")},this.transitionCollapse=function(e,t,n){this.animateHeight(e,t,n,"collapse")},this.transitionTop=function(e,t,n,r){var i=function(){e.removeClass(t),typeof r=="function"&&r()};e.addClass(t),e.css("top",n),TD.ui.main.TRANSITION_END_EVENTS?e.one(TD.ui.main.TRANSITION_END_EVENTS,i):i()}};return e}),define("ui/popover",["flight/component","ui/with_template","util/notifications","ui/with_transitions"],function(e,t,n,r){var i=function(){this.defaultAttrs({header:".js-popover-header",content:".js-popover-content",footer:".js-popover-footer",columnScrollerIsAnimatingClass:"is-column-scroller-animating",contentInsetClass:"popover-scroller-inset",defaultHeight:750,defaultWidth:310,bottomPadding:30,repositionPeriod:100,withClickTrap:!0,withOverlay:!1,closeModals:!1}),this.clickTrap=function(e){if(e===this.lastSeenEvent)return;this.lastSeenEvent=e,this.$node&&this.$node.find(e.currentTarget).length===0&&this.hide()},this.show=function(){if(this.visible)return;this.$popover.removeClass("is-hidden"),this.attr.withOverlay&&this.$overlay.removeClass("is-hidden"),this.attr.closeModals&&this.trigger("uiCloseModal"),this.reposition(),this.repositionInterval=this.repositionInterval||setInterval(this.reposition.bind(this),this.attr.repositionPeriod),this.attr.withClickTrap&&_.defer(function(){$("body").on("click","*",this.boundClickTrap)}.bind(this)),this.trigger("uiPopoverShown",{id:this.attr.id}),this.visible=!0},this.hide=function(){if(!this.visible)return;$("body").off("click","*",this.boundClickTrap),this.$popover.addClass("is-hidden"),this.$overlay.addClass("is-hidden"),clearInterval(this.repositionInterval),this.repositionInterval=null,this.trigger("uiPopoverHidden",{id:this.attr.id}),this.visible=!1},this.destroy=function(){this.hide(),this.$popover.remove(),this.$overlay.remove(),this.teardown()},this.resizeContent=function(e){var t=0,n=0;this.$header.hasClass("is-hidden")||(t=this.$header.outerHeight()),this.$footer.hasClass("is-hidden")||(n=this.$footer.outerHeight()),this.$content.css({top:t,bottom:n})},this.reposition=function(e){var t=this.$popover.offset().top,n=$(window).height(),r=0,i=0;this.$header.hasClass("is-hidden")||(r=this.$header.outerHeight()),this.$footer.hasClass("is-hidden")||(i=this.$footer.outerHeight()),this.maxHeight=n-t-this.attr.bottomPadding,this.$popover.css({"max-height":this.maxHeight}),this.attr.defaultHeight==="auto"&&(this.height=this.$content.contents().outerHeight()+r+i,this.$popover.css({height:this.height}))},this.setSize=function(e,t){this.width=t.width,this.height=t.height,this.$popover.css({width:this.width,height:this.height,"margin-left":-this.width/2}),this.resizeContent()},this.setContent=function(e,t){t.header!==undefined&&(this.$header.contents().detach(),this.$header.append(t.header)),t.content!==undefined&&(this.$content.contents().detach(),this.$content.append(t.content)),t.footer!==undefined&&(this.$footer.contents().detach(),this.$footer.append(t.footer)),this.$header.toggleClass("is-hidden",!t.header),this.$content.toggleClass("is-hidden",!t.content),this.$content.toggleClass(this.attr.contentInsetClass,Boolean(t.content&&t.header)),this.$footer.toggleClass("is-hidden",!t.footer),this.resizeContent()},this.hideFooter=function(e){this.$footer.addClass("is-hidden")},this.showFooter=function(e){this.$footer.removeClass("is-hidden")},this.handleColumnOptionsTransitionStart=function(e,t){var n=this.$content,r=parseInt(n.css("top"),10),i=function(){n.data("isAnimating",!1)};n.data("isAnimating")===!0?this.columnScrollerTargetTop=this.columnScrollerTargetTop+t.delta:(n.data("isAnimating",!0),this.columnScrollerTargetTop=r+t.delta),this.transitionTop(n,this.attr.columnScrollerIsAnimatingClass,this.columnScrollerTargetTop,i)},this.after("initialize",function(){this.visible=!1,this.$popover=this.renderTemplate("menus/popover"),this.$node.append(this.$popover),this.$overlay=this.renderTemplate("overlay"),this.$overlay.insertBefore(this.$node),this.$header=this.select("header"),this.$content=this.select("content"),this.$footer=this.select("footer"),this.on("uiPopoverShow",this.show),this.on("uiPopoverHide",this.hide),this.on("uiPopoverDestroy",this.destroy),this.on("uiPopoverSetSize",this.setSize),this.on("uiPopoverSetContent",this.setContent),this.on("uiPopoverReposition",this.resizeContent),this.on("uiPopoverHideFooter",this.hideFooter),this.on("uiPopoverShowFooter",this.showFooter),this.on("uiTransitionExpandStart",this.handleColumnOptionsTransitionStart),this.on("uiAccordionTotalHeightChanged",this.resizeContent),this.setSize(null,{width:this.attr.defaultWidth,height:this.attr.defaultHeight}),this.trigger("uiPopoverCreated",{id:this.attr.id}),this.on(document,"uiCloseModal",this.hide),this.boundClickTrap=this.clickTrap.bind(this)})};return e(i,t,r)}),define("ui/with_focus",[],function(){var e=function(){this.focusRequest=function(){this.trigger("uiFocusRequest",{id:this.focusId})},this.focusRelease=function(){this.trigger("uiFocusRelease",{id:this.focusId})},this.handleFocus=function(e,t){t.id===this.focusId?this.hasFocus=!0:this.hasFocus=!1},this.after("teardown",function(){this.trigger("uiFocusRelease",{id:this.focusId})}),this.after("initialize",function(){this.focusId=_.uniqueId("focus"),this.hasFocus=!1,this.on(document,"uiFocus",this.handleFocus),this.attr.autoFocus===!0&&this.focusRequest()})};return e}),define("ui/typeahead/typeahead_dropdown",["flight/component","ui/typeahead/with_users","ui/typeahead/with_saved_searches","ui/typeahead/with_recent_searches","ui/typeahead/with_topics","ui/with_template","ui/popover","ui/with_focus"],function(e,t,n,r,i,s,o,u){function a(){this.defaultAttrs({inputSelector:".js-search-input",dropdownSelector:".js-typeahead-dropdown",itemsSelector:".js-typeahead-item",itemSelectedClass:"is-selected",itemSelectedSelector:".is-selected",deciders:{showDebugInfo:!1},datasources:["topics","savedSearches","recentSearches","users"],datasourcesRecentOnly:["recentSearches"],queryTypes:["topic","saved-search","recent-search","user"]}),this.dropdownFocus=function(){this.$input.attr("data-focus",!0),this.hidden&&(this.hidden=!1,this.trigger("uiTypeaheadDropdownInvoked")),this.inputValueUpdated()},this.dropdownBlur=function(){this.$input.data("focus",!1),this.trigger("dataTypeaheadQueryReset"),this.mouseIsOverDropdown||this.hide()},this.mouseOver=function(e,t){this.select("itemsSelector").removeClass(this.attr.itemSelectedClass),$(t.el).addClass(this.attr.itemSelectedClass)},this.moveSelection=function(e){var t=this.select("itemsSelector").filter(":visible"),n=t.filter(this.attr.itemSelectedSelector),r;n.removeClass(this.attr.itemSelectedClass),n.length?r=t.index(n)+e:r=-1+e,r<0?r=t.length-1:r>=t.length&&(r=0),t.eq(r).addClass(this.attr.itemSelectedClass)},this.moveSelectionUp=function(e){this.moveSelection(-1)},this.moveSelectionDown=function(e){this.moveSelection(1)},this.getInputValue=function(){return this.$input.val()},this.show=function(e){this.focusRequest(),this.trigger("uiPopoverShow")},this.hide=function(e){this.focusRelease(),this.trigger("uiPopoverHide"),this.hidden=!0},this.destroy=function(e){this.trigger("dataTypeaheadQueryReset"),this.teardown()},this.inputValueUpdated=function(){var e=this.getInputValue(),t=this.attr.datasources;e.trim().length===0&&(t=this.attr.datasourcesRecentOnly),this.select("itemsSelector").removeClass(this.attr.itemSelectedClass),this.trigger("uiNeedsTypeaheadSuggestions",{query:e,datasources:t,dropdownId:this.getDropdownId()})},this.getDropdownId=function(){return this.dropdownId||(this.dropdownId="swift_typeahead_dropdown_"+ +(new Date)),this.dropdownId},this.triggerSelectionEvent=function(e){var t=this.select("itemsSelector"),n=t.index(e),r=this.getInputValue(),i=e.data("search-query");if(!r&&!i)return;this.trigger("uiTypeaheadItemSelected",{index:n,searchType:e.data("search-type"),query:i,input:r})},this.submitClickedItem=function(e,t){var n=$(t.el);this.triggerSelectionEvent(n)},this.submitQuery=function(e){var t,n=this.select("itemsSelector").filter(this.attr.itemSelectedSelector).filter(":visible").first();n.length?this.triggerSelectionEvent(n):(t=this.getInputValue().trim(),t&&this.trigger("uiTypeaheadSubmitQuery",{query:t}))},this.completeSelection=function(e){if(this.$input.attr("dir")=="rtl"&&e.type==="uiTypeaheadInputRight")return;if(["lrt",undefined,""].indexOf(this.$input.attr("dir"))!==-1&&e.type==="uiTypeaheadInputLeft")return;var t=this.select("itemsSelector").filter(this.attr.itemSelectedSelector).first();if(!t.length){t=this.select("itemsSelector").first();var n=t.data("search-query")!==this.getInputValue();if(!n)return}var r=t.data("search-type"),i=this.attr.queryTypes.some(function(e){return e===r});if(!i)return;var s=t.data("search-query"),o=this.select("itemsSelector"),u=o.index(t);this.trigger("uiSearchInputItemComplete",{value:s,searchType:t.data("search-type"),index:u,query:s})},this.updateDropdown=function(e,t){var n=this.select("itemsSelector").filter(this.attr.itemSelectedSelector);if(t.dropdownId!=this.getDropdownId()||t.query!==this.getInputValue()||!this.$input.attr("data-focus")||n.length)return;this.trigger("uiTypeaheadRenderResults",t);var r=this.attr.datasources.some(function(e){return t.suggestions[e]&&t.suggestions[e].length});r=r||!t.query,r?(this.trigger("uiSearchInputSetPreventDefault",{preventDefault:!0,key:9}),this.show(),this.select("itemsSelector").removeClass("list-item-first").removeClass("list-item-last").filter(":visible").first().addClass("list-item-first").end().last().addClass("list-item-last")):(this.trigger("uiSearchInputSetPreventDefault",{preventDefault:!1,key:9}),this.hide())},this.mouseEnter=function(e,t){this.mouseIsOverDropdown=!0},this.mouseLeave=function(e,t){this.mouseIsOverDropdown=!1},this.handlePopoverCreated=function(e,t){var n=this.toHtml("typeahead/typeahead_dropdown");this.trigger("uiPopoverSetContent",{content:n}),this.on(".popover","mouseenter",this.mouseEnter),this.on(".popover","mouseleave",this.mouseLeave)},this.before("teardown",function(){this.trigger("uiPopoverDestroy",{id:this.popoverId})}),this.after("initialize",function(){this.on(document,"uiPopoverCreated",this.handlePopoverCreated),this.popoverId=_.uniqueId("popover_"),o.attachTo(".js-search-form",{id:this.popoverId,withOverlay:!1,withClickTrap:!0,closeModals:!0,defaultHeight:"auto"}),this.hidden=!0,this.$input=this.select("inputSelector"),this.on(document,"dataTypeaheadSuggestions",this.updateDropdown),this.on(document,"uiTypeaheadHide",this.hide),this.on(document,"uiTypeaheadDestroy",this.destroy),this.on(this.$input,"uiTypeaheadInputFocus",this.dropdownFocus),this.on(this.$input,"uiTypeaheadInputBlur",this.dropdownBlur),this.on(this.$input,"uiTypeaheadInputSubmit",this.submitQuery),this.on(this.$input,"uiTypeaheadInputEscaped",this.hide),this.on(this.$input,"uiTypeaheadInputChanged",this.inputValueUpdated),this.on(this.$input,"uiTypeaheadInputMoveUp",this.moveSelectionUp),this.on(this.$input,"uiTypeaheadInputMoveDown",this.moveSelectionDown),this.on(this.$input,"uiTypeaheadInputTab uiTypeaheadInputRight uiTypeaheadInputLeft",this.completeSelection),this.on("mouseover",{itemsSelector:this.mouseOver}),this.on("click",{itemsSelector:this.submitClickedItem})})}return e(a,s,n,t,i,r,u)}),define("ui/toggle_button",["flight/component","ui/with_template"],function(e,t){var n=function(){this.defaultAttrs({template:"menus/toggle_button",buttonSelector:".js-toggle-button"}),this.handleButtonClick=function(e){var t=$(e.currentTarget),n=t.data("clickevent");n&&(this.trigger(n),this.$buttons.removeClass("is-selected"),t.addClass("is-selected"))},this.handleSelectItem=function(e,t){this.$node.find("."+t.class).click()},this.after("initialize",function(e){var t=this;this.buttons=e.buttons;var n={buttons:[this.buttons.left,this.buttons.right]};this.render(this.attr.template,n),this.$buttons=this.select("buttonSelector"),this.on(this.$buttons,"click",this.handleButtonClick),this.on("uiToggleSelectItem",this.handleSelectItem),this.on("uiToggleButtonDestroy",this.teardown)})};return e(n,t)}),define("ui/with_user_menu",[],function(){var e=function(){this.defaultAttrs({userMenuButtonSelector:".js-profile-menu"}),this.showUserMenu=function(e,t,n){var r=!0;return this.userMenu&&(r=n.id!==this.userMenu.user.id,this.userMenu.destroy()),r&&(this.userMenu=new TD.components.ProfileMenu(t,n),this.userMenu.setPosition(TD.components.DropDown.POSITION_LEFT),e.stopPropagation()),r},this.handleUserMenuButtonClick=function(e){var t=$(e.target).closest(this.attr.userMenuButtonSelector),n=t.data("user-id").toString(),r;for(var i=0;i<this.users.length;i++)if(this.users[i].id===n){r=this.users[i];break}this.showUserMenu(e,t,r)},this.destroyMenuReference=function(e,t){t.target===this.userMenu&&(this.userMenu=null)},this.hideUserMenu=function(){this.userMenu&&this.userMeny.destroy()},this.before("teardown",function(){this.userMenu&&this.userMenu.destroy()}),this.after("initialize",function(){this.userMenu=null,this.on("td-dropdown-close",this.destroyMenuReference),this.on("click",{userMenuButtonSelector:this.handleUserMenuButtonClick})})};return e}),define("ui/user_search_results",["flight/component","ui/with_template","ui/with_user_menu"],function(e,t,n){var r=function(){this.query=null,this.handleSearch=function(e,t){this.query=t.query,this.hideUserMenu(),this.$node.empty(),this.trigger(document,"uiNeedsUserSearch",{query:this.query})},this.handleResults=function(e,t){if(t.query!==this.query)return;this.users=t.result,this.users.length===0?this.render("search_no_users_placeholder"):this.render("menus/user_results",{users:this.users,withUserMenu:!0})},this.after("initialize",function(){this.on(document,"uiSearchResultsSearch",this.handleSearch),this.on(document,"dataUserSearch",this.handleResults),this.on("uiUserResultsDestroy",this.teardown)})};return e(r,t,n)}),define("ui/with_accordion",["flight/compose","ui/with_transitions"],function(e,t){var n=function(){e.mixin(this,[t]),this.defaultAttrs({accordionItemSelector:".js-accordion-item",accordionIsExpandedClass:"is-expanded",accordionIsActiveClass:"is-active",accordionToggleSelector:".js-accordion-toggle-view",accordionPanelSelector:".js-accordion-panel",isAccordionPanelAnimatingClass:"is-accordion-panel-animating"}),this.accordionToggle=function(e){var t=$(e.target).closest(this.attr.accordionItemSelector),n=t.find(this.attr.accordionPanelSelector),r=this.select("accordionItemSelector").filter(function(e,t){return $(t).hasClass(this.attr.accordionIsExpandedClass)}.bind(this)),i=r.find(this.attr.accordionPanelSelector);r.length>0&&(r.removeClass(this.attr.accordionIsActiveClass),this.transitionCollapse(i,this.attr.isAccordionPanelAnimatingClass,function(){r.removeClass(this.attr.accordionIsExpandedClass)}.bind(this)),this.trigger(r,"uiAccordionCollapseAction")),t.is(r)||(t.addClass(this.attr.accordionIsExpandedClass),t.addClass(this.attr.accordionIsActiveClass),this.transitionExpand(n,this.attr.isAccordionPanelAnimatingClass),this.trigger(t,"uiAccordionExpandAction"))},this.handleUpdatePanelHeights=function(){this.select("accordionPanelSelector").filter(":visible").each(function(e,t){var n=$(t);n.css("height",""),n.height(n.height()),this.trigger("uiAccordionTotalHeightChanged")}.bind(this))},this.after("initialize",function(){this.on("click",{accordionToggleSelector:_.throttle(this.accordionToggle,300).bind(this)}),this.on("uiAccordionUpdatePanelHeights",this.handleUpdatePanelHeights)})};return n}),define("data/with_languages",[],function(){function e(){this.before("initialize",function(){this.languages=TD.languages.getAllLanguages()})}return e}),define("ui/search/content_filter_form",["flight/component","ui/with_template","data/with_languages"],function(e,t,n){var r=function(){this.defaultAttrs({filterType:"content",template:"menus/search_content_form",matchingSelector:".js-matching",excludingSelector:".js-excluding",containingSelector:".js-containing",writtenInSelector:".js-written-in",retweetsSelector:".js-retweets",searchFilter:null,renderOptions:{withContentType:!0,withMatching:!0,withExcluding:!0,withLanguage:!0,withRetweetsToggle:!0}}),this.getContainingOptions=function(){return[{value:TD.vo.ContentFilter.TYPE_ANYTHING,title:TD.i("all Tweets")},{value:TD.vo.ContentFilter.TYPE_IMG,title:TD.i("Tweets with images")},{value:TD.vo.ContentFilter.TYPE_VID,title:TD.i("Tweets with videos")},{value:TD.vo.ContentFilter.TYPE_IMG_AND_VID,title:TD.i("Tweets with any media")},{value:TD.vo.ContentFilter.TYPE_LINKS,title:TD.i("Tweets with links")}]},this.getRetweetOptions=function(){return[{value:"included",title:TD.i("included"),isIncluded:!0},{value:"excluded",title:TD.i("excluded"),isIncluded:!1}]},this.handleChange=function(e){var t=this.$containing.val(),n=this.$matching.val(),r=this.$excluding.val(),i=this.$writtenIn.val(),s=this.$retweets.val(),o=this.retweetOptions.filter(function(e){return e.value===s})[0],u=new TD.vo.ContentFilter({type:t,matching:n,excluding:r,lang:i,includeRTs:o.isIncluded});this.trigger("uiSearchFilterUpdateAction",{type:"content",filter:u,filterName:$(e.target).data("title"),value:e.target.value})},this.after("initialize",function(){this.containingOptions=this.getContainingOptions(),this.retweetOptions=this.getRetweetOptions();var e={containingOptions:this.containingOptions,retweetOptions:this.retweetOptions},t=TD.languages.getSystemLanguageCode(!0),n=TD.languages.getLanguageFromISOCode(t);e.userLanguage=n,e.allLanguages=_.sortBy(this.languages,function(e){return e.localized_name}),this.attr.searchFilter&&this.attr.searchFilter.content&&(e.matching=this.attr.searchFilter.content.matching,e.excluding=this.attr.searchFilter.content.excluding),$.extend(e,this.attr.renderOptions),this.render(this.attr.template,e),this.$matching=this.select("matchingSelector"),this.$excluding=this.select("excludingSelector"),this.$containing=this.select("containingSelector"),this.$writtenIn=this.select("writtenInSelector"),this.$retweets=this.select("retweetsSelector"),this.attr.searchFilter&&this.attr.searchFilter.content&&(this.$containing.val(this.attr.searchFilter.content.type),this.attr.searchFilter.content.includeRTs?this.$retweets.val("included"):this.$retweets.val("excluded"),this.$writtenIn.val(this.attr.searchFilter.content.lang)),this.on("change",this.handleChange)})};return e(r,t,n)}),define("ui/search/user_filter_form",["flight/component","ui/with_template","data/with_languages"],function(e,t,n){var r=function(){this.defaultAttrs({FROM_ME:"from_me",MENTIONING_USER:"mentioning_user",MENTIONING_ME:"mentioning_me",filterType:"user",template:"menus/search_user_form",tweetsFromSelector:".js-tweets-from",tweetsFromUserOrListSelector:".js-tweets-from-user-or-list",tweetsFromMeSelector:".js-tweets-from-me",mentioningSelector:".js-mentioning",mentioningUserSelector:".js-mentioning-user",mentioningMeSelector:".js-mentioning-me",isHiddenClass:"is-hidden",renderOptions:{withFromList:!1}}),this.getTweetsFromOptions=function(e){var t=[{value:TD.vo.UserFilter.FROM_ALL,title:TD.i("all users")},{value:TD.vo.UserFilter.FROM_USER,title:TD.i("specific user")},{value:this.attr.FROM_ME,title:TD.i("me")},{value:TD.vo.UserFilter.FROM_VERIFIED,title:TD.i("verified users")}];return e&&t.push({value:TD.vo.UserFilter.FROM_LIST,title:TD.i("members of list")}),t},this.getMentioningOptions=function(){return[{value:"",title:TD.i("-")},{value:this.attr.MENTIONING_USER,title:TD.i("specific user")},{value:this.attr.MENTIONING_ME,title:TD.i("me")}]},this.getMyAccounts=function(){var e=TD.storage.accountController.getPreferredAccount("twitter"),t=TD.storage.accountController.getAccountsForService("twitter");return t=t.map(function(t){return{value:t.getUsername(),title:"@"+t.getUsername(),isDefault:t===e}}),t=t.sort(function(e,t){return e.value.toLowerCase().localeCompare(t.value.toLowerCase())}),t},this.updateFormState=function(e,t){switch(e){case TD.vo.UserFilter.FROM_USER:case TD.vo.UserFilter.FROM_LIST:this.$tweetsFromUserOrList.removeClass(this.attr.isHiddenClass),this.$tweetsFromMe.addClass(this.attr.isHiddenClass);break;case this.attr.FROM_ME:this.$tweetsFromMe.removeClass(this.attr.isHiddenClass),this.$tweetsFromUserOrList.addClass(this.attr.isHiddenClass),this.$tweetsFromUserOrList.val("");break;default:this.$tweetsFromMe.addClass(this.attr.isHiddenClass),this.$tweetsFromUserOrList.addClass(this.attr.isHiddenClass),this.$tweetsFromUserOrList.val("")}switch(t){case this.attr.MENTIONING_USER:this.$mentioningUser.removeClass(this.attr.isHiddenClass),this.$mentioningMe.addClass(this.attr.isHiddenClass);break;case this.attr.MENTIONING_ME:this.$mentioningMe.removeClass(this.attr.isHiddenClass),this.$mentioningUser.addClass(this.attr.isHiddenClass),this.$mentioningUser.val("");break;default:this.$mentioningMe.addClass(this.attr.isHiddenClass),this.$mentioningUser.addClass(this.attr.isHiddenClass),this.$mentioningUser.val("")}},this.handleChange=function(e){var t,n,r=this.$tweetsFrom.val(),i=this.$mentioning.val(),s=$(e.target).data("title");this.updateFormState(r,i),r===this.attr.FROM_ME?(t=this.$tweetsFromMe.val(),r=TD.vo.UserFilter.FROM_USER):t=this.$tweetsFromUserOrList.val(),n=i===this.attr.MENTIONING_ME?this.$mentioningMe.val():this.$mentioningUser.val(),!t&&(r===TD.vo.UserFilter.FROM_USER||r===TD.vo.UserFilter.FROM_LIST)&&(r=TD.vo.UserFilter.FROM_ALL);var o=new TD.vo.UserFilter({from_type:r,from_name:t,mention_name:n});this.trigger("uiSearchFilterUpdateAction",{type:"user",filter:o,filterName:s,value:e.target.value})},this.after("initialize",function(){var e,t,n;this.tweetsFromOptions=this.getTweetsFromOptions(this.attr.renderOptions.withFromList),this.mentioningOptions=this.getMentioningOptions(),this.myAccounts=this.getMyAccounts(),e={tweetsFromOptions:this.tweetsFromOptions,mentioningOptions:this.mentioningOptions,myAccounts:this.myAccounts},this.render(this.attr.template,e),this.$tweetsFrom=this.select("tweetsFromSelector"),this.$tweetsFromUserOrList=this.select("tweetsFromUserOrListSelector"),this.$tweetsFromMe=this.select("tweetsFromMeSelector"),this.$mentioning=this.select("mentioningSelector"),this.$mentioningUser=this.select("mentioningUserSelector"),this.$mentioningMe=this.select("mentioningMeSelector"),this.attr.searchFilter&&this.attr.searchFilter.user&&(t=this.attr.searchFilter.user.from_name&&TD.storage.accountController.getAccountFromUsername(this.attr.searchFilter.user.from_name).length>0,n=this.attr.searchFilter.user.mention_name&&TD.storage.accountController.getAccountFromUsername(this.attr.searchFilter.user.mention_name).length>0,t?(this.$tweetsFrom.val(this.attr.FROM_ME),this.$tweetsFromMe.val(this.attr.searchFilter.user.from_name)):(this.$tweetsFrom.val(this.attr.searchFilter.user.from_type),this.$tweetsFromUserOrList.val(this.attr.searchFilter.user.from_name)),n?(this.$mentioning.val(this.attr.MENTIONING_ME),this.$mentioningMe.val(this.attr.searchFilter.user.mention_name)):this.attr.searchFilter.user.mention_name&&(this.$mentioning.val(this.attr.MENTIONING_USER),this.$mentioningUser.val(this.attr.searchFilter.user.mention_name))),this.updateFormState(this.$tweetsFrom.val(),this.$mentioning.val()),this.on("change",this.handleChange)})};return e(r,t,n)}),define("ui/with_search_filter",["flight/compose","ui/with_template","ui/search/content_filter_form","ui/search/user_filter_form"],function(e,t,n,r){var i=function(){e.mixin(this,[t]),this.defaultAttrs({contentFilterSelector:".js-content-filter",userFilterSelector:".js-user-filter",locationFilterSelector:".js-location-filter",searchAccordionTemplate:"menus/search_accordion",contentSummarySelector:".js-content-filter-summary",userSummarySelector:".js-user-filter-summary",contentSummaryClass:"js-content-filter-summary",userSummaryClass:"js-user-filter-summary",locationSummarySelector:".js-location-filter-summary"}),this.defaultAttrs({filterTypes:["content","user"]}),this.isValidFilterType=function(e){return this.attr.filterTypes.some(function(t){return e===t})},this.handleSearchFilterUpdate=function(e,t){if(!t.filter||!this.isValidFilterType(t.type))return;this.searchFilter[t.type]=t.filter;var n=t.filter.getSummaryText(),r=this.select(t.type+"SummarySelector");r.text(n),TD.controller.stats.advancedSearchSettings(this.attr.scribeSection,t.type,t.filterName,t.value),this.trigger(this.$accordion,"uiAccordionUpdatePanelHeights"),this.trigger("uiColumnUpdateSearchFilter",this.searchFilter)},this.renderSearchFilters=function(e,t){this.searchFilter=e,this.$accordion=this.select("accordionSelector");var i=this.renderTemplate(this.attr.searchAccordionTemplate,{content:{summaryText:this.searchFilter.content.getSummaryText(),iconClass:"icon-content",title:TD.i("Content"),jsClass:this.attr.contentSummaryClass},user:{summaryText:this.searchFilter.user.getSummaryText(),iconClass:"icon-user",title:TD.i("Users"),jsClass:this.attr.userSummaryClass}});this.$accordion.append(i),n.attachTo(this.select("contentFilterSelector"),{searchFilter:e,renderOptions:t}),r.attachTo(this.select("userFilterSelector"),{searchFilter:e,renderOptions:t})},this.after("initialize",function(){this.searchFilter=this.searchFilter||new TD.vo.SearchFilter,this.on("uiSearchFilterUpdateAction",this.handleSearchFilterUpdate)})};return i}),define("ui/search_results",["flight/component","ui/popover","ui/toggle_button","ui/user_search_results","ui/with_accordion","ui/with_template","ui/with_search_filter","ui/with_focus"],function(e,t,n,r,i,s,o,u){var a=function(){this.defaultAttrs({scribeSection:"search_results",accordionSelector:".js-accordion"}),this.handleUpdateSearchFilter=function(e,t){if(!this.temporaryColumn)return;this.temporaryColumn.column.updateSearchFilter(t),this.temporaryColumn.populate()},this.handleSearch=function(e,t){var n=TD.storage.accountController.getPreferredAccount("twitter"),r=new TD.vo.SearchFilter;this.query=t.query,this.temporaryColumn&&this.temporaryColumn.destroy(),this.temporaryColumn=new TD.components.TemporaryColumn,this.temporaryColumn.search(this.query,n.getKey()),this.$tweetResults.empty(),this.$tweetResults.append(this.temporaryColumn.$node),this.trigger(this.$header,"uiToggleSelectItem",{"class":"js-toggle-tweets"}),this.trigger("uiPopoverShow"),this.initialized||(this.trigger("uiPopoverSetContent",{header:this.$header,content:this.$content,footer:this.$footer}),this.initialized=!0),this.renderSearchFilters(r,{withContentType:!0,withMatching:!1,withExcluding:!0,withLanguage:!0,withRetweetsToggle:!0,withFromList:!0}),this.trigger(this.$header,"uiPopoverReposition"),this.temporaryColumn.populate()},this.handleAddColumn=function(){this.temporaryColumn.makePermanent(),this.hide()},this.showTweets=function(){this.focusRequest(),this.$header.removeClass("is-hidden"),this.$accordion.removeClass("is-hidden"),this.$tweetResults.removeClass("is-hidden"),this.$userResults.addClass("is-hidden"),this.trigger("uiPopoverShowFooter"),this.trigger("uiPopoverReposition")},this.showUsers=function(){this.focusRequest(),this.$header.removeClass("is-hidden"),this.$accordion.addClass("is-hidden"),this.$tweetResults.addClass("is-hidden"),this.$userResults.removeClass("is-hidden"),this.trigger("uiPopoverHideFooter"),this.trigger("uiPopoverReposition")},this.hide=function(){this.trigger("uiPopoverHide"),this.focusRelease()},this.handlePopoverHidden=function(e,t){if(t.id!==this.popoverId)return;this.temporaryColumn&&(this.temporaryColumn.destroy(),this.temporaryColumn=null),this.trigger("uiSearchResultsClosed")},this.handlePopoverCreated=function(e,t){t.id===this.popoverId&&(this.$popover=$(e.target),this.off("uiPopoverCreated",this.handlePopoverCreated))},this.before("teardown",function(){this.trigger(this.$userResults,"uiUserResultsDestroy"),this.trigger(this.$header,"uiToggleButtonDestroy"),this.trigger("uiPopoverDestroy",{id:this.popoverId})}),this.after("initialize",function(){this.popoverId=_.uniqueId("popover_"),this.on(document,"uiSearchResultsSearch",this.handleSearch),this.on(document,"uiSearchResultsHide",this.hide),this.on(document,"uiSearchResultsDestroy",this.teardown),this.on(document,"uiPopoverCreated",this.handlePopoverCreated),this.on(document,"uiPopoverHidden",this.handlePopoverHidden),this.on("uiColumnUpdateSearchFilter",this.handleUpdateSearchFilter),this.$content=this.renderTemplate("menus/search_results_content_container"),this.$tweetResults=this.$content.filter(".js-tweet-results"),this.$userResults=this.$content.filter(".js-user-results"),r.attachTo(this.$userResults),this.$header=this.renderTemplate("menus/search_results_header"),n.attachTo(this.$header.find(".js-toggle"),{buttons:{left:{label:TD.i("Tweets"),"class":"js-toggle-tweets",clickEvent:"uiToggleTweetsClick",selected:!0},right:{label:TD.i("Users"),"class":"js-toggle-users",clickEvent:"uiToggleUsersClick"}}}),this.on(this.$header,"uiToggleTweetsClick",this.showTweets),this.on(this.$header,"uiToggleUsersClick",this.showUsers),this.$footer=this.renderTemplate("menus/search_results_footer"),this.on(this.$footer.find(".js-add-column"),"click",this.handleAddColumn),t.attachTo(".js-search-form",{id:this.popoverId,withOverlay:!0,withClickTrap:!0,closeModals:!0})})};return e(a,i,s,u,o)}),define("ui/search_input",["flight/component","ui/typeahead/typeahead_dropdown","ui/search_results"],function(e,t,n){function i(){this.defaultAttrs({inputSelector:".js-search-input",searchButtonSelector:".js-perform-search",KEY_CODE_MAP:{13:{name:"ENTER",event:"uiTypeaheadInputSubmit",on:"keypress",preventDefault:!0},27:{name:"ESC",event:"uiTypeaheadInputEscaped",on:"keydown"},9:{name:"TAB",event:"uiTypeaheadInputTab",on:"keydown",preventDefault:!0},37:{name:"LEFT",event:"uiTypeaheadInputLeft",on:"keydown"},39:{name:"RIGHT",event:"uiTypeaheadInputRight",on:"keydown"},38:{name:"UP",event:"uiTypeaheadInputMoveUp",on:"keydown",preventDefault:!0},40:{name:"DOWN",event:"uiTypeaheadInputMoveDown",on:"keydown",preventDefault:!0}}}),this.setPreventKeyDefault=function(e,t){this.attr.KEY_CODE_MAP[t.key].preventDefault=t.preventDefault},this.focus=function(e){this.isTypeaheadEnabled&&!this.isPopoverShown&&_.defer(this.$input.select.bind(this.$input)),this.trigger(this.$input,"uiTypeaheadInputFocus")},this.blur=function(e){this.trigger(this.$input,"uiTypeaheadInputBlur")},this.modifierKeyPressed=function(e){var t=this.attr.KEY_CODE_MAP[e.which||e.keyCode];if(t){if(e.type!==t.on)return;t.preventDefault&&e.preventDefault(),this.trigger(this.$input,t.event)}else{var n=this.$input.val();n=n.trim()===""?"":n,this.setQuery(n)}},this.completeInput=function(e,t){t.searchType==="user"&&(t.value="@"+t.value),this.$input.val(t.value),this.setQuery(t.value),this.focus()},this.setQuery=function(e){if(!this.currentQuery||this.currentQuery!==e)this.currentQuery=e,this.trigger("uiSearchResultsHide"),this.trigger(this.$input,"uiTypeaheadInputChanged",{value:this.currentQuery})},this.focusInput=function(){this.$input.focus()},this.activateTypeahead=function(){this.isTypeaheadEnabled||(this.isTypeaheadEnabled=!0,this.trigger("uiSearchResultsDestroy"),t.attachTo(this.$node))},this.activateSearchResults=function(){this.isTypeaheadEnabled&&(this.isTypeaheadEnabled=!1,this.trigger("uiTypeaheadDestroy"),n.attachTo(this.$node))},this.handleTypeaheadItemSelect=function(e,t){switch(t.searchType){case"user":this.$input.blur(),this.trigger("uiTypeaheadHide"),this.trigger("uiShowProfile",{id:t.query});break;case"topic":case"saved-search":case"recent-search":this.performSearch(null,t);break;case"recent-search-clear":this.trigger("uiRecentSearchClearAction");break;default:}},this.performSearch=function(e,t){this.$input.val(t.query),this.query=t.query,t.query&&this.triggerSearch(t.query),this.focusInput()},this.handleTypeaheadSubmitQuery=function(e,t){var n;if(twttr.txt.isValidList(t.query)){n=t.query.split("/"),TD.ui.openColumn.showList(n[0].substr(1),n[1]),this.trigger("uiPopoverHide"),this.$input.blur();return}this.triggerSearch(t.query)},this.triggerSearch=function(e){this.activateSearchResults(),this.trigger("uiSearchResultsSearch",{query:e})},this.before("teardown",function(){this.trigger("uiSearchResultsDestroy"),this.trigger("uiTypeaheadDestroy")}),this.after("initialize",function(){this.isTypeaheadEnabled=!1,this.activateTypeahead(),this.$input=this.select("inputSelector"),this.on(this.$input,"keyup keydown keypress paste",this.modifierKeyPressed),this.on(this.$input,"focus",this.focus),this.on(this.$input,"blur",this.blur),this.on(this.$input,"uiInputBlur",function(e){this.$input.blur()}),this.on(this.select("searchButtonSelector"),"click",function(e){this.trigger(this.$input,"uiTypeaheadInputSubmit")}),this.on("uiSearchInputSetPreventDefault",this.setPreventKeyDefault),this.on("uiSearchInputItemComplete",this.completeInput),this.on(document,"uiSearchInputFocus",this.focusInput),this.on("uiTypeaheadItemSelected",this.handleTypeaheadItemSelect),this.on("uiTypeaheadSubmitQuery",this.handleTypeaheadSubmitQuery),this.on(document,"uiPerformSearch",this.performSearch),this.on(document,"uiSearchResultsClosed",this.activateTypeahead),this.on("uiPopoverShown",function(){this.$input.addClass("is-focused"),this.isPopoverShown=!0}.bind(this)),this.on("uiPopoverHidden",function(){this.$input.removeClass("is-focused"),this.isPopoverShown=!1}.bind(this))})}var r=e(i);return r}),define("ui/with_theme",[],function(){var e=function(){this.setTheme=function(e,t){var n=t.theme;$("meta[http-equiv=Default-Style]")[0].content=n},this.after("initialize",function(){this.on(document,"dataTheme",this.setTheme)})};return e}),define("ui/with_column_selectors",[],function(){var e=function(){this.defaultAttrs({columnStateDetailViewClass:"js-column-state-detail-view",columnStateSocialProofClass:"js-column-state-social-proof",columnSelector:".js-column",scrollContainerSelector:".js-column-scroller",columnDetailScrollerSelector:".js-detail-container",columnOptionsSelector:".js-column-options"}),this.getColumnScrollContainerByKey=function(e){var t=this.getColumnElementByKey(e),n=t.find(this.attr.columnDetailScrollerSelector);return n.length>0?n:t.find(this.attr.scrollContainerSelector)},this.getColumnElementByKey=function(e){return this.select("columnSelector").filter('[data-column="'+e+'"]')},this.getKeyForColumnAtIndex=function(e){return this.select("columnSelector").eq(e).attr("data-column")},this.getKeyForLastColumn=function(){return this.select("columnSelector").last().attr("data-column")}};return e}),define("ui/social_proof_for_tweet",["flight/component","ui/with_template","ui/with_text_utils","ui/with_user_menu"],function(e,t,n,r){var i=function(){this.defaultAttrs({columnBackSelector:".js-tweet-social-proof-back",headerLinkClass:"js-tweet-social-proof-back",templateName:"status/social_proof_for_tweet"}),this.handleTwitterUsers=function(e,t){t.requestId===this.requestId&&(this.renderParams.users=t.users,this.users=t.users,this.render(this.attr.templateName,this.renderParams))},this.close=function(){this.trigger("uiSocialProofForTweetClosed"),this.teardown()},this.after("initialize",function(e){var t,n,r;this.on("uiSocialProofForTweetClose",this.close),this.on("click",{columnBackSelector:this.close}),this.on(document,"dataTwitterUsers",this.handleTwitterUsers),this.userIds=e.tweetSummary[e.type],this.attr.type==="retweeters"?(n="Retweeted",r=e.tweetSummary.retweeters_count):(n="Favorited",r=e.tweetSummary.favoriters_count),parseInt(r,10)>1?t=TD.i("{{action}} {{n}} times",{n:this.prettyNumber(r),action:n}):t=TD.i("{{action}} once",{action:n}),this.renderParams={title:t,columntitle:TD.i("Tweet"),headerLinkClass:this.attr.headerLinkClass,withUserMenu:!0},this.render(this.attr.templateName,this.renderParams),this.requestId=_.uniqueId("twitterUsers"),this.trigger("uiNeedsTwitterUsers",{requestId:this.requestId,userIds:this.userIds})})};return e(i,t,n,r)}),define("ui/column",["flight/component","ui/social_proof_for_tweet","ui/with_column_selectors","ui/with_template","ui/with_transitions"],function(e,t,n,r,i){var s=function(){this.defaultAttrs({columnMessageSelector:".js-column-message",columnMessageTemplate:"column/column_message",hasFiltersClass:"has-filters",showDetailViewClass:"is-shifted-1",showSocialProofClass:"is-shifted-2",socialProofSelector:".js-column-social-proof",columnStateDefault:"default",columnStateDetailView:"detailView",columnStateSocialProof:"socialProof",columnScrollerIsAnimatingClass:"is-column-scroller-animating"}),this.setColumnState=function(e){this.$node.removeClass([this.attr.showDetailViewClass,this.attr.columnStateDetailViewClass,this.attr.showSocialProofClass,this.attr.columnStateSocialProofClass].join(" "));switch(e){case this.attr.columnStateDetailView:this.$node.addClass(this.attr.showDetailViewClass),this.$node.addClass(this.attr.columnStateDetailViewClass);break;case this.attr.columnStateSocialProof:this.$node.addClass(this.attr.showSocialProofClass),this.$node.addClass(this.attr.columnStateSocialProofClass)}},this.handleDetailViewActive=function(){this.setColumnState(this.attr.columnStateDetailView)},this.handleDetailViewClosed=function(){this.setColumnState(this.attr.columnStateDefault),this.column.detailViewComponent=null},this.handleCloseDetailView=function(){this.column.detailViewComponent.destroy()},this.handleShowSocialProof=function(e,n){t.attachTo(this.$socialProofContainer,{type:n.type,tweetSummary:n.tweetSummary}),this.setColumnState(this.attr.columnStateSocialProof)},this.handleSocialProofClosed=function(){this.setColumnState(this.attr.columnStateDetailView)},this.handleCloseSocialProof=function(){this.$socialProofContainer.trigger("uiSocialProofForTweetClose")},this.handleColumnOptionsShown=function(e,t){this.select("columnMessageSelector").html("")},this.handleColumnOptionsHidden=function(e){this.column.hasActiveSearchFilters()&&this.$node.find(this.attr.columnMessageSelector).animate({opacity:1},150,"easeInOutQuad")},this.handleHidingColumnOptions=function(e){var t=this.$node,n,r;this.column.hasActiveSearchFilters()?(n=this.renderTemplate(this.attr.columnMessageTemplate),r=t.find(this.attr.columnMessageSelector),r.removeClass("is-hidden").css("opacity",0).html(n),t.addClass(this.attr.hasFiltersClass),this.handleColumnOptionsTransitionStart(null,{delta:r.outerHeight()})):t.removeClass(this.attr.hasFiltersClass)},this.handleShowingColumnOptions=function(e,t){var n=this.$node,r=this.select("columnMessageSelector");n.hasClass(this.attr.hasFiltersClass)&&this.handleColumnOptionsTransitionStart(null,{delta:r.outerHeight()*-1,$column:n}),r.addClass("is-hidden")},this.handleColumnOptionsTransitionStart=function(e,t){var n=this.select("scrollContainerSelector"),r=parseInt(n.css("top"),10),i=function(){n.data("isAnimating",!1)};n.data("isAnimating")===!0?this.columnScrollerTargetTop=this.columnScrollerTargetTop+t.delta:(n.data("isAnimating",!0),this.columnScrollerTargetTop=r+t.delta),this.transitionTop(n,this.attr.columnScrollerIsAnimatingClass,this.columnScrollerTargetTop,i)},this.handleShowDetailView=function(e,t){var n,r;t.columnKey===this.column.model.getKey()&&t.chirpId&&(n=this.column.findChirp(t.chirpId),r=this.column.findMostInterestingChirp(t.chirpId),this.trigger("uiColumnFocus",{columnKey:t.columnKey}),r instanceof TD.services.TwitterAction||$.publish("chirp/action",["viewDetails",r,n,this.column]))},this.after("initialize",function(){var e=this.$node.data("column");this.column=TD.controller.columnManager.get(e),this.$socialProofContainer=this.select("socialProofSelector"),this.on(document,"uiShowDetailView",this.handleShowDetailView),this.on("uiDetailViewActive",this.handleDetailViewActive),this.on("uiDetailViewClosed",this.handleDetailViewClosed),this.on("uiCloseDetailView",this.handleCloseDetailView),this.on("uiSocialProofForTweetClosed",this.handleSocialProofClosed),this.on("uiShowSocialProof",this.handleShowSocialProof),this.on("uiCloseSocialProof",this.handleCloseSocialProof),this.on("uiColumnOptionsShown",this.handleColumnOptionsShown),this.on("uiHidingColumnOptions",this.handleHidingColumnOptions),this.on("uiShowingColumnOptions",this.handleShowingColumnOptions),this.on("uiColumnOptionsHidden",this.handleColumnOptionsHidden),this.on("uiTransitionExpandStart",{columnOptionsSelector:this.handleColumnOptionsTransitionStart}),this.on("uiRemoveColumn",this.teardown)})};return e(s,n,r,i)}),define("ui/alerts_form",["flight/component","ui/with_template"],function(e,t){var n=function(){this.defaultAttrs({template:"column/alerts_form",actionButton:"[data-action]",summarySelector:".js-alerts-summary",summaryClass:"js-alerts-summary"}),this.updateSummary=function(){var e=this.column.model,t=e.getHasNotification(),n=e.getHasSound(),r;t&&n?r=TD.i("sounds and popups"):t?r=TD.i("popups"):n?r=TD.i("sounds"):r=TD.i("none"),this.select("summarySelector").text(r)},this.toggleColumnSetting=function(e){var t=$(e.target).closest(this.attr.actionButton),n=t.data("action"),r=this.column.model,i;switch(n){case"popups":i=!r.getHasNotification(),r.setHasNotification(i);break;case"sound":i=!r.getHasSound(),r.setHasSound(i)}this.updateSummary()},this.after("initialize",function(e){var t={summaryText:"",iconClass:"icon-alerts",title:TD.i("Alerts"),jsClass:this.attr.summaryClass,options:[{action:"sound",option:TD.i("Sounds"),on:e.column.model.getHasSound()}]};this.column=e.column;if(e.column.getColumnType()===TD.util.columnUtils.columnMetaTypes.SCHEDULED){this.teardown();return}TD.controller.notifications.hasNotifications()&&t.options.push({action:"popups",option:TD.i("Popups"),on:e.column.model.getHasNotification()}),this.$alertsForm=this.renderTemplate(this.attr.template,t),this.$node.append(this.$alertsForm),this.updateSummary(),this.on(this.$alertsForm,"click",{actionButton:this.toggleColumnSetting})})};return e(n,t)}),define("ui/column_options",["flight/component","ui/alerts_form","ui/with_accordion","ui/with_template","ui/with_search_filter","ui/with_transitions"],function(e,t,n,r,i,s){var o=function(){this.defaultAttrs({actionButton:"[data-action]",searchInputForm:".js-column-options-search-form",searchInput:".js-search-input",scribeSection:"column_options",dropShadowClass:"with-drop-shadow",isAnimatingClass:"is-column-options-animating",accordionSelector:".js-accordion",searchFilterSelector:".js-search-filter"}),this.updateHeight=function(){this.$node.css("height",""),this.$node.height(this.$node.height()),this.trigger("uiAccordionTotalHeightChanged")},this.handleChildTransitionExpandStart=function(e,t){this.$node.css("height","")},this.handleChildTransitionExpandEnd=function(){this.$node.height(this.$node.height())},this.after("initialize",function(e){var n;this.column=e.column,this.on("uiColumnOptionsCloseAction",this.hide),this.on("uiColumnUpdateSearchFilter",this.handleUpdateSearchFilter),this.on("uiAccordionExpandAction",this.updateHeight),this.on("uiAccordionCollapseAction",this.updateHeight),this.on("uiTransitionExpandStart",{searchFilterSelector:this.handleChildTransitionExpandStart}),this.on("uiTransitionExpandEnd",{searchFilterSelector:this.handleChildTransitionExpandEnd}),this.on("click",{actionButton:this.handleClickEvents});var r=this.column.isMessageColumn()&&TD.config.enableMarkAsRead;n={searchTerm:this.column.getBaseQuery(),isOwnList:Boolean(this.column.isOwnList()),isEmbeddable:this.column.isEmbeddable(),isClearable:this.column.isClearable(),withMarkAllAsRead:r},this.render("column/column_options",n);var i=this.column.getSearchFilter(),s=this.column.isSearchColumn();this.renderSearchFilters(i,{withContentType:!0,withMatching:!0,withExcluding:!0,withLanguage:s,withRetweetsToggle:!0,withFromList:s}),t.attachTo(this.select("accordionSelector"),{column:this.column}),this.showColumnOptions()}),this.handleUpdateSearchFilter=function(e,t){this.updateHeight(),this.column.updateSearchFilter(t)},this.hide=function(){this.trigger("uiHidingColumnOptions",this.column),this.transitionCollapse(this.$node,this.attr.isAnimatingClass,this.afterHideTransition.bind(this)),this.teardown()},this.afterHideTransition=function(){this.$node.removeClass(this.attr.dropShadowClass),this.$node.css("height",""),this.$node.empty(),this.trigger("uiColumnOptionsHidden",this.column)},this.showColumnOptions=function(){var e=this.$node.height(),t=function(){this.trigger("uiColumnOptionsShown",{column:this.column})};this.trigger("uiShowingColumnOptions",{columnOptionsHeight:e,column:this.column}),this.$node.addClass(this.attr.dropShadowClass),this.transitionExpand(this.$node,this.attr.isAnimatingClass,t.bind(this))},this.handleClickEvents=function(e){var t=$(e.target).closest(this.attr.actionButton),n=t.data("action"),r=this.column.model.getKey();switch(n){case"remove":this.trigger("uiDeleteColumnAction",{columnId:r});break;case"clear":this.column.clear(),this.trigger("uiClearColumnAction",{columnId:r});break;case"left":case"right":this.trigger("uiMoveColumnAction",{columnId:r,action:n});break;case"edit-list":new TD.components.ListMembers(this.column.isOwnList());break;case"edit-search":this.handleSubmitSearchQuery(e);break;case"embed":this.trigger("uiEmbedTimelineAction",{column:this.column});break;case"mark-all-as-read":this.column.markAllMessagesAsRead()}}};return e(o,n,r,i,s)}),define("td/UI/columns",["ui/column_options"],function(e){var t=window.TD||{};t.ui=t.ui||{},window.TD=t,t.ui.columns=function(){var n,r,i=10,s=40,o=20,u=350,a=500,f=200,l=20,c={},h={},p={},d={},v={},m=150,g=15,y="is-options-open",b="is-moving",w="is-focused",E=".is-focused",S="is-actionable",x="is-new",T="#container",N="#columns",C=".js-column-options",k=".js-action-header-button",L=".js-column-scroller",A=".js-column",O=".js-column-header",M=".js-column-message",D=".js-detail-header",P=".js-chirp-container",H=".js-stream-item",B=".js-action-header-button",j=".is-minimalist",F=150,I=function(e){return Q.getColumnElementByKey(e).find(O)},q=function(e){var t=$(e.currentTarget),n=t.data("action"),r=t.parents(A),i;switch(n){case"options":e.preventDefault(),i=r.attr("data-column"),r.hasClass(y)?Q.exitEditMode(i):Q.enterEditMode(i),e.stopPropagation();break;case"edit-list":e.preventDefault(),e.stopPropagation()}},R=function(e){var n=$(e.currentTarget),r=n.data("action"),i=n.parents(A),s=i.data("column");t.ui.columns.setColumnToTop(s)},U=function(){var e=$(this);return e.offset().top+this.offsetHeight>0&&e.offset().top<n.innerHeight()},z=function(){var e=t.ui.updates.findParentArticle($(this)),n=t.controller.columnManager.get(e.column),r=n.updateIndex[e.statusKey];e.element.replaceWith(r.render(n.temporary))},W=_.debounce(function(e){e.find(j).filter(U).each(z)},F),X=function(e,n){var r,i,s=0;return function(o){var u=o.timeStamp||(new Date).getTime(),a,f,l=n.scrollTop();d[e]=l,W(n),u-s>200&&(s=u,i=o.currentTarget.scrollHeight,r=n.height()),f=(r+l)/i,f>.999?(s=0,a=t.controller.columnManager.get(e),a.fetchOlderUpdates()):l===0&&Q.setHeaderState(e,!1)}},V=function(e,t){var n=t.closest(".scroll-h");return function(i){var s,o,u,a=$(i.currentTarget);if(!i.originalEvent.wheelDeltaY&&!i.originalEvent.wheelDeltaX)return;i.preventDefault(),Math.abs(i.originalEvent.wheelDeltaY)>Math.abs(i.originalEvent.wheelDeltaX)?a.is(L)?(s=i.currentTarget.scrollHeight,o=t.height(),u=d[e],u=Math.max(0,u-i.originalEvent.wheelDeltaY),u=Math.min(u,s-o),t.scrollTop(u),d[e]=u):a.scrollTop(a.scrollTop()-i.originalEvent.wheelDeltaY):n.length&&n.scrollLeft(r.scrollLeft()-i.originalEvent.wheelDeltaX)}},J=function(e,r){var i,s=function(n){var r=n.model,s=n.hasActiveSearchFilters(),o={columnkey:r.getKey(),columntitle:e[i].getTitleHTML(),columnclass:e[i].getIconClass(),hasFilters:s};return t.ui.template.render("column",o)};r=Boolean(r);if(r)for(i=e.length-1;i>=0;i--)n.prepend(s(e[i])),Q.setupColumn(e[i]);else for(i=0;i<e.length;i++)n.append(s(e[i])),Q.setupColumn(e[i])},K=function(){var e=$(this);Q.setColumnScrollerPosition(e)},Q={COLUMN_GLOW_DURATION:500,init:function(){n=$(N),r=$(T);var e=_.throttle(q,300);n.on("click",B+", "+M,e);var t=$(O);t.live("click",R),$(document).on("uiColumnWidthChange",this.handleColumnWidthChange.bind(this)),n.on("uiAccordionTotalHeightChanged",A,K)},setupColumn:function(e){var t=e.model.getKey(),n=$(P+'[data-column="'+t+'"]').closest(L),r=$(A+'[data-column="'+t+'"]'),i=n.scrollTop(),s=X(t,n),o=V(t,n);$(document).trigger("uiColumnRendered",{column:e,$column:r}),d[t]=i,h[t]=n,n.scroll(s),r.on("mousewheel onmousewheel",".scroll-v",o),r.on("mouseover",O,function(){var e=d[t];$(this).toggleClass(S,e>0)})},setHeaderState:function(e,t){var n=I(e);t?n.addClass(x):n.removeClass(x)},refreshTitle:function(e){var n,r=e.getIconClass(),i=Q.getColumnElementByKey(e.model.getKey()),s;e.temporary&&e.getColumnType()===t.util.columnUtils.columnMetaTypes.SEARCH?s=t.i("results"):s=e.getDetailTitleHTML(),n=t.ui.template.render("column/column_header",{columntitle:e.getTitleHTML(),columnclass:r,isTemporary:e.temporary}),I(e.model.getKey()).replaceWith(n),n=t.ui.template.render("column/column_header_detail",{headerClass:"js-detail-header",headerAction:"resetToTopColumn",headerLinkClass:"js-column-back",columntitle:s}),i.find(D).replaceWith(n),this.setColumnSettingsLinkText(i)},setColumnToTop:function(e){var t=h[e],n=10,r,i=d[e],s=250,o=function(){var u=Math.max(i-s,0);i-=s,t.scrollTop(u),d[e]=u,u>0?setTimeout(o,n):(Q.setHeaderState(e,!1),r=I(e),r.toggleClass(S,Q.getColumnElementByKey(e).find(L).scrollTop>0))};i*n/s>u&&(s=i*n/u),o()},setColumnSettingsLinkText:function(e){var n=e.find(k);e.hasClass(y)?n.text(t.i("Close")):n.text(t.i("Edit"))},setColumnScrollerPosition:function(e,n){var r=$(C,e),i=e.attr("data-column"),s=t.controller.columnManager.get(i);if(!s)return;var u=n?0:r.height();s.hasActiveSearchFilters()&&n&&(u+=o),$(L,e).css("top",u)},handleColumnWidthChange:function(){var e=this.setColumnScrollerPosition;n.find("."+y).each(function(){e($(this),!1)})},enterEditMode:function(n){var r=t.controller.columnManager.get(n),i=Q.getColumnElementByKey(n),s;i.length&&(i.addClass(y),s=$(C,i),this.setColumnSettingsLinkText(i),e.attachTo(s,{column:r}))},exitEditMode:function(e){var t=Q.getColumnElementByKey(e),n=$(C,t);if(!t.hasClass(y))return;t.removeClass(y),this.setColumnSettingsLinkText(t),n.trigger("uiColumnOptionsCloseAction")},isFrozen:function(e){var t=h[e];return t?d[e]!==0:!1},freezeScroll:function(e){var t=h[e];if(!t)return!1;var n=d[e];return v[e]||(c[e]=t[0].scrollHeight-n),n!==0},unfreezeScroll:function(e,t){var n=h[e],r=c[e],i=p[e],s=d[e],o;if(v[e])return;if(!n)return;r&&s>0?(o=n[0].scrollHeight-r,n.scrollTop(o),d[e]=o,t&&t()):W(n),i&&i.resizeScroller()},addColumnsToView:function(e){J(e),$(P).show()},removeColumn:function(e){var t=Q.getColumnElementByKey(e);t.trigger("uiRemoveColumn"),t.remove(),delete d[e],delete h[e],delete p[e]},_moveColumnInstantly:function(e,t,r,i,s,o){r.length>0&&r.attr("data-column")!==s[i+1]&&(o[r.attr("data-column")]=r.detach()),e?t.insertAfter(e):t.prependTo(n)},_animateInsertColumn:function(e,r){var i=this._getOriginalWidth(e),s=e.find(L),o=s.css("top"),u,a=new t.core.defer.Deferred;return e.index()===n.children(A).length-1&&e.after(u=$("<div />",{"class":"column",css:{width:i}})),e.css({width:0,overflow:"hidden"}).find(O+","+L).css({width:i}).end().animate({width:i},{duration:200,complete:function(){u&&u.remove(),$(this).attr("style","").find(O+","+L).attr("style",""),s.css("top")!==o&&s.css("top",o),a.callback()},step:function(e){u&&u.css({width:i-e})}}),a},_getOriginalWidth:function(e){return e.data("originalWidth")||parseInt(e.css("width"),10)},_storeOriginalWidth:function(e){var t=e.data("originalWidth");t===undefined&&(t=parseInt(e.css("width"),10)),e.data("originalWidth",t)},_isColumnOffScreen:function(e){return e.position().left+this._getOriginalWidth(e)<0||e.position().left+this._getOriginalWidth(e)>r.width()},_moveColumnToNewIndex:function(e,t,r,i,s){var o=t[e],u=r[o]||n.children('[data-column="'+o+'"]'),a=u.index(),f,l,c,h=function(){u.removeClass(b),i=u,delete r[o]};t.length>=e?(f=n.children(A).filter('[data-column="'+t[e+1]+'"]'),l=f.index()):(f=!1,l=-1),e<t.length&&a!==l&&(u.hasClass(b)?(this._storeOriginalWidth(u),this._moveColumnInstantly(i,u,f,e,t,r),this._isColumnOffScreen(u)?(c=this.scrollColumnToCenter(u.attr("data-column"),u.outerWidth()),c.addCallback(function(){h(),Q._moveColumnToNewIndex(e+1,t,r,i,s)})):(Q.focusColumn(u.attr("data-column"),Q.COLUMN_GLOW_DURATION),c=this._animateInsertColumn(u),c.addCallback(function(){h(),Q._moveColumnToNewIndex(e+1,t,r,i,s)}))):(i=u,this._moveColumnToNewIndex(e+1,t,r,i,s)))},reorderColumns:function(e){var t={},r=null,i=n.children("."+b);i.length>0?this._moveColumnToNewIndex(0,e,t,r,i):_.each(e,function(i,s){var o=t[i]||Q.getColumnElementByKey(i),u=n.children(A).eq(s);u[0]!==o[0]&&(e.length>s+1&&u.length>0&&u.attr("data-column")!==e[s+1]&&(t[u.attr("data-column")]=u.detach()),s===0?o.prependTo(n):o.insertAfter(r),delete t[i]),r=o})},calculateScrollDuration:function(e,t,n){n=n||a,t=t||l;var r=f+e/100*t;return r=Math.min(r,n),r},scrollColumnToCenter:function(e,s,o){s=s||0,o=o===undefined?!0:!1;var u=Q.getColumnElementByKey(e),c,h,p=u.outerWidth(),d=r.get(0).scrollWidth-i,v=n.width(),m=r.scrollLeft(),g=u.offset().left,y=m+g-(v-p)/2+s,b;return y=Math.min(y,d-v),y=Math.max(y,0),y!==m?(r.stop(),c=Math.abs(y-m),h=f+c/100*l,h=Math.min(h,a),b=new t.core.defer.Deferred,r.animate({scrollLeft:y},h,"easeInOutQuad",function(){o&&t.ui.columns.focusColumn(e,Q.COLUMN_GLOW_DURATION),b.callback()})):(t.ui.columns.focusColumn(e,Q.COLUMN_GLOW_DURATION),b=t.core.defer.succeed()),b},getLeftmostColumn:function(){var e=null;return n.children(A).each(function(){e||($(this).position().left<10&&$(this).position().left>=0?e=this:$(this).position().left>10&&(e=$(this).prev()))}),$(e)},scrollColumn:function(e){$.fn.reverse=[].reverse;var t,s,o=r[0].scrollWidth-r.outerWidth(),u=!1,a=!1,f,l=0;e==="right"?t=this.getLeftmostColumn().next():t=this.getLeftmostColumn().prev(),t.length?(s=r.scrollLeft()+t.position().left,s>o?(u=!0,f=r[0].scrollWidth-(r.scrollLeft()+r.outerWidth()),f>0&&r.stop().animate({scrollLeft:o},350)):r.stop().animate({scrollLeft:s-i},350)):a=!0,u&&f===0&&n.find(A).last().animate({marginRight:20},{duration:150,complete:function(){$(this).animate({marginRight:0},150),r.scrollLeft(r[0].scrollWidth)},step:function(e){r.not(":animated").scrollLeft(r.scrollLeft()+e-l),l=e}}),a&&this.bounceLeft()},bounceLeft:function(){n.animate({marginLeft:g},m,function(){n.animate({marginLeft:0},m)})},bounceRight:function(){var e=n.find(A).last(),t=parseInt(e.css("marginRight"),10);e.animate({marginRight:t+g},{duration:m,complete:function(){$(this).animate({marginRight:t},m)},step:function(e){r.scrollLeft(r[0].scrollWidth)}})},scrollPage:function(e){$.fn.reverse=[].reverse;var t=e==="left"?-1:1,s,o=r.innerWidth(),u=n.children(A).outerWidth()+i,a=Math.floor(o/u),f=r.scrollLeft()+a*u*t,l,c,h,p;if(e==="left"&&f>0){c=a*u*t;for(var d=0;d<n.children(A).length;d++){var v=n.children(A).eq(d),m=v.position().left;m<c&&(l=v.next())}l&&(f=r.scrollLeft()-l.position().left*-1)}f<0?f=0:f+o>r[0].scrollWidth&&(f=r[0].scrollWidth-o),f===r.scrollLeft()&&e==="left"?this.bounceLeft():f===r.scrollLeft()&&e==="right"?this.bounceRight():(p=Math.abs(f-r.scrollLeft()),s=this.calculateScrollDuration(p,50,1e3),s<700?r.is(":animated")?h="easeOutQuad":h="easeInOutQuad":r.is(":animated")?h="easeOutQuart":h="easeInOutQuart",r.stop().animate({scrollLeft:f},{duration:s,easing:h}))},focusColumn:function(e,r){$(E,n).removeClass(w),Q.getColumnElementByKey(e).addClass(w),_.isNumber(r)&&_.delay(function(){t.ui.columns.unfocusColumn(e)},r)},unfocusColumn:function(e){Q.getColumnElementByKey(e).removeClass(w)},setMovingColumn:function(e){Q.getColumnElementByKey(e).addClass(b)},getColumnElementByKey:function(e){return $(A+'[data-column="'+e+'"]')}};return Q}()}),define("ui/column_controller",["flight/component","ui/with_column_selectors","ui/with_template","ui/with_transitions","ui/column","td/UI/columns"],function(e,t,n,r,i,s){var o=function(){this.defaultAttrs({columnsContainerSelector:"#columns",containerSelector:"#container",columnMessageSelector:".js-column-message",columnMessageTemplate:"column/column_message",hasFiltersClass:"has-filters",columnsLeftMargin:10,slideMinDuration:200,slideMaxDuration:500,extraSlideTimePer100Px:20,scrollChirpToTopDuration:750,scrollChirpToTopOffset:50}),this.handleColumnFocus=function(e,t){var n,r=0;t.index!==undefined?n=this.getKeyForColumnAtIndex(t.index):t.last?n=this.getKeyForLastColumn():t.columnKey&&(n=t.columnKey),n&&TD.ui.columns.scrollColumnToCenter(n,r)},this.handleScrollToColumn=function(e,t){var n=this.getColumnElementByKey(t.column.model.getKey()),r=this.select("containerSelector"),i=this.select("columnsContainerSelector"),s,o,u=n.outerWidth(),a=i.width(),f=r.scrollLeft(),l=n.position().left,c=l+u,h;if(l>=0&&c<=a)return;t.direction==="left"?h=f+l-t.offset:h=f+c+t.offset-a,h!==f&&(r.stop(),s=Math.abs(h-f),o=this.attr.slideMinDuration+s/100*this.attr.extraSlideTimePer100Px,o=Math.min(o,this.attr.slideMaxDuration),r.animate({scrollLeft:h},o,"easeInOutQuad"))},this.handleScrollToChirp=function(e,t){if(!t.$chirp||!t.columnKey||t.$chirp.length===0)return;var n=this.getColumnScrollContainerByKey(t.columnKey),r=n.scrollTop(),i=t.$chirp.position().top+r,s=n.innerHeight(),o,u;t.direction==="up"?(o=i-t.offset,o<r&&n.stop().animate({scrollTop:o},100)):(u=i+t.$chirp.outerHeight()+t.offset,u>r+s&&(o=u-s,n.stop().animate({scrollTop:o},100)))},this.handleColumnRendered=function(e,t){i.attachTo(t.$column,{column:t.column})},this.after("initialize",function(){this.on(document,"uiColumnFocus",this.handleColumnFocus),this.on(document,"uiColumnsScrollToColumn",this.handleScrollToColumn),this.on(document,"uiColumnsScrollToChirp",this.handleScrollToChirp),this.on(document,"uiColumnRendered",this.handleColumnRendered),this.select("columnSelector").each(function(e,t){var n=$(t);i.attachTo(n)})})};return e(o,t,n,r)}),define("ui/grid",["flight/component","ui/with_focus","ui/with_column_selectors"],function(e,t,n){var r=function(){this.defaultAttrs({id:"grid",chirpScrollOffset:20,columnScrollOffset:20,isSelectedClass:"is-selected-tweet",chirpSelector:".js-stream-item",autoFocus:!0,pagingEasingFunction:"easeOutQuad"}),this.setSelectedColumn=function(e){var t=this.columns.length;e<0?e=0:e>=t&&(e=t-1),this.columns[e]!==this.selectedColumn&&(clearTimeout(this.chirpCenterTimeout),this.chirpCenter=this.calculateChirpCenterRelativeToColumn(this.selectedColumn,this.$selectedChirp),this.chirpCenterTimeout=setTimeout(function(){this.chirpCenter=null}.bind(this),1e3),this.selectedColumn=this.columns[e],this.columnIndex=e,this.chirpCenter===null?this.selectFirstChirpInSelectedColumn():this.selectClosestChirpToOffsetCenter(this.selectedColumn,this.chirpCenter,!0))},this.selectClosestChirpToOffsetCenter=function(e,t,n){var r=this.selectedColumn.model.getKey(),i=this.getColumnScrollContainerByKey(r),s=i.innerHeight(),o=i.find(this.attr.chirpSelector),u=$(),a=null,f=Number.MAX_VALUE;o.each(function(){var e=$(this),n=e.position().top,r=n+e.outerHeight();r>=0&&n<=s&&n<=t&&r>=t&&(u=$().add(e))}),u.length===0?a=o.last():u.length===1?a=u:u.each(function(n,r){var i=this.calculateChirpCenterRelativeToColumn(e,$(r)),s=Math.abs(t-i);f=Math.min(s,f),s===f&&(a=$(r))}.bind(this)),this.setSelectedChirp(a,n)},this.calculateChirpCenterRelativeToColumn=function(e,t){if(t.length===0||this.chirpCenter!==null)return this.chirpCenter;var n,r,i,s=e.model.getKey(),o=this.getColumnScrollContainerByKey(s).innerHeight();return n=t.position().top,r=t.outerHeight(),i=n+r/2,i>o?i=o:i<0&&(i=0),i},this.selectFirstChirpInSelectedColumn=function(){var e;if(this.isInDetailView())this.$selectedChirp=this.selectedColumn.detailViewComponent.getMostInteresting$Chirp();else if(!this.isInDetailViewLevel2()){e=this.selectedColumn.model.getKey();var t=this.getColumnElementByKey(e).find(this.attr.chirpSelector);this.$selectedChirp.removeClass(this.attr.isSelectedClass),this.$selectedChirp=$(),t.each(function(e,t){var n=$(t);if(n.position().top+n.outerHeight()/2>0)return this.$selectedChirp=n,!1}.bind(this)),this.$selectedChirp.length===0&&(this.$selectedChirp=t.first())}this.$selectedChirp.addClass(this.attr.isSelectedClass),this.scrollToChirp("up")},this.setSelectedChirp=function(e,t){this.$selectedChirp.length>0&&this.$selectedChirp.removeClass(this.attr.isSelectedClass),this.$selectedChirp=e,this.$selectedChirp.addClass(this.attr.isSelectedClass),t&&this.$selectedChirp.length>0&&this.scrollToChirp(this.scrollDirection)},this.selectPrevChirp=function(){var e,t,n;this.chirpCenter=null,this.isInDetailView()?(t=this.selectedColumn.detailViewComponent.$find(this.attr.chirpSelector),n=t.index(this.$selectedChirp),e=t.eq(Math.max(0,n-1))):e=this.$selectedChirp.prev(this.attr.chirpSelector),e.length===0?this.selectFirstChirpInSelectedColumn():this.setSelectedChirp(e,!0)},this.selectNextChirp=function(){var e,t,n;this.chirpCenter=null,this.isInDetailView()?(t=this.selectedColumn.detailViewComponent.$find(this.attr.chirpSelector),n=t.index(this.$selectedChirp),e=t.eq(Math.min(t.length-1,n+1))):this.$selectedChirp.next(this.attr.chirpSelector).length>0?e=this.$selectedChirp.next(this.attr.chirpSelector):e=this.$selectedChirp,e.length===0?this.selectFirstChirpInSelectedColumn():this.setSelectedChirp(e,!0)},this.moveSelection=function(e){var t=function(){var t;if(this.hasFocus)if(this.selectedColumn===null)this.setSelectedColumn(0);else{this.scrollDirection=e;switch(e){case"left":t=this.columnIndex===null?0:this.columnIndex-1,this.setSelectedColumn(t);break;case"right":t=this.columnIndex===null?0:this.columnIndex+1,this.setSelectedColumn(t);break;case"up":this.selectPrevChirp();break;case"down":this.selectNextChirp();break;default:}this.trigger("uiColumnsScrollToColumn",{column:this.selectedColumn,source:this.attr.id,offset:this.attr.columnScrollOffset,direction:this.scrollDirection})}},n=_.throttle(t.bind(this),100);return n},this.handleColumnOrderData=function(e,t){t.columns&&(this.columns=t.columns,this.columnIndex=null,this.selectedColumn&&this.columns.forEach(function(e,t){this.selectedColumn===e&&(this.columnIndex=t)}.bind(this)),this.columnIndex===null&&(this.selectedColumn=null,this.$selectedChirp=$(),this.offset=null))},this.selectColumnByKey=function(e){for(var t=0;t<this.columns.length;t++)if(this.columns[t].model.getKey()===e)return this.columnIndex=t,this.selectedColumn=this.columns[t],!0;return!1},this.selectColumnByIndex=function(e){return this.selectedColumn!==this.columns[e]?(this.columnIndex=e,this.selectedColumn=this.columns[e],!0):!1},this.selectLastColumn=function(){return this.selectColumnByIndex(this.columns.length-1)},this.handleColumnFocus=function(e,t){var n=!1;this.$selectedChirp.removeClass(this.attr.isSelectedClass),t.key!==undefined?n=this.selectColumnByKey(t.key):t.index!==undefined?n=this.selectColumnByIndex(t.index):t.last===!0&&(n=this.selectLastColumn()),n?(this.$selectedChirp=$(),this.chirpIndex=null,this.offset=null):this.$selectedChirp.addClass(this.attr.isSelectedClass)},this.clearSelection=function(){this.$selectedChirp.removeClass(this.attr.isSelectedClass),this.$selectedChirp=$(),this.selectedColumn=null,this.chirpIndex=null,this.columnIndex=null,this.offset=null},this.scrollToChirp=function(e){this.trigger("uiColumnsScrollToChirp",{columnKey:this.selectedColumn.model.getKey(),$chirp:this.$selectedChirp,direction:e,offset:this.attr.chirpScrollOffset})},this.handleBack=function(){var e,t,n,r;this.hasFocus&&(r=this.getColumnElementByKey(this.selectedColumn.model.getKey()),this.isInDetailView()?(e=this.selectedColumn.detailViewComponent.parentChirp,n=this.selectedColumn.getChirpContainer(),t=n.find('[data-key="'+e.id+'"]'),r.trigger("uiCloseDetailView"),t.addClass(this.attr.isSelectedClass),this.$selectedChirp=t,this.scrollToChirp("down")):this.isInDetailViewLevel2()&&r.trigger("uiCloseSocialProof"))},this.handleClearSelection=function(){this.hasFocus&&this.clearSelection()},this.isInDetailView=function(){var e=this.getColumnElementByKey(this.selectedColumn.model.getKey());return e.hasClass(this.attr.columnStateDetailViewClass)},this.isInDetailViewLevel2=function(){var e=this.getColumnElementByKey(this.selectedColumn.model.getKey());return e.hasClass(this.attr.columnStateSocialProofClass)},this.tweetActionFactory=function(e){return function(){var t,n,r,i;if(this.hasFocus&&this.$selectedChirp.length>0&&!this.isInDetailViewLevel2()){n=this.$selectedChirp.attr("data-key"),t=this.selectedColumn.findMostInterestingChirp(n);if(!t)return;switch(e){case"profile":t.getMainUser?r=t.getMainUser():t.getRelatedUser&&(r=t.getRelatedUser()),r&&this.trigger("uiShowProfile",{id:r.screenName});break;case"viewDetails":if(t instanceof TD.services.TwitterDirectMessage)return;default:if(t instanceof TD.services.TwitterAction)return;e==="reply"&&(t instanceof TD.services.TwitterDirectMessage||t instanceof TD.services.TwitterMessageThread)?i="dm":i=e,this.parentChirp=this.selectedColumn.findChirp(n),$.publish("chirp/action",[i,t,this.parentChirp,this.selectedColumn])}}else switch(e){case"dm":this.trigger("uiShowMessageCompose")}}.bind(this)},this.handleDetailViewActive=function(e,t){var n=t.$chirp.closest(this.attr.columnSelector);this.selectColumnByKey(n.attr("data-column")),this.$selectedChirp.removeClass(this.attr.isSelectedClass),this.$selectedChirp=t.$chirp,this.parentChirp===t.parentChirp&&this.$selectedChirp.addClass(this.attr.isSelectedClass)},this.handleDetailClosed=function(e,t){var n;t&&t.column&&(n=t.column.model.getKey(),this.$selectedChirp.removeClass(this.attr.isSelectedClass),this.selectColumnByKey(n),this.$selectedChirp=$())},this.handlePagingFactory=function(e){var t=function(){if(this.hasFocus&&this.selectedColumn){var t,n=this.selectedColumn.model.getKey(),r=this.getColumnScrollContainerByKey(n),i=r.scrollTop(),s=r.innerHeight(),o,u,a,f,l,c;this.$selectedChirp.length===0&&this.selectFirstChirpInSelectedColumn(),this.chirpOffsetTop!==null?t=this.chirpOffsetTop:(t=this.$selectedChirp.position().top,this.targetChirpOffsetTop=null),this.chirpOffsetTop=t,this.$selectedChirp.removeClass(this.attr.isSelectedClass);if(e==="down"){this.targetChirpOffsetTop=this.targetChirpOffsetTop===null?t+s:this.targetChirpOffsetTop+s;do l=this.$selectedChirp.next(this.attr.chirpSelector),l.length>0&&(this.$selectedChirp=l);while(l.length>0&&l.position().top<this.targetChirpOffsetTop);o=i+(this.$selectedChirp.position().top-t),o+s+50>r.get(0).scrollHeight&&(o+=50),u=o-i}else{this.targetChirpOffsetTop=this.targetChirpOffsetTop===null?t-s:this.targetChirpOffsetTop-s;do f=this.$selectedChirp.prev(this.attr.chirpSelector),f.length>0&&(this.$selectedChirp=f);while(f.length>0&&f.position().top>this.targetChirpOffsetTop);o=i-(t+Math.abs(this.$selectedChirp.position().top)),u=i-o}this.$selectedChirp.addClass(this.attr.isSelectedClass),c=function(){this.chirpOffsetTop=null,this.targetChirpOffsetTop=null}.bind(this),a=TD.ui.columns.calculateScrollDuration(u,50,750),r.stop().animate({scrollTop:o},a,this.attr.pagingEasingFunction,c)}};return t.bind(this)},this.handleGridHome=function(){if(!this.hasFocus||!this.selectedColumn)return;this.chirpOffsetTop=null,this.targetChirpOffsetTop=null;var e=this.selectedColumn.model.getKey(),t=this.getColumnScrollContainerByKey(e),n=t.scrollTop(),r=TD.ui.columns.calculateScrollDuration(n,20,300);this.$selectedChirp.removeClass(this.attr.isSelectedClass),this.$selectedChirp=this.$selectedChirp.parent().find(".js-stream-item:first"),this.$selectedChirp.addClass(this.attr.isSelectedClass),t.stop().animate({scrollTop:0},r,this.attr.pagingEasingFunction)},this.handleGridEnd=function(){if(!this.hasFocus||!this.selectedColumn)return;this.chirpOffsetTop=null,this.targetChirpOffsetTop=null;var e=this.selectedColumn.model.getKey(),t=this.getColumnScrollContainerByKey(e),n=t.scrollTop(),r=t.get(0).scrollHeight-t.innerHeight()+50,i=r-n,s=TD.ui.columns.calculateScrollDuration(i,20,300);this.$selectedChirp.removeClass(this.attr.isSelectedClass),this.$selectedChirp=this.$selectedChirp.parent().find(".js-stream-item:last"),this.$selectedChirp.addClass(this.attr.isSelectedClass),t.stop().animate({scrollTop:r},s,this.attr.pagingEasingFunction)},this.after("initialize",function(){this.selectedColumn=null,this.$selectedChirp=$(),this.columnIndex=null,this.chirpCenter=null,this.scrollDirection=this.attr.down,this.chirpOffsetTop=null,this.on(document,"uiGridLeft",this.moveSelection("left")),this.on(document,"uiGridUp",this.moveSelection("up")),this.on(document,"uiGridRight",this.moveSelection("right")),this.on(document,"uiGridDown",this.moveSelection("down")),this.on(document,"uiGridBack",this.handleBack),this.on(document,"uiGridClearSelection",this.handleClearSelection),this.on(document,"uiColumnFocus",this.handleColumnFocus),this.on(document,"uiGridPageDown",this.handlePagingFactory("down")),this.on(document,"uiGridPageUp",this.handlePagingFactory("up")),this.on(document,"uiGridHome",this.handleGridHome),this.on(document,"uiGridEnd",this.handleGridEnd),this.on(document,"uiGridShowDetail",this.tweetActionFactory("viewDetails")),this.on(document,"uiGridReply",this.tweetActionFactory("reply")),this.on(document,"uiGridFavorite",this.tweetActionFactory("favorite")),this.on(document,"uiGridRetweet",this.tweetActionFactory("retweet")),this.on(document,"uiGridDirectMessage",this.tweetActionFactory("dm")),this.on(document,"uiGridProfile",this.tweetActionFactory("profile")),this.on(document,"uiDetailViewActive",this.handleDetailViewActive),this.on(document,"uiShowSocialProof",this.handleDetailViewActive),this.on(document,"uiDetailViewClosed",this.handleDetailClosed),this.on(document,"dataColumnOrder",this.handleColumnOrderData),this.trigger("uiNeedsColumnOrder",{source:this.attr.id})})};return e(r,t,n)}),define("ui/focus_controller",["flight/component"],function(e){var t=function(){this.handleFocusRequest=function(e,t){t&&t.id!==undefined&&this.focusHistory[this.focusHistory.length-1]!==t.id&&(this.focusHistory.push(t.id),this.trigger("uiFocus",{id:t.id}))},this.handleFocusRelease=function(e,t){t&&t.id!==undefined&&(this.focusHistory[this.focusHistory.length-1]===t.id?(this.focusHistory=this.focusHistory.filter(function(e){return e!==t.id}),this.focusHistory.length>0&&_.defer(function(){this.trigger("uiFocus",{id:this.focusHistory[this.focusHistory.length-1]})}.bind(this))):this.focusHistory=this.focusHistory.filter(function(e){return e!==t.id}))},this.after("initialize",function(){this.focusHistory=[],this.on(document,"uiFocusRequest",this.handleFocusRequest),this.on(document,"uiFocusRelease",this.handleFocusRelease)})};return e(t)}),define("ui/confirmation_dialog_controller",["flight/component"],function(e){var t=function(){this.showConfirmationDialog=function(e,t){this.trigger(document,"uiConfirmationAction",{id:t.id,result:confirm(t.message)?!0:!1})},this.after("initialize",function(e){this.on(document,"uiShowConfirmationDialog",this.showConfirmationDialog)})};return e(t)}),define("ui/with_modal",["util/notifications","flight/compose","ui/with_focus"],function(e,t,n){function r(){t.mixin(this,[n]),this.defaultAttrs({dismissButton:".js-dismiss",modalPanel:".js-modal-panel",modalDragHandle:".mdl-drag-handle",isDraggingClass:"is-dragging",autoFocus:!0}),this.handleDragStart=function(){var e=this.select("modalPanel");e.css({position:"absolute",top:e.offset().top,left:e.offset().left}),this.$node.addClass(this.attr.isDraggingClass)},this.getDragDropBoundary=function(){return this.$node},this.before("initialize",function(){this.trigger("uiCloseModal")}),this.dismiss=function(){this.attr.closeEvent&&this.trigger(this.attr.closeEvent)},this.handleClickOnOverlay=function(e){e.target===this.$node.get(0)&&this.dismiss()},this.after("teardown",function(){this.$node.hide()}),this.after("initialize",function(){this.on(this.$node,"click",this.handleClickOnOverlay),this.on("click",{dismissButton:this.dismiss}),this.on(document,"uiCloseModal",this.dismiss)}),this.after("render",function(){this.select("modalPanel").draggable({boundary:this.getDragDropBoundary.bind(this),handle:this.select("modalDragHandle")}),this.on("start.draggable",this.handleDragStart),this.focusRequest()}),this.before("teardown",function(){this.$node.removeClass(this.attr.isDraggingClass)})}return r}),define("ui/embed_tweet",["flight/component","ui/with_template","ui/with_modal"],function(e,t,n){function r(){this.defaultAttrs({embedDataCache:{},includeParentTweet:!0,includeMedia:!0,closeEvent:"uiCloseEmbedTweet",dataEmbeddedTweetEvent:"dataEmbeddedTweet",dataEmbeddedTweetErrorEvent:"dataEmbeddedTweetError",embedTextArea:".js-embed-textarea",embedIncludeParentCheckBox:".js-embed-include-parent",embedIncludeMediaCheckBox:".js-embed-include-media",modalTitle:".js-header-title",embedIframe:".js-embed-iframe",embedIframeContainer:".js-embed-iframe-container",embedModalPanel:".js-modal-panel",embedModalHeader:".js-mdl-header",embedModalContent:".js-mdl-content",embedLoading:".js-embed-loading-container"}),this.handleEmbeddedTweet=function(e,t){var n,r,i,s,o,u,a,f;if(t&&t.html&&t.request&&t.request.tweetID===this.attr.tweet.id&&t.request.hideThread!==this.includeParentTweet&&t.request.hideMedia!==this.includeMedia){this.putEmbedDataInCache(t),f=function(e){var f;this.render("embed_tweet",{html:t.html,isReply:!!e.inReplyToID,includeParentTweet:this.includeParentTweet,hasMedia:!!e.cards,includeMedia:this.includeMedia}),this.select("modalTitle").text(TD.i("Embed this Tweet")),this.on(this.select("embedTextArea"),"focus",this.handleInputBoxFocus),r=this.select("embedIframe"),i=this.select("embedIframeContainer"),s=this.select("embedModalPanel"),o=this.select("embedModalHeader"),u=this.select("embedModalContent"),a=this.select("embedLoading"),f=function(){i.css("height","auto"),r.height(Math.max($("html",n).outerHeight(),$("body",n).outerHeight(),r.height())),s.height(u.height()+o.outerHeight()),$("a",n).attr("target","_blank")}.bind(this),r.load(function(){a.addClass("is-hidden"),f(),this.resizeIframeIntervalId=setInterval(f,500)}.bind(this)),r[0]&&(n=r[0].contentWindow.document,n.open(),n.write('<!DOCTYPE html><head><base href="https://api.tweetdeck.com"></head><body>'+t.html+"</body>"+"</html>"),n.close())};if(!this.attr.tweet.cards&&this.attr.tweet.hasLink()){var l=TD.controller.clients.getClient(this.attr.tweet.account.getKey());l.show(this.attr.tweet.id,f.bind(this),function(){this.trigger(document,this.attr.dataEmbeddedTweetErrorEvent,t)}.bind(this))}else f.call(this,this.attr.tweet)}},this.handleEmbeddedTweetError=function(e,t){t&&t.request&&t.request.tweetID===this.attr.tweet.id&&(this.teardown(e),TD.controller.progressIndicator.addMessage(TD.i("Sorry, couldn't retrieve embedded Tweet. Please try again later.")))},this.handleInputBoxFocus=function(e){var t=this.select("embedTextArea");_.defer(function(){t.select()})},this.handleEmbeddedTweetOptionsChange=function(e){var t;this.includeParentTweet=$(this.attr.embedIncludeParentCheckBox).prop("checked"),this.includeMedia=$(this.attr.embedIncludeMediaCheckBox).prop("checked"),this.render("embed_tweet",{loading:!0}),t=this.getEmbedDataFromCache(),t?this.trigger(document,"dataEmbeddedTweet",t):this.trigger(document,"uiNeedsEmbeddedTweet",{tweetID:this.attr.tweet.id,hideThread:!this.includeParentTweet,hideMedia:!this.includeMedia})},this.getEmbedDataFromCache=function(){var e=!!this.includeParentTweet,t=!!this.includeMedia,n=this.attr.embedDataCache[e+":"+t];if(n&&n.request.tweetID===this.attr.tweet.id)return n},this.putEmbedDataInCache=function(e){var t=!!this.includeParentTweet,n=!!this.includeMedia;this.attr.embedDataCache[t+":"+n]=e},this.after("teardown",function(){clearInterval(this.resizeIframeIntervalId),this.$node.html("")}),this.after("initialize",function(e){this.includeParentTweet=this.attr.includeParentTweet,this.includeMedia=this.attr.includeMedia,this.render("embed_tweet",{loading:!0}),this.trigger(document,"uiNeedsEmbeddedTweet",{tweetID:this.attr.tweet.id,hideThread:!this.includeParentTweet,hideMedia:!this.includeMedia}),this.on(this.attr.closeEvent,this.teardown),this.on("change",{embedIncludeParentCheckBox:this.handleEmbeddedTweetOptionsChange,embedIncludeMediaCheckBox:this.handleEmbeddedTweetOptionsChange}),this.on(document,this.attr.dataEmbeddedTweetEvent,this.handleEmbeddedTweet),this.on(document,this.attr.dataEmbeddedTweetErrorEvent,this.handleEmbeddedTweetError)})}return e(r,t,n)}),define("ui/keyboard_shortcut_list",["flight/component","ui/with_template","ui/with_modal"],function(e,t,n){function r(){this.defaultAttrs({closeEvent:"uiCloseKeyboardShortcutsList",modalTitle:".js-header-title"}),this.after("teardown",function(){this.$node.html("")}),this.after("initialize",function(e){this.render("keyboard_shortcut_list",{isMac:TD.util.getOSName()==="osx"}),this.select("modalTitle").text(TD.i("Keyboard shortcuts")),this.on(this.attr.closeEvent,this.teardown)})}return e(r,t,n)}),define("ui/with_column_config",[],function(){var e=function(){this.before("initialize",function(){this.columnConfig={DISPLAY_ORDER_PROFILE:TD.controller.columnManager.DISPLAY_ORDER_PROFILE,OPEN_COLUMN_URL_BASE:TD.components.OpenColumnHome.URL_BASE,GO_EVENT:TD.components.OpenColumn.GO_EVENT}})};return e}),define("ui/relationship",["flight/component"],function(e){var t=function(){this.defaultAttrs({states:{unknown:"unknown",following:"following",notFollowing:"notFollowing",blocking:"blocking",me:"me"},classNamesForStates:{unknown:"unknown",following:"s-following",notFollowing:"s-not-following",blocking:"s-blocking",me:"s-thats-you"},followButton:".js-follow-button",menuButton:".js-profile-menu"}),this.resetState=function(){this.$node.removeClass(this.attr.classNamesForStates[this.state])},this.setState=function(e,t){e.following?this.state=this.attr.states.following:this.state=this.attr.states.notFollowing,e.id===t.id&&(this.state=this.attr.states.me),e.blocking&&(this.state=this.attr.states.blocking)},this.handleMenuButtonClick=function(e){this.menu?this.menu.destroy():(this.menu=new TD.components.ProfileMenu(this.select("menuButton"),this.twitterUser),this.menu.setPosition(TD.components.DropDown.POSITION_LEFT),e.stopPropagation())},this.handleFollowButtonClick=function(e){var t={account:this.account,twitterUser:this.twitterUser};switch(this.state){case this.attr.states.following:this.trigger("uiUnfollowAction",t);break;case this.attr.states.notFollowing:this.trigger("uiFollowAction",t);break;case this.attr.states.blocking:this.trigger("uiUnblockAction",t);break;case this.attr.states.me:TD.util.openURL("https://twitter.com/settings/profile");break;case this.attr.states.unknown:break;default:}e.stopPropagation()},this.enableButton=function(){this.select("followButton").attr("disabled",!1)},this.setTargetElementState=function(){this.$node.addClass(this.attr.classNamesForStates[this.state])},this.isRelevantRelationship=function(e){return this.account.isSameUser(e.source.screen_name)&&this.twitterUser.isSameUser(e.target.screen_name)},this.handleRelationshipData=function(e,t){t&&t.relationship&&this.isRelevantRelationship(t.relationship)&&(this.resetState(),this.setState(t.relationship.source,t.relationship.target),this.state!==this.attr.states.unknown&&this.enableButton(),this.setTargetElementState())},this.isRelevantAction=function(e){return e&&e.twitterUser&&e.twitterUser.isSameUser(this.twitterUser)&&e.account===this.account},this.handleActionFactory=function(e){var t=function(t,n){this.isRelevantAction(n)&&(this.resetState(),this.state=this.attr.states[e],this.setTargetElementState())};return t.bind(this)},this.handlePubSubEvent=function(e){var t=function(t,n){n.getAccountKey()===this.account.getAccountKey()&&(this.resetState(),this.state=this.attr.states[e],this.setTargetElementState())};return t.bind(this)},this.destroy=function(e){e.stopPropagation(),this.teardown()},this.destroyMenuReference=function(){this.menu=null},this.after("initialize",function(e){this.account=e.account,this.twitterUser=e.twitterUser,this.state=this.attr.states.unknown,this.on(document,"dataRelationship",this.handleRelationshipData),this.on("click",{followButton:this.handleFollowButtonClick,menuButton:this.handleMenuButtonClick}),this.on("td-dropdown-close",this.destroyMenuReference),this.on(document,"uiFollowAction dataUnfollowActionError",this.handleActionFactory("following")),this.on(document,"uiUnfollowAction dataFollowActionError",this.handleActionFactory("notFollowing")),this.on(document,"uiBlockAction dataUnblockActionError",this.handleActionFactory("blocking")),this.on(document,"uiUnblockAction dataBlockActionError dataReportActionError",this.handleActionFactory("notFollowing")),this.on(document,"uiReportAction",this.handleActionFactory("blocking")),$.subscribe("/user/"+this.screenName+"/block",this.handlePubSubEvent("blocking")),$.subscribe("/user/"+this.screenName+"/unblock",this.handlePubSubEvent("notFollowing")),this.attr.closeEvent&&this.on(this.attr.closeEvent,this.destroy),this.trigger("uiNeedsRelationship",{account:this.account,screenName:this.twitterUser.screenName})})};return e(t)}),define("ui/follow_state",["flight/component"],function(e){var t=function(){this.defaultAttrs({follows:"s-follows"}),this.handleRelationshipData=function(e,t){t&&t.relationship&&this.account.isSameUser(t.relationship.source.screen_name)&&this.twitterUser.isSameUser(t.relationship.target.screen_name)&&this.$node.toggleClass(this.attr.follows,t.relationship.target.following)},this.destroy=function(e){e.stopPropagation(),this.teardown()},this.after("initialize",function(e){if(!(e.account instanceof TD.storage.Account))throw"source must be instance of TD.storage.Account";if(!(e.twitterUser instanceof TD.services.TwitterUser))throw"target must be instance of TD.services.TwitterUser";this.account=e.account,this.twitterUser=e.twitterUser,this.on(document,"dataRelationship",this.handleRelationshipData),this.attr.closeEvent&&this.on(this.attr.closeEvent,this.destroy),this.trigger("uiNeedsRelationship",{account:this.account,screenName:this.twitterUser.screenName})})};return e(t)}),define("ui/twitter_profile",["flight/component","ui/with_template","ui/with_modal","ui/with_column_config","ui/relationship","util/notifications","ui/follow_state","ui/with_transitions"],function(e,t,n,r,i,s,o,u){function a(){this.defaultAttrs({dataAction:"[data-action]",socialProofSelector:".js-social-proof",followFromSelector:".js-action-follow",followStateSelector:".prf-follow-status",closeEvent:"uiCloseTwitterProfile",numUsersInSocialProof:3,isSocialProofAnimatingClass:"social-proof-animating"}),this.handleTwitterAccount=function(e,t){if(t&&t.account&&t.screenName&&t.screenName.toLowerCase()===this.screenName.toLowerCase()){this.twitterUser=t,this.render("twitter_profile",{twitterProfile:{preferredAccount:this.account.getUsername(),profile:this.twitterUser,displayOrderProfile:this.columnConfig.DISPLAY_ORDER_PROFILE,account:this.account,showAccountMenu:!0,hideFromAccountName:!0,isSingleAccount:this.isSingleAccount}}),this.on(this.attr.dataAction,"click",this.handleActionClick),this.twitterUser.isMe()||this.trigger(document,"uiNeedsUserProfileSocialProof",{screenName:this.screenName});var n={account:this.account,twitterUser:this.twitterUser,closeEvent:this.attr.closeEvent};i.attachTo(this.select("followFromSelector"),n),o.attachTo(this.select("followStateSelector"),n)}},this.handleTwitterUserError=function(e,t){t.screenName.toLowerCase()===this.screenName.toLowerCase()&&this.teardown()},this.handleSocialProofData=function(e,t){var n=this.select("socialProofSelector"),r=this.select("modalPanel"),i=[],s=0,o=[],u,a,f,l;if(t.users&&t.users.length){if(t.users.length>this.attr.numUsersInSocialProof){s=t.users.length-this.attr.numUsersInSocialProof;while(i.length<this.attr.numUsersInSocialProof)l=Math.floor(Math.random()*t.users.length),i.push(t.users.splice(l,1)[0])}else i=t.users;i.forEach(function(e){o.push(TD.ui.template.render("text/social_proof_link",e))}),s>0&&o.push(TD.ui.template.render("text/followers_you_follow_link",{screenName:this.screenName})),o.length>1&&(a=o.splice(o.length-1,1)),u=o.join(", "),f=r.position(),r.css("position","absolute").css("left",f.left).css("top",f.top),n.removeClass("is-hidden"),n.html(TD.ui.template.render("twitter_profile_social_proof",{followedByString:u,others:a})),this.transitionExpand(n,this.attr.isSocialProofAnimatingClass)}},this.handleActionClick=function(e){var t=$(e.currentTarget),n=t.data("action"),r=t.data("type"),i=this.columnConfig.OPEN_COLUMN_URL_BASE+"/"+r,o=TD.util.maybeOpenClickExternally(e);o||(this.screenName&&(i+="?screenName="+this.screenName),s.publishToQueue(this.columnConfig.GO_EVENT,{data:i,history:{type:"uiShowProfile",target:document,data:{id:this.screenName}}}),e.preventDefault(),e.stopPropagation())},this.destroy=function(e){e.stopPropagation(),this.teardown()},this.before("teardown",function(){this.trigger(this.select("followStateSelector"),this.attr.closeEvent),this.trigger(this.select("followFromSelector"),this.attr.closeEvent)}),this.after("teardown",function(){this.$node.html("")}),this.handleAccountsForService=function(e,t){this.isSingleAccount=t.accounts.length===1},this.after("initialize",function(e){this.screenName=e.screenName,this.account=e.account,this.screenName.indexOf("@")===0&&(this.screenName=this.screenName.substring(1)),this.on(document,"dataAccountsForService",this.handleAccountsForService),this.trigger(document,"uiNeedsAccountsForService",{service:"twitter"}),this.on(document,"dataTwitterUser",this.handleTwitterAccount),this.on(document,"dataTwitterUserError",this.handleTwitterUserError),this.on(document,"dataUserProfileSocialProof",this.handleSocialProofData),this.render("twitter_profile",{loading:!0}),this.trigger(document,"uiNeedsTwitterUser",{screenName:this.screenName}),this.on(this.attr.closeEvent,this.destroy)})}return e(a,t,n,r,u)}),define("ui/with_dialog_manager",["ui/embed_tweet","ui/keyboard_shortcut_list","ui/twitter_profile"],function(e,t,n){var r=function(){this.showProfile=function(e,t){n.attachTo(this.select("modal"),{screenName:t.id,account:this.preferredAccount}),this.select("modal").show()},this.showCompose=function(e){TD.ui.compose.showComposeWindow()},this.showMessageCompose=function(e){TD.ui.compose.directMessage()},this.showAddColumn=function(e){TD.ui.openColumn.showOpenColumn()},this.showEmbedTweet=function(t,n){e.attachTo(this.select("modal"),{tweet:n.tweet}),this.select("modal").show()},this.showKeyboardShortcutList=function(e,n){t.attachTo(this.select("modal")),this.select("modal").show()},this.after("initialize",function(){this.on("uiShowProfile",this.showProfile),this.on("uiShowCompose",this.showCompose),this.on("uiShowMessageCompose",this.showMessageCompose),this.on("uiShowAddColumn",this.showAddColumn),this.on("uiShowEmbedTweet",this.showEmbedTweet),this.on("uiShowKeyboardShortcutList",this.showKeyboardShortcutList)})};return r}),define("tracking/column_options_scribe",["flight/component"],function(e){var t=function(){this.trackClear=function(){TD.controller.stats.columnActionClick("clear")},this.trackMoveColumn=function(e,t){TD.controller.stats.columnActionClick(t.action)},this.trackEmbedTimeline=function(e,t){TD.controller.stats.columnActionClick("embed",{type:t.column.getColumnType()})},this.after("initialize",function(){this.on(document,"uiClearColumnAction",this.trackClear),this.on(document,"uiMoveColumnAction",this.trackMoveColumn),this.on(document,"uiEmbedTimelineAction",this.trackEmbedTimeline)})};return e(t)}),define("tracking/message_banner_scribe",["flight/component"],function(e){var t=function(){this.trackImpression=function(e,t){TD.controller.stats.messageBannerImpression(t.id)},this.trackDismiss=function(e,t){TD.controller.stats.messageBannerDismiss(t.id)},this.trackAction=function(e,t){TD.controller.stats.messageBannerClick(t.messageId,t.actionId)},this.after("initialize",function(){this.on(document,"uiShowMessageBanner",this.trackImpression),this.on(document,"uiDismissMessageAction",this.trackDismiss),this.on(document,"uiClickMessageButtonAction",this.trackAction)})};return e(t)}),define("tracking/embed_tweet_dialog_scribe",["flight/component"],function(e){var t=function(){this.trackOpen=function(e,t){TD.controller.stats.embedTweetDialogOpen(t.tweet.id)},this.after("initialize",function(){this.on(document,"uiShowEmbedTweet",this.trackOpen)})};return e(t)}),define("tracking/typeahead_scribe",["flight/component"],function(e){var t=function(){this.trackInvocation=function(){TD.controller.stats.typeaheadInvoked()},this.trackSelection=function(e,t){var n=t.input.length;TD.controller.stats.typeaheadItemSelected(n,t.searchType,t.index)},this.after("initialize",function(){this.on(document,"uiTypeaheadDropdownInvoked",this.trackInvocation),this.on(document,"uiTypeaheadItemSelected",this.trackSelection)})};return e(t)}),define("tracking/social_proof_for_tweet_scribe",["flight/component"],function(e){var t=function(){this.trackViews=function(e,t){TD.controller.stats.viewedTweetSocialProof(t.type)},this.after("initialize",function(){this.on(document,"uiShowSocialProof",this.trackViews)})};return e(t)}),define("page/default",["flight/component","data/accounts","data/column_manager","data/embed_timeline","data/embed_tweet","data/message_banner","data/preferred_account","data/relationship","data/twitter_user","data/user_actions","data/theme_switch","data/stream_counter","data/search","data/storage","data/recent_searches","data/typeahead","data/user_profile_social_proof","data/twitter_users","ui/keyboard_shortcuts","ui/message_banner","ui/search_input","ui/with_theme","ui/column_controller","ui/grid","ui/focus_controller","ui/confirmation_dialog_controller","ui/with_dialog_manager","tracking/column_options_scribe","tracking/message_banner_scribe","tracking/embed_tweet_dialog_scribe","tracking/typeahead_scribe","tracking/social_proof_for_tweet_scribe"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M){function _(){this.defaultAttrs({modal:"#open-modal",message:".message-banner",appHeader:".js-app-header",searchResults:".js-search-form",container:"#container"}),this.showMessageBanner=function(){var e=this.select("message");this.select("container").animate({top:parseInt(this.select("container").css("top"),10)+e.outerHeight()})},this.hideMessageBanner=function(){var e=this.select("message");this.select("container").animate({top:parseInt(this.select("container").css("top"),10)-e.outerHeight()})},this.handlePreferredAccount=function(e,t){t&&t.account&&(this.preferredAccount=t.account)},this.initUI=function(){T.attachTo(this.$node),b.attachTo(this.select("message")),w.attachTo(".js-search-form"),S.attachTo(this.$node),x.attachTo(this.$node)},this.after("initialize",function(){p.attachTo(this.$node),d.attachTo(this.$node),l.attachTo(this.$node),t.attachTo(this.$node),n.attachTo(this.$node),s.attachTo(this.$node),o.attachTo(this.$node),u.attachTo(this.$node),a.attachTo(this.$node),f.attachTo(this.$node),c.attachTo(this.$node),i.attachTo(this.$node),r.attachTo(this.$node),h.attachTo(this.$node),v.attachTo(this.$node),m.attachTo(this.$node),g.attachTo(this.$node),N.attachTo(this.$node),k.attachTo(this.$node),L.attachTo(this.$node),A.attachTo(this.$node),O.attachTo(this.$node),M.attachTo(this.$node),y.attachTo(this.$node),this.on(document,"TD.ready",this.initUI),this.trigger(document,"uiNeedsPreferredAccount"),this.on(document,"dataPreferredAccount",this.handlePreferredAccount),this.on(document,"uiShowingMessageBanner",this.showMessageBanner),this.on(document,"uiHidingMessageBanner",this.hideMessageBanner)})}return e(_,E,C)}),requirejs.config({baseUrl:"/web/scripts/swift",paths:{flight:"lib/flight/lib",data:"app/data",ui:"app/ui",page:"app/page",util:"app/util",tracking:"app/tracking",td:"../"}}),require(["page/default"],function(e){e.attachTo(document)}),define("app/main",function(){})